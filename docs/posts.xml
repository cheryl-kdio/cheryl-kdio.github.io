<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Cheryl Kouadio</title>
<link>https://cheryl-kdio.github.io/posts.html</link>
<atom:link href="https://cheryl-kdio.github.io/posts.xml" rel="self" type="application/rss+xml"/>
<description>Cheryl Kouadio is a graduate student in stochastic modeling and quantitative finance at Universit√© Paris Cit√©. Her academic interests focus on probability theory, stochastic processes, data analysis, and financial risk modeling. She studies how rigorous statistical and mathematical methods can be applied to quantify uncertainty and support decision-making in finance and risk management.</description>
<image>
<url>https://cheryl-kdio.github.io/files/profile/kouadio_profile.jpeg</url>
<title>Cheryl Kouadio</title>
<link>https://cheryl-kdio.github.io/posts.html</link>
</image>
<generator>quarto-1.6.40</generator>
<lastBuildDate>Tue, 10 Feb 2026 23:00:00 GMT</lastBuildDate>
<item>
  <title>Model free pricing results</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/m2mo/derivatives/02_model_free(1).html</link>
  <description><![CDATA[ 




<!-- 
AddToAny check more: https://www.addtoany.com/buttons/for/website 
Using includes will make edits easier, will only need to add or remove button here if needed.
https://quarto.org/docs/authoring/includes.html
-->
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<p><a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_bluesky"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_whatsapp"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_copy_link"></a> <a class="a2a_button_email"></a></p>
</div>
<script async="" src="https://static.addtoany.com/menu/page.js"></script>



 ]]></description>
  <category>paper</category>
  <category>m2mo</category>
  <category>derivatives</category>
  <guid>https://cheryl-kdio.github.io/posts/m2mo/derivatives/02_model_free(1).html</guid>
  <pubDate>Tue, 10 Feb 2026 23:00:00 GMT</pubDate>
  <media:content url="https://cheryl-kdio.github.io/posts/m2mo/derivatives/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Mathematical foundations of financial market modeling</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/m2mo/yield_curves/00_yield_curve.html</link>
  <description><![CDATA[ 




<p>The interest rate market is one of the largest and most liquid segments of the financial markets. It encompasses a wide range of instruments, including government bonds, corporate bonds, interest rate swaps, and options on interest rates. The modeling of interest rates is crucial for pricing and managing the risks associated with these instruments.</p>
<p>To understand the dynamics of interest rate, we first need to introduce the different types of interest rates that are used in creating and pricing interest rate derivatives, as well as the concept of yield curve, which is a fundamental tool for analyzing the term structure of interest rates.</p>
<p>Moreover, we will introduce several interest rate derivatives currently traded in the market.</p>
<section id="different-types-of-interest-rates" class="level1">
<h1>Different types of interest rates</h1>
<p>An interest rate can be seen as the cost of borrowing or the return on lending money. For exemple, when a counterparty A borrows, at time t, a certain amount of cash <img src="https://latex.codecogs.com/png.latex?N"> from a counterparty B with a maturity <img src="https://latex.codecogs.com/png.latex?T">, and interest rate <img src="https://latex.codecogs.com/png.latex?r">. Then, at maturity <img src="https://latex.codecogs.com/png.latex?T">, A will have to pay back to B the amount <img src="https://latex.codecogs.com/png.latex?N(1+r(T-t))%20=%20N(1+r%5Ctau)"> with <img src="https://latex.codecogs.com/png.latex?%5Ctau%20=%20T-t"> the time to maturity, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?N%20%5Cmapsto%20N(1+r%5Ctau)">. This is the case of a simple interest rate.</p>
<p>In practice, one can differentiate two types of interest rates : - the simple interest rate and the compound interest rate. The simple interest rate is the one we just introduced. In continuous time, we would say <img src="https://latex.codecogs.com/png.latex?N%20%5Cmapsto%20N%20e%5E%7Br%5Ctau%7D">, where <img src="https://latex.codecogs.com/png.latex?e"> is the exponential function.</p>
<ul>
<li>the compound interest rate is defined as follows: at time <img src="https://latex.codecogs.com/png.latex?t">, A borrows an amount <img src="https://latex.codecogs.com/png.latex?N"> from B with a maturity <img src="https://latex.codecogs.com/png.latex?T"> and a compound interest rate <img src="https://latex.codecogs.com/png.latex?r">. Then, at maturity <img src="https://latex.codecogs.com/png.latex?T">, A will have to pay back to B the amount <img src="https://latex.codecogs.com/png.latex?N(1+r)%5E%7B%5Ctau%7D"> with <img src="https://latex.codecogs.com/png.latex?%5Ctau%20=%20T-t"> the time to maturity. Hence, <img src="https://latex.codecogs.com/png.latex?N%20%5Cmapsto%20N(1+r)%5E%7B%5Ctau%7D">.</li>
</ul>
<p>It is also important to distinguish between the different types of interest rates that are used in the market. The most common ones are: - the <strong>spot interest rate</strong> is the interest rate that applies to a loan or deposit that starts immediately and has a maturity of <img src="https://latex.codecogs.com/png.latex?T">.</p>
<ul>
<li>the <strong>forward interest rate</strong> is the interest rate that applies to a loan or deposit that starts at a future date <img src="https://latex.codecogs.com/png.latex?T"> and has a maturity of <img src="https://latex.codecogs.com/png.latex?S">.</li>
</ul>
</section>
<section id="link-between-the-zero-coupon-bond-price-and-the-interest-rates" class="level1">
<h1>Link between the Zero-coupon bond price and the interest rates</h1>
<p>::{.callout-note} # What is a zero-coupon bond? A zero-coupon bond is a debt security that does not pay periodic interest (coupons). Instead, it is issued at a discount to its face value and pays the full face value at maturity. For example, assuming an investor buys a zero-coupon bond with a face value of <img src="https://latex.codecogs.com/png.latex?1"> and a maturity of 1 year. This means the investor will receive <img src="https://latex.codecogs.com/png.latex?1"> at the end of 1 year. Generally, the price of the zero-coupon bond will be denoted by <img src="https://latex.codecogs.com/png.latex?B(t,T)">, where <img src="https://latex.codecogs.com/png.latex?t"> is the current time and <img src="https://latex.codecogs.com/png.latex?T"> is the maturity of the bond. :::</p>
<section id="zero-coupon-bond-price-and-simple-spot-interest-rate" class="level2">
<h2 class="anchored" data-anchor-id="zero-coupon-bond-price-and-simple-spot-interest-rate">Zero-coupon bond price and simple spot interest rate</h2>
<p>Assuming we pay <img src="https://latex.codecogs.com/png.latex?B(t,T)"> at time <img src="https://latex.codecogs.com/png.latex?t"> to buy a zero-coupon bond that will pay <img src="https://latex.codecogs.com/png.latex?1"> at maturity <img src="https://latex.codecogs.com/png.latex?T">. Hence, we have <img src="https://latex.codecogs.com/png.latex?B(t,T)%20%5Cmapsto%201"> at maturity <img src="https://latex.codecogs.com/png.latex?T">. One can also, instead of buying the zero-coupon bond, invest <img src="https://latex.codecogs.com/png.latex?B(t,T)"> in the money market account that pays the short-term interest rate <img src="https://latex.codecogs.com/png.latex?L(t,T)">. Hence, at maturity <img src="https://latex.codecogs.com/png.latex?T">, we will have <img src="https://latex.codecogs.com/png.latex?B(t,T)%20%5Cmapsto%20B(t,T)(1%20-%20(T-t)%20L(t,T))">. Since, we are in a no-arbitrage framework, we must have the same payoff at maturity <img src="https://latex.codecogs.com/png.latex?T"> for both strategies, which means that <img src="https://latex.codecogs.com/png.latex?1%20=%20B(t,T)(1%20-%20(T-t)%20L(t,T))">. Hence, we can deduce the following link between the zero-coupon bond price and the simple forward interest rate:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(t,T)%20=%20%5Cfrac%7B1%7D%7BT-t%7D%20%5Cleft(%20%5Cfrac%7B1%7D%7BB(t,T)%7D%20-%201%20%5Cright).%0A"></p>
<p>In continuous time, we have <img src="https://latex.codecogs.com/png.latex?1%20=%20B(t,T)%20e%5E%7B(T-t)%20R(t,T)%7D">, which gives us the following link between the zero-coupon bond price and the continuous forward interest rate: <img src="https://latex.codecogs.com/png.latex?%0AR(t,T)%20=%20-%5Cfrac%7B1%7D%7BT-t%7D%20%5Cln(B(t,T)).%0A"></p>
<p>Therefore, we call <strong>short term interest rate</strong>, the spot interest rate <img src="https://latex.codecogs.com/png.latex?L(t,T)"> or <img src="https://latex.codecogs.com/png.latex?R(t,T)">, with <img src="https://latex.codecogs.com/png.latex?T%20%5Crightarrow%20t">, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?lim_%7BT%20%5Crightarrow%20t%7D%20L(t,T)"> = <img src="https://latex.codecogs.com/png.latex?%5Clim_%7BT%20%5Crightarrow%20t%7D%20R(t,T)%20=%20r_t">.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The yield curve or the term structure of interest rates
</div>
</div>
<div class="callout-body-container callout-body">
<p>The yield curve is a graphical representation of the relationship between interest rates and the maturity of debt securities. It is hence a function <img src="https://latex.codecogs.com/png.latex?T%20%5Cmapsto%20L(t,T)">, with a given date <img src="https://latex.codecogs.com/png.latex?t">. Therefore, for each date <img src="https://latex.codecogs.com/png.latex?t">, we can build a yield curve made of market data (Bonds, FRA, SWAP, etc.) and use it to price interest rate derivatives.</p>
</div>
</div>
</section>
<section id="zero-coupon-bond-price-and-simple-forward-interest-rate" class="level2">
<h2 class="anchored" data-anchor-id="zero-coupon-bond-price-and-simple-forward-interest-rate">Zero-coupon bond price and simple forward interest rate</h2>
<p>In order to understand the link between the zero-coupon bond price and the forward interest rate, we can refer to the fct that it is the rate that one can lock at time <img src="https://latex.codecogs.com/png.latex?t"> for a loan that will start at a future date <img src="https://latex.codecogs.com/png.latex?T"> and has a maturity of <img src="https://latex.codecogs.com/png.latex?S">. Hence at time t, one can invest on a zero-coupon bond with maturity <img src="https://latex.codecogs.com/png.latex?S"> and get <img src="https://latex.codecogs.com/png.latex?B(t,S)%20%5Cmapsto%201"> at maturity <img src="https://latex.codecogs.com/png.latex?S">. Alternatively, one can invest on a zero-coupon bond with maturity <img src="https://latex.codecogs.com/png.latex?T"> and get <img src="https://latex.codecogs.com/png.latex?B(t,T)%20%5Cmapsto%201"> at maturity <img src="https://latex.codecogs.com/png.latex?T">, and then reinvest the proceeds in the money market account that pays the short-term interest rate <img src="https://latex.codecogs.com/png.latex?L(t;%20T,S)"> until maturity <img src="https://latex.codecogs.com/png.latex?S">. Hence, at maturity <img src="https://latex.codecogs.com/png.latex?S">, we will have <img src="https://latex.codecogs.com/png.latex?B(t,T)(1%20-%20(S-T)%20L(T,S))">.</p>
<p>Assuming we are in a no-arbitrage framework, we must have the same payoff at maturity <img src="https://latex.codecogs.com/png.latex?S"> for both strategies, which means that <img src="https://latex.codecogs.com/png.latex?1%20=%20B(t,T)(1%20-%20(S-T)%20L(T,S))">. Hence, we can deduce the following link between the zero-coupon bond price and the simple forward interest rate:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(t;%20T,S)%20=%20%5Cfrac%7B1%7D%7BS-T%7D%20%5Cleft(%20%5Cfrac%7BB(t,T)%7D%7BB(t,S)%7D%20-%201%20%5Cright).%0A"></p>
<p>Therefore, we call <strong>forward interest rate</strong>, the simple forward interest rate <img src="https://latex.codecogs.com/png.latex?L(t;%20T,S)"> or the continuous forward interest rate <img src="https://latex.codecogs.com/png.latex?R(t;%20T,S)">, with <img src="https://latex.codecogs.com/png.latex?S%20%5Crightarrow%20T">, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?lim_%7BS%20%5Crightarrow%20T%7D%20L(t;%20T,S)"> = f(t,T)$.</p>
<p>Moreover, when <img src="https://latex.codecogs.com/png.latex?T%20%5Crightarrow%20t">, we have <img src="https://latex.codecogs.com/png.latex?f(t,t)%20=%20r_t">, meaning that the forward interest rate at time <img src="https://latex.codecogs.com/png.latex?t"> for a loan that starts immediately and has a maturity of <img src="https://latex.codecogs.com/png.latex?T"> is equal to the short-term interest rate at time <img src="https://latex.codecogs.com/png.latex?t">.</p>
<p>::{.callout-note} üí° We can show that the instantaneous interest rate <img src="https://latex.codecogs.com/png.latex?f(t,T)"> is equal to <img src="https://latex.codecogs.com/png.latex?-%5Cfrac%7BdB(t,T)%7D%7BdT%7D">. Hence, we can deduce that the zero-coupon bond price can be expressed as follows: <img src="https://latex.codecogs.com/png.latex?%0AB(t,T)%20=%20e%5E%7B-%5Cint_t%5ET%20f(t,u)%20du%7D.%0A"> :::</p>
<section id="rates-derivatives" class="level3">
<h3 class="anchored" data-anchor-id="rates-derivatives">Rates derivatives</h3>


</section>
</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>m2mo</category>
  <category>yield-curve</category>
  <guid>https://cheryl-kdio.github.io/posts/m2mo/yield_curves/00_yield_curve.html</guid>
  <pubDate>Tue, 10 Feb 2026 23:00:00 GMT</pubDate>
  <media:content url="https://cheryl-kdio.github.io/posts/m2mo/yield_curves/featured.png" medium="image" type="image/png" height="87" width="144"/>
</item>
<item>
  <title>Mathematical foundations of financial market modeling</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/m2mo/derivatives/01_intro_market.html</link>
  <description><![CDATA[ 




<p>A financial market is an institutional framework in which financial instruments are issued and exchanged. In the primary market, newly created securities such as shares or bonds are sold for the first time by firms or governments to investors. The objective of this article is to introduce the economic role of financial markets and to present the fundamental structural properties required for coherent financial modeling.</p>
<p>For theoretical clarity, we adopt a discrete-time framework. Time is indexed by <img src="https://latex.codecogs.com/png.latex?%0At%20%5Cin%20%5C%7B0,1,%5Cdots,T%5C%7D,%0A"> where <img src="https://latex.codecogs.com/png.latex?T"> denotes a fixed time horizon.</p>
<section id="financial-markets-and-traded-assets" class="level1">
<h1>Financial markets and traded assets</h1>
<p>Financial markets encompass several types of instruments. The equity market consists of ownership claims on firms, such as common or preferred shares. Firms raise capital by issuing equity securities, and these securities are subsequently traded on organized exchanges such as Euronext Paris or the New York Stock Exchange. Prices are determined by supply and demand and reflect expectations regarding firm performance and economic conditions.</p>
<p>The bond market consists of debt instruments issued by governments or corporations. A bond is a contract specifying that the issuer will repay a principal amount at maturity and pay periodic interest, referred to as coupons. Bonds provide predictable income streams and are fundamental instruments for public and private financing.</p>
<p>The derivatives market includes financial instruments whose value depends on an underlying asset. Typical examples are options, forwards, futures, and swaps. Derivatives are used for risk management, speculative positioning, and arbitrage strategies across markets.</p>
<p>The primary market enables capital allocation within the economy. Firms obtain financing for investment and expansion, while investors allocate resources in expectation of future returns. Financial markets also facilitate risk transfer. For example, firms exposed to commodity price risk may use derivative contracts to hedge adverse fluctuations.</p>
<section id="structural-properties-of-a-financial-market" class="level2">
<h2 class="anchored" data-anchor-id="structural-properties-of-a-financial-market">Structural properties of a financial market</h2>
<p>For a financial market to function efficiently, several properties are desirable. Liquidity ensures that assets can be traded without significant price impact. Transparency guarantees that relevant information is accessible to participants. Fairness implies equal access to market information. Efficiency requires that prices reflect available information and that arbitrage opportunities do not persist.</p>
<p>The absence of arbitrage is a central assumption in modern financial mathematics and underlies pricing theory.</p>
</section>
</section>
<section id="mathematical-framework" class="level1">
<h1>Mathematical Framework</h1>
<p>We consider a financial market composed of one risk-free asset and <img src="https://latex.codecogs.com/png.latex?q"> risky assets.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?S_t%5E0"> denote the price of the risk-free asset. In discrete time, we assume it evolves deterministically according to <img src="https://latex.codecogs.com/png.latex?%0AS_%7Bt+1%7D%5E0%20=%20(1%20+%20r_t)%20S_t%5E0,%0A"> where <img src="https://latex.codecogs.com/png.latex?r_t"> denotes the short-term interest rate.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?S_t%5Ei"> for <img src="https://latex.codecogs.com/png.latex?i=1,%5Cdots,q"> denote the prices of risky assets. Their evolution is stochastic and will be specified through an appropriate probabilistic model.</p>
<section id="trading-strategies-and-wealth-process" class="level2">
<h2 class="anchored" data-anchor-id="trading-strategies-and-wealth-process">Trading strategies and wealth process</h2>
<p>A trading strategy is a predictable process <img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta_t%20=%20(%5Cdelta_t%5E0,%20%5Cdelta_t%5E1,%20%5Cdots,%20%5Cdelta_t%5Eq),%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cdelta_t%5Ei"> represents the number of units of asset <img src="https://latex.codecogs.com/png.latex?i"> held at time <img src="https://latex.codecogs.com/png.latex?t">.</p>
<p>The associated wealth process is defined by <img src="https://latex.codecogs.com/png.latex?%0AV_t%20=%20%5Csum_%7Bi=0%7D%5Eq%20%5Cdelta_t%5Ei%20S_t%5Ei.%0A"></p>
<p>A strategy is said to be self-financing if changes in wealth are solely due to variations in asset prices. In discrete time, this condition reads <img src="https://latex.codecogs.com/png.latex?%0AV_%7Bt+1%7D%20-%20V_t%20=%20%5Cdelta_t%5E0%20%5C,%20dS_t%5E0%20%20+%20%5Csum_%7Bi=1%7D%5Eq%20%5Cdelta_t%5Ei%20(S_%7Bt+1%7D%5Ei%20-%20S_t%5Ei).%0A"> Equivalently, <img src="https://latex.codecogs.com/png.latex?%0AV_t%20=%20V_0%20+%20%5Cdelta_t%5E0%20%5C,%20dS_t%5E0%20%20+%20%5Csum_%7Bs=1%7D%5E%7Bt-1%7D%20%5Csum_%7Bi=0%7D%5Eq%20%5Cdelta_s%5Ei%20(S_%7Bs+1%7D%5Ei%20-%20S_s%5Ei).%0A"></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Self financing condition in continuous time
</div>
</div>
<div class="callout-body-container callout-body">
<p>In continuous time, the self-financing condition is expressed as <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0AdV_t%20&amp;=%20%5Cdelta_t%5E0%20%5C,%20dS_t%5E0%20%20+%20%5Csum_%7Bi=1%7D%5Eq%20%5Cdelta_t%5Ei%20%5C,%20dS_t%5Ei.%20%5C%5C%0A%5CLeftrightarrow%0AV_t%20&amp;=%20V_0%20+%20%5Cdelta_t%5E0%20%5C,%20dS_t%5E0%20%20+%20%5Cint_1%5Et%20%5Csum_%7Bi=0%7D%5Eq%20%5Cdelta_s%5Ei%20%5C,%20dS_s%5Ei.%0A%5Cend%7Balign%7D%0A"></p>
<p>In the case where the risky assets give dividends, the self-financing condition must be modified to account for dividend payments. Let <img src="https://latex.codecogs.com/png.latex?D_t%5Ei"> denote the cumulative dividends paid by asset <img src="https://latex.codecogs.com/png.latex?i"> up to time <img src="https://latex.codecogs.com/png.latex?t">. The wealth process then satisfies : <img src="https://latex.codecogs.com/png.latex?%0AdV_t%20=%20%5Cdelta_t%5E0%20%5C,%20dS_t%5E0%20%20+%20%5Csum_%7Bi=1%7D%5Eq%20%5Cdelta_t%5Ei%20%5C,%20dS_t%5Ei%20+%20%5Csum_%7Bi=1%7D%5Eq%20%5Cdelta_t%5Ei%20%5C,%20dD_t%5Ei.%0A"></p>
<p>One can talk in term of discounted wealth process <img src="https://latex.codecogs.com/png.latex?%5Ctilde%20V_t%20=%20%5Cfrac%7BV_t%7D%7BS_t%5E0%7D">, which satisfies <img src="https://latex.codecogs.com/png.latex?%0Ad%5Ctilde%20V_t%20=%20%5Csum_%7Bi=1%7D%5Eq%20%5Cdelta_t%5Ei%20%5C,%20d%5Ctilde%20S_t%5Ei,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Ctilde%20S_t%5Ei%20=%20%5Cfrac%7BS_t%5Ei%7D%7BS_t%5E0%7D%20=%20%5Cbeta_t%20S_t%5Ei"> is the discounted price of the risky asset <img src="https://latex.codecogs.com/png.latex?i">.</p>
</div>
</div>
</section>
</section>
<section id="arbitrage" class="level1">
<h1>Arbitrage</h1>
<p>An arbitrage opportunity is defined as a self-financing strategy satisfying <img src="https://latex.codecogs.com/png.latex?%0AV_0%20=%200,%20%5Cqquad%20V_T%20%5Cge%200%20%5Ctext%7B%20almost%20surely%7D,%20%5Cqquad%20%5Cmathbb%7BP%7D(V_T%20%3E%200)%20%3E%200.%0A"> Such a strategy generates profit without risk or initial investment. Markets admitting arbitrage are economically inconsistent, and therefore we assume the market is arbitrage-free.</p>
<section id="risk-neutral-measure" class="level2">
<h2 class="anchored" data-anchor-id="risk-neutral-measure">Risk-neutral measure</h2>
<p>Under the absence of arbitrage, there exists an equivalent probability measure <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BQ%7D"> under which discounted asset prices are martingales. Let <img src="https://latex.codecogs.com/png.latex?%0A%5Ctilde%20S_t%5Ei%20=%20%5Cfrac%7BS_t%5Ei%7D%7BS_t%5E0%7D%0A"> denote the discounted price process. Then <img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbb%7BE%7D%5E%7B%5Cmathcal%7BQ%7D%7D%5B%5Ctilde%20S_%7Bt+1%7D%5Ei%20%5Cmid%20%5Cmathcal%7BF%7D_t%5D%20=%20%5Ctilde%20S_t%5Ei.%0A"> This result allows derivative pricing via expectation: <img src="https://latex.codecogs.com/png.latex?%0A%5CPi_0%20=%20S_0%5E0%20%5C,%20%5Cmathbb%7BE%7D%5E%7B%5Cmathcal%7BQ%7D%7D%5Cleft%5B%5Cfrac%7B%5Cvarepsilon%7D%7BS_T%5E0%7D%5Cright%5D,%0A"> where <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon"> denotes the contingent claim payoff at maturity.</p>
</section>
<section id="market-completeness" class="level2">
<h2 class="anchored" data-anchor-id="market-completeness">Market completeness</h2>
<p>The market is said to be complete if every contingent claim <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon"> can be replicated by a self-financing strategy. In a complete market, the risk-neutral measure is unique and every derivative admits a unique arbitrage-free price. In an incomplete market, multiple risk-neutral measures may exist and perfect replication is not always possible, leading to pricing and hedging challenges.</p>
<p>As an illustration, the payoff of a European call option with strike <img src="https://latex.codecogs.com/png.latex?K"> and maturity <img src="https://latex.codecogs.com/png.latex?T"> is given by <img src="https://latex.codecogs.com/png.latex?%0A%5Cvarepsilon%20=%20%5Cmax(S_T%20-%20K,%200).%0A"></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Take away
</div>
</div>
<div class="callout-body-container callout-body">
<p>Financial markets play a fundamental role in capital allocation, risk transfer, and price discovery within the economy. From a mathematical perspective, their analysis relies on a structured framework built upon trading strategies, wealth dynamics, and probabilistic modeling.</p>
<p>The <strong>absence of arbitrage</strong> constitutes the cornerstone of modern financial theory. It guarantees the existence of a risk-neutral measure under which discounted asset prices behave as martingales, thereby providing a coherent foundation for derivative pricing.</p>
<p>Finally, the notion of <strong>market completeness</strong> determines whether contingent claims can be perfectly replicated and uniquely priced. These structural concepts form the basis of quantitative finance and underpin the development of more advanced pricing and hedging models.</p>
</div>
</div>
<!-- 
AddToAny check more: https://www.addtoany.com/buttons/for/website 
Using includes will make edits easier, will only need to add or remove button here if needed.
https://quarto.org/docs/authoring/includes.html
-->
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<p><a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_bluesky"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_whatsapp"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_copy_link"></a> <a class="a2a_button_email"></a></p>
</div>
<script async="" src="https://static.addtoany.com/menu/page.js"></script>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>m2mo</category>
  <category>derivatives</category>
  <guid>https://cheryl-kdio.github.io/posts/m2mo/derivatives/01_intro_market.html</guid>
  <pubDate>Mon, 09 Feb 2026 23:00:00 GMT</pubDate>
  <media:content url="https://cheryl-kdio.github.io/posts/m2mo/derivatives/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Introduction to financial markets</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/m2mo/derivatives/00_references.html</link>
  <description><![CDATA[ 




<p>In the financial sector, a market refers to the place where the supply and demand for financial products and services meet. It brings together numerous participants, including banks, financial institutions, corporations, and individual investors.</p>
<p>Among the various financial instruments traded, one finds equities, bonds, derivatives, currencies, and commodities.</p>
<p>In this article, we examine three major types of financial markets: the equity market, the bond market, and the derivatives market, along with their characteristics and operating mechanisms.</p>
<section id="equity-markets" class="level2">
<h2 class="anchored" data-anchor-id="equity-markets">Equity markets</h2>
<p>The equity market enables companies to raise capital by issuing ownership securities (shares) that investors can purchase. These shares are subsequently traded on stock exchanges such as euronext paris or the new york stock exchange.</p>
<p>Share prices fluctuate according to supply and demand, influenced by corporate performance, macroeconomic conditions, and market sentiment.</p>
<p>The main participants in this market include issuing companies, institutional investors such as pension funds and insurance companies, and retail investors. To buy or sell shares, investors typically use online brokers or investment banks. They submit buy orders (bid) or sell orders (ask), which can be observed in the order book and are then executed on the market.</p>
<p>A market order corresponds to an immediate purchase or sale at the best available price.</p>
<p>A limit order allows the purchase or sale of a specified quantity of securities subject to a price condition. It provides control over the execution price and enables investors to set a target buying or selling price.</p>
<p>A stop order is executed only if the price reaches a specified threshold. It is often used to limit losses or secure gains. For a purchase, it is generally placed above the current market price; for a sale, below.</p>
<p>A stop-limit order combines a stop trigger with a limit condition and may include time restrictions.</p>
<p>A trailing stop order functions similarly to a stop order but is defined as a percentage variation rather than a fixed price level.</p>
<p>Additional tactical order types allow the implementation of more sophisticated investment strategies.</p>
<p>In france, the autorit√© des march√©s financiers supervises financial markets to ensure transparency and proper functioning.</p>
<section id="price-formation" class="level3">
<h3 class="anchored" data-anchor-id="price-formation">Price formation</h3>
<p>The price of a share is determined by the interaction of supply and demand. When demand increases, the price tends to rise. Conversely, when supply exceeds demand, the price falls. The traded price corresponds to the effective intersection between a bid and an ask, that is, where an order is matched.</p>
<p>Fundamental factors also influence prices, including corporate earnings, dividend distributions, growth prospects, and general economic conditions.</p>
<p>At market close, the closing price corresponds to the last traded price of the session. This price may differ from the next opening price due to events occurring outside trading hours.</p>
</section>
</section>
<section id="bond-market" class="level2">
<h2 class="anchored" data-anchor-id="bond-market">Bond market</h2>
<p>The bond market is where investors buy and sell debt securities. Bonds are debt instruments issued by governments or corporations to raise capital. A bond is a contract between an issuer and an investor in which the issuer commits to repaying the principal at maturity while paying periodic interest payments, known as coupons.</p>
<p>Through bond issuance, the issuer contracts debt on the market. The investor lends funds by purchasing the bond and receives interest payments until maturity, at which point the principal, also called the face value, is repaid.</p>
<p>Bonds are generally considered lower-risk investments compared to equities, as they typically provide fixed returns and exhibit lower volatility. However, their expected return is usually lower than that of stocks.</p>
<p>Bonds can be classified according to their issuer, maturity, and interest structure. Government bonds are issued by sovereign states. Corporate bonds are issued by private or public companies. Short-term bonds typically have maturities below five years, whereas long-term bonds exceed ten years. Interest rates may be fixed or variable. Bonds are also categorized according to credit rating, which assesses the issuer‚Äôs ability to repay its debt.</p>
<section id="bond-valuation" class="level3">
<h3 class="anchored" data-anchor-id="bond-valuation">Bond valuation</h3>
<p>Bond valuation consists of determining its present value, that is, the amount an investor is willing to pay today. The price of a bond is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?B(t,T)%20=%20%5Csum_%7Bu=1%7D%5E%7BT%7D%20%5Cfrac%7BC%7D%7B(1+r)%5Eu%7D%20+%20%5Cfrac%7BN%7D%7B(1+r)%5ET%7D.%0A"></p>
<p>The bond value depends on the market interest rate (r), the remaining maturity (T-t), the coupon rate, and the issuer‚Äôs credit quality. When market interest rates increase, existing bond prices decline, as new bonds offer higher yields.</p>
<p>A zero-coupon bond does not pay periodic interest. Its value simplifies to</p>
<p><img src="https://latex.codecogs.com/png.latex?B(t,T)%20=%20%5Cfrac%7BN%7D%7B(1+r)%5E%7BT-t%7D%7D."></p>
</section>
</section>
<section id="derivatives-market" class="level2">
<h2 class="anchored" data-anchor-id="derivatives-market">Derivatives market</h2>
<p>Derivatives are financial instruments whose value depends on an underlying asset. Examples include options, futures, forwards, and swaps. These instruments are used for hedging, speculation, and arbitrage.</p>
<p>Hedging involves taking a derivative position to offset an existing exposure. Speculation consists of taking a position based on expected future price movements without prior exposure. Arbitrage involves exploiting price discrepancies across markets to generate risk-free profit.</p>
<p>Derivatives may be traded on organized exchanges or over-the-counter markets. Organized markets are centralized and regulated, offering standardized contracts and daily settlement through clearinghouses. Margin requirements and marking-to-market procedures reduce counterparty risk.</p>
<p>Over-the-counter markets are decentralized and allow customized contracts between counterparties.</p>
<p>Prices are determined by bid and ask quotes. The bid-ask spread reflects market liquidity.</p>
<section id="forward-contracts" class="level3">
<h3 class="anchored" data-anchor-id="forward-contracts">Forward contracts</h3>
<p>A forward contract is an agreement between two parties to buy or sell an asset at a price (K) at a future date (T). The payoff for a long position is <img src="https://latex.codecogs.com/png.latex?S_T%20-%20K,"> and for a short position, <img src="https://latex.codecogs.com/png.latex?K%20-%20S_T."></p>
<p>Forwards are primarily used for hedging purposes.</p>
</section>
<section id="options" class="level3">
<h3 class="anchored" data-anchor-id="options">Options</h3>
<p>An option gives the holder the right, but not the obligation, to buy or sell an underlying asset at a strike price (K) before or at maturity (T).</p>
<p>The payoff of a european call is <img src="https://latex.codecogs.com/png.latex?%5Cmax(S_T%20-%20K,%200),"> while the payoff of a european put is <img src="https://latex.codecogs.com/png.latex?%5Cmax(K%20-%20S_T,%200)."></p>
<p>Options may be used for hedging, speculation, or income generation.</p>
</section>
<section id="futures" class="level3">
<h3 class="anchored" data-anchor-id="futures">Futures</h3>
<p>Futures contracts are standardized agreements traded on organized exchanges. They are marked to market daily, and margin accounts are adjusted accordingly. Futures prices converge to spot prices at maturity to prevent arbitrage.</p>
</section>
<section id="swaps" class="level3">
<h3 class="anchored" data-anchor-id="swaps">Swaps</h3>
<p>A swap is a derivative contract in which two parties exchange cash flows based on a notional amount over a specified period. The most common type is the interest rate swap, in which one party pays a fixed rate while receiving a floating rate, typically linked to libor or a similar benchmark.</p>
<p>The swap can be viewed as a combination of a fixed-rate bond and a floating-rate bond. Its value equals the difference between the present values of fixed and floating cash flows:</p>
<p><img src="https://latex.codecogs.com/png.latex?V_%7B%5Ctext%7Bswap%7D%7D%20=%20B_%7B%5Ctext%7Bfixed%7D%7D%20-%20B_%7B%5Ctext%7Bfloating%7D%7D.%0A"></p>
<p>When the fixed rate equals the swap rate, the contract initially has zero net value.</p>
<p>Swap markets provide quoted bid and ask fixed rates across maturities, which are used to construct the zero-coupon yield curve through bootstrapping techniques.</p>
<p>Although swap rates are not strictly risk-free, they are often used as reference discount rates for long maturities under normal market conditions.</p>
<p>Source: john c.&nbsp;hull, <em>options, futures, and other derivatives</em>, 11th edition.</p>
<!-- 
AddToAny check more: https://www.addtoany.com/buttons/for/website 
Using includes will make edits easier, will only need to add or remove button here if needed.
https://quarto.org/docs/authoring/includes.html
-->
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<p><a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_bluesky"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_whatsapp"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_copy_link"></a> <a class="a2a_button_email"></a></p>
</div>
<script async="" src="https://static.addtoany.com/menu/page.js"></script>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>m2mo</category>
  <category>derivatives</category>
  <guid>https://cheryl-kdio.github.io/posts/m2mo/derivatives/00_references.html</guid>
  <pubDate>Sat, 31 Jan 2026 23:00:00 GMT</pubDate>
  <media:content url="https://cheryl-kdio.github.io/posts/m2mo/derivatives/featured.png" medium="image" type="image/png" height="96" width="144"/>
</item>
<item>
  <title>Detecting the Cure Model Appropriateness in Randomized Clinical Trials With Long-Term Survivors</title>
  <link>https://cheryl-kdio.github.io/</link>
  <description>To evaluate the appropriateness of a cure model when analyzing right-censored end points of a randomized clinical trial (RCT) in malignancy in the presence of long-term survivors. We aim to derive how the ratio estimation of censored cured subjects (RECeUS), previously proposed for a homogeneous population, could be extended for use in RCTs.</description>
  <category>news</category>
  <guid>https://cheryl-kdio.github.io/</guid>
  <pubDate>Sun, 14 Dec 2025 23:00:00 GMT</pubDate>
  <media:content url="https://ascopubs.org/cms/10.1200/CCI-25-00084/asset/d0c5b157-fe4e-42e3-b911-27a37c390406/assets/images/large/cci-25-00084f1.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Risque de valorisation d‚Äôobligation</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3.html</link>
  <description><![CDATA[ 




<p>Le risque de valorisation est le risque que la valeur d‚Äôun actif financier soit inf√©rieure √† sa valeur comptable ou √† sa valeur de march√©. Ce risque peut √™tre caus√© par des fluctuations des taux d‚Äôint√©r√™t, des changements dans la qualit√© de cr√©dit de l‚Äô√©metteur, ou d‚Äôautres facteurs √©conomiques et financiers. Dans le cadre de nos travaux, nous allons nous interesser √† la valorisation d‚Äôune obligation.</p>
<section id="d√©finition-dune-obligation" class="level4">
<h4 class="anchored" data-anchor-id="d√©finition-dune-obligation">D√©finition d‚Äôune obligation</h4>
<p>Une obligation est un titre de cr√©ance √©mis par une entreprise ou une collectivit√© publique afin de financer un projet ou de refinancer une dette. Contrairement aux actions, qui conf√®rent un droit de propri√©t√©, les obligations sont des instruments de dette qui garantissent aux investisseurs des paiements p√©riodiques sous forme d‚Äôint√©r√™ts (coupons) et le remboursement du capital √† une √©ch√©ance d√©termin√©e.</p>
<p>Pour la valoriser, comme pour valoriser n‚Äôimporte quel produit, nous devons faire l‚Äôesp√©rance de la valeur actualis√©e des flux futurs sous la probabilit√© risque neutre. En effet, cela permet de se mettre sous la perspective d‚Äôun investisseur qui est indiff√©rent au risque et qui ne demande qu‚Äô√† √™tre r√©mun√©r√© pour le temps qu‚Äôil pr√™te son argent.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AX_%7Bt=0%7D%20=%20%5Cmathbb%7BE%7D%5EQ%20%5Cleft%5B%20e%5E%7B-r(T-t)%7D%20X_T%20%5Cright%5D%0A"></p>
<p>La valorisation d‚Äôune obligation repose principalement sur deux notions fondamentales :</p>
<ul>
<li>Le taux d‚Äôint√©r√™t : il repr√©sente le co√ªt du capital et refl√®te la r√©mun√©ration exig√©e par les investisseurs pour pr√™ter leur argent. Il peut √™tre per√ßu comme le ‚Äúloyer‚Äù du capital pr√™t√© ou encore comme la compensation pour le risque associ√© √† l‚Äôinvestissement. Ce taux influence directement la valeur d‚Äôune obligation, car une hausse des taux entra√Æne g√©n√©ralement une baisse du prix des obligations existantes sur le march√© secondaire.</li>
<li>Le taux de recouvrement : il correspond au pourcentage du capital que les investisseurs peuvent esp√©rer r√©cup√©rer en cas de d√©faut de l‚Äô√©metteur. Un taux de recouvrement √©lev√© signifie que, m√™me en cas de faillite, les cr√©anciers peuvent r√©cup√©rer une grande partie de leur investissement, tandis qu‚Äôun taux faible sugg√®re un risque de perte plus important. Historiquement, il est fix√© √† <img src="https://latex.codecogs.com/png.latex?R%20=%2040%5C%25">.</li>
</ul>
<p>Valoriser une obligation revient donc √† calculer la valeur actualis√©e des flux futurs de paiement. De ce fait, cela revient √† valoriser les coupons, le nominal en cas de non d√©faut de la part de l‚Äô√©metteur et le recouvrement en cas de d√©faut de l‚Äô√©metteur.</p>
</section>
<section id="a.-valorisation-des-coupons" class="level4">
<h4 class="anchored" data-anchor-id="a.-valorisation-des-coupons">a. Valorisation des coupons</h4>
<p>Le coupon est le montant que l‚Äô√©metteur de l‚Äôobligation s‚Äôengage √† verser √† l‚Äôinvestisseur √† intervalles r√©guliers (g√©n√©ralement annuels ou semestriels) jusqu‚Äô√† l‚Äô√©ch√©ance de l‚Äôobligation. Il est exprim√© en pourcentage de la valeur nominale de l‚Äôobligation et peut √™tre fixe ou variable, en fonction des modalit√©s de l‚Äô√©mission.</p>
<p>Vu √† <img src="https://latex.codecogs.com/png.latex?t">, la valeur d‚Äôun coupon <img src="https://latex.codecogs.com/png.latex?c"> qui sera pay√© √† <img src="https://latex.codecogs.com/png.latex?T_i"> est donn√©e par : <img src="https://latex.codecogs.com/png.latex?%0AN%20%5Cmathbb%7BE%7D%5EQ%20%5Cleft%5B%20e%5E%7B-r(Ti-t)%7D%20c%20%5Cright%5D,%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?c"> est le coupon, <img src="https://latex.codecogs.com/png.latex?r"> est le taux d‚Äôint√©r√™t sans risque et <img src="https://latex.codecogs.com/png.latex?T_i"> est la date de paiement du coupon. Comme le taux d‚Äôint√©r√™t est constant, et le paiement du coupon d√©pend de la probabilit√© de survie de l‚Äô√©metteur, on peut r√©√©crire la formule pr√©c√©dente comme suit :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AN%20e%5E%7B-r(Ti-t)%7D%20c%20%5Cmathbb%7BP%7D(%5Ctau%20%3E%20T_i),%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BP%7D(%5Ctau%20%3E%20T_i)"> est la probabilit√© de survie de l‚Äô√©metteur √† la date <img src="https://latex.codecogs.com/png.latex?T_i">. Le mod√®le utilis√© pour la probabilit√© de survie est le mod√®le √† intensit√© <img src="https://latex.codecogs.com/png.latex?%5Clambda"> de Jarrow et Turnbull. La probabilit√© de survie est donn√©e par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathbb%7BP%7D(%5Ctau%20%3E%20T_i)%20=%20e%5E%7B-%5Cint_%7Bt%7D%5E%7BT_i%7D%20%5Clambda(s)%20ds%7D%20=%20e%5E%7B-%5Clambda%20%5Cint_%7Bt%7D%5E%7BT_i%7D%20ds%7D%20=%20e%5E%7B-%5Clambda%20(T_i%20-%20t)%7D.%0A"></p>
<p>De ce fait, la valorisation du coupon est donn√©e par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC_%7Bt%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20N%20%5Ctimes%20c%20%5Ctimes%20e%5E%7B-r(T_i-t)%7D%20%5Ctimes%20e%5E%7B-%5Clambda%20(T_i%20-%20t)%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20N%20%5Ctimes%20c%20%5Ctimes%20e%5E%7B-(r%20+%20%5Clambda)%20%5Ctimes%20(T_i-t)%7D%20%5Cmathbb%7B1%7D_%7BT_i%20%5Cgeq%20t%7D%0A"></p>
</section>
<section id="b.-valorisation-du-nominal" class="level4">
<h4 class="anchored" data-anchor-id="b.-valorisation-du-nominal">b. Valorisation du nominal</h4>
<p>Le nominal est le montant demand√© par l‚Äô√©metteur. Sa valorisation est donn√©e par : <img src="https://latex.codecogs.com/png.latex?%0AN_t%20=%20N%20%5Ctimes%20e%5E%7B-r(T-t)%7D%20%5Ctimes%20e%5E%7B-%5Clambda%20(T-t)%7D%20%5Cmathbb%7B1%7D_%7BT%20%5Cgeq%20t%7D%0A"></p>
</section>
<section id="c.-valorisation-du-recouvrement" class="level4">
<h4 class="anchored" data-anchor-id="c.-valorisation-du-recouvrement">c.&nbsp;Valorisation du recouvrement</h4>
<p>Pour valoriser le recouvrement, il est n√©cessaire de connaitre la probabilit√© de d√©faut √† l‚Äôinstant pr√©cis <img src="https://latex.codecogs.com/png.latex?t">.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0A%5Cmathbb%7BP%7D(%5Ctau%20=%20u)%20&amp;=%20%5Cmathbb%7BP%7D(u%20%5Cleq%20%5Ctau%20%5Cleq%20u%20+%20du)%20%5C%5C%0A&amp;=%20%5Cmathbb%7BP%7D(%5Ctau%20%5Cgeq%20u)%20-%20%5Cmathbb%7BP%7D(%5Ctau%20%5Cgeq%20u%20+%20du)%5C%5C%0A&amp;=%20-%20%5Cfrac%7B%20%5Cmathbb%7BP%7D(%5Ctau%20%5Cgeq%20u%20+%20du)%20-%20%5Cmathbb%7BP%7D(%5Ctau%20%5Cgeq%20u)%20%7D%7Bdu%7D%20du%5C%5C%0A&amp;=%20-%5Cfrac%7B%5Cmathbb%7BP%7D(%5Ctau%20%5Cgeq%20u)%7D%7Bdu%7Ddu%20%5C%5C%0A&amp;=%20%5Clambda%20e%5E%7B%5Clambda%20(u-t)%7D%20du%0A%5Cend%7Baligned%7D%0A"></p>
<p>De ce fait, la valorisation du recouvrement √† t est : <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AR_t%20&amp;=%20%5Cint_t%5ET%20N%20R%20e%5E%7B-rt%7D%20%5Cmathbb%7BP%7D(%5Ctau%20=%20u)%20%20%5C%5C%0A&amp;=%20%5Cint_t%5ET%20N%20R%20e%5E%7B-rt%7D%20%5Clambda%20e%5E%7B%5Clambda%20(u-t)%7D%20du%20%5C%5C%0A&amp;=%20N%20%5Clambda%20R%20%5Ctimes%20%5Cfrac%7B1%20-%20e%5E%7B-(r+%5Clambda)(T-t)%7D%7D%7Br+%5Clambda%7D%20%5Cmathbb%7B1%7D_%7BT%20%5Cgeq%20t%7D%0A%5Cend%7Baligned%7D%0A"></p>
En se servant de ces formules, nous pouvons valoriser une obligation de la mani√®re suivante : $$
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0AB_t%20&amp;=%20C_t%20+%20N_t%20+%20R_t%20%5C%5C%0A&amp;=%20N%20%5Cleft%5B%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%20c%20%5Ctimes%20e%5E%7B-(r%20+%20%5Clambda)%20%5Ctimes%20(T_i%0A-t)%7D%20%5Cmathbb%7B1%7D_%7BT_i%20%5Cgeq%20t%7D%20+%20e%5E%7B-(r+%5Clambda)(T-t)%7D%20%5Cmathbb%7B1%7D_%7BT%20%5Cgeq%20t%7D%20+%20%20%5Clambda%20R%20%5Ctimes%20%5Cfrac%7B1%20-%20e%5E%7B-(r+%5Clambda)(T-t)%7D%7D%7Br+%5Clambda%7D%20%5Cmathbb%7B1%7D_%7BT%20%5Cgeq%20t%7D%20%5Cright%5D%0A%5Cend%7Baligned%7D">
<div id="548af1df" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#------------------------------------#</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------- Package Imports ---------#</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#------------------------------------#</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-6">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yfinance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> yf </span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> bisect</span></code></pre></div>
</div>
<div id="85310a59" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> pricing_bond(t,c,T,r,lambda_,R,N,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Fonction qui calcule la valeur d'une obligation.</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    t : date actuelle</span></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    c : coupon</span></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    T : date de maturit√©</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    r : taux sans risque</span></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    lambda_ : intensit√© de d√©faut</span></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    R : taux de recouvrement</span></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    N : nominal</span></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-12"></span>
<span id="cb2-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Valorisation du coupon</span></span>
<span id="cb2-14">    Ct <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>([np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>lambda_) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span>t) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> Ti <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(dt, T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>dt,dt)])</span>
<span id="cb2-15"></span>
<span id="cb2-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Valorisation du nominal</span></span>
<span id="cb2-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#Proba de survie</span></span>
<span id="cb2-18">    PS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp( <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t))</span>
<span id="cb2-19">    Nt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp( <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> PS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span>t)</span>
<span id="cb2-20"></span>
<span id="cb2-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Valorisation du recouvrement</span></span>
<span id="cb2-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>lambda_)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> :</span>
<span id="cb2-23">        R_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t</span>
<span id="cb2-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> :</span>
<span id="cb2-25">        R_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ( <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp( <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>lambda_) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t)))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>lambda_)</span>
<span id="cb2-26">    Rt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> R_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> t)</span>
<span id="cb2-27"></span>
<span id="cb2-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### Valorisation de l'obligation</span></span>
<span id="cb2-29">    Bond <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Ct <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Nt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Rt</span>
<span id="cb2-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> Bond</span></code></pre></div>
</div>
</section>
<section id="i.-valorisation-dune-obligation-sans-risque-de-d√©faut" class="level2">
<h2 class="anchored" data-anchor-id="i.-valorisation-dune-obligation-sans-risque-de-d√©faut">I. Valorisation d‚Äôune obligation sans risque de d√©faut</h2>
<p>Nous souhaitons valoriser une obligation sans risque de d√©faut, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%200">. Pour ce faire, nous fixons les param√®tres suivants :</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?N%20=%201"> : le nominal de l‚Äôobligation</li>
<li><img src="https://latex.codecogs.com/png.latex?r%20=%200.02"> : le taux d‚Äôint√©r√™t sans risque</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%200"> : l‚Äôintensit√© de d√©faut</li>
<li><img src="https://latex.codecogs.com/png.latex?T%20=%2010"> : l‚Äô√©ch√©ance de l‚Äôobligation</li>
<li><img src="https://latex.codecogs.com/png.latex?c%20=%200.02"> : le coupon annuel</li>
<li><img src="https://latex.codecogs.com/png.latex?R%20=%200.4"> : le taux de recouvrement</li>
<li><img src="https://latex.codecogs.com/png.latex?n%20=%2010"> : le nombre de coupons</li>
<li><img src="https://latex.codecogs.com/png.latex?t%20=%200"> : l‚Äôinstant pr√©sent</li>
</ul>
<div id="a679d77a" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-3">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-4">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb3-5">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-6">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-7">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-8"></span>
<span id="cb3-9">B_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb3-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prix de l'obligation vu √† t=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>B_t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prix de l'obligation vu √† t=0 : 0.9981933497987289</code></pre>
</div>
</div>
<p>En valorisant l‚Äôobligation, nous obtenons un prix de <img src="https://latex.codecogs.com/png.latex?B_0%20%5Capprox%200.99">. Ce prix est proche du nominal, car les taux de coupons sont √©gaux au taux de march√©. L‚Äôobligation est dite au pair (Prix = Nominal) car elle r√©mun√®re au taux de march√©. Si <img src="https://latex.codecogs.com/png.latex?c%20%3E%20r">, le prix de l‚Äôobligation sera sup√©rieur au nominal, car le march√© se serait ru√© sur cette obligation, car elle offrirait plus que le taux de march√©. Sinon, le prix de l‚Äôobligation sera inf√©rieur au nominal, car le march√© serait plus r√©ticent.</p>
<blockquote class="blockquote">
<p>üí° La condition dans laquelle l‚Äôobligation √©mise vaut 100% du nominal, i.e.&nbsp;au pair, est <img src="https://latex.codecogs.com/png.latex?c%20%5Capprox%20r%20+%20%5Clambda">. C‚Äôest une obligation qui permet de recouvrir ausi bien le risque de taux (<img src="https://latex.codecogs.com/png.latex?r">) et le risque de cr√©dit li√© √† l‚Äôintensit√© de d√©faut (<img src="https://latex.codecogs.com/png.latex?%5Clambda">). Pour voir ceci, nous avons impl√©ment√© ci-dessous une fonction qui permet d‚Äôextrait le coupon qui permet d‚Äôavoir une obligation au pair, avec les m√™mes param√®tres que pr√©c√©demment.</p>
</blockquote>
<div id="027ced9f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb5-3">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb5-4">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb5-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb5-6">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># M√©thode de dichotomie</span></span>
<span id="cb5-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> trouver_coupon(t, T, r, lambda_, R, N, dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, tol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>):</span>
<span id="cb5-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Trouve le coupon c tel que la valeur de l'obligation soit √©gale √† N.</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb5-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> equation(c):</span>
<span id="cb5-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pricing_bond(t, c, T, r, lambda_, R, N, dt) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> N</span>
<span id="cb5-15">    </span>
<span id="cb5-16">    c_opt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bisect(equation, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, xtol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tol)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recherche de c dans l'intervalle [0,1]</span></span>
<span id="cb5-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> c_opt</span>
<span id="cb5-18"></span>
<span id="cb5-19">c_opt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> trouver_coupon(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t, T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T, r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r, lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_, R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R, N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb5-20">c_opt</span>
<span id="cb5-21"></span>
<span id="cb5-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Coupon pour avoir une obligation au pair vu √† t=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>c_opt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-23">B_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c_opt,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb5-24"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prix de l'obligation vu √† t=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>B_t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coupon pour avoir une obligation au pair vu √† t=0 : 2.64%
Prix de l'obligation vu √† t=0 : 1.000007783902349</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>De plus, lorsque l‚Äôintensit√© de d√©faut est tr√®s grande, on retrouve un prix √† peu pr√®s √©gal au taux de recouvrement. En effet, la probabilit√© de d√©faut est tr√®s grande et donc la probabilit√© qu‚Äôil y ait un recouvrement est tr√®s √©lev√©e. (voir exemple ci-dessous)</p>
</blockquote>
<div id="fc21ba8b" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb7-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb7-3">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb7-4">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb7-5">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb7-6">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb7-7">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-8"></span>
<span id="cb7-9"></span>
<span id="cb7-10">B_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb7-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prix de l'obligation vu √† t=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>B_t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Taux de recouvrement : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prix de l'obligation vu √† t=0 : 0.3992
Taux de recouvrement : 0.4000</code></pre>
</div>
</div>
</section>
<section id="ii.-evolution-du-prix-de-lobligation-en-fonction-du-temps" class="level2">
<h2 class="anchored" data-anchor-id="ii.-evolution-du-prix-de-lobligation-en-fonction-du-temps">II. Evolution du prix de l‚Äôobligation en fonction du temps</h2>
<p>Durant la vie de l‚Äôobligation, son prix √©volue en fonction des paiements de coupons. √Ä chaque distribution de coupon, une chute du prix de l‚Äôobligation est observ√©e. Cette baisse s‚Äôexplique par le fait que, juste avant le versement, le prix de l‚Äôobligation int√®gre la valeur du coupon √† percevoir. Une fois le coupon pay√© aux d√©tenteurs, cette valeur dispara√Æt, entra√Ænant m√©caniquement une diminution du prix de l‚Äôobligation, jusqu‚Äô√† atteindre le nominal de l‚Äôobligation ainsi que le dernier coupon.</p>
<p>Toutefois, apr√®s cette chute li√©e au d√©tachement du coupon, la valeur de l‚Äôobligation remonte progressivement √† mesure que l‚Äô√©ch√©ance du prochain coupon approche. Ce ph√©nom√®ne cr√©e une √©volution en dents de scie, o√π chaque baisse correspond √† un paiement de coupon et chaque remont√©e traduit l‚Äôaccumulation de la valeur du prochain paiement attendu.</p>
<p>Bien que ce ph√©nom√®ne soit logique et attendu, il peut √™tre per√ßu n√©gativement car la forme en dents de scie pourrait donner l‚Äôimpression d‚Äôune d√©gradation de la qualit√© de l‚Äôobligation. C‚Äôest pourquoi on distingue deux types de prix :</p>
<ul>
<li>Le dirty price (prix sale) : il correspond au prix de l‚Äôobligation tel qu‚Äôaffich√© sur le march√©, int√©grant les variations dues aux paiements de coupons.</li>
<li>Le clean price (prix net ou pied de coupon) : il correspond au prix de l‚Äôobligation ‚Äúnettoy√©‚Äù des coupons accumul√©s. Ce prix est obtenu en soustrayant les int√©r√™ts courus au dirty price. Ainsi, le clean price permet d‚Äô√©valuer plus pr√©cis√©ment la valeur intrins√®que de l‚Äôobligation sans √™tre pollu√© par les variations dues aux paiements p√©riodiques de coupons. C‚Äôest cette valeur qui est g√©n√©ralement utilis√©e pour comparer les obligations entre elles.</li>
</ul>
<p>Pour illustrer cette √©volution, nous avons trac√© l‚Äô√©volution du prix de l‚Äôobligation en fonction du temps. Nous avons fix√© les param√®tres suivants :</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?N%20=%201"> : le nominal de l‚Äôobligation</li>
<li><img src="https://latex.codecogs.com/png.latex?r%20=%200.02"> : le taux d‚Äôint√©r√™t sans risque</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%200.01"> : l‚Äôintensit√© de d√©faut</li>
<li><img src="https://latex.codecogs.com/png.latex?T%20=%2010"> : l‚Äô√©ch√©ance de l‚Äôobligation</li>
<li><img src="https://latex.codecogs.com/png.latex?c%20=%200.03"> : le coupon annuel</li>
<li><img src="https://latex.codecogs.com/png.latex?R%20=%200.4"> : le taux de recouvrement</li>
<li><img src="https://latex.codecogs.com/png.latex?n%20=%2010"> : le nombre de coupons</li>
<li><img src="https://latex.codecogs.com/png.latex?t%20=%200"> : l‚Äôinstant pr√©sent</li>
</ul>
<div id="d4a5a955" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> myFloor(x):</span>
<span id="cb9-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb9-3">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb9-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>np.floor(x):</span>
<span id="cb9-5">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb9-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.floor(x)</span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> clean_price(t,c,T,r,lambda_,R,N,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb9-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb9-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Fonction qui calcule le prix d'une obligation propre.</span></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb9-12">    B_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t,c,T,r,lambda_,R,N,dt)</span>
<span id="cb9-13">    cc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> myFloor(t))</span>
<span id="cb9-14"></span>
<span id="cb9-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> B_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cc</span></code></pre></div>
</div>
<div id="8d16247d" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb10-3">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb10-4">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb10-5">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb10-6">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb10-7">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-8"></span>
<span id="cb10-9"></span>
<span id="cb10-10">dirty_prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-11">clean_prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb10-12">grid_values_c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span>
<span id="cb10-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> grid_values_c:</span>
<span id="cb10-14">    dirty_prices.append(pricing_bond(t,c,T,r,lambda_,R,N))</span>
<span id="cb10-15">    clean_prices.append(clean_price(t,c,T,r,lambda_,R,N))</span>
<span id="cb10-16"></span>
<span id="cb10-17"></span>
<span id="cb10-18"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb10-19">plt.plot(grid_values_c,dirty_prices, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices"</span>)</span>
<span id="cb10-20">plt.plot(grid_values_c,clean_prices, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clean prices"</span>)</span>
<span id="cb10-21">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices vs Clean prices"</span>)</span>
<span id="cb10-22">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>)</span>
<span id="cb10-23">plt.grid()</span>
<span id="cb10-24">plt.legend()</span>
<span id="cb10-25">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix de l'obligation"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>Text(0, 0.5, "Prix de l'obligation")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="a.-cas-extr√™mes" class="level3">
<h3 class="anchored" data-anchor-id="a.-cas-extr√™mes">a. Cas extr√™mes</h3>
<p>Nous avons analys√© l‚Äô√©volution du prix de l‚Äôobligation dans deux cas extr√™mes afin d‚Äôobserver l‚Äôimpact du coupon sur la dynamique des prix. Toutes choses √©gales par ailleurs, nous avons modifi√© le coupon de l‚Äôobligation tout en conservant les autres param√®tres constants. Les deux sc√©narios √©tudi√©s sont les suivants :</p>
<ul>
<li>$ c = 0.01 $ : le coupon est inf√©rieur au taux d‚Äôint√©r√™t sans risque.<br>
</li>
<li>$ c = 0.05 $ : le coupon est sup√©rieur au taux d‚Äôint√©r√™t sans risque.</li>
</ul>
<section id="cas-1-c-0.01" class="level4">
<h4 class="anchored" data-anchor-id="cas-1-c-0.01">Cas 1 : $ c = 0.01 $</h4>
<p>Lorsque $ c = 1% $ et que ce coupon est inf√©rieur au taux d‚Äôint√©r√™t sans risque $ r $, la valeur de l‚Äôobligation √©volue de mani√®re sp√©cifique :</p>
<ul>
<li>Au d√©part, l‚Äôobligation est escompt√©e car le coupon est faible, et les investisseurs anticipent un rendement global inf√©rieur au taux du march√©.<br>
</li>
<li>√Ä mesure que l‚Äô√©ch√©ance approche, l‚Äôincertitude sur le paiement du coupon dispara√Æt progressivement. Les investisseurs deviennent de plus en plus certains que le paiement aura bien lieu.<br>
</li>
<li>√Ä la veille du paiement, l‚Äôobligation converge vers un prix proche de $ N + c $ pour le dirty price (car elle inclut le coupon accumul√©) et $ N $ pour le clean price (qui exclut le coupon accumul√©).</li>
</ul>
<p>Cela signifie que l‚Äôobligation s‚Äôappr√©cie au fil du temps en raison de la certitude croissante du paiement des flux futurs. En d‚Äôautres termes, plus l‚Äô√©ch√©ance se rapproche, plus l‚Äôinvestisseur est assur√© de recevoir ses paiements, ce qui entra√Æne une augmentation progressive de la valeur de l‚Äôobligation.</p>
<div id="ae9fe8b7" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb12-2">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb12-3">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb12-4">c1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb12-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb12-6">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb12-7"></span>
<span id="cb12-8">clean_prices1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-9">dirty_prices1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb12-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> grid_values_c:</span>
<span id="cb12-11">    B_t_dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c1,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb12-12">    B_t_clean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clean_price(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c1,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb12-13">    clean_prices1.append(B_t_clean)</span>
<span id="cb12-14">    dirty_prices1.append(B_t_dirty)</span>
<span id="cb12-15"></span>
<span id="cb12-16">plt.plot(grid_values_c,clean_prices1, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clean prices"</span>)</span>
<span id="cb12-17">plt.plot(grid_values_c,dirty_prices1, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices"</span>)</span>
<span id="cb12-18">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clean prices vs Dirty prices"</span>)</span>
<span id="cb12-19">plt.legend()</span>
<span id="cb12-20">plt.grid()</span>
<span id="cb12-21">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>)</span>
<span id="cb12-22">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix de l'obligation"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Text(0, 0.5, "Prix de l'obligation")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-9-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cas-2-c-0.05" class="level4">
<h4 class="anchored" data-anchor-id="cas-2-c-0.05">Cas 2 : $ c = 0.05 $</h4>
<p>Lorsque $ c = 5% $ et que ce coupon est sup√©rieur au taux d‚Äôint√©r√™t sans risque $ r $, la dynamique du prix de l‚Äôobligation suit une √©volution inverse :</p>
<ul>
<li>Au d√©part, l‚Äôobligation est pris√©e au-dessus du nominal (elle se n√©gocie avec une prime). Cela s‚Äôexplique par le fait que son coupon g√©n√©reux attire les investisseurs, qui consid√®rent que le rendement offert par l‚Äôobligation compense largement le risque de cr√©dit et est plus attractif que les opportunit√©s de placement √† taux sans risque.<br>
</li>
<li>√Ä mesure que l‚Äô√©ch√©ance approche, la valeur de l‚Äôobligation se depr√©cie progressivement. En effet, √† chaque p√©riode, l‚Äôinvestisseur re√ßoit un coupon √©lev√©, mais √† l‚Äô√©ch√©ance, il ne r√©cup√®re que le nominal $ N $, ce qui entra√Æne une correction progressive du prix de march√©.<br>
</li>
<li>√Ä la veille du remboursement, l‚Äôobligation converge vers $ N + c $ pour le dirty price (qui inclut le dernier coupon √† verser) et vers $ N $ pour le clean price.</li>
</ul>
<p>Ainsi, cette obligation se d√©pr√©cie progressivement jusqu‚Äô√† l‚Äô√©ch√©ance, car l‚Äôeffet attractif du coupon √©lev√© s‚Äôamenuise √† mesure que le remboursement du capital nominal devient imminent. En d‚Äôautres termes, l‚Äôobligation part d‚Äôune valeur sup√©rieure √† son nominal mais perd progressivement sa prime √† l‚Äôapproche de l‚Äô√©ch√©ance.</p>
<div id="d1ed4ba9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-2">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-3">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb14-4">c2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb14-6">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb14-7"></span>
<span id="cb14-8">clean_prices2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb14-9">dirty_prices2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb14-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> grid_values_c:</span>
<span id="cb14-11">    B_t_dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c2,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb14-12">    B_t_clean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clean_price(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c2,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb14-13">    clean_prices2.append(B_t_clean)</span>
<span id="cb14-14">    dirty_prices2.append(B_t_dirty)</span>
<span id="cb14-15"></span>
<span id="cb14-16">plt.plot(grid_values_c,clean_prices2, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clean prices"</span>)</span>
<span id="cb14-17">plt.plot(grid_values_c,dirty_prices2, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices"</span>)</span>
<span id="cb14-18">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clean prices vs Dirty prices"</span>)</span>
<span id="cb14-19">plt.legend()</span>
<span id="cb14-20">plt.grid()</span>
<span id="cb14-21">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>)</span>
<span id="cb14-22">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix de l'obligation"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Text(0, 0.5, "Prix de l'obligation")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-10-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="iii.-√©volution-du-prix-en-fonction-du-taux-dint√©r√™t" class="level2">
<h2 class="anchored" data-anchor-id="iii.-√©volution-du-prix-en-fonction-du-taux-dint√©r√™t">III. √âvolution du prix en fonction du taux d‚Äôint√©r√™t</h2>
<p>Le prix d‚Äôune obligation est une fonction d√©croissante du taux d‚Äôint√©r√™t. En effet, plus le taux d‚Äôint√©r√™t est √©lev√©, plus la valeur actualis√©e des flux futurs (coupons et remboursement du nominal) est faible, ce qui r√©duit m√©caniquement le prix de l‚Äôobligation.</p>
<p>Dans cette analyse, il est inutile de distinguer le dirty price et le clean price, car la diff√©rence entre les deux ne d√©pend pas du taux d‚Äôint√©r√™t. De plus, en consid√©rant $t = 0 <img src="https://latex.codecogs.com/png.latex?,%20il%20n'y%20a%20pas%20encore%20d%E2%80%99int%C3%A9r%C3%AAts%20courus%20(">c = 0 $), donc les deux prix co√Øncident.</p>
<section id="obligation-au-pair" class="level3">
<h3 class="anchored" data-anchor-id="obligation-au-pair">Obligation au pair</h3>
<p>Autour de $c - = 2% $, le prix de l‚Äôobligation est √©gal au nominal. Cela s‚Äôexplique par le fait que le taux de coupon est exactement √©gal au taux de march√©. L‚Äôobligation est alors dite ‚Äúau pair‚Äù, car les investisseurs n‚Äôont ni prime ni d√©cote √† appliquer sur son prix.</p>
</section>
<section id="explication-de-la-relation-n√©gative-entre-prix-et-taux" class="level3">
<h3 class="anchored" data-anchor-id="explication-de-la-relation-n√©gative-entre-prix-et-taux">Explication de la relation n√©gative entre prix et taux</h3>
<p>La relation n√©gative entre le prix d‚Äôune obligation et le taux d‚Äôint√©r√™t s‚Äôexplique par l‚Äôeffet de substitution avec les nouvelles √©missions obligataires.</p>
<ul>
<li>Lorsque les taux d‚Äôint√©r√™t augmentent, de nouvelles obligations sont √©mises avec des coupons plus attractifs.<br>
</li>
<li>En cons√©quence, les obligations existantes, qui offrent un coupon fixe plus faible, deviennent moins int√©ressantes pour les investisseurs. Leur prix diminue afin d‚Äôajuster leur rendement effectif au nouveau niveau des taux du march√©.<br>
</li>
<li>Inversement, si les taux d‚Äôint√©r√™t baissent, les obligations existantes deviennent plus attractives puisqu‚Äôelles offrent un coupon plus √©lev√© que les nouvelles √©missions, ce qui entra√Æne une hausse de leur prix sur le march√© secondaire.</li>
</ul>
<p>Ainsi, la sensibilit√© d‚Äôune obligation aux variations de taux d‚Äôint√©r√™t, appel√©e ‚Äúduration‚Äù, est un √©l√©ment cl√© dans l‚Äô√©valuation du risque de taux et la gestion de portefeuille obligataire.</p>
<div id="badce34a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb16-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb16-3">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb16-4">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb16-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb16-6">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb16-7"></span>
<span id="cb16-8">dirty_prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb16-9">grid_values_r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>) </span>
<span id="cb16-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> r <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> grid_values_r:</span>
<span id="cb16-11">    B_t_dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N)</span>
<span id="cb16-12">    dirty_prices.append(B_t_dirty)</span>
<span id="cb16-13"></span>
<span id="cb16-14">plt.plot(grid_values_r,dirty_prices, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices"</span>)</span>
<span id="cb16-15">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix de l'obligation en fonction du taux d'int√©r√™t"</span>)</span>
<span id="cb16-16">plt.legend()</span>
<span id="cb16-17">plt.grid()</span>
<span id="cb16-18">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb16-19">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix de l'obligation"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Text(0, 0.5, "Prix de l'obligation")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="iv.-sensibilit√©-du-prix-de-lobligation-au-taux-dint√©r√™t-duration" class="level2">
<h2 class="anchored" data-anchor-id="iv.-sensibilit√©-du-prix-de-lobligation-au-taux-dint√©r√™t-duration">IV. Sensibilit√© du prix de l‚Äôobligation au taux d‚Äôint√©r√™t / Duration</h2>
<p>La duration est une mesure de la sensibilit√© du prix d‚Äôune obligation aux variations du taux d‚Äôint√©r√™t. Elle permet d‚Äô√©valuer le risque de taux, c‚Äôest-√†-dire l‚Äôimpact d‚Äôune variation des taux sur la valeur de l‚Äôobligation.</p>
<blockquote class="blockquote">
<p>Dans le cas de l‚Äô√©volution du prix en fonction du taux d‚Äôint√©r√™t, la duration sera donc la pente de la courbe repr√©sentant cette relation.</p>
</blockquote>
<p>Math√©matiquement, la duration est d√©finie comme la d√©riv√©e du prix de l‚Äôobligation par rapport au taux d‚Äôint√©r√™t :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cdelta%20=%20-%20%5Cfrac%7Bd%20B_t%7D%7Bd%20r%7D%20%5Ctimes%20%5Cfrac%7B1%7D%7BB_t%7D%0A"></p>
<p>En utilisant une approximation en diff√©rences finies, on exprime cette d√©riv√©e de la mani√®re suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7Bd%20B_t%7D%7Bd%20r%7D%20%20%5Capprox%20%5Cfrac%7BB_t(r+%5CDelta%20r)%20-%20B_t(r)%7D%7B%5CDelta%20r%7D%0A"></p>
<p>Cette sensibilit√© permet de mesurer la variation du prix de l‚Äôobligation en r√©ponse √† une fluctuation du taux d‚Äôint√©r√™t, offrant ainsi une √©valuation directe du risque de taux auquel est expos√© l‚Äôinvestisseur. De ce fait, si les taux d‚Äôint√©r√™t bouge de <img src="https://latex.codecogs.com/png.latex?%5CDelta%20r"> = 1%, alors les prix bougeront de -sensibilit√© * <img src="https://latex.codecogs.com/png.latex?%5CDelta%20r"> .</p>
<p>Nous allons impl√©menter ce calcul en Python, en prenant <img src="https://latex.codecogs.com/png.latex?%5CDelta%20r%20=%201"> bp (soit <img src="https://latex.codecogs.com/png.latex?0.0001"> en notation d√©cimale).</p>
<div id="c2fbab8d" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sensivity_to_rate(t,c,T,r,lambda_,R,N,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,dr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>):</span>
<span id="cb18-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Fonction qui calcule la sensibilit√© d'une obligation √† un taux d'int√©r√™t.</span></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb18-5">    B_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t,c,T,r,lambda_,R,N,dt)</span>
<span id="cb18-6">    B_t_plus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t,c,T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>dr,lambda_,R,N,dt)</span>
<span id="cb18-7">    sensivity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>((B_t_plus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> B_t)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dr) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>B_t)</span>
<span id="cb18-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> sensivity</span></code></pre></div>
</div>
<p>Si les taux d‚Äôint√©r√™t bouge de <img src="https://latex.codecogs.com/png.latex?%5CDelta%20r"> = 1%, alors les prix bougeront de -sensibilit√© * <img src="https://latex.codecogs.com/png.latex?%5CDelta%20r"> = -8,64 * 1%. La duration va √™tre souvent proche de la maturit√©.</p>
<div id="59cf8e12" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb19-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-3">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb19-4">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-6">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-7">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb19-8"></span>
<span id="cb19-9">sensivity_to_rate(t,c,T,r,lambda_,R,N)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>np.float64(8.643982489102903)</code></pre>
</div>
</div>
<p>D‚Äôun point de vue graphique, il existe une certaine identit√© entre la maturit√© et la duration, car cette derni√®re peut √™tre interpr√©t√©e comme le barycentre des flux futurs de l‚Äôobligation. Plus ces flux sont concentr√©s dans le temps, plus leur pond√©ration affecte la sensibilit√© du prix aux variations des taux d‚Äôint√©r√™t.</p>
<section id="lien-entre-duration-et-maturit√©" class="level4">
<h4 class="anchored" data-anchor-id="lien-entre-duration-et-maturit√©">Lien entre duration et maturit√©</h4>
<ul>
<li>La duration est une approximation de la dur√©e d‚Äôexposition au risque, ajust√©e en fonction des flux de paiements.<br>
</li>
<li>Elle est souvent proche de la maturit√© moyenne de l‚Äôobligation, bien que l√©g√®rement inf√©rieure (environ 80% de la maturit√© totale, en fonction des conditions de march√© et du niveau des coupons).</li>
</ul>
<p>Ainsi, plus l‚Äô√©ch√©ance de l‚Äôobligation se rapproche, plus la duration tend √† augmenter, car les flux futurs deviennent plus proches dans le temps, rendant l‚Äôobligation plus sensible aux variations des taux d‚Äôint√©r√™t.</p>
<blockquote class="blockquote">
<p>Lorsque la maturit√© de l‚Äôobligation approche, sa sensibilit√© au taux d‚Äôint√©r√™t tend √† augmenter. En effet, la duration peut √™tre interpr√©t√©e comme une mesure du temps moyen pond√©r√© pendant lequel l‚Äôinvestisseur est expos√© au risque de taux.</p>
</blockquote>
<div id="ed567e4e" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb21-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb21-3">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb21-4">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb21-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb21-6">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb21-7"></span>
<span id="cb21-8">dirty_prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb21-9">grid_values_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb21-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> T <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> grid_values_T:</span>
<span id="cb21-11">    B_t_dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sensivity_to_rate(t,c,T,r,lambda_,R,N)</span>
<span id="cb21-12">    dirty_prices.append(B_t_dirty)</span>
<span id="cb21-13"></span>
<span id="cb21-14">plt.plot(grid_values_T,dirty_prices, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices"</span>)</span>
<span id="cb21-15">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sensibilit√© en fonction de la maturit√©"</span>)</span>
<span id="cb21-16">plt.legend()</span>
<span id="cb21-17">plt.grid()</span>
<span id="cb21-18">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>)</span>
<span id="cb21-19">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sensibilit√©"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Text(0, 0.5, 'Sensibilit√©')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cas-particulier-absence-de-coupon-de-taux-dint√©r√™t-et-de-risque-de-d√©faut" class="level4">
<h4 class="anchored" data-anchor-id="cas-particulier-absence-de-coupon-de-taux-dint√©r√™t-et-de-risque-de-d√©faut">Cas particulier : absence de coupon, de taux d‚Äôint√©r√™t et de risque de d√©faut</h4>
<p>Lorsque le coupon, le taux d‚Äôint√©r√™t et l‚Äôintensit√© de d√©faut sont nuls, la duration est exactement √©gale √† la maturit√© de l‚Äôobligation. Puisque la duration peut √™tre interpr√©t√©e comme le barycentre des flux futurs de l‚Äôobligation, lorsque le coupon et l‚Äôintensit√© de d√©faut sont nuls, tous les flux sont concentr√©s √† l‚Äô√©ch√©ance, ce qui √©quivaut √† la maturit√© de l‚Äôobligation.</p>
<div id="62d0b679" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb23-2">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10e-6</span></span>
<span id="cb23-3">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb23-4">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb23-5"></span>
<span id="cb23-6"></span>
<span id="cb23-7">dirty_prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb23-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> T <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> grid_values_T:</span>
<span id="cb23-9">    B_t_dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sensivity_to_rate(t,c,T,r,lambda_,R,N)</span>
<span id="cb23-10">    dirty_prices.append(B_t_dirty)</span>
<span id="cb23-11"></span>
<span id="cb23-12">plt.plot(grid_values_T,dirty_prices, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices"</span>)</span>
<span id="cb23-13">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sensibilit√© au taux en fonction de la maturit√©"</span>)</span>
<span id="cb23-14">plt.legend()</span>
<span id="cb23-15">plt.grid()</span>
<span id="cb23-16">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>)</span>
<span id="cb23-17">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sensibilit√©"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Text(0, 0.5, 'Sensibilit√©')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-15-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>Dans le risque de taux, le principale indicateur est la duration.</p>
</blockquote>
</section>
</section>
<section id="v.-mod√®lisation-de-la-var" class="level2">
<h2 class="anchored" data-anchor-id="v.-mod√®lisation-de-la-var">V. Mod√®lisation de la VaR</h2>
<section id="v.1.-approche-par-la-sensibilit√©" class="level3">
<h3 class="anchored" data-anchor-id="v.1.-approche-par-la-sensibilit√©">V.1. Approche par la sensibilit√©</h3>
<p>Selon le mod√®le de Hull et White, le taux d‚Äôint√©r√™t est mod√©lis√© par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Adr%20=%20%5Ctheta%20(%20%5Cmu%20-%20r)%20dt%20+%20%5Csigma%20dW%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> est le coefficient de vitesse de r√©version, <img src="https://latex.codecogs.com/png.latex?%5Cmu"> est le taux d‚Äôint√©r√™t moyen, <img src="https://latex.codecogs.com/png.latex?%5Csigma"> est la volatilit√© du taux d‚Äôint√©r√™t et <img src="https://latex.codecogs.com/png.latex?dW"> est un mouvement brownien. Ce mod√®le a la sp√©cifit√© d‚Äô√™tre normale. De ce fait, <img src="https://latex.codecogs.com/png.latex?%5CDelta%20r%20%5Csim%20N(0,%20%5Csigma%5E2%20%5CDelta%20t)">. En faisant l‚Äôapproximation de la variation du prix, il est possible d‚Äôapprocher une VaR par la sensibilit√© :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0ADuration%20&amp;=%20-%20%5Cfrac%7Bd%20B_t%7D%7Bd%20r%7D%20%5Ctimes%20%5Cfrac%7B1%7D%7BB_t%7D%20%5C%5C%0A%5Cfrac%7Bd%20B_t%7D%7BB_t%7D%20&amp;%5Capprox%20-%20Duration%20%5Ctimes%20%20%5CDelta%20r%20%5C%5C%0A%5Cend%7Baligned%7D%0A"></p>
<div id="c6303e61" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : √©crire une fonction qui calcule la VaR avec l'approche par duration</span></span>
<span id="cb25-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sensitive_VaR(mu,sigma,t,c,T,r,lambda_,R,N,h,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>) :</span>
<span id="cb25-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb25-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb25-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb25-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb25-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb25-10">    Duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sensivity_to_rate(t,c,T,r,lambda_,R,N,dt)</span>
<span id="cb25-11"></span>
<span id="cb25-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Duration <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(h) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha))</span>
<span id="cb25-13"></span>
<span id="cb25-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#--------------------------------------</span></span>
<span id="cb25-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres du mod√®le de taux</span></span>
<span id="cb25-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------------------</span></span>
<span id="cb25-17"></span>
<span id="cb25-18">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb25-19">h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb25-20">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb25-21"></span>
<span id="cb25-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#--------------------------------------</span></span>
<span id="cb25-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres de la valorisation du bond</span></span>
<span id="cb25-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------------------</span></span>
<span id="cb25-25"></span>
<span id="cb25-26">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb25-27">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb25-28">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb25-29">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb25-30">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb25-31">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb25-32">T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb25-33"></span>
<span id="cb25-34">VaR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sensitive_VaR(mu,sigma,t,c,T,r,lambda_,R,N,h<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>h,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>)</span>
<span id="cb25-35"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR estim√© par l'approche par la sensibilit√© : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VaR estim√© par l'approche par la sensibilit√© : 5.8049%</code></pre>
</div>
</div>
<p>Pour cette estimation, nous avions suppos√© que la volatilit√© <img src="https://latex.codecogs.com/png.latex?%5Csigma%20=%201%5C%25">. Cependant, cette hypoth√®se pourrait s‚Äô√©carter de la r√©alit√©. Pour ce faire, nous allons extraire les donn√©es de taux d‚Äôint√©r√™t et calculer la volatilit√© empirique. L‚ÄôESTR est un taux un jour collat√©ralis√©,c‚Äôest donc quasiment sans risque. Nous allons donc utiliser ce taux pour calculer la volatilit√© empirique. Pour cela, nous allons utiliser l‚Äôhistorique des taux d‚Äôint√©r√™t de l‚ÄôESTR sur une p√©riode de 5 ans, i.e.&nbsp;10/03/2025 - 12/03/2020, disponible sur ce <a href="data/estr.xlsx">lien</a>.</p>
<p>Pour ce faire, nous utilisons la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma%20=%20%5Csqrt%7B%5Cfrac%7B1%7D%7Bn-1%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(r_i%20-%20%5Cbar%7Br%7D)%5E2%7D%0A"></p>
<p>Nous constatons que la volatilit√© empirique sur les 5 ans est de 25.45%. Cette valeur est tr√®s √©lev√©e, ce qui signifie que les taux d‚Äôint√©r√™t ont connu des variations importantes sur cette p√©riode. Cela peut √™tre du √† la trop grande p√©riode utilis√©e pour la calibration de la volatilit√©. Pour ce faire, nous avons restreint la p√©riode √† 1 an, i.e.&nbsp;10/03/2025 - 10/03/2024. La volatilit√© empirique sur cette p√©riode est de 1.04%. Cette valeur est plus coh√©rente avec les taux d‚Äôint√©r√™t sans risque.</p>
<div id="698ebb08" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb27-2">estr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_excel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/estr.xlsx"</span>, skiprows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb27-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#date as date</span></span>
<span id="cb27-4">estr_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(estr_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb27-5">estr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> estr_df.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>)</span>
<span id="cb27-6">estr_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> estr_df.sort_index()</span>
<span id="cb27-7"></span>
<span id="cb27-8">estr_df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PX_LAST</th>
<th data-quarto-table-cell-role="th">CHG_PCT_1D</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-12</td>
<td>-0.540</td>
<td>0.5525</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-03-13</td>
<td>-0.541</td>
<td>-0.1852</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-16</td>
<td>-0.536</td>
<td>0.9242</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-03-17</td>
<td>-0.531</td>
<td>0.9328</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-18</td>
<td>-0.529</td>
<td>0.3766</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="417607b8" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">vol_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(estr_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PX_LAST"</span>].pct_change())</span>
<span id="cb28-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© estim√©e sur 5 ans: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>vol_est<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># volatilit√© sur 1 an</span></span>
<span id="cb28-5">vol_est<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(estr_df.loc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-03-10"</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2025-03-10"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PX_LAST"</span>].pct_change())</span>
<span id="cb28-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© estim√©e sur 1 an : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>vol_est<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Volatilit√© estim√©e sur 5 ans: 0.2545
Volatilit√© estim√©e sur 1 an : 0.0104</code></pre>
</div>
</div>
</section>
<section id="v.2.-approche-avec-un-repricing" class="level3">
<h3 class="anchored" data-anchor-id="v.2.-approche-avec-un-repricing">V.2. Approche avec un repricing</h3>
<p>Cette approche consiste √† revaloriser, sous l‚Äôhypoth√®se de normalit√© des taux, l‚Äôobligation √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t"> pour un taux <img src="https://latex.codecogs.com/png.latex?r%20+%20%5CDelta%20r"> et de calculer la perte maximale possible. De ce fait, elle est plus pr√©cise que l‚Äôapproche par la sensibilit√©.</p>
<p>Puisque dans le cas d‚Äôune obligation, ce dont on veut se pr√©munir c‚Äôest de la hausse des taux (puisqu‚Äôelle fait baisser le taux d‚Äôint√©r√™t). De ce fait, la VaR est donn√©e par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVaR%7D%20=%20%20-%20%5Cfrac%7BB_t(r%20+%20%5CDelta%20r)%20-%20B_t%20%7D%7BB_t%7D,%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5CDelta%20r"> est la variation des taux d‚Äôint√©r√™t.</p>
<p>Par d√©finition, la VaR estim√©e sera plus basse que l‚Äôautre approche en raison de la convexit√© de l‚Äô√©volution du prix de l‚Äôobligation en fonction des taux d‚Äôint√©r√™t. La Var par l‚Äôapproche de la sensibilit√©, quant √† elle, suppose une lin√©arit√© de l‚Äô√©volution du prix de l‚Äôobligation en fonction des taux d‚Äôint√©r√™t.</p>
<div id="f22cdcfd" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> repricing_VaR(mu,sigma,t,c,T,r,lambda_,R,N,h,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>) :</span>
<span id="cb30-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb30-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb30-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb30-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb30-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb30-7">    delta_r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(h) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.ppf(alpha)</span>
<span id="cb30-8">    P_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t,c,T,r,lambda_,R,N,dt)</span>
<span id="cb30-9">    P_t_shocked <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t,c,T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>delta_r,lambda_,R,N,dt)</span>
<span id="cb30-10"></span>
<span id="cb30-11">    VAR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>( (P_t_shocked <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> P_t)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>P_t)</span>
<span id="cb30-12"></span>
<span id="cb30-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> VAR, delta_r</span>
<span id="cb30-14"></span>
<span id="cb30-15"></span>
<span id="cb30-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#--------------------------------------</span></span>
<span id="cb30-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres du mod√®le de taux</span></span>
<span id="cb30-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------------------</span></span>
<span id="cb30-19">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb30-20">h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb30-21">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb30-22"></span>
<span id="cb30-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#--------------------------------------</span></span>
<span id="cb30-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres de la valorisation du bond</span></span>
<span id="cb30-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------------------</span></span>
<span id="cb30-26">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb30-27">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb30-28">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb30-29">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb30-30">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb30-31">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb30-32">T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb30-33"></span>
<span id="cb30-34">VaR, delta_r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> repricing_VaR(mu,sigma,t,c,T,r,lambda_,R,N,h<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>h,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>)</span>
<span id="cb30-35"></span>
<span id="cb30-36"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR estim√© par l'approche par le r√©ajustement : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb30-37"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Choc de taux : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>delta_r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VaR estim√© par l'approche par le r√©ajustement : 5.6272%
Choc de taux : 0.67%</code></pre>
</div>
</div>
</section>
</section>
<section id="vi.-focus-risque-de-cr√©dit-contrepartie" class="level2">
<h2 class="anchored" data-anchor-id="vi.-focus-risque-de-cr√©dit-contrepartie">VI. Focus risque de cr√©dit &amp; contrepartie</h2>
<p>Le risque de cr√©dit est le risque que l‚Äô√©metteur d‚Äôune obligation ne soit pas en mesure de respecter ses engagements financiers, entra√Ænant ainsi des pertes pour les investisseurs. Ce risque est particuli√®rement pertinent dans le contexte des obligations, car il peut affecter la valeur de l‚Äôobligation et la capacit√© de l‚Äôinvestisseur √† r√©cup√©rer son capital. Le risque de contrepartie, quant √† lui, est le risque que la contrepartie d‚Äôune transaction financi√®re ne respecte pas ses obligations contractuelles. Dans le cas des obligations, cela peut se traduire par le non-paiement des coupons ou du capital √† l‚Äô√©ch√©ance. Ce risque est particuli√®rement important dans les transactions de gr√© √† gr√© (OTC), o√π les parties ne sont pas soumises aux m√™mes exigences r√©glementaires que celles des march√©s organis√©s.</p>
<section id="vi.1.-comment-estimer-lintensit√©-de-d√©faut" class="level3">
<h3 class="anchored" data-anchor-id="vi.1.-comment-estimer-lintensit√©-de-d√©faut">VI.1. Comment estimer l‚Äôintensit√© de d√©faut ?</h3>
<p>Pr√©cedemment, nous avons valoriser l‚Äôobligation de la mani√®re suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AB_t%20&amp;=%20C_t%20+%20N_t%20+%20R_t%20%5C%5C%0A&amp;=%20N%20%5Cleft%5B%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%20c%20%5Ctimes%20e%5E%7B-(r%20+%20%5Clambda)%20%5Ctimes%20(T_i%0A-t)%7D%20%5Cmathbb%7B1%7D_%7BT_i%20%5Cgeq%20t%7D%20+%20e%5E%7B-(r+%5Clambda)(T-t)%7D%20%5Cmathbb%7B1%7D_%7BT%20%5Cgeq%20t%7D%20+%20%20%5Clambda%20R%20%5Ctimes%20%5Cfrac%7B1%20-%20e%5E%7B-(r+%5Clambda)(T-t)%7D%7D%7Br+%5Clambda%7D%20%5Cmathbb%7B1%7D_%7BT%20%5Cgeq%20t%7D%20%5Cright%5D%0A%5Cend%7Baligned%7D%0A"></p>
<p>et nous avons signfi√© la condition dans laquelle l‚Äôobligation √©mise vaut 100% du nominal, i.e.&nbsp;au pair, est <img src="https://latex.codecogs.com/png.latex?c%20%5Capprox%20r%20+%20%5Clambda">. Cependant, ce n‚Äôest pas exact.</p>
<p>Soit un coupon pay√© en continu, la valorisation de l‚Äôobligation est donn√©e par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0AB_t%20&amp;=%20N%20%5Cleft%5B%20%5Cint_%7Bt%7D%5E%7BT%7D%20c%20e%5E%7B-(r%20+%20%5Clambda)%20%5Ctimes%20(u-t)%7D%20du%20+%20e%5E%7B-(r+%5Clambda)(T-t)%7D%20+%20%20%5Clambda%20R%20%5Ctimes%20%5Cfrac%7B1%20-%20e%5E%7B-(r+%5Clambda)(T-t)%7D%7D%7Br+%5Clambda%7D%20%5Cright%5D%5C%5C%0A&amp;=%20N%20%5Cleft%5B%20%5Cfrac%7Bc%7D%7Br%20+%20%5Clambda%7D%20%5Cleft(1%20-%20e%5E%7B-(r%20+%20%5Clambda)(T-t)%7D%20%5Cright)%20+%20e%5E%7B-(r+%5Clambda)(T-t)%7D%20+%20%20%5Clambda%20R%20%5Ctimes%20%5Cfrac%7B1%20-%20e%5E%7B-(r+%5Clambda)(T-t)%7D%7D%7Br+%5Clambda%7D%20%5Cright%5D%5C%5C%0AB_t%20=%20N%20&amp;%5CLeftrightarrow%20c%20=%20r%20+%20%5Clambda%20(1%20-%20R)%20%5C%5C%0A&amp;%20c%20-%20r%20=%20%5Clambda%20(1%20-%20R)%0A%5Cend%7Baligned%7D%0A"></p>
<p>De ce fait, en extrayant <img src="https://latex.codecogs.com/png.latex?c">, la condition dans laquelle l‚Äôobligation √©mise vaut 100% du nominal, i.e.&nbsp;au pair, est $c = r + (1 - R) $.</p>
<blockquote class="blockquote">
<p>üí° <img src="https://latex.codecogs.com/png.latex?s%20=%20c-r"> est la prime de cr√©dit ou encore le spread de cr√©dit. C‚Äôest la prime que l‚Äôinvestisseur demande pour le risque de cr√©dit. Si <img src="https://latex.codecogs.com/png.latex?c%20%3E%20r">, l‚Äôobligation est √©mise √† un prix sup√©rieur √† 100% du nominal. Si <img src="https://latex.codecogs.com/png.latex?c%20%3C%20r">, l‚Äôobligation est √©mise √† un prix inf√©rieur √† 100% du nominal. Ce spread permet de faire la relation entre la PD exprim√© par <img src="https://latex.codecogs.com/png.latex?%5Clambda"> et la LGD exprim√© par <img src="https://latex.codecogs.com/png.latex?1%20-R">. Cette information est plus facile √† avoir que l‚Äôintensit√© de d√©faut car le spread est cot√© sur le march√© √† travers les CDS. Par d√©finition, on en d√©duit facilement que plus cettre prime est √©lev√©, plus l‚Äôemetteur est risqu√©.</p>
</blockquote>
<blockquote class="blockquote">
<p>Take away : Les notions de duration et de spread sont tr√®s importants dans la mod√©lisation du risque de taux</p>
</blockquote>
<section id="cas-de-largentine-pays-risqu√©" class="level4">
<h4 class="anchored" data-anchor-id="cas-de-largentine-pays-risqu√©">cas de l‚Äôargentine, pays risqu√©</h4>
<div id="12568131" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1">s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1031</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> </span>
<span id="cb32-2">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb32-3">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R)</span>
<span id="cb32-4">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb32-5"></span>
<span id="cb32-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Spread de cr√©dit : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>s<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Recouvrement : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Intensit√© de d√©faut : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lambda_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-9">PS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [np.exp( <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t)) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> T <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>)]</span>
<span id="cb32-10"></span>
<span id="cb32-11">plt.plot(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>),PS)</span>
<span id="cb32-12">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probabilit√© de survie en fonction de la maturit√©"</span>)</span>
<span id="cb32-13">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>)</span>
<span id="cb32-14">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probabilit√© de survie"</span>)</span>
<span id="cb32-15">plt.grid()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spread de cr√©dit : 10.31%
Recouvrement : 40.00%
Intensit√© de d√©faut : 17.18%</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-20-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cas-de-la-france" class="level4">
<h4 class="anchored" data-anchor-id="cas-de-la-france">cas de la France</h4>
<div id="0c027ef3" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cas de la France</span></span>
<span id="cb34-2">s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">32.4</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> </span>
<span id="cb34-3">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb34-4">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R)</span>
<span id="cb34-5">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb34-6"></span>
<span id="cb34-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Spread de cr√©dit : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>s<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb34-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Recouvrement : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>R<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb34-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Intensit√© de d√©faut : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lambda_<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb34-10">PS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [np.exp( <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t)) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> T <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>)]</span>
<span id="cb34-11"></span>
<span id="cb34-12">plt.plot(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>),PS)</span>
<span id="cb34-13">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probabilit√© de survie en fonction de la maturit√©"</span>)</span>
<span id="cb34-14">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>)</span>
<span id="cb34-15">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probabilit√© de survie"</span>)</span>
<span id="cb34-16">plt.grid()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spread de cr√©dit : 0.32%
Recouvrement : 40.00%
Intensit√© de d√©faut : 0.54%</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>En comparant les deux pays, l‚ÄôArgentine et la France. On sait que l‚Äôargentine est un pays plus risqu√© que la France. Cela se voit √©galement au niveau des spreads de cr√©dit. En effet, le spread de l‚ÄôArgentine est plus √©lev√© que celui de la France. Cela signifie que les investisseurs demandent une prime de risque plus √©lev√©e pour investir dans des obligations argentines que dans des obligations fran√ßaises. De plus, en regardant la probabilit√© de survie des deux pays, on constate que la probabilit√© de survie de l‚ÄôArgentine est plus faible que celle de la France. Cela signifie que les investisseurs consid√®rent que l‚ÄôArgentine est plus susceptible de faire d√©faut que la France.</p>
</section>
</section>
<section id="vi.2-sensibilit√©-cr√©dit" class="level3">
<h3 class="anchored" data-anchor-id="vi.2-sensibilit√©-cr√©dit">VI.2 Sensibilit√© cr√©dit</h3>
<div id="b2c7d27c" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sensivity_to_credit(t,c,T,r,lambda_,R,N,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,dlambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>):</span>
<span id="cb36-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb36-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Fonction qui calcule la sensibilit√© d'une obligation √† un taux d'int√©r√™t.</span></span>
<span id="cb36-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb36-5">    B_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t,c,T,r,lambda_,R,N,dt)</span>
<span id="cb36-6">    B_t_plus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t,c,T,r,lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> dlambda_,R,N,dt)</span>
<span id="cb36-7">    </span>
<span id="cb36-8">    sensivity <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>((B_t_plus <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> B_t)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>dlambda_) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>B_t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R))</span>
<span id="cb36-9"></span>
<span id="cb36-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> sensivity</span></code></pre></div>
</div>
<div id="11fc057c" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb37-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb37-3">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb37-4">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb37-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb37-6">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb37-7">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb37-8"></span>
<span id="cb37-9">sensivity_to_credit(t,c,T,r,lambda_,R,N,dlambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>np.float64(8.821190868023761)</code></pre>
</div>
</div>
<div id="bd8bd207" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1">t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb39-2">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb39-3">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb39-4">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb39-5">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb39-6">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb39-7"></span>
<span id="cb39-8">dirty_prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb39-9">grid_values_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb39-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> T <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> grid_values_T:</span>
<span id="cb39-11">    B_t_dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sensivity_to_credit(t,c,T,r,lambda_,R,N)</span>
<span id="cb39-12">    dirty_prices.append(B_t_dirty)</span>
<span id="cb39-13"></span>
<span id="cb39-14">plt.plot(grid_values_T,dirty_prices, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dirty prices"</span>)</span>
<span id="cb39-15">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sensibilit√© cr√©dit en fonction de la maturit√©"</span>)</span>
<span id="cb39-16">plt.legend()</span>
<span id="cb39-17">plt.grid()</span>
<span id="cb39-18">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>)</span>
<span id="cb39-19">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sensibilit√©"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>Text(0, 0.5, 'Sensibilit√©')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-24-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Soit le mod√®le normale pour le taux :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Adr_t%20=%20%5Ctheta%20(%5Cmu%20-%20r_t)%20dt%20+%20%5Csigma_r%20dW_t%0A"></p>
<p>et un mod√®le log normale pour le spread de cr√©dit, puisqu‚Äôil ne peut √™tre n√©gatif : <img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7Bds_t%7D%7Bs_t%7D%20=%20%5Csigma_s%20dZ_t%0A"></p>
<p>Ces deux mod√®les sont li√©s par <img src="https://latex.codecogs.com/png.latex?dW_t%20dZ_t%20=%20%5Crho%20dt">. On peut exprimer cette relation par <img src="https://latex.codecogs.com/png.latex?Z_t%20=%20%5Crho%20W_t%20+%20%5Csqrt%7B1%20-%20%5Crho%5E2%7D%20V_t">, o√π <img src="https://latex.codecogs.com/png.latex?V_t"> est un mouvement brownien standard ind√©pendant de <img src="https://latex.codecogs.com/png.latex?W_t">. Cette corr√©lation est positive. &gt; üí° si les taux d‚Äôint√©r√™t montent, le risque de cr√©dit augmente puisque les entreprises ont plus de mal √† rembourser leur dette. De ce fait, le spread de cr√©dit augmente.</p>
<p>Supposons qu‚Äôon cherche √† calculer une VaR d‚Äôhorizon <img src="https://latex.codecogs.com/png.latex?h">. Pour cela, il faudra faire des simulations de Monte Carlo pour les deux mod√®les.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Ar_%7Bt+h%7D%20&amp;=%20r_t%20+%20%5Ctheta%20(%5Cmu%20-%20r_t)%20h%20+%20%5Csigma_r%20%5Csqrt%7Bh%7D%20W_t%20%5C%5C%0As_%7Bt+h%7D%20&amp;=%20s_t%20%5Cexp(%5Csigma_s%20%5Csqrt%7Bh%7D%20Z_t)%20%5C%5C%0Aou%20%5Cquad%20s_%7Bt+h%7D%20&amp;=%20s_t%20(1%20+%20%5Csigma_s%20%5Csqrt%7Bh%7D%20Z_t)%20%5Cquad%20(%5Ctext%7Bpar%20DL%7D)%0A%5Cend%7Baligned%7D%0A"></p>
<p>Posons les param√®tres suivants :</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%200.1"> : le coefficient de vitesse de r√©version</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%200.02"> : le taux d‚Äôint√©r√™t moyen</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csigma_r%20=%200.01"> : la volatilit√© du taux d‚Äôint√©r√™t</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csigma_s%20=%200.4"> : la volatilit√© du spread de cr√©dit</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Crho%20=%200.4"> : la corr√©lation entre les deux mouvements browniens</li>
<li><img src="https://latex.codecogs.com/png.latex?r%20=%200.02"> : le taux d‚Äôint√©r√™t initial</li>
<li><img src="https://latex.codecogs.com/png.latex?h%20=%201/12"> : l‚Äôhorizon de calcul de la VaR</li>
<li><img src="https://latex.codecogs.com/png.latex?c%20=%203%5C%25"> : le coupon annuel</li>
<li><img src="https://latex.codecogs.com/png.latex?R%20=%2040%5C%25"> : le taux de recouvrement</li>
<li><img src="https://latex.codecogs.com/png.latex?N%20=%201"> : le nominal de l‚Äôobligation</li>
<li><img src="https://latex.codecogs.com/png.latex?T%20=%2010"> : l‚Äô√©ch√©ance de l‚Äôobligation</li>
</ul>
<div id="865b403b" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb41-2"></span>
<span id="cb41-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> MC_VaR(c,T,r,lambda_,R,N,h,sigma_r, sigma_s, rho, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, N_MC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb41-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("Parameters")</span></span>
<span id="cb41-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"coupon : {c:.2%}")</span></span>
<span id="cb41-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"maturity : {T} years")</span></span>
<span id="cb41-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"risk free rate : {r:.2%}")</span></span>
<span id="cb41-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"credit spread : {lambda_:.2%}")</span></span>
<span id="cb41-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"recovery rate : {R:.2%}")</span></span>
<span id="cb41-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"nominal : {N}")</span></span>
<span id="cb41-11"></span>
<span id="cb41-12">    prices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb41-13">    </span>
<span id="cb41-14">    P_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dt)</span>
<span id="cb41-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"P0 : {P_0}")</span></span>
<span id="cb41-16"></span>
<span id="cb41-17">    s_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R)</span>
<span id="cb41-18">    r_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r</span>
<span id="cb41-19"></span>
<span id="cb41-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(N_MC):</span>
<span id="cb41-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate correlated Brownian motions</span></span>
<span id="cb41-22">        W1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal()</span>
<span id="cb41-23">        W2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.random.normal()</span>
<span id="cb41-24"></span>
<span id="cb41-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Euler discretization </span></span>
<span id="cb41-26">        r_h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> r_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma_r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(h) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W1</span>
<span id="cb41-27">        s_h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ( <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma_s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(h) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W2)</span>
<span id="cb41-28">        lambda_h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> s_h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> R)</span>
<span id="cb41-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("="*30)</span></span>
<span id="cb41-30">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("Parameters")</span></span>
<span id="cb41-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"coupon : {c:.2%}")</span></span>
<span id="cb41-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"maturity : {T} years")</span></span>
<span id="cb41-33">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"risk free rate : {r_h:.2%}")</span></span>
<span id="cb41-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"credit spread : {lambda_h:.2%}")</span></span>
<span id="cb41-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"recovery rate : {R:.2%}")</span></span>
<span id="cb41-36">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"nominal : {N}")</span></span>
<span id="cb41-37"></span>
<span id="cb41-38">        P_h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pricing_bond(t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>h,c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>c,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>T,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r_h,lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lambda_h,R<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>R,N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dt)</span>
<span id="cb41-39">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"Price : {P_h}")</span></span>
<span id="cb41-40">        variation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (P_h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> P_0)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>P_0</span>
<span id="cb41-41">        prices.append(variation)</span>
<span id="cb41-42"></span>
<span id="cb41-43"></span>
<span id="cb41-44">    VaR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.quantile(prices, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha)</span>
<span id="cb41-45"></span>
<span id="cb41-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> VaR</span>
<span id="cb41-47"></span>
<span id="cb41-48">sigma_r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb41-49">sigma_s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb41-50">rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.40</span></span>
<span id="cb41-51"></span>
<span id="cb41-52">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb41-53">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb41-54">c <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb41-55">R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb41-56">N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb41-57">h <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb41-58">T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb41-59"></span>
<span id="cb41-60">VaR_monte_carlo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MC_VaR(c,T,r,lambda_,R,N,h,sigma_r, sigma_s, rho, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, N_MC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb41-61"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR estim√© par Monte Carlo : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR_monte_carlo<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VaR estim√© par Monte Carlo : -6.3438%</code></pre>
</div>
</div>
<p>Lorsque $ $ (le coefficient de corr√©lation entre les taux d‚Äôint√©r√™t et le spread de cr√©dit) est positif, une hausse des taux d‚Äôint√©r√™t entra√Æne √©galement une hausse du spread de cr√©dit. Cette dynamique amplifie le risque global, car les pertes dues √† la hausse des taux s‚Äôajoutent aux pertes induites par l‚Äô√©largissement du spread de cr√©dit. Ainsi, la Value at Risk (VaR) est plus √©lev√©e, refl√©tant l‚Äôaccumulation des risques li√©s aux deux facteurs.</p>
<p>En revanche, lorsque $ $ est n√©gatif, une hausse des taux d‚Äôint√©r√™t tend √† r√©duire le spread de cr√©dit, et inversement. Il se cr√©e alors un effet de compensation : les pertes g√©n√©r√©es par l‚Äô√©volution des taux sont partiellement absorb√©es par les gains r√©sultant de la contraction du spread (ou inversement). C‚Äôest le principe de diversification. Dans ce cas, la VaR est plus faible, car les effets du taux d‚Äôint√©r√™t et du spread de cr√©dit s‚Äôannulent en partie, r√©duisant ainsi l‚Äôampleur des pertes potentielles.</p>
<div id="1fd2d3b6" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VaR en fonction de rho</span></span>
<span id="cb43-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tqdm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tqdm </span>
<span id="cb43-3"></span>
<span id="cb43-4">rhos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb43-5">VaRs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [MC_VaR(c,T,r,lambda_,R,N,h,sigma_r, sigma_s, rho, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, N_MC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,dt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> rho <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tqdm(rhos)]</span>
<span id="cb43-6"></span>
<span id="cb43-7">plt.plot(rhos,VaRs)</span>
<span id="cb43-8">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VaR en fonction de la corr√©lation"</span>)</span>
<span id="cb43-9">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rho"</span>)</span>
<span id="cb43-10">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VaR"</span>)</span>
<span id="cb43-11">plt.grid()</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|          | 0/100 [00:00&lt;?, ?it/s] 11%|‚ñà         | 11/100 [00:00&lt;00:00, 101.45it/s] 22%|‚ñà‚ñà‚ñè       | 22/100 [00:00&lt;00:00, 102.17it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 33/100 [00:00&lt;00:00, 102.04it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 44/100 [00:00&lt;00:00, 101.93it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 55/100 [00:00&lt;00:00, 102.33it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 66/100 [00:00&lt;00:00, 102.45it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 77/100 [00:00&lt;00:00, 102.70it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 88/100 [00:00&lt;00:00, 103.00it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 99/100 [00:00&lt;00:00, 103.20it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 100/100 [00:00&lt;00:00, 102.64it/s]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3_files/figure-html/cell-26-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="estimation-de-la-volatilit√©-du-spread-de-cr√©dit" class="level4">
<h4 class="anchored" data-anchor-id="estimation-de-la-volatilit√©-du-spread-de-cr√©dit">Estimation de la volatilit√© du spread de cr√©dit</h4>
<p>Pour la volatilit√© du spread, nous avons suppos√© que <img src="https://latex.codecogs.com/png.latex?%5Csigma_s%20=%2040%5C%25">. Nous allons maintenant estimer cette volatilit√© √† partir des donn√©es de march√©, en utilisant l‚Äôhistorique des spreads de cr√©dit sur une p√©riode de 5 ans, i.e.&nbsp;11/03/2025 - 11/03/2020, disponible sur ce <a href="data/cds.xlsx">lien</a>.</p>
<p>La volatilit√© du spread est une volatilit√© annualis√©e. De ce fait, la formulation de la volatilit√© empirique, lorsque la fr√©quence est quotidienne, est la suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma_s%20=%20%5Csqrt%7B%5Cfrac%7B1%7D%7Bn-1%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(s_i%20-%20%5Cbar%7Bs%7D)%5E2%7D%20%5Ctimes%20%5Csqrt%7B255%7D%0A"></p>
<div id="59ad58fa" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1">cds_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_excel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/cds.xlsx"</span>, skiprows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb45-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#date as date</span></span>
<span id="cb45-3">cds_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(cds_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%d</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb45-4">cds_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cds_df.set_index(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>)</span>
<span id="cb45-5">cds_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cds_df.sort_index()</span>
<span id="cb45-6"></span>
<span id="cb45-7">cds_df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PX_LAST</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-11</td>
<td>30.772</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-03-12</td>
<td>36.977</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-13</td>
<td>37.869</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2020-03-16</td>
<td>44.432</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2020-03-17</td>
<td>49.923</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="72bac931" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1">vol_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(cds_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PX_LAST"</span>].pct_change())</span>
<span id="cb46-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© estim√©e sur 5 ans: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>vol_est<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb46-3"></span>
<span id="cb46-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># volatilit√© sur 1 an</span></span>
<span id="cb46-5">vol_est<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(cds_df.loc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2024-03-11"</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2025-03-11"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PX_LAST"</span>].pct_change())</span>
<span id="cb46-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© estim√©e sur 1 an : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>vol_est<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">255</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Volatilit√© estim√©e sur 5 ans: 0.4512
Volatilit√© estim√©e sur 1 an : 0.5181</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="asset-management-autres-types-de-risques" class="level1">
<h1>Asset management : autres types de risques</h1>
<p>En dehors du risque de cr√©dit et du risque de march√©, il existe d‚Äôautres types de risques qui peuvent affecter les institutions financi√®res et les march√©s. Deux d‚Äôentre eux sont le risque de mod√®le et le risque climatique.</p>
<section id="risque-de-mod√®le" class="level2">
<h2 class="anchored" data-anchor-id="risque-de-mod√®le">Risque de mod√®le</h2>
<p>Le risque de mod√®le est le risque associ√© √† une mauvaise utilisation d‚Äôun mod√®le dans le processus de prise de d√©cision. Il peut √™tre caus√© par :</p>
<ul>
<li>une incertitude sur les param√®tres,</li>
<li>une qualit√© insuffisante des donn√©es,</li>
<li>ou une inad√©quation structurelle du mod√®le par rapport √† la r√©alit√© observ√©e.</li>
</ul>
<p>Ce risque peut conduire √† des erreurs de pr√©vision, √† des d√©cisions inappropri√©es ou √† des pertes financi√®res. Il est donc essentiel de bien comprendre les hypoth√®ses et limites des mod√®les employ√©s.</p>
<p>C‚Äôest une activit√© o√π l‚Äôintervention humaine reste indispensable : il est n√©cessaire de proc√©der √† des <em>sanity checks</em>, du <em>backtesting</em>, et de challenger les mod√®les √† l‚Äôaide de versions plus simples (<em>d√©g√©n√©r√©es</em>) ou plus riches, afin d‚Äôen comparer les r√©sultats et de mieux cerner leurs faiblesses.</p>
<p>Pour r√©duire le risque de mod√®le, il est courant de mettre en place une fonction ind√©pendante de validation, g√©n√©ralement assur√©e par les √©quipes MRM (Model Risk Management). Ces derni√®res sont charg√©es :</p>
<ul>
<li>d‚Äôauditer les mod√®les,</li>
<li>de mener des tests de robustesse,</li>
<li>et de recommander des provisions en cas de risque de sur√©valuation des actifs.</li>
</ul>
<p>Les comp√©tences cl√©s pour cette activit√© incluent : - les math√©matiques financi√®res, - la connaissance des march√©s financiers et des mod√®les de risque, - la programmation et l‚Äôutilisation d‚Äôoutils quantitatifs, - ainsi que des aptitudes √† la communication, au travail en √©quipe et au raisonnement critique.</p>
</section>
<section id="risque-climatique" class="level2">
<h2 class="anchored" data-anchor-id="risque-climatique">Risque climatique</h2>
<p>Le risque climatique d√©signe les impacts potentiels des changements climatiques et des politiques environnementales sur les entreprises et les march√©s financiers. Contrairement aux risques classiques, les trajectoires de r√©f√©rence sont d√©finies par des organismes scientifiques comme le GIEC, ce qui limite l‚Äôappropriation directe des mod√®les par les institutions financi√®res. Il s‚Äôagit donc d‚Äôun domaine o√π le risque de mod√®le est indirect.</p>
<p>Le r√©seau NGFS (Network for Greening the Financial System) a √©t√© mis en place pour aider les r√©gulateurs et les banques centrales √† mieux int√©grer les risques climatiques dans leurs cadres prudentiels.</p>
<p>√Ä l‚Äôheure actuelle, il n‚Äôexiste pas de consensus clair sur la mani√®re d‚Äôint√©grer pleinement le risque climatique dans les mod√®les financiers ; il s‚Äôagit plut√¥t de tentatives progressives d‚Äôadaptation. Le NGFS propose plusieurs sc√©narios climatiques, parmi lesquels :</p>
<ul>
<li>Current Policies : continuit√© des politiques actuelles sans nouvel engagement.</li>
<li>NDC (Nationally Determined Contributions) : politiques actuelles + engagements annonc√©s par les √âtats.</li>
<li>Disorderly Transition (1.5¬∞C) : les engagements sont mis en ≈ìuvre avec retard ou de fa√ßon d√©sorganis√©e.</li>
<li>Net Zero / 2¬∞C : sc√©nario optimis√© pour limiter le r√©chauffement √† 2¬∞C ‚Äî le cadre le plus ambitieux et le plus stable.</li>
</ul>
<p>On distingue g√©n√©ralement deux types de risques climatiques :</p>
<section id="risque-physique" class="level3">
<h3 class="anchored" data-anchor-id="risque-physique">1. Risque physique</h3>
<p>Ce risque est li√© aux cons√©quences directes des changements climatiques sur les infrastructures et l‚Äôenvironnement : - Risques aigus : √©v√©nements extr√™mes (inondations, s√©cheresses, temp√™tes, etc.). - Risques chroniques : √©volutions lentes (√©l√©vation du niveau des mers, hausse des temp√©ratures, etc.).</p>
<p>Ces risques peuvent entra√Æner : - des pertes mat√©rielles, - des interruptions d‚Äôactivit√©, - des co√ªts de r√©paration et d‚Äôadaptation.</p>
</section>
<section id="risque-de-transition" class="level3">
<h3 class="anchored" data-anchor-id="risque-de-transition">2. Risque de transition</h3>
<p>Ce risque est associ√© aux mesures prises pour r√©duire les √©missions de gaz √† effet de serre et passer √† une √©conomie bas carbone. Il peut provoquer : - des pertes de valeur sur certains actifs, - des co√ªts de transition √©lev√©s, - des bouleversements sectoriels et technologiques.</p>
<p>Il comprend deux composantes : - le risque politique (durcissement r√©glementaire, interdictions, fiscalit√© verte, etc.), - et le risque/opportunit√© technologique (√©mergence de nouvelles technologies, changement dans les pr√©f√©rences de consommation, etc.).</p>
<p>On peut formuler ce risque comme une relation :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BRisque%20de%20transition%7D%20=%20%5Ctext%7BRisque%20politique%7D%20-%20%5Ctext%7BOpportunit%C3%A9s%20technologiques%7D%0A"></p>
<p>Ainsi, une entreprise bien positionn√©e sur les technologies vertes peut compenser tout ou partie du risque politique subi.</p>
<ul>
<li>Le risque physique est plus √©lev√© dans les sc√©narios Current Policies, NDC, et Disorderly Transition, car ils impliquent une action climatique insuffisante ou retard√©e.</li>
<li>√Ä l‚Äôinverse, le risque de transition est plus important dans les sc√©narios ambitieux comme Net Zero, o√π les ajustements politiques et √©conomiques sont rapides et profonds.</li>
</ul>


</section>
</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>asset-management</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-3.html</guid>
  <pubDate>Sat, 22 Mar 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Projet de gestion de risques multiples</title>
  <dc:creator>Cheryl Kouadio</dc:creator>
  <dc:creator>Mariyam Ouyassin</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules.html</link>
  <description><![CDATA[ 




<p>Les banques jouent un r√¥le central dans l‚Äô√©conomie nationale et internationale. En effet, elles assurent l‚Äôinterm√©diation entre les agents disposant d‚Äôun exc√©dent de financement et ceux ayant un besoin de financement, facilitant ainsi les transactions et soutenant l‚Äôinvestissement, et donc la croissance √©conomique. Toutefois, cette activit√© les expose √† divers risques majeurs, notamment le risque de cr√©dit, le risque de liquidit√© et le risque de march√©. La quantification de ces risques est essentielle pour permettre aux institutions bancaires de s‚Äôen pr√©munir et de les surveiller efficacement. Dans ce cadre, la Value-at-Risk (VaR) s‚Äôimpose comme une mesure de r√©f√©rence. Elle permet d‚Äô√©valuer la perte potentielle maximale qu‚Äôune institution pourrait subir, avec un certain niveau de confiance, sur un horizon temporel donn√© et pour un portefeuille sp√©cifique.</p>
<p>Dans l‚Äôanalyse de la VaR, un portefeuille est souvent compos√© d‚Äôau moins deux cr√©ances. Il est donc indispensable de prendre en compte les d√©pendances entre les facteurs de risque. Une approche classique consiste √† supposer que le vecteur des risques individuels suit une distribution normale multivari√©e et √† utiliser le coefficient de corr√©lation lin√©aire de Pearson comme mesure de d√©pendance. Cependant, cette hypoth√®se est souvent trop restrictive en finance : les distributions des facteurs de risque ne sont pas n√©cessairement gaussiennes et le coefficient de Pearson ne permet pas toujours de capturer les structures de d√©pendance non lin√©aires. De plus, cette mesure de corr√©lation est pertinente uniquement dans un cadre gaussien, qui repr√©sente rarement les dynamiques financi√®res r√©elles.</p>
<p>Dans ce contexte, la th√©orie des copules constitue un outil statistique puissant permettant de mod√©liser la d√©pendance entre les risques sans se limiter √† l‚Äôhypoth√®se de normalit√©. Une copule est une fonction qui caract√©rise la structure de d√©pendance entre plusieurs variables al√©atoires ind√©pendamment de leurs distributions marginales. En s√©parant la mod√©lisation des distributions marginales et celle de la d√©pendance conjointe, les copules offrent une flexibilit√© accrue pour l‚Äôanalyse du risque et permettent de mieux repr√©senter les interactions entre les actifs financiers.</p>
<p>L‚Äôobjectif de ce projet est d‚Äô√©valuer le risque de cr√©dit en calculant une CreditVaR avec un niveau de confiance de 99% sur un portefeuille compos√© de deux obligations bancaires. Ces obligations, bien que diff√©rentes en termes de subordination et de risque de recouvrement, appartiennent au m√™me secteur, ce qui accro√Æt le risque global du portefeuille. Il est donc essentiel de mod√©liser ad√©quatement la d√©pendance entre ces actifs pour obtenir une estimation r√©aliste du risque de cr√©dit.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le rapport de ce projet est disponible <a href="../rapports/Rapport_Kouadio_Ouyassin_copules.pdf">ici</a>.</p>
</div>
</div>
<section id="i.-donn√©es" class="level1">
<h1>I. Donn√©es</h1>
<p>Nous disposons des prix des actions des composantes d‚Äôun portefeuille constitu√© de deux cr√©ances issues du secteur bancaire, ayant un m√™me notionnel de <img src="https://latex.codecogs.com/png.latex?N%20=%201000"> euros et une maturit√© de <img src="https://latex.codecogs.com/png.latex?T%20=%204"> ans. En l‚Äôabsence de lignes de cr√©dit, l‚Äôexposition en cas de d√©faut de ces banques est √©gale au notionnel, soit <img src="https://latex.codecogs.com/png.latex?EAD%20=%20N%20=%201000"> euros.</p>
<p>La premi√®re obligation, de type senior, est √©mise par BNP et pr√©sente un taux de recouvrement moyen de 60% ainsi qu‚Äôune volatilit√© de 15%. La seconde, de type junior (ou subordonn√©e), est √©mise par la Soci√©t√© G√©n√©rale et se caract√©rise par un taux de recouvrement moyen de 30% et une volatilit√© de 25%. On suppose qu‚Äôil n‚Äôexiste aucune d√©pendance entre les taux de recouvrement.</p>
<p>Par ailleurs, nous disposons d‚Äôinformations sur les spreads des Credit Default Swaps (CDS) des deux banques, qui permettent d‚Äô√©valuer le risque de cr√©dit en fonction de la maturit√© des actifs. En effet, les CDS sont des contrats d‚Äôassurance contre le d√©faut d‚Äôune entreprise. Le spread d‚Äôun CDS repr√©sente le co√ªt de cette assurance : plus ce spread est √©lev√©, plus le march√© per√ßoit l‚Äôentreprise comme risqu√©e.</p>
<p>On consid√®re que les spreads de CDS de BNP et de Soci√©t√© G√©n√©rale pour une maturit√© de <img src="https://latex.codecogs.com/png.latex?T%20=%204"> ans sont respectivement de 100 bps et 120 bps, tandis que pour une maturit√© de <img src="https://latex.codecogs.com/png.latex?T%20=%205"> ans, ils s‚Äô√©l√®vent √† 120 bps et 150 bps. Ces CDS ont √©t√© √©valu√©s avec un taux de recouvrement <img src="https://latex.codecogs.com/png.latex?R"> fix√© √† 40%.</p>
<p>Puisque les spreads de Soci√©t√© G√©n√©rale sont syst√©matiquement plus √©lev√©s, quelle que soit la maturit√©, on en d√©duit que l‚Äôobligation √©mise par SG est plus risqu√©e que celle √©mise par BNP. Cette observation est ainsi coh√©rente avec la hi√©rarchie des obligations consid√©r√©es.</p>
<p>Pour extraire les probabilit√©s de d√©fauts, nous allons utilis√© les CDS √©tant plus liquides que les obligations. Les CDS sont des contrats d‚Äôassurance contre le d√©faut d‚Äôune entreprise. Le spread de CDS est le prix de cette assurance. Plus le spread est √©lev√©, plus le march√© estime que l‚Äôentreprise est risqu√©e. Le fair spread est donn√©e par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0As*%20=%20(1-%5Cdelta)%20%5Ctimes%20%5Clambda%0A"></p>
<p>Avec <img src="https://latex.codecogs.com/png.latex?%5Cdelta"> le taux de recouvrement et <img src="https://latex.codecogs.com/png.latex?%5Clambda"> le hazard rate. Le hazard rate est la probabilit√© de d√©faut de l‚Äôentreprise. On peut donc isoler le hazard rate :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Clambda%20=%20%5Cfrac%7Bs*%7D%7B1-%5Cdelta%7D%0A"></p>
<p>De ce fait, on peut calculer la probabilit√© de d√©faut donn√©e par : <img src="https://latex.codecogs.com/png.latex?%0APD%20=%20P(%5Ctau%20%3C%20T)%20=%201%20-%20e%5E%7B-%5Clambda%20%5Ctimes%20T%7D%0A"></p>
<p>car <img src="https://latex.codecogs.com/png.latex?%5Ctau%20%5Csim%20Exp(%5Clambda)"></p>
<div id="efb409ff" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Noms des entreprises</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pprint <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pprint</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4">entreprises <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>]</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> PD(T,spread,Recouvrement):</span>
<span id="cb1-7">    lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spread <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Recouvrement)</span>
<span id="cb1-8">    PD <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>T)</span>
<span id="cb1-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> PD,lambda_</span>
<span id="cb1-10"></span>
<span id="cb1-11">spread_4Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 100 et 120 points de base</span></span>
<span id="cb1-12">spread_5Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 120 et 150 points de base</span></span>
<span id="cb1-13">tx_recouvrement <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb1-14"></span>
<span id="cb1-15">proba_defaut_quatre <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(spread_4Y))</span>
<span id="cb1-16">proba_defaut_cinq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(spread_5Y))</span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(spread_4Y)) :</span>
<span id="cb1-19">    proba_defaut_quatre[i],_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PD(spread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>spread_4Y[i],T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,Recouvrement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)</span>
<span id="cb1-20">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(_)</span>
<span id="cb1-21">    proba_defaut_cinq[i],_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PD(spread<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>spread_5Y[i],T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,Recouvrement<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>)</span>
<span id="cb1-22">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(_)</span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©ation d'un dictionnaire pour stocker les probabilit√©s de d√©faut</span></span>
<span id="cb1-25">probabilites_defaut <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remplir le dictionnaire</span></span>
<span id="cb1-28"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, entreprise <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(entreprises):</span>
<span id="cb1-29">    probabilites_defaut[entreprise] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-30">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"4 ans"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(proba_defaut_quatre[i]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"5 ans"</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(proba_defaut_cinq[i]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb1-32">    }</span>
<span id="cb1-33"></span>
<span id="cb1-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afficher le dictionnaire</span></span>
<span id="cb1-35">pprint(probabilites_defaut)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.016666666666666666
0.02
0.02
0.025
{'BNP': {'4 ans': np.float64(6.4493), '5 ans': np.float64(9.5163)},
 'SG': {'4 ans': np.float64(7.6884), '5 ans': np.float64(11.7503)}}</code></pre>
</div>
</div>
<p>Nous constatons que les probabilit√©s de d√©faut pour les deux entreprises pour une m√™me maturit√© sont g√©n√©ralement plus √©lev√©s pour la Soci√©t√© G√©n√©rale que pour BNP Paribas. Cela est coh√©rent avec le type d‚Äôobligation √©mise par les deux entreprises. En effet, une obligation junior est plus risqu√©e qu‚Äôune obligation senior.</p>
</section>
<section id="ii.-caract√©risation-les-distributions-des-taux-de-recouvrement-de-chacune-des-deux-cr√©ances" class="level1">
<h1>II. Caract√©risation les distributions des taux de recouvrement de chacune des deux cr√©ances</h1>
<p>Pour caract√©riser les distributions des taux de recouvrement, on va utiliser la loi Beta(a,b). La loi Beta est une loi de probabilit√© continue d√©finie sur l‚Äôintervalle [0, 1]. Elle est souvent utilis√©e pour mod√©liser des variables al√©atoires qui prennent des valeurs dans un intervalle born√© en forme de U ce qui est le cas des taux de recouvrement. L‚Äôexpression de sa densit√© est donn√©e par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(x)%20=%20%5Cfrac%7Bx%5E%7Ba-1%7D%20%5Ctimes%20(1-x)%5E%7Bb-1%7D%7D%7BB(a,b)%7D%201_%7B%5B0,1%5D%7D(x)%0A"></p>
<p>Puisque nous poss√©dons des taux de recouvrement de moyenne 60% et de volatilit√© 15% pour la premi√®re cr√©ance et de moyenne 30% et de volatilit√© 25% pour la seconde cr√©ance, nous allons utiliser la m√©thode des moments pour d√©terminer les param√®tres a et b de la loi Beta. De ce fait, les param√®tres sont calibr√©s de la mani√®re suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Aa%20=%20%5Cfrac%7B%5Cmu%5E2%20%5Ctimes%20(1-%5Cmu)%7D%7B%5Csigma%5E2%7D%20-%20%5Cmu;%20%5Cquad%20b%20=%20%5Cfrac%7B%5Cmu%5E2%20%5Ctimes%20(1-%5Cmu)%7D%7B%20%5Cmu%20%5Csigma%5E2%7D%20-%20(1-%5Cmu%20)%0A"></p>
<p>La premi√®re est une obligation BNP senior de taux de recouvrement de moyenne 60% et de volatilit√© 15%, et la seconde est une obligation Soci√©t√© G√©n√©rale junior (ou subordonn√©e) de taux de recouvrement de moyenne 30% et de volatilit√© 25%.</p>
<section id="ii.1.-caract√©risation-de-la-distribution-des-tx-de-recouvrement-bnp" class="level3">
<h3 class="anchored" data-anchor-id="ii.1.-caract√©risation-de-la-distribution-des-tx-de-recouvrement-bnp">II.1. Caract√©risation de la distribution des tx de recouvrement BNP</h3>
<div id="d84ea86b" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb3-2"></span>
<span id="cb3-3">tx_recouvrement_BNP <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span></span>
<span id="cb3-4">vol_recouvrement_BNP <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> calibration_beta(mu,sigma):</span>
<span id="cb3-7">    a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu</span>
<span id="cb3-8">    b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>mu)</span>
<span id="cb3-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> a,b</span>
<span id="cb3-10"></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># def moment_beta(moyenne, variance):</span></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     alpha = (moyenne * (1 - moyenne) / variance**2 - 1) * moyenne</span></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     beta = (moyenne * (1 - moyenne) / variance**2 - 1) * (1 - moyenne)</span></span>
<span id="cb3-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     return alpha, beta</span></span>
<span id="cb3-15"></span>
<span id="cb3-16">a_BNP,b_BNP <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calibration_beta(tx_recouvrement_BNP,vol_recouvrement_BNP)</span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a_BNP = "</span>, a_BNP)</span>
<span id="cb3-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b_BNP = "</span>, b_BNP)</span>
<span id="cb3-20"></span>
<span id="cb3-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># densit√© beta</span></span>
<span id="cb3-22"></span>
<span id="cb3-23"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> beta</span>
<span id="cb3-24"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb3-25"></span>
<span id="cb3-26">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb3-27">y_BNP <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> beta.pdf(x,a_BNP,b_BNP)</span>
<span id="cb3-28"></span>
<span id="cb3-29">plt.plot(x,y_BNP)</span>
<span id="cb3-30">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Densit√© de probabilit√© du taux de recouvrement de BNP"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a_BNP =  5.8
b_BNP =  3.8666666666666676</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>Text(0.5, 1.0, 'Densit√© de probabilit√© du taux de recouvrement de BNP')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-3-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous constatons que la distribution des taux de recouvrement de BNP est l√©g√®rement asym√©trique √† droite. En effet, le param√®tre a, contr√¥le la concentration des valeurs proches de 1, est sup√©rieur au param√®tre b, contr√¥le la concentration des valeurs proches de 0. De ce fait, la distribution est asym√©trique √† gauche. Cependant que la majorit√© des valeurs sont concentr√©es autour de la moyenne et il y a une <strong>faible probabilit√© de recouvrement tr√®s bas ou tr√®s √©lev√©</strong>.</p>
</section>
<section id="ii.2.-caract√©risation-de-la-distribution-des-tx-de-recouvrement-sg" class="level3">
<h3 class="anchored" data-anchor-id="ii.2.-caract√©risation-de-la-distribution-des-tx-de-recouvrement-sg">II.2. Caract√©risation de la distribution des tx de recouvrement SG</h3>
<div id="5aa8bf60" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">tx_recouvrement_SG <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb6-2">vol_recouvrement_SG <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span></span>
<span id="cb6-3"></span>
<span id="cb6-4"></span>
<span id="cb6-5">a_SG,b_SG <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calibration_beta(tx_recouvrement_SG,vol_recouvrement_SG)</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a_SG = "</span>, a_SG)</span>
<span id="cb6-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b_SG = "</span>, b_SG)</span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># densit√© beta</span></span>
<span id="cb6-11">y_SG <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> beta.pdf(x,a_SG,b_SG)</span>
<span id="cb6-12"></span>
<span id="cb6-13">plt.plot(x,y_SG)</span>
<span id="cb6-14">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Densit√© de probabilit√© du taux de recouvrement de BNP"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a_SG =  0.708
b_SG =  1.652</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Text(0.5, 1.0, 'Densit√© de probabilit√© du taux de recouvrement de BNP')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-4-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>En ce qui concerne la distribution des taux de recouvrement de la Soci√©t√© G√©n√©rale, nous constatons une asym√©trie √† gauche √©galement.</p>
<p>La densit√© est <strong>tr√®s asym√©trique</strong>, d√©croissant fortement √† partir de 0. On constate une forte <strong>concentration des valeurs proches de 0</strong> indique un <strong>risque √©lev√© de faible recouvrement</strong>. La longue tra√Æne vers la droite signifie que, bien que des recouvrements plus √©lev√©s soient possibles, ils sont peu probables.</p>
</section>
<section id="ii.3.-comparaison-des-distributions" class="level2">
<h2 class="anchored" data-anchor-id="ii.3.-comparaison-des-distributions">II.3. Comparaison des distributions</h2>
<div id="ae65be4d" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb9-2"></span>
<span id="cb9-3">plt.plot(x, y_BNP, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'BNP'</span>)</span>
<span id="cb9-4">plt.plot(x, y_SG, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SG'</span>)</span>
<span id="cb9-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Densit√©s de probabilit√© des taux de recouvrement"</span>)</span>
<span id="cb9-6">plt.legend()</span>
<span id="cb9-7">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p><strong>BNP senior</strong> : L‚Äôobligation senior b√©n√©ficie d‚Äôun <strong>taux de recouvrement plus √©lev√© et plus stable</strong>, donc <strong>moins risqu√©</strong>.</p></li>
<li><p><strong>SG junior</strong> : L‚Äôobligation junior a une <strong>probabilit√© √©lev√©e d‚Äôun recouvrement tr√®s faible</strong>, ce qui refl√®te un <strong>risque plus important</strong>.</p></li>
</ul>
<p>Cela est coh√©rent avec la cat√©gorisation des obligations. Dans la hi√©rarchie des dettes, une obligation peut √™tre class√©e comme senior ou junior (subordonn√©e) en fonction de la priorit√© de remboursement en cas de faillite de l‚Äô√©metteur. Cette distinction est essentielle pour √©valuer le risque de cr√©dit et le taux de recouvrement attendu. Une obligation class√©e senior est moins risqu√©e qu‚Äôune obligation junior, car elle est rembours√©e en premier en cas de d√©faut de l‚Äô√©metteur, cependant le rendement attendu est moins √©lev√©. Par cons√©quent, les obligations senior ont un taux de recouvrement plus √©lev√© et plus stable que les obligations junior.</p>
</section>
</section>
<section id="iii.-caract√©risation-des-lois-de-d√©fauts" class="level1">
<h1>III. Caract√©risation des lois de d√©fauts</h1>
<p>Pour caract√©riser les lois de d√©faut, nous avons besoin de prendre en compte la structure de d√©pendance en plus des lois marginales pr√©sent√©es dans la section I. Pour ce faire, nous devons utiliser un produit dnt le prix d√©pendant de la d√©pendance entre les d√©fauts des deux entreprises. Dans notre cas, nous utiliserons le prix des actions des deux entreprises pour d√©terminer la d√©pendance entre les d√©fauts.</p>
<section id="iii.1.-analyse-exploratoire-univari√©e-des-donn√©es-actions-de-ces-deux-entreprises." class="level2">
<h2 class="anchored" data-anchor-id="iii.1.-analyse-exploratoire-univari√©e-des-donn√©es-actions-de-ces-deux-entreprises.">III.1. Analyse exploratoire univari√©e des donn√©es actions de ces deux entreprises.</h2>
<p>En observant le prix des actions BNP et SG, nous constatons que les actions BNP ont un prix plus √©lev√©s que les actions SG. Cela est coh√©rent avec la capitalisation boursi√®re des deux entreprises. De plus, nous constatons que les rendements de BNP sont semblables √† ceux de SG. Cela est coh√©rent avec le fait que les deux entreprises sont des banques fran√ßaises et sont donc expos√©es aux m√™mes risques macro√©conomiques. N√©anmoins, les actions de BNP pr√©sentent une volatilit√© l√©g√®rement plus √©lev√© que celles de SG.</p>
<div id="687b9a36" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># read data.txt</span></span>
<span id="cb10-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb10-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb10-4">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data_copules.txt'</span>, sep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-5">data.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BNP</th>
<th data-quarto-table-cell-role="th">SG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>42.36</td>
<td>55.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>42.72</td>
<td>55.59</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>43.20</td>
<td>56.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>42.67</td>
<td>55.55</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>41.81</td>
<td>54.50</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="b3c88a9e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb11-2">plt.plot(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'BNP'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'BNP'</span>)</span>
<span id="cb11-3">plt.plot(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SG'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SG'</span>)</span>
<span id="cb11-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix des actions"</span>)</span>
<span id="cb11-5">plt.legend()</span>
<span id="cb11-6">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="034da347" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">returns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame()</span>
<span id="cb12-2">returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>].pct_change().dropna()</span>
<span id="cb12-3">returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>].pct_change().dropna()</span>
<span id="cb12-4"></span>
<span id="cb12-5">fig, axes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), sharey<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb12-6"></span>
<span id="cb12-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Premier sous-graphique : Rendements BNP</span></span>
<span id="cb12-8">axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tab:blue'</span>)</span>
<span id="cb12-9">axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements BNP"</span>)</span>
<span id="cb12-10">axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb12-11"></span>
<span id="cb12-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Deuxi√®me sous-graphique : Rendements SG</span></span>
<span id="cb12-13">axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].plot(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tab:orange'</span>)</span>
<span id="cb12-14">axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements SG"</span>)</span>
<span id="cb12-15">axes[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb12-16"></span>
<span id="cb12-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ajustement automatique pour √©viter les chevauchements</span></span>
<span id="cb12-18">plt.tight_layout()</span>
<span id="cb12-19"></span>
<span id="cb12-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage</span></span>
<span id="cb12-21">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1632167f" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">returns.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">BNP</th>
<th data-quarto-table-cell-role="th">SG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>999.000000</td>
<td>999.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>-0.000590</td>
<td>-0.000473</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.024340</td>
<td>0.020690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-0.116199</td>
<td>-0.093616</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-0.013771</td>
<td>-0.011760</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>-0.000358</td>
<td>-0.000547</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.012605</td>
<td>0.011286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>0.086786</td>
<td>0.079479</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="iii.2.-mod√©lisation-des-distributions-univari√©es-des-facteurs-de-risques" class="level2">
<h2 class="anchored" data-anchor-id="iii.2.-mod√©lisation-des-distributions-univari√©es-des-facteurs-de-risques">III.2. Mod√©lisation des distributions univari√©es des facteurs de risques</h2>
<p>Dans le cadre des prix des actions, le seul facteur de risque est le rendement. Nous allons donc mod√©liser les rendements des actions de BNP et SG par des lois normales, lois student, skew student, et Normal Inverse Gaussian afin de d√©terminer la loi qui s‚Äôajuste le mieux aux donn√©es.</p>
<section id="iii.2.1.-mod√©lisation-des-rendements-de-bnp" class="level3">
<h3 class="anchored" data-anchor-id="iii.2.1.-mod√©lisation-des-rendements-de-bnp">III.2.1. Mod√©lisation des rendements de BNP</h3>
<p>En ce qui concerne les rendements de BNP, nous constatons que les lois de student et normal inverse gaussian sont les plus adapt√©es pour mod√©liser les rendements de BNP. En effet, lorsqu‚Äôon compare les QQ-plot des rendements de BNP avec les lois normales, student, skew student et normal inverse gaussian, on constate que les quantiles empiriques des rendements de BNP sont plus proches des quantiles th√©oriques des lois student et normal inverse gaussian. De plus, les densit√©s ajust√©es semblent √©galement mieux coller aux donn√©es.</p>
<p>Si l‚Äôon devait choisir une loi pour mod√©liser les rendements de BNP, nous choisirions la loi normal inverse gaussian. En effet, bien qu‚Äôelle soit plus complexe √† mod√©liser, elle permet d‚Äôavoir un p-value, au test de Kolmogorov-Smirnov, plus √©lev√© que la loi student. Cela signifie que la loi normal inverse gaussian est plus adapt√©e pour mod√©liser les rendements de BNP.</p>
<div id="0031cf02" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb14-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> stats</span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation de donn√©es pour l'exemple (remplace par tes donn√©es r√©elles)</span></span>
<span id="cb14-6">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>]</span>
<span id="cb14-7"></span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©ation de la figure et des axes pour 4 subplots (2 lignes, 2 colonnes)</span></span>
<span id="cb14-9">fig, axs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb14-10"></span>
<span id="cb14-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################## Loi normale ########################</span></span>
<span id="cb14-12">params_norm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm.fit(data)</span>
<span id="cb14-13"></span>
<span id="cb14-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Histogramme avec densit√© th√©orique de la loi normale (subplot 0,0)</span></span>
<span id="cb14-15">xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(data), np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(data), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb14-16">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(data, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram"</span>)</span>
<span id="cb14-17">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(xs, stats.norm.pdf(xs, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_norm), label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Normal Distribution'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb14-18">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© ajust√©e - loi normale'</span>)</span>
<span id="cb14-19">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb14-20"></span>
<span id="cb14-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-Q plot (subplot 0,1)</span></span>
<span id="cb14-22">stats.probplot(data, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm"</span>,sparams<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_norm), plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb14-23">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Q-Q Plot - loi normale'</span>)</span>
<span id="cb14-24"></span>
<span id="cb14-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################## Loi de student ########################</span></span>
<span id="cb14-26"></span>
<span id="cb14-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation des param√®tres de la distribution de Student pour vos donn√©es.</span></span>
<span id="cb14-28">params_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.t.fit(data)</span>
<span id="cb14-29"></span>
<span id="cb14-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Histogramme avec densit√© th√©orique de la loi de Student.</span></span>
<span id="cb14-31">xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(data), np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(data), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb14-32">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(data, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram"</span>)</span>
<span id="cb14-33">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(xs, stats.t.pdf(xs, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_std), label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Fitted t-Distribution'</span>,color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>)</span>
<span id="cb14-34">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© ajust√©e - loi de student'</span>)</span>
<span id="cb14-35">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb14-36"></span>
<span id="cb14-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-Q plot avec une loi de Student.</span></span>
<span id="cb14-38">stats.probplot(data, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>, sparams<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_std), plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb14-39">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Q-Q Plot - loi de student'</span>)</span>
<span id="cb14-40"></span>
<span id="cb14-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################## Loi de Normal Inverse Gaussian ########################</span></span>
<span id="cb14-42">params_nig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norminvgauss.fit(data)</span>
<span id="cb14-43"></span>
<span id="cb14-44">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(data, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram"</span>)</span>
<span id="cb14-45">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(xs, stats.norminvgauss.pdf(xs, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_nig), label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Fitted normal inverse gaussian'</span>,color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>)</span>
<span id="cb14-46">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© ajust√©e - loi normale inverse gaussienne'</span>)</span>
<span id="cb14-47">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb14-48"></span>
<span id="cb14-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-Q plot avec une loi de NIG.</span></span>
<span id="cb14-50">stats.probplot(data, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norminvgauss"</span>, sparams<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_nig), plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb14-51">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Q-Q Plot - loi normale inverse gaussienne'</span>)</span>
<span id="cb14-52"></span>
<span id="cb14-53">plt.tight_layout()</span>
<span id="cb14-54"></span>
<span id="cb14-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage des graphiques</span></span>
<span id="cb14-56">plt.show()</span>
<span id="cb14-57"></span>
<span id="cb14-58">U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>returns.index, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>returns.columns)</span>
<span id="cb14-59"></span>
<span id="cb14-60">U[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'BNP'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norminvgauss.cdf(data,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_nig)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="47a86659" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(params_norm)</span>
<span id="cb15-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(params_std)</span>
<span id="cb15-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(params_nig)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(np.float64(-0.0005897932128196069), np.float64(0.024327449407557697))
(np.float64(4.605552436800593), np.float64(-0.00046153919290846087), np.float64(0.018734588738427177))
(np.float64(1.114374971099747), np.float64(-0.01637147555477723), np.float64(-0.00021011775496697913), np.float64(0.025828797181227353))</code></pre>
</div>
</div>
<div id="e368db98" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######## Test de kolmogorov-smirnov ########</span></span>
<span id="cb17-2"></span>
<span id="cb17-3">ks_stat_norm, ks_p_value_norm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.kstest(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'norm'</span>, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_norm))</span>
<span id="cb17-4">ks_stat_std, ks_p_value_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.kstest(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t'</span>, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_std))</span>
<span id="cb17-5">ks_stat_nig, ks_p_value_nig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.kstest(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'norminvgauss'</span>, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_nig))</span>
<span id="cb17-6"></span>
<span id="cb17-7">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb17-8">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Statistic"</span>: [ks_stat_norm, ks_stat_std, ks_stat_nig],</span>
<span id="cb17-9">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span>: [ks_p_value_norm, ks_p_value_std, ks_p_value_nig]</span>
<span id="cb17-10">            }, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Student"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal Inverse Gaussian"</span>])</span>
<span id="cb17-11"></span>
<span id="cb17-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb17-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test de Kolmogorov-Smirnov"</span>)</span>
<span id="cb17-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb17-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(res)</span>
<span id="cb17-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
Test de Kolmogorov-Smirnov
==================================================
                         Statistic   p-value
Normal                    0.051878  0.008908
Student                   0.027225  0.441752
Normal Inverse Gaussian   0.026466  0.477953
==================================================</code></pre>
</div>
</div>
</section>
<section id="iii.2.1.-mod√©lisation-des-rendements-de-sg" class="level3">
<h3 class="anchored" data-anchor-id="iii.2.1.-mod√©lisation-des-rendements-de-sg">III.2.1. Mod√©lisation des rendements de SG</h3>
<p>Comme les rendements de BNP, les rendements de SG sont mieux mod√©lis√©s par les lois student et normal inverse gaussian.</p>
<div id="ab3912de" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb19-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb19-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> stats</span>
<span id="cb19-4"></span>
<span id="cb19-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation de donn√©es pour l'exemple (remplace par tes donn√©es r√©elles)</span></span>
<span id="cb19-6">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>]</span>
<span id="cb19-7"></span>
<span id="cb19-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©ation de la figure et des axes pour 4 subplots (2 lignes, 2 colonnes)</span></span>
<span id="cb19-9">fig, axs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb19-10"></span>
<span id="cb19-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################## Loi normale ########################</span></span>
<span id="cb19-12">params_norm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm.fit(data)</span>
<span id="cb19-13"></span>
<span id="cb19-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Histogramme avec densit√© th√©orique de la loi normale (subplot 0,0)</span></span>
<span id="cb19-15">xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(data), np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(data), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb19-16">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(data, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram"</span>)</span>
<span id="cb19-17">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(xs, stats.norm.pdf(xs, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_norm), label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Normal Distribution'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb19-18">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© ajust√©e - loi normale'</span>)</span>
<span id="cb19-19">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb19-20"></span>
<span id="cb19-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-Q plot (subplot 0,1)</span></span>
<span id="cb19-22">stats.probplot(data, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm"</span>,sparams<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_norm), plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb19-23">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Q-Q Plot - loi normale'</span>)</span>
<span id="cb19-24"></span>
<span id="cb19-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################## Loi de student ########################</span></span>
<span id="cb19-26"></span>
<span id="cb19-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation des param√®tres de la distribution de Student pour vos donn√©es.</span></span>
<span id="cb19-28">params_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.t.fit(data)</span>
<span id="cb19-29"></span>
<span id="cb19-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Histogramme avec densit√© th√©orique de la loi de Student.</span></span>
<span id="cb19-31">xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(data), np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(data), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb19-32">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(data, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram"</span>)</span>
<span id="cb19-33">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(xs, stats.t.pdf(xs, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_std), label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Fitted t-Distribution'</span>,color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'orange'</span>)</span>
<span id="cb19-34">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© ajust√©e - loi de student'</span>)</span>
<span id="cb19-35">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb19-36"></span>
<span id="cb19-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-Q plot avec une loi de Student.</span></span>
<span id="cb19-38">stats.probplot(data, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t"</span>, sparams<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_std), plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb19-39">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Q-Q Plot - loi de student'</span>)</span>
<span id="cb19-40"></span>
<span id="cb19-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######################## Loi de Normal Inverse Gaussian ########################</span></span>
<span id="cb19-42">params_nig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norminvgauss.fit(data)</span>
<span id="cb19-43"></span>
<span id="cb19-44">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(data, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histogram"</span>)</span>
<span id="cb19-45">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(xs, stats.norminvgauss.pdf(xs, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_nig), label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Fitted normal inverse gaussian'</span>,color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'green'</span>)</span>
<span id="cb19-46">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© ajust√©e - loi normale inverse gaussienne'</span>)</span>
<span id="cb19-47">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb19-48"></span>
<span id="cb19-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Q-Q plot avec une loi de NIG.</span></span>
<span id="cb19-50">stats.probplot(data, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norminvgauss"</span>, sparams<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_nig), plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb19-51">axs[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Q-Q Plot - loi normale inverse gaussienne'</span>)</span>
<span id="cb19-52"></span>
<span id="cb19-53">plt.tight_layout()</span>
<span id="cb19-54"></span>
<span id="cb19-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage des graphiques</span></span>
<span id="cb19-56">plt.show()</span>
<span id="cb19-57"></span>
<span id="cb19-58">U[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SG'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norminvgauss.cdf(data,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_nig)</span>
<span id="cb19-59"></span>
<span id="cb19-60">U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U.to_numpy()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="81d39935" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">######## Test de kolmogorov-smirnov ########</span></span>
<span id="cb20-2"></span>
<span id="cb20-3">ks_stat_norm, ks_p_value_norm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.kstest(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'norm'</span>, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_norm))</span>
<span id="cb20-4">ks_stat_std, ks_p_value_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.kstest(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'t'</span>, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_std))</span>
<span id="cb20-5">ks_stat_nig, ks_p_value_nig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.kstest(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'norminvgauss'</span>, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(params_nig))</span>
<span id="cb20-6"></span>
<span id="cb20-7">res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb20-8">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Statistic"</span>: [ks_stat_norm, ks_stat_std, ks_stat_nig],</span>
<span id="cb20-9">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span>: [ks_p_value_norm, ks_p_value_std, ks_p_value_nig]</span>
<span id="cb20-10">            }, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Student"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normal Inverse Gaussian"</span>])</span>
<span id="cb20-11"></span>
<span id="cb20-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb20-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Test de Kolmogorov-Smirnov"</span>)</span>
<span id="cb20-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb20-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(res)</span>
<span id="cb20-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
Test de Kolmogorov-Smirnov
==================================================
                         Statistic   p-value
Normal                    0.047345  0.021967
Student                   0.025635  0.519206
Normal Inverse Gaussian   0.022462  0.685866
==================================================</code></pre>
</div>
</div>
</section>
</section>
<section id="iii.3.-etude-de-la-structure-de-d√©pendance" class="level2">
<h2 class="anchored" data-anchor-id="iii.3.-etude-de-la-structure-de-d√©pendance">III.3. Etude de la structure de d√©pendance</h2>
<p>L‚Äô√©valuation de la d√©pendance entre les facteurs de risque sera r√©alis√©e en utilisant des outils graphiques bas√©s sur des crit√®res non param√©triques, tels que les nuages de points, les ajustements lin√©aires et le d√©pendogramme.</p>
<p>Ces m√©thodes, choisies pour leur capacit√© √† traiter des donn√©es sans pr√©supposer une distribution sp√©cifique, offrent une approche flexible et visuelle pour identifier et analyser les relations entre les variables de risque. Par exemple, les nuages de points permettent de visualiser la dispersion et la relation potentielle entre deux variables, tandis que les ajustements lin√©aires cherchent √† mod√©liser la relation par une ligne droite, facilitant ainsi la compr√©hension des tendances g√©n√©rales.</p>
<p>Le d√©pendogramme, quant √† lui, repr√©sente la structure de d√©pendance sous la forme du nuage de points des marges uniformes extraites de l‚Äô√©chantillon n couples de donn√©es <img src="https://latex.codecogs.com/png.latex?%5Cleft(%5Cleft(x_%7B1,1%7D%20;%20x_%7B2,1%7D%5Cright),%20%5Ccdots,%5Cleft(x_%7B1,%20n%7D%20;%20x_%7B2,%20n%7D%5Cright)%5Cright)">, i.e.&nbsp;:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Au_%7Bi,%20j%7D=%5Cfrac%7B1%7D%7Bn%7D%20%5Csum_%7Bk=1%7D%5En%201_%7B%5Cleft%5C%7Bx_%7Bj,%20k%7D%20%5Cleq%20x_%7Bj,i%7D%5Cright%5C%7D%7D,%20%5Cquad%20i%20%5Cin%5B1,%20n%5D,%20%5Cquad%20%5Cforall%20j%20%5Cin%5B1,2%5D%0A"></p>
<p>Le d√©pendogramme de l‚Äô√©chantillon est donc la repr√©sentation de n couples <img src="https://latex.codecogs.com/png.latex?%5Cleft(%5Cleft(u_%7B1,1%7D%20;%20u_%7B2,1%7D%5Cright),%20%5Ccdots,%5Cleft(u_%7B1,%20n%7D%20;%20u_%7B2,%20n%7D%5Cright)%5Cright)">. Il permet d‚Äôobserver le caract√®re plus ou moins simultan√© des r√©alisations issues de l‚Äô√©chantillon.</p>
<div id="5dbc0f0c" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tableax avec tx de pearson, spearman et kendall</span></span>
<span id="cb22-2"></span>
<span id="cb22-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pearsonr, spearmanr, kendalltau</span>
<span id="cb22-4"></span>
<span id="cb22-5">pearson <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pearsonr(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>], returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>])</span>
<span id="cb22-6">spearman <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spearmanr(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>], returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>])</span>
<span id="cb22-7">kendall <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kendalltau(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>], returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>])</span>
<span id="cb22-8"></span>
<span id="cb22-9">tableau_correlation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb22-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Pearson"</span>: pearson,</span>
<span id="cb22-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spearman"</span>: spearman,</span>
<span id="cb22-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kendall"</span>: kendall</span>
<span id="cb22-13">}, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Coefficient"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span>])</span>
<span id="cb22-14"></span>
<span id="cb22-15">tableau_correlation</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Pearson</th>
<th data-quarto-table-cell-role="th">Spearman</th>
<th data-quarto-table-cell-role="th">Kendall</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Coefficient</td>
<td>8.646588e-01</td>
<td>8.409565e-01</td>
<td>6.690959e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">p-value</td>
<td>2.383438e-300</td>
<td>3.609139e-268</td>
<td>9.880880e-220</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>En analysant la corr√©lation entre les rendements de BNP et SG, nous constatons qu‚Äôil y a une corr√©lation positive significative peu importe le test de corr√©lation effectu√©. La corr√©lation de spearman et de pearson indique qu‚Äôil y a une liaison monotone et lin√©aire forte d‚Äôau moins 84% entre les rendements des deux entreprises. En ce qui concerne le taux de kendall, nous constatons une corr√©lation positive significative de 67% environ. Cela signifie que les rendements des actions de BNP et SG sont positivement corr√©l√©s.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Attention la corr√©lation de pearson n‚Äôest pas une mesure de concordance contrairement au coefficient de spearman. Dans notre cas, il indique une corr√©lation lin√©aire forte.</p>
</div>
</div>
<div id="34f334f6" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dependogramme</span></span>
<span id="cb23-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Posons x1, u1 = BNP et x2, u2 = SG</span></span>
<span id="cb23-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb23-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> rankdata</span>
<span id="cb23-5"></span>
<span id="cb23-6">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb23-7"></span>
<span id="cb23-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Transformation en pseudo-observations</span></span>
<span id="cb23-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> pseudo_observations(X):</span>
<span id="cb23-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Transforme les donn√©es en pseudo-observations U dans [0,1]."""</span></span>
<span id="cb23-11">    n, d <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.shape</span>
<span id="cb23-12">    U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((n, d))</span>
<span id="cb23-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> j <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(d):</span>
<span id="cb23-14">        U[:, j] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rankdata(X[:, j]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour √©viter les 1 stricts</span></span>
<span id="cb23-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> U</span>
<span id="cb23-16"></span>
<span id="cb23-17">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.to_numpy()</span>
<span id="cb23-18">u_obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pseudo_observations(X)</span>
<span id="cb23-19"></span>
<span id="cb23-20"></span>
<span id="cb23-21">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb23-22">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 ligne, 2 colonnes, premier graphique</span></span>
<span id="cb23-23"></span>
<span id="cb23-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># nuages de points des donn√©es BNP et SG</span></span>
<span id="cb23-25">plt.scatter(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>], returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>], cmap<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"viridis"</span>)</span>
<span id="cb23-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ajout la droite qui s'ajuste aux donn√©es</span></span>
<span id="cb23-27">plt.plot(np.unique(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>]), np.poly1d(np.polyfit(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>], returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SG"</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))(np.unique(returns[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BNP"</span>])), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Droite d'ajustement"</span>)</span>
<span id="cb23-28">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nuages de points des rendements"</span>)</span>
<span id="cb23-29">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x1"</span>)</span>
<span id="cb23-30">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x2"</span>)</span>
<span id="cb23-31">plt.legend()</span>
<span id="cb23-32">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb23-33"></span>
<span id="cb23-34">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb23-35">plt.scatter(u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb23-36">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©pendogrammes"</span>)</span>
<span id="cb23-37">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u1"</span>)</span>
<span id="cb23-38">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u2"</span>)</span>
<span id="cb23-39">plt.legend()</span>
<span id="cb23-40">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb23-41">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>En observant le d√©pendogramme, nous constatons la m√™me d√©pendance positive entre les deux entreprises. Cela signifie que si l‚Äôune des entreprises fait d√©faut, l‚Äôautre a plus de chance de faire d√©faut √©galement. Cela est coh√©rent avec la corr√©lation positive observ√©e entre les rendements des actions de BNP et SG.</p>
<p>De plus, en observant le d√©pendogramme, il semble avoir des d√©pendances √† gauche et √† droite entre les deux entreprises. Nous allons tout de m√™me tester un √©ventail de copules afin de v√©rifier laquelle des copules est la plus adapt√©e √† notre cas : - Copules elliptiques : gaussienne, Student. - Copules archim√©diennes : Clayton, Gumbel, Frank.</p>
<p>Il faudrait au pr√©alable estimer les param√®tres des copules archim√©diennes et elliptiques pour d√©terminer laquelle des copules est la plus adapt√©e √† notre cas. Pr√©cedemment, nous avons estim√© les param√®tres des lois marginales des rendements de BNP et SG. Nous allons utiliser ces param√®tres pour estimer les param√®tres des copules. Nous allons utiliser ces param√®tres pour la mod√©lisation des diff√©rentes copules.</p>
<div id="3e54eaa7" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize</span>
<span id="cb24-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.distributions.copula.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> (</span>
<span id="cb24-3">    GaussianCopula, StudentTCopula, ClaytonCopula, GumbelCopula, FrankCopula</span>
<span id="cb24-4">)</span>
<span id="cb24-5"></span>
<span id="cb24-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_copula(copula_type, params):</span>
<span id="cb24-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> copula_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>:</span>
<span id="cb24-8">        rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> GaussianCopula(corr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>np.array([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, rho], [rho, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]))</span>
<span id="cb24-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"student"</span>:</span>
<span id="cb24-11">        rho, nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params</span>
<span id="cb24-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> StudentTCopula(corr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>np.array([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, rho], [rho, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]), df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>nu)</span>
<span id="cb24-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clayton"</span>:</span>
<span id="cb24-14">        theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> ClaytonCopula(theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta)</span>
<span id="cb24-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>:</span>
<span id="cb24-17">        theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> GumbelCopula(theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta)</span>
<span id="cb24-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frank"</span>:</span>
<span id="cb24-20">        theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb24-21">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> FrankCopula(theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta)</span>
<span id="cb24-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb24-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Copula type </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>copula_type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> not supported"</span>)</span>
<span id="cb24-24"></span>
<span id="cb24-25"></span>
<span id="cb24-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Log-vraisemblance n√©gative pour estimation MLE</span></span>
<span id="cb24-27"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> negative_log_likelihood(params, U, copula_type):</span>
<span id="cb24-28">    copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_copula(copula_type, params)</span>
<span id="cb24-29">    log_likelihood <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> copula.logpdf(U)</span>
<span id="cb24-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(log_likelihood)</span>
<span id="cb24-31"></span>
<span id="cb24-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ajustement de la copule (MLE)</span></span>
<span id="cb24-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> fit_copula(U, copula_type):</span>
<span id="cb24-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> copula_type <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clayton"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frank"</span>]:</span>
<span id="cb24-35">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>:</span>
<span id="cb24-36">            x0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>]</span>
<span id="cb24-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb24-38">            x0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb24-39">        bounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> copula_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> [(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>)]</span>
<span id="cb24-40">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"student"</span>:</span>
<span id="cb24-41">        x0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># rho et df</span></span>
<span id="cb24-42">        bounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)]</span>
<span id="cb24-43"></span>
<span id="cb24-44">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize(negative_log_likelihood, x0, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(U, copula_type), bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bounds, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Nelder-Mead'</span>)</span>
<span id="cb24-45"></span>
<span id="cb24-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> result.success:</span>
<span id="cb24-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">RuntimeError</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"MLE failed for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>copula_type<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> copula: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>message<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb24-48"></span>
<span id="cb24-49">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> result.x</span></code></pre></div>
</div>
</section>
<section id="iii.4.-mod√©lisation-la-structure-de-d√©pendance-au-moyen-des-copules-param√©triques" class="level2">
<h2 class="anchored" data-anchor-id="iii.4.-mod√©lisation-la-structure-de-d√©pendance-au-moyen-des-copules-param√©triques">III.4. Mod√©lisation la structure de d√©pendance au moyen des copules param√©triques</h2>
<p>Pour mod√©liser la structure de d√©pendance entre les d√©fauts, de mani√®re pr√©cise, nous utiliserons les copules. Une copule est une fonction de r√©partition multivari√©e de marginales uniformes sur <img src="https://latex.codecogs.com/png.latex?%5B0,1%5D">. Dans le cas bivari√©, on a:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BC%7D%5Cleft(%5Cmathrm%7Bu%7D_1,%20%5Cmathrm%7Bu%7D_%7B%5Cmathrm%7B2%7D%7D%5Cright)=%5Cmathrm%7BP%7D%5Cleft%5B%5Cmathrm%7BU%7D_1%20%5Cleq%20%5Cmathrm%7Bu%7D_1,%5Cmathrm%7BU%7D_%7B%5Cmathrm%7B2%7D%7D%20%5Cleq%20%5Cmathrm%7Bu%7D_%7B%5Cmathrm%7B2%7D%7D%5Cright%5D%0A"></p>
<p>Dans le cadre de ce projet, nous allons √©tudier deux principales familles de copules pr√©sent√©s dans le tableau :</p>
<ul>
<li>Copules elliptiques : gaussienne, Student</li>
<li>Copules archim√©diennes : Clayton, Gumbel, Frank</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Btable%7D%5BH%5D%0A%5Ccentering%0A%5Cbegin%7Btabular%7D%7Bl%7Cc%7Ccc%7D%0A%5Chline%0AFamille%20&amp;%20Nom%20%20%20%20&amp;%20Copule%20$C(u,v)$%20%20%20&amp;%20Param%C3%A8tres%20%5C%5C%20%5Chline%0A%5Cmultirow%7B2%7D%7B*%7D%7BElliptique%7D%20&amp;%20Gaussien%20&amp;%20$%5CPhi_%7B%5CSigma%7D%5Cleft(%5CPhi%5E%7B-1%7D(u),%5CPhi%5E%7B-1%7D(v)%5Cright)$%20&amp;%20$%5Crho$%20%5C%5C%0A&amp;%20Student%20&amp;%20%20$T_%7B%5CSigma%7D%5Cleft(T_%7B%5Cnu%7D%5E%7B-1%7D(u),T_%7B%5Cnu%7D%5E%7B-1%7D(v)%5Cright)$%20&amp;%20$%5Crho,%20%5Cnu$%20%5C%5C%0A%5Cmidrule%0A%5Cmultirow%7B3%7D%7B*%7D%7BArchim%C3%A9dienne%7D%20&amp;%20Frank%20%20&amp;%20$%5Cfrac%7B1%7D%7B%5Ctheta%7D%20%5Cleft(-%5Cln(1+%20%5Cfrac%7B(e%5E%7B-%5Ctheta%20u%7D%20%20-%201)(e%5E%7B-%5Ctheta%20v%7D%20-%201)%7D%7Be%5E%7B-%5Ctheta%20v%7D%20-%201%7D)%5Cright)$%20&amp;%20$%5Ctheta%20%5Cne%200$%20%5C%5C%0A&amp;%20Gumbel%20&amp;%20$%5Cexp%5Cleft(-%5Cleft((-%20%5Cln(u))%5E%7B%5Ctheta%7D%20+%20(-%20%5Cln(v))%5E%7B%5Ctheta%7D%5Cright)%5E%7B%5Cfrac%7B1%7D%7B%5Ctheta%7D%7D%5Cright)$%20&amp;%20$%5Ctheta%20%5Cgeq%201$%20%5C%5C%0A&amp;%20Clayton%20%20&amp;%20$(u%5E%7B-%5Ctheta%7D%20+%20v%5E%7B-%5Ctheta%7D%20-1)%5E%7B-%5Cfrac%7B1%7D%7B%5Ctheta%7D%7D$%20&amp;%20$%5Ctheta%20%3E%200$%0A%5C%5C%20%5Chline%0A%5Cend%7Btabular%7D%5C%5C%0A%7B%5Cfootnotesize%20*$%5CSigma$%20est%20la%20matrice%20de%20variance%20covariance.%20%7D%0A%5Ccaption%7BCopules%20archim%C3%A9diennes%20bivari%C3%A9es%20les%20plus%20courantes.%7D%0A%5Clabel%7Btab:copule_family%7D%0A%5Cend%7Btable%7D%0A"></p>
<p>Il s‚Äôagira apr√®s estimation des param√®tres et des tests d‚Äôajustement, la copule la plus ad√©quate pour mod√©liser au mieux la d√©pendance entre les variables √©tudi√©es.</p>
<p>Pour l‚Äôestimation des param√®tres des copules s√©lectionn√©es, plusieurs approches m√©thodologiques s‚Äôoffrent √† nous: la m√©thode des moments, la m√©thode du maximum de vraisemblance et l‚Äôapproche IFM. Nous privil√©gierons l‚Äôapproche IFM (Inference Functions for Margins) pr√©sent√© ci dessous (algo <img src="https://latex.codecogs.com/png.latex?%5Cref%7BIFM%7D">). Cet algorithme a l‚Äôavantage d‚Äô√™tre plus rapide que la m√©thode du maximum de vraisemblance.</p>
<p>Pour l‚Äô√©valuation de l‚Äôajustement des copules √† la structure de d√©pendance d‚Äôun √©chantillon, nous utiliserons des outils graphiques tels que le d√©pendogramme, pr√©sent√© pr√©cedemment, et le Kendall plot.</p>
<p>Le Kendall plot permet une comparaison directe entre la copule empirique et la copule th√©orique. Plus le Kendall plot se rapproche d‚Äôune droite, plus l‚Äôajustement entre la structure de d√©pendance de l‚Äô√©chantillon et la copule estim√©e sur ce m√™me √©chantillon est bon.</p>
<section id="iii.4.1-copule-gaussienne" class="level3">
<h3 class="anchored" data-anchor-id="iii.4.1-copule-gaussienne">III.4.1 Copule gaussienne</h3>
<section id="iii.4.1.a.-estimation-des-param√®tres-de-la-copule-gaussienne" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.1.a.-estimation-des-param√®tres-de-la-copule-gaussienne">III.4.1.a. Estimation des param√®tres de la copule gaussienne</h4>
<p>Dans le cadre de la copule gaussienne, il nous faut la matrice de variance qui est donn√©e par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bpmatrix%7D%0A1%20&amp;%20%5Crho%20%5C%5C%0A%5Crho%20&amp;%201%0A%5Cend%7Bpmatrix%7D%0A"></p>
<p>Dans notre cas, le seul param√®tre √† estimer est le coefficient de corr√©lation de pearson. Nous allons donc estimer le coefficient de corr√©lation de pearson entre les rendements des actions de BNP et SG.</p>
<div id="cc0fd4d8" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(u_obs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb25-2"></span>
<span id="cb25-3">mat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, rho], [rho, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span>
<span id="cb25-4">mat</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>array([[1.        , 0.86097656],
       [0.86097656, 1.        ]])</code></pre>
</div>
</div>
</section>
<section id="iii.4.1.b.-simulation-de-la-copule-gaussienne" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.1.b.-simulation-de-la-copule-gaussienne">III.4.1.b. Simulation de la copule gaussienne</h4>
<p>Pour simuler la copule gaussienne, nous allons utiliser la m√©thode de distribution puisque la loi est facile √† impl√©menter.</p>
<div id="6fa3de95" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Simuler r√©alisation W suivant une loi normale centr√©e multivari√©e</span></span>
<span id="cb27-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import scipy.stats as stats</span></span>
<span id="cb27-3"></span>
<span id="cb27-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># np.random.seed(0)</span></span>
<span id="cb27-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># n = 1000</span></span>
<span id="cb27-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># W = np.random.multivariate_normal([0, 0], mat, n)</span></span>
<span id="cb27-7"></span>
<span id="cb27-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # Calculer U1 et U2</span></span>
<span id="cb27-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># U = np.zeros((n, 2))</span></span>
<span id="cb27-10"></span>
<span id="cb27-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for i in range(n):</span></span>
<span id="cb27-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     U[i,0] = stats.norm.cdf(W[i,0])</span></span>
<span id="cb27-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     U[i,1] = stats.norm.cdf(W[i,1])</span></span>
<span id="cb27-14"></span>
<span id="cb27-15"></span>
<span id="cb27-16">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> u_obs.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb27-17">_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GaussianCopula(corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rho).rvs(n)</span>
<span id="cb27-18">u_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pseudo_observations(_)</span></code></pre></div>
</div>
</section>
<section id="iii.4.1.c.-test-dajustement" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.1.c.-test-dajustement">III.4.1.c. Test d‚Äôajustement</h4>
<div id="9696ca51" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb28-2">plt.scatter(u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Donn√©es empiriques"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)</span>
<span id="cb28-3">plt.scatter(u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Copule gaussienne"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb28-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©pendogrammes"</span>)</span>
<span id="cb28-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u1"</span>)</span>
<span id="cb28-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u2"</span>)</span>
<span id="cb28-7">plt.legend()</span>
<span id="cb28-8">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb28-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8c2caf1e" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Kendall plot</span></span>
<span id="cb29-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb29-3"></span>
<span id="cb29-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> calculer_Hi_vect(U):</span>
<span id="cb29-5">    n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(U)</span>
<span id="cb29-6">    H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb29-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Comparaison de chaque paire une seule fois</span></span>
<span id="cb29-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb29-9">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©er des masques bool√©ens pour les conditions</span></span>
<span id="cb29-10">        cond1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> U[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># u_{1,j} &lt;= u_{1,i}</span></span>
<span id="cb29-11">        cond2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> U[i, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># u_{2,j} &lt;= u_{2,i}</span></span>
<span id="cb29-12"></span>
<span id="cb29-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Appliquer les conditions et exclure le cas o√π i == j</span></span>
<span id="cb29-14">        H[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(np.logical_and(cond1, cond2)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb29-15"></span>
<span id="cb29-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> H<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(U)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb29-17"></span>
<span id="cb29-18"></span>
<span id="cb29-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> kendall_plot(U,S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>,copula<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>,rho<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,nu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb29-20"></span>
<span id="cb29-21">    H_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> calculer_Hi_vect(U)</span>
<span id="cb29-22">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(U)</span>
<span id="cb29-23"></span>
<span id="cb29-24">    H_means <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((S, n)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S lignes et n colonnes</span></span>
<span id="cb29-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(S):</span>
<span id="cb29-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'gaussian'</span>:</span>
<span id="cb29-27">            X_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GaussianCopula(corr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>rho).rvs(n)</span>
<span id="cb29-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'student'</span>:</span>
<span id="cb29-29">            X_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StudentTCopula(df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nu, corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rho).rvs(n)</span>
<span id="cb29-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>:</span>
<span id="cb29-31">            X_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GumbelCopula(theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta).rvs(n)</span>
<span id="cb29-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clayton"</span>:</span>
<span id="cb29-33">            X_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ClaytonCopula(theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta).rvs(n)</span>
<span id="cb29-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frank"</span>:</span>
<span id="cb29-35">            X_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FrankCopula(theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta).rvs(n)</span>
<span id="cb29-36">        U_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pseudo_observations(X_)</span>
<span id="cb29-37">        H_means[s] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(calculer_Hi_vect(U_))</span>
<span id="cb29-38"></span>
<span id="cb29-39">    H_mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(H_means, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># axis=0 pour moyenne par colonne</span></span>
<span id="cb29-40"></span>
<span id="cb29-41">    x,y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(H_i), np.sort(H_mean)</span>
<span id="cb29-42">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(x.shape, y.shape)</span>
<span id="cb29-43"></span>
<span id="cb29-44">    plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb29-45">    plt.plot(x, y)</span>
<span id="cb29-46">    plt.plot([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>)</span>
<span id="cb29-47">    plt.title(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Kendall plot for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>copula<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> copula"</span>)</span>
<span id="cb29-48">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"i"</span>)</span>
<span id="cb29-49">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kendall"</span>)</span>
<span id="cb29-50">    plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb29-51">    plt.show()</span>
<span id="cb29-52"></span>
<span id="cb29-53">S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb29-54">kendall_plot(u_obs,S,copula<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>,rho<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>rho)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(999,) (999,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="iii.4.1.d.-test-dad√©quation" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.1.d.-test-dad√©quation">III.4.1.d. Test d‚Äôad√©quation</h4>
<div id="6b99a0d2" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Copule empirique Cn(u)</span></span>
<span id="cb31-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> empirical_copula_cdf(U, u):</span>
<span id="cb31-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Calcule la copule empirique Cn(u)."""</span></span>
<span id="cb31-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.mean(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">all</span>(U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> u, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb31-5"></span>
<span id="cb31-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Statistique de Cram√©r-von Mises</span></span>
<span id="cb31-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> cramer_von_mises_stat(U, copula):</span>
<span id="cb31-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Calcule la statistique de test Tn."""</span></span>
<span id="cb31-9">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(U)</span>
<span id="cb31-10">    Tn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb31-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb31-12">        u_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> U[i]</span>
<span id="cb31-13">        Cn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> empirical_copula_cdf(U, u_i)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Copule empirique Cn(u_i)</span></span>
<span id="cb31-14">        C_theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> copula.cdf([u_i])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Copule th√©orique estim√©e CŒ∏(u_i)</span></span>
<span id="cb31-15">        Tn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> (Cn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> C_theta) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb31-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> Tn</span>
<span id="cb31-17"></span>
<span id="cb31-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test d‚Äôad√©quation complet avec bootstrap param√©trique</span></span>
<span id="cb31-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> adequation_test(X, copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>, M<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>):</span>
<span id="cb31-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb31-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Test d'ad√©quation de Genest &amp; R√©millard (2008) pour une copule avec</span></span>
<span id="cb31-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    statistique de Cram√©r-von Mises et bootstrap param√©trique.</span></span>
<span id="cb31-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb31-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pseudo-observations</span></span>
<span id="cb31-25">    U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pseudo_observations(X)</span>
<span id="cb31-26">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(U)</span>
<span id="cb31-27"></span>
<span id="cb31-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation MLE de la copule sur les donn√©es</span></span>
<span id="cb31-29">    params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(U, copula_type)</span>
<span id="cb31-30">    copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_copula(copula_type, params)</span>
<span id="cb31-31"></span>
<span id="cb31-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la statistique observ√©e Tn</span></span>
<span id="cb31-33">    T_obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cramer_von_mises_stat(U, copula)</span>
<span id="cb31-34"></span>
<span id="cb31-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bootstrap param√©trique</span></span>
<span id="cb31-36">    T_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb31-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(M):</span>
<span id="cb31-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Simulation d‚Äôun √©chantillon sous la copule ajust√©e</span></span>
<span id="cb31-39">        U_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> copula.rvs(n)</span>
<span id="cb31-40"></span>
<span id="cb31-41">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. R√©-estimation de la copule sur U_boot</span></span>
<span id="cb31-42">        params_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(U_boot, copula_type)</span>
<span id="cb31-43">        copula_boot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_copula(copula_type, params_boot)</span>
<span id="cb31-44"></span>
<span id="cb31-45">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Calcul de Tn pour cet √©chantillon bootstrap</span></span>
<span id="cb31-46">        T_boot.append(cramer_von_mises_stat(U_boot, copula_boot))</span>
<span id="cb31-47"></span>
<span id="cb31-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la p-value (proportion des T_boot sup√©rieurs √† T_obs)</span></span>
<span id="cb31-49">    p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(np.array(T_boot) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> T_obs)</span>
<span id="cb31-50"></span>
<span id="cb31-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb31-52">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"copula_type"</span>: copula_type,</span>
<span id="cb31-53">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"params"</span>: params,</span>
<span id="cb31-54">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T_obs"</span>: T_obs,</span>
<span id="cb31-55">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p_value"</span>: p_value</span>
<span id="cb31-56">    }</span>
<span id="cb31-57"></span>
<span id="cb31-58"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pprint <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pprint</span>
<span id="cb31-59">result_gaussian <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adequation_test(X, copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gaussian"</span>)</span>
<span id="cb31-60">pprint(result_gaussian)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'T_obs': np.float64(0.05456423166335546),
 'copula_type': 'gaussian',
 'p_value': np.float64(0.892),
 'params': array([0.86097656])}</code></pre>
</div>
</div>
</section>
</section>
<section id="iii.4.2-copule-de-student" class="level3">
<h3 class="anchored" data-anchor-id="iii.4.2-copule-de-student">III.4.2 Copule de student</h3>
<section id="iii.4.2.a.-estimation-des-param√®tres-de-la-copule-student" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.2.a.-estimation-des-param√®tres-de-la-copule-student">III.4.2.a. Estimation des param√®tres de la copule student</h4>
<div id="dbe5070c" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1">rho,nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(u_obs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"student"</span>)</span>
<span id="cb33-2"></span>
<span id="cb33-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rho = "</span>, rho)</span>
<span id="cb33-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nu = "</span>, nu)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rho =  0.8496143388748167
nu =  2.0</code></pre>
</div>
</div>
</section>
<section id="iii.4.2.b.-simulation-de-la-copule-de-student" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.2.b.-simulation-de-la-copule-de-student">III.4.2.b. Simulation de la copule de student</h4>
<div id="92eeb004" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> u_obs.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb35-2">_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StudentTCopula(corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rho, df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>nu).rvs(n)</span>
<span id="cb35-3">u_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pseudo_observations(_)</span></code></pre></div>
</div>
</section>
<section id="iii.4.2.c.-test-dajustement" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.2.c.-test-dajustement">III.4.2.c. Test d‚Äôajustement</h4>
<div id="d8fc4aac" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb36-2">plt.scatter(u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Donn√©es empiriques"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)</span>
<span id="cb36-3">plt.scatter(u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Copule de student"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb36-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©pendogrammes"</span>)</span>
<span id="cb36-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u1"</span>)</span>
<span id="cb36-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u2"</span>)</span>
<span id="cb36-7">plt.legend()</span>
<span id="cb36-8">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb36-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c576ff19" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1">kendall_plot(u_obs,S,copula<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"student"</span>,rho<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>rho,nu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>nu)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(999,) (999,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-26-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Attention, nous avons utilis√© le package copula.api de statsmodels pour impl√©menter les copules. Cependant, la classe correspondant √† la copule de Student ne permet pas d‚Äôobtenir une fonction de r√©partition (voir <a href="https://www.statsmodels.org/dev/_modules/statsmodels/distributions/copula/elliptical.html#StudentTCopula.cdf">lien</a>).</p>
<p>En utilisant un environnement virtuel, il a √©t√© possible de modifier le fichier statsmodels/distributions/copula/elliptical.py du package afin d‚Äôimpl√©menter la m√©thode pour la fonction de r√©partition. Vous trouverez ce fichier <a href="utiles/elliptical.py">ci-joint</a> afin de garantir le bon fonctionnement du code si vous devez le relancer.</p>
</div>
</div>
</section>
<section id="iii.4.2.d.-test-dad√©quation" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.2.d.-test-dad√©quation">III.4.2.d. Test d‚Äôad√©quation</h4>
<div id="24b4d009" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pprint <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pprint</span>
<span id="cb39-2">result_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adequation_test(X, copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"student"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">ATTENTION</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"> DIFFICULTE POUR ESSTIMER COPULE STUDENT</span></span>
<span id="cb39-3">pprint(result_std)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'T_obs': np.float64(0.05937889644009823),
 'copula_type': 'student',
 'p_value': np.float64(0.85),
 'params': array([0.84961434, 2.        ])}</code></pre>
</div>
</div>
</section>
</section>
<section id="iii.4.3-copule-de-clayton" class="level3">
<h3 class="anchored" data-anchor-id="iii.4.3-copule-de-clayton">III.4.3 Copule de clayton</h3>
<section id="iii.4.3.a.-estimation-des-param√®tres-de-la-copule-clayton" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.3.a.-estimation-des-param√®tres-de-la-copule-clayton">III.4.3.a. Estimation des param√®tres de la copule clayton</h4>
<div id="edf88af7" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1">theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(u_obs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clayton"</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb41-2"></span>
<span id="cb41-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theta = "</span>, theta)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>theta =  2.4768310546874988</code></pre>
</div>
</div>
</section>
<section id="iii.4.3.b.-simulation-de-la-copule-de-clayton" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.3.b.-simulation-de-la-copule-de-clayton">III.4.3.b. Simulation de la copule de clayton</h4>
<div id="eb84fd42" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> u_obs.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb43-2">_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ClaytonCopula(theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta).rvs(n)</span>
<span id="cb43-3">u_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pseudo_observations(_)</span></code></pre></div>
</div>
</section>
<section id="iii.4.3.c.-test-dajustement" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.3.c.-test-dajustement">III.4.3.c. Test d‚Äôajustement</h4>
<div id="95731f90" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb44-2">plt.scatter(u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Donn√©es empiriques"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)</span>
<span id="cb44-3">plt.scatter(u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Copule de clayton"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb44-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©pendogrammes"</span>)</span>
<span id="cb44-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u1"</span>)</span>
<span id="cb44-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u2"</span>)</span>
<span id="cb44-7">plt.legend()</span>
<span id="cb44-8">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb44-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1cf5c130" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1">S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb45-2">kendall_plot(u_obs,S,copula<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clayton"</span>,theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(999,) (999,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-31-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="iii.4.3.d.-test-dad√©quation" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.3.d.-test-dad√©quation">III.4.3.d. Test d‚Äôad√©quation</h4>
<div id="5816c26b" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pprint <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pprint</span>
<span id="cb47-2">result_clayton<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adequation_test(X, copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clayton"</span>) </span>
<span id="cb47-3">pprint(result_clayton)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'T_obs': array([0.86477661]),
 'copula_type': 'clayton',
 'p_value': np.float64(0.004),
 'params': array([2.47683105])}</code></pre>
</div>
</div>
</section>
</section>
<section id="iii.4.4-copule-de-gumbel" class="level3">
<h3 class="anchored" data-anchor-id="iii.4.4-copule-de-gumbel">III.4.4 Copule de gumbel</h3>
<section id="iii.4.4.a.-estimation-des-param√®tres-de-la-copule-gumbel" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.a.-estimation-des-param√®tres-de-la-copule-gumbel">III.4.4.a. Estimation des param√®tres de la copule gumbel</h4>
<div id="a42a4379" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1">theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(u_obs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb49-2"></span>
<span id="cb49-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theta = "</span>, theta)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>theta =  2.9939208984374996</code></pre>
</div>
</div>
</section>
<section id="iii.4.4.b.-simulation-de-la-copule-de-clayton" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.b.-simulation-de-la-copule-de-clayton">III.4.4.b. Simulation de la copule de clayton</h4>
<div id="107ca25e" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> u_obs.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb51-2">_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GumbelCopula(theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta).rvs(n)</span>
<span id="cb51-3">u_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pseudo_observations(_)</span></code></pre></div>
</div>
</section>
<section id="iii.4.4.c.-test-dajustement" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.c.-test-dajustement">III.4.4.c. Test d‚Äôajustement</h4>
<div id="a6682d08" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb52-2">plt.scatter(u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Donn√©es empiriques"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)</span>
<span id="cb52-3">plt.scatter(u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Copule de gumbel"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb52-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©pendogrammes"</span>)</span>
<span id="cb52-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u1"</span>)</span>
<span id="cb52-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u2"</span>)</span>
<span id="cb52-7">plt.legend()</span>
<span id="cb52-8">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb52-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c3b56a5e" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1">kendall_plot(u_obs,S,copula<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>,theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(999,) (999,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-36-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="iii.4.4.d.-test-dad√©quation" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.d.-test-dad√©quation">III.4.4.d. Test d‚Äôad√©quation</h4>
<div id="f1674f67" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pprint <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pprint</span>
<span id="cb55-2">result_gumbel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adequation_test(X, copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>) </span>
<span id="cb55-3">pprint(result_gumbel)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'T_obs': array([0.03485682]),
 'copula_type': 'gumbel',
 'p_value': np.float64(0.988),
 'params': array([2.9939209])}</code></pre>
</div>
</div>
</section>
</section>
<section id="iii.4.4-copule-de-frank" class="level3">
<h3 class="anchored" data-anchor-id="iii.4.4-copule-de-frank">III.4.4 Copule de frank</h3>
<section id="iii.4.4.a.-estimation-des-param√®tres-de-la-copule-frank" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.a.-estimation-des-param√®tres-de-la-copule-frank">III.4.4.a. Estimation des param√®tres de la copule frank</h4>
<div id="c86253c2" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1">theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(u_obs, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frank"</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb57-2"></span>
<span id="cb57-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theta = "</span>, theta)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>theta =  10.0</code></pre>
</div>
</div>
</section>
<section id="iii.4.4.b.-simulation-de-la-copule-de-clayton-1" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.b.-simulation-de-la-copule-de-clayton-1">III.4.4.b. Simulation de la copule de clayton</h4>
<div id="3fec9362" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> u_obs.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb59-2">_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FrankCopula(theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta).rvs(n)</span>
<span id="cb59-3">u_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pseudo_observations(_)</span></code></pre></div>
</div>
</section>
<section id="iii.4.4.c.-test-dajustement-1" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.c.-test-dajustement-1">III.4.4.c. Test d‚Äôajustement</h4>
<div id="3a9b643f" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb60-2">plt.scatter(u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_obs[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Donn√©es empiriques"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)</span>
<span id="cb60-3">plt.scatter(u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], u_est[:,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Copule de frank"</span>, color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb60-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©pendogrammes"</span>)</span>
<span id="cb60-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u1"</span>)</span>
<span id="cb60-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"u2"</span>)</span>
<span id="cb60-7">plt.legend()</span>
<span id="cb60-8">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb60-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="87cebd33" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1">kendall_plot(u_obs,S,copula<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frank"</span>,theta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(999,) (999,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-41-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="iii.4.4.d.-test-dad√©quation-1" class="level4">
<h4 class="anchored" data-anchor-id="iii.4.4.d.-test-dad√©quation-1">III.4.4.d. Test d‚Äôad√©quation</h4>
<div id="f9ded077" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb63" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> pprint <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pprint</span>
<span id="cb63-2">result_frank <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adequation_test(X, copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"frank"</span>) </span>
<span id="cb63-3">pprint(result_frank)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'T_obs': array([0.12454173]),
 'copula_type': 'frank',
 'p_value': np.float64(0.492),
 'params': array([10.])}</code></pre>
</div>
</div>
</section>
</section>
<section id="iii.5.-r√©sultats" class="level3">
<h3 class="anchored" data-anchor-id="iii.5.-r√©sultats">III.5. R√©sultats</h3>
<p>Nos r√©sultats mettent en √©vidence l‚Äôimportance de la structure de d√©pendance dans l‚Äô√©valuation du risque de cr√©dit. Apr√®s avoir test√© plusieurs copules param√©triques, nous avons retenu la copule de Gumbel comme la plus appropri√©e, en raison de son bon ajustement aux donn√©es et de sa capacit√© √† capturer les asym√©tries et les queues de distribution lourdes, essentielles dans un contexte de crise financi√®re.</p>
<div id="17291739" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb65" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1">dict_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [result_gaussian, result_std, result_clayton, result_gumbel, result_frank]</span>
<span id="cb65-2"></span>
<span id="cb65-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to DataFrame</span></span>
<span id="cb65-4">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(dict_list)</span>
<span id="cb65-5">df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">copula_type</th>
<th data-quarto-table-cell-role="th">params</th>
<th data-quarto-table-cell-role="th">T_obs</th>
<th data-quarto-table-cell-role="th">p_value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>gaussian</td>
<td>[0.8609765625000002]</td>
<td>0.054564</td>
<td>0.892</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>student</td>
<td>[0.8496143388748167, 2.0]</td>
<td>0.059379</td>
<td>0.850</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>clayton</td>
<td>[2.4768310546874988]</td>
<td>[0.8647766118220173]</td>
<td>0.004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>gumbel</td>
<td>[2.9939208984374996]</td>
<td>[0.034856823632549765]</td>
<td>0.988</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>frank</td>
<td>[10.0]</td>
<td>[0.12454172887238589]</td>
<td>0.492</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="iv.-estimation-de-la-credit-var" class="level1">
<h1>IV. Estimation de la Credit VaR</h1>
<p>La simulation Monte Carlo nous a permis d‚Äôestimer la distribution des pertes du portefeuille et de d√©terminer une CreditVaR √† 99% de 1286,61 euros. L‚Äôanalyse de la convergence des r√©sultats confirme la robustesse de cette estimation, qui reste stable malgr√© les variations de taille d‚Äô√©chantillon.</p>
<p>Ainsi, cette √©tude illustre la pertinence des copules pour mod√©liser de mani√®re plus r√©aliste la d√©pendance entre les actifs financiers, l√† o√π les approches classiques fond√©es sur la corr√©lation lin√©aire sont insuffisantes. Une perspective d‚Äôam√©lioration pourrait consister √† explorer des copules dynamiques ou √† affiner l‚Äôestimation des param√®tres via des m√©thodes bay√©siennes.</p>
<div id="e1872b99" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la credit var par monte carlo</span></span>
<span id="cb66-2"></span>
<span id="cb66-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> credit_var(params_R1,params_R2,lambda_1,lambda_2,EAD,params,S,tau,copula_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>,alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>):</span>
<span id="cb66-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb66-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        Cette fonction est Var de niveau alpha qui estime la perte maximale sur l'horizon tau</span></span>
<span id="cb66-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        et retourne le quantile de niveau 99% pour dim=2.</span></span>
<span id="cb66-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb66-8"></span>
<span id="cb66-9">    copula <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_copula(copula_type, params)</span>
<span id="cb66-10">    U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> copula.rvs(S)</span>
<span id="cb66-11">    a1,b1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params_R1</span>
<span id="cb66-12">    a2,b2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params_R2</span>
<span id="cb66-13"></span>
<span id="cb66-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># G√©n√©rer des √©chantillons pour lgd_bnp et lgd_sg avec la loi Beta, vectoris√©e</span></span>
<span id="cb66-15">    LGD1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.random.beta(a1, b1, S)</span>
<span id="cb66-16">    LGD2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.random.beta(a2, b2, S)</span>
<span id="cb66-17"></span>
<span id="cb66-18"></span>
<span id="cb66-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simuler tau_bnp et tau_sg en utilisant la fonction de r√©partition inverse de la loi exponentielle</span></span>
<span id="cb66-20">    tau_bnp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.expon.ppf(U[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>lambda_1)</span>
<span id="cb66-21">    tau_sg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.expon.ppf(U[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>lambda_2)</span>
<span id="cb66-22"></span>
<span id="cb66-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculer les pertes, vectoris√©e</span></span>
<span id="cb66-24">    L1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.where(tau_bnp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> tau, LGD1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> EAD, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb66-25">    L2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.where(tau_sg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> tau, LGD2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> EAD, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb66-26"></span>
<span id="cb66-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Somme des pertes</span></span>
<span id="cb66-28">    L <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> L1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> L2</span>
<span id="cb66-29"></span>
<span id="cb66-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculer et retourner le quantile de niveau 99%</span></span>
<span id="cb66-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.percentile(L, alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
</div>
<div id="808ea6e4" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tracer la courbe de la VaR en fonction de S</span></span>
<span id="cb67-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set seed</span></span>
<span id="cb67-3">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb67-4"></span>
<span id="cb67-5">S_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb67-6">params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fit_copula(U, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gumbel"</span>)</span>
<span id="cb67-7">EAD <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb67-8">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb67-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> PD(T,spread,Recouvrement):</span>
<span id="cb67-10">    lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> spread <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Recouvrement)</span>
<span id="cb67-11">    PD <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>T)</span>
<span id="cb67-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> PD,lambda_</span>
<span id="cb67-13"></span>
<span id="cb67-14">_,lambda_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PD(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,spread_4Y[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],tx_recouvrement)</span>
<span id="cb67-15">_,lambda_2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PD(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,spread_5Y[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],tx_recouvrement)</span>
<span id="cb67-16"></span>
<span id="cb67-17">params_R1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a_BNP,b_BNP</span>
<span id="cb67-18">params_R2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a_SG,b_SG</span>
<span id="cb67-19">VaR_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [credit_var(params_R1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params_R1,params_R2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params_R2, lambda_1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_1, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb67-20">                         lambda_2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_2, EAD<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>EAD, params<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params, S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>S, tau<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tau) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> S <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> S_values]</span>
<span id="cb67-21"></span>
<span id="cb67-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Je veux tracer une droite horizontale pour la mediane de la VaR et mettre √ßa valeur sur l'axe des ordonn√©es</span></span>
<span id="cb67-23">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb67-24">plt.plot(S_values, VaR_values)</span>
<span id="cb67-25">plt.axhline(np.mean(VaR_values), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>)</span>
<span id="cb67-26">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"S"</span>)</span>
<span id="cb67-27">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VaR"</span>)</span>
<span id="cb67-28">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb67-29">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="521b2f12" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1">np.mean(VaR_values)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>np.float64(1286.2298311022887)</code></pre>
</div>
</div>
<div id="c74e0cd2" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb70" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40000</span></span>
<span id="cb70-2">credit_var(params_R1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params_R1,params_R2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params_R2, lambda_1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_1, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb70-3">                         lambda_2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lambda_2, EAD<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>EAD, params<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params, S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>S, tau<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tau)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>np.float64(1290.3822356040268)</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>paper</category>
  <category>risques-fin</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/pj_copules.html</guid>
  <pubDate>Wed, 12 Mar 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Mod√®les de courbe de taux</title>
  <link>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx.html</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Que ce soit pour les banques, les assureurs ou les fonds de pension, la courbe de taux z√©ro-coupon constitue la brique de base pour la valorisation de nombreux instruments financiers, de la d√©termination du prix des obligations aux produits d√©riv√©s plus complexes tels que les swaps de taux, les caplets, les swaptions ou encore les produits structur√©s de taux. De ce fait, la construction fiable, coh√©rente et r√©guli√®rement mise √† jour d‚Äôune courbe de taux z√©ro-coupon repr√©sente un enjeu majeur.</p>
<p>Dans ce contexte, ce projet propose une m√©thodologie compl√®te de reconstitution de la courbe de taux z√©ro-coupon implicite, √©labor√©e √† partir des cotations de march√© disponibles sur diff√©rents segments : Money Market (march√© mon√©taire), Futures et Swaps. L‚Äôapproche adopt√©e repose sur une combinaison de bootstrapping, permettant d‚Äôextraire les taux z√©ro-coupon pour chaque maturit√© observable, et d‚Äôinterpolations par spline cubique, afin d‚Äôassurer la lissit√© et la continuit√© de la courbe sur l‚Äôensemble de l‚Äô√©ch√©ancier, y compris sur les maturit√©s non directement observ√©es.</p>
<p>La courbe obtenue sert ensuite de r√©f√©rence pour la valorisation de produits d√©riv√©s de taux, en particulier les caplets et les swaptions, via le mod√®le classique de Black, largement utilis√© sur les march√©s. Toutefois, afin de mieux capturer la dynamique temporelle des taux d‚Äôint√©r√™t et de prendre en compte la structure temporelle de la volatilit√© implicite, la seconde partie du projet repose sur la calibration d‚Äôun mod√®le de Hull-White, un mod√®le de taux affine avec retour √† la moyenne. La calibration est r√©alis√©e √† partir des cotations de caplets at-the-money (ATM), √† l‚Äôaide d‚Äôune proc√©dure de recherche num√©rique par dichotomie.</p>
<p>Le projet met √©galement en √©vidence la sensibilit√© de la courbe de taux forward et des prix d‚Äôoptions aux param√®tres de march√©, notamment la volatilit√© et le param√®tre de mean reversion du mod√®le Hull-White. Cette analyse de sensibilit√© illustre comment la structure de la courbe de taux et son √©volution future sont influenc√©es par les hypoth√®ses de mod√©lisation, ce qui est particuli√®rement crucial pour les desks de trading, les gestionnaires d‚Äôactifs ou les √©quipes de gestion actif-passif (ALM).</p>
<p>Enfin, le projet se prolonge par une extension appliqu√©e aux produits structur√©s : la valorisation de caplets √† barri√®re d√©sactivante (knock-out caplets), qui n√©cessite une approche par simulation Monte-Carlo. Cette extension illustre comment la dynamique du taux court, simul√©e sous la mesure forward neutre, peut √™tre exploit√©e pour √©valuer des produits de plus en plus complexes, r√©pondant √† des besoins sp√©cifiques d‚Äôinvestisseurs ou de gestionnaires de risques.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Le rapport de ce projet est disponible <a href="../rapports/Rapport_KOUADIO_OUYASSIN_courbes_de_taux.pdf">ici</a>.</p>
</div>
</div>
</section>
<section id="i.-reconstitution-de-la-courbe-de-taux" class="level2">
<h2 class="anchored" data-anchor-id="i.-reconstitution-de-la-courbe-de-taux">I. Reconstitution de la courbe de taux</h2>
<section id="i.1.-formules-de-valorisation-des-taux-de-march√©" class="level3">
<h3 class="anchored" data-anchor-id="i.1.-formules-de-valorisation-des-taux-de-march√©">I.1. Formules de valorisation des taux de march√©</h3>
<p>La courbe interbancaire est une courbe de taux qui repr√©sente les taux d‚Äôint√©r√™t auxquels les banques se pr√™tent de l‚Äôargent entre elles. Elle est utilis√©e pour d√©terminer les taux d‚Äôint√©r√™t des pr√™ts et des emprunts √† court terme. Elle est construite sur le court terme (maturit√©&lt;6M) √† partir des taux du march√©s mon√©taire (Money Market) bas√©s sur les d√©pots non garantis entre banques. Sur le moyen terme (6m - 3y) elle est construite √† partir des contrats futures, i.e.&nbsp;des forwards sur un march√© OTC (Over The Counter) et sur le long terme (&gt;3y) elle est construite √† partir des contrats de swap euribor (Euro Interbank Offered Rate) 3M ou 6M.</p>
<p>Ci dessous, nous disposons de ces donn√©es de taux de march√© cot√©s sur le march√© interbancaire. Nous allons essayer de reconstituer la courbe de taux zero coupon implicite, qui ne cote pas directement sur le march√©. Le fichier de donn√©es contient trois variables : - Type d‚Äôinstruments (Money Market, Futures, Swap) - Maturit√© (en ann√©es) - Taux d‚Äôint√©r√™t</p>
<div id="229e14ed" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-4">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ignore'</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_excel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/Data_tx.xlsx'</span>, sheet_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx_marche'</span>)</span>
<span id="cb1-7">data.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>]</span>
<span id="cb1-8">data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">tx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>MM</td>
<td>0.25</td>
<td>0.030698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MM</td>
<td>0.50</td>
<td>0.026191</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MM</td>
<td>0.75</td>
<td>0.023958</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MM</td>
<td>1.00</td>
<td>0.022979</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>FUT</td>
<td>1.25</td>
<td>0.978691</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>FUT</td>
<td>1.50</td>
<td>0.977094</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>FUT</td>
<td>1.75</td>
<td>0.974981</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>FUT</td>
<td>2.00</td>
<td>0.972911</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>FUT</td>
<td>2.25</td>
<td>0.970984</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>FUT</td>
<td>2.50</td>
<td>0.969711</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>FUT</td>
<td>2.75</td>
<td>0.968436</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>SWAP</td>
<td>3.00</td>
<td>0.026112</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>SWAP</td>
<td>4.00</td>
<td>0.028117</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>SWAP</td>
<td>5.00</td>
<td>0.029680</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SWAP</td>
<td>6.00</td>
<td>0.031107</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>SWAP</td>
<td>7.00</td>
<td>0.032313</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>SWAP</td>
<td>8.00</td>
<td>0.033382</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>SWAP</td>
<td>9.00</td>
<td>0.034385</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>SWAP</td>
<td>10.00</td>
<td>0.035312</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>SWAP</td>
<td>11.00</td>
<td>0.036197</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>SWAP</td>
<td>12.00</td>
<td>0.037003</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>SWAP</td>
<td>13.00</td>
<td>0.037668</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>SWAP</td>
<td>14.00</td>
<td>0.038201</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>SWAP</td>
<td>15.00</td>
<td>0.038624</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>SWAP</td>
<td>20.00</td>
<td>0.039380</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>SWAP</td>
<td>25.00</td>
<td>0.038501</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>SWAP</td>
<td>30.00</td>
<td>0.037668</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>En l‚Äôabsence d‚Äôoppotunit√© d‚Äôarbitrage, les valorisations des instruments de march√© s‚Äôexpriment en fonction des taux z√©ro coupon implicites suivantes :</p>
<ul>
<li><p>Sur le segment <strong>Money Market</strong>, on cote en taux mon√©taires :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%20%20L_t(T,T+%5Cdelta)%20=%20%5Cfrac%7B1%7D%7B%5Cdelta%7D%20%5Cleft(%20%5Cfrac%7BB(t,T)%7D%7BB(t,T+%5Cdelta)%7D%20-%201%20%5Cright),%0A%20%20"></p>
<p>avec t le temps courant, T la maturit√© et <img src="https://latex.codecogs.com/png.latex?%5Cdelta"> la p√©riode de capitalisation. Dans notre cas, t=T=0 et <img src="https://latex.codecogs.com/png.latex?%5Cdelta"> varie en fonction de la maturit√©.</p></li>
<li><p>Sur le segment <strong>Future</strong>, on c√¥te en 1 - tx forward :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%20%20future(T,%20T+%5Cdelta)%20=%201%20-%20L_t(T,T+%5Cdelta).%0A%20%20"> Dans notre cas, t=0, T= maturit√© - 3m et <img src="https://latex.codecogs.com/png.latex?%5Cdelta%20=%203m">.</p></li>
<li><p>Sur le segment <strong>Swap</strong>, on c√¥te en taux swap :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%20%20Swap(t,%20T_0,%20T_n)%20=%20B(t,%20T_0)%E2%88%92B(t,%20T_n)%E2%88%92K%20%C3%97lvl(t),%0A%20%20"></p>
<p>avec K le taux fixe du swap qui √©galise la PV du swap vaut 0 et <img src="https://latex.codecogs.com/png.latex?lvl(t)=%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Cdelta_i%20B(t,%20T_i)"> le taux de march√© √† la maturit√© <img src="https://latex.codecogs.com/png.latex?T_n">. Dans notre cas, la date de d√©part est le spot, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?T_0=0"> et <img src="https://latex.codecogs.com/png.latex?T_n"> est la maturit√© du swap, et t=0 (vu d‚Äôaujourd‚Äôhui).</p></li>
</ul>
<p>De ce fait, le donn√©es ne sont pas homog√®nes en taux du fait de la diff√©rente cotations des instruments. Nous allons donc les transformer en taux mon√©taires pour les homog√©n√©iser.</p>
<p><strong>Remarques pr√©liminaires</strong> : - En zone EURO, les swaps standards c√¥t√©s sur le march√© ont une fr√©quence de paiement semestrielle pour la patte variable et annuelle pour la patte fixe. Ainsi pour le calcul du level du swap, <img src="https://latex.codecogs.com/png.latex?%5Cdelta=1"> et on ajoute progressivement les taux de march√©. - Pour simplifier les calculs, nous supposerons que les dates de d√©part des taux mon√©taires et des taux de swap sont spot (i.e.&nbsp;T0 = 0 et non 1 ou 2 jours).</p>
<p><strong>Methode de bootstrapping &amp; stripping</strong> :</p>
<p>Pour extraire les taux z√©ro coupon implicites, nous allons utiliser la m√©thode de bootstrapping. Cette m√©thode consiste √† calculer les taux z√©ro coupon implicites √† partir des taux de march√©. Pour cela, nous allons utiliser les formules des taux mon√©taires pr√©sent√©es ci-dessus, qui sont vu comme des fonctions de taux z√©ro coupon implicites.</p>
<p>Comme les taux de swap ne sont pas n√©cessairement disponibles pour toutes les maturit√©s annuelles, il faut interpoler les taux interm√©diaires. Cela permettra de simplifier la m√©thode de bootstrapping. Nous allons utiliser une interpolation par spline cubic afin d‚Äôavoir des taux swap par an. Une interpolation par spline permet d‚Äôavoir des bonnes propri√©t√©s en terme de d√©rivabilit√© et de continuit√© de la courbe de taux.</p>
<p>Il s‚Äôagira donc de construire une nouvelle courbe de taux de march√© discr√®te avec des cotations annuelles de taux swap √† l‚Äôaide d‚Äôune m√©thode d‚Äôinterpolation par spline, en plus des autres instruments. Par la suite, on supposera que cette nouvelle courbe est la courbe de march√© de r√©f√©rence, i.e.&nbsp;la courbe utilis√©e pour impliciter les taux z√©ro coupon.</p>
<p>Enfin, nous allons faire du stripping afin de reconstituer une courbe de taux zero coupon implicite plus lisse √† l‚Äôaide de diff√©rentes m√©thodes d‚Äôinterpolations (lin√©aire, spline, etc).</p>
</section>
<section id="i.2.-construction-de-la-courbe-des-taux-z√©ro-coupon" class="level3">
<h3 class="anchored" data-anchor-id="i.2.-construction-de-la-courbe-des-taux-z√©ro-coupon">I.2. Construction de la courbe des taux z√©ro-coupon</h3>
<div id="5ee4e138" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.interpolate <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> interp1d</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> interpolate_and_update_df(data, col_x, col_y, kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cubic'</span>, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb2-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Interpole les taux SWAP et met √† jour le DataFrame avec les nouvelles valeurs interpol√©es.</span></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Param√®tres :</span></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - data : DataFrame d'origine contenant une colonne 'type' avec 'SWAP', 'T' et 'tx'.</span></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - kind : Type d'interpolation (par d√©faut 'cubic', peut √™tre 'linear', 'quadratic', etc.).</span></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - start : Valeur minimale de T pour l'interpolation (par d√©faut 3).</span></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - end : Valeur maximale de T pour l'interpolation (par d√©faut 31).</span></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - step : Pas d'incr√©mentation pour la grille interpol√©e (par d√©faut 1).</span></span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retourne :</span></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - new_df : DataFrame mis √† jour avec les taux SWAP interpol√©s.</span></span>
<span id="cb2-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-19"></span>
<span id="cb2-20">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.copy()</span>
<span id="cb2-21">    x, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[col_x].values, data[col_y].values</span>
<span id="cb2-22"></span>
<span id="cb2-23">    f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> interp1d(x, y, kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>kind)</span>
<span id="cb2-24">    xnew <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(start, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>step, step)</span>
<span id="cb2-25">    tx_new <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> f(xnew)</span>
<span id="cb2-26">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({col_x: xnew, col_y: tx_new})</span>
<span id="cb2-27"></span>
<span id="cb2-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb2-29"></span>
<span id="cb2-30">df_interp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> interpolate_and_update_df(data, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>) </span>
<span id="cb2-31">df_interp[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SWAP'</span></span>
<span id="cb2-32">df_interp.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">tx</th>
<th data-quarto-table-cell-role="th">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3</td>
<td>0.026112</td>
<td>SWAP</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>4</td>
<td>0.028117</td>
<td>SWAP</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5</td>
<td>0.029680</td>
<td>SWAP</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>6</td>
<td>0.031107</td>
<td>SWAP</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>7</td>
<td>0.032313</td>
<td>SWAP</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="e98d35fa" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Le rajoiuter dans le df</span></span>
<span id="cb3-2">new_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([data[data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SWAP"</span>], df_interp], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-3">new_df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">T</th>
<th data-quarto-table-cell-role="th">tx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>MM</td>
<td>0.25</td>
<td>0.030698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>MM</td>
<td>0.50</td>
<td>0.026191</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>MM</td>
<td>0.75</td>
<td>0.023958</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>MM</td>
<td>1.00</td>
<td>0.022979</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>FUT</td>
<td>1.25</td>
<td>0.978691</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="4dd5e163" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage d'une courbe homog√®ne de taux de march√© en fonction de la maturit√©</span></span>
<span id="cb4-2">new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx_h'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'FUT'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-3"></span>
<span id="cb4-4">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb4-5">plt.plot(new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>], new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_h"</span>], marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'b'</span>)</span>
<span id="cb4-6">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Maturit√©'</span>)</span>
<span id="cb4-7">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux de march√©'</span>)</span>
<span id="cb4-8">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe des taux de march√©'</span>)</span>
<span id="cb4-9">plt.grid()</span>
<span id="cb4-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="extraction-du-taux-zero-coupon-sur-le-segment-money-market" class="level4">
<h4 class="anchored" data-anchor-id="extraction-du-taux-zero-coupon-sur-le-segment-money-market">Extraction du taux zero coupon sur le segment Money Market</h4>
<p>Les taux z√©ro-coupon continus sont d√©finis par la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ar(t,T)%20=%20-%5Cfrac%7B1%7D%7BT-t%7D%20%5Cln%20B(t,T),%0A"></p>
<p>o√π B(t,T) est le facteur d‚Äôactualisation (<img src="https://latex.codecogs.com/png.latex?B(t,T)%20=%20exp(-r(t,T)%20%5Ctimes%20%20T)"> ), i.e.&nbsp;le prix d‚Äôune obligation z√©ro-coupon de maturit√© T √† la date t.</p>
<p>Ils sont la brique de base pour la valorisation des produits d√©riv√©s et des obligations. De ce fait, nous allons essayer de reconstituer la courbe des taux z√©ro-coupon implicite √† partir de la courbe des taux de march√© √† l‚Äôaide de la m√©thode du bootstrapping. Cette m√©thode consiste √† calculer les taux z√©ro-coupon implicites √† partir des taux de march√© en utilisant la formule suivante selon le segment Money Market :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL_0(0,%5Cdelta)%20=%20%5Cfrac%7B1%7D%7B%5Cdelta%7D%20%5Cleft(%20%5Cfrac%7B1%7D%7BB(0,%5Cdelta)%7D%20-%201%20%5Cright)%0A"></p>
<p>De ce fait, le facteur d‚Äôactualisation est : <img src="https://latex.codecogs.com/png.latex?%0AB(0,%5Cdelta)%20=%20%5Cfrac%7B1%7D%7B1%20+%20%5Cdelta%20L_0(0,%5Cdelta)%7D%0A"></p>
<div id="d2394b02" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des facteurs d'actualisation pour les Money Market</span></span>
<span id="cb5-2">mm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df[new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MM'</span>]</span>
<span id="cb5-3"></span>
<span id="cb5-4">mm.loc[:, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> mm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>])</span>
<span id="cb5-5">mm.loc[:, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.log(mm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> mm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>]</span>
<span id="cb5-6"></span>
<span id="cb5-7">df_ZC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mm</span></code></pre></div>
</div>
</section>
<section id="extraction-du-taux-zero-coupon-sur-le-segment-future" class="level4">
<h4 class="anchored" data-anchor-id="extraction-du-taux-zero-coupon-sur-le-segment-future">Extraction du taux zero coupon sur le segment Future</h4>
<p>Sur le segment Future, on a :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AFuture%20=%201%20-%20L_0(T,T+%5Cdelta)%20=%201%20-%20%5Cfrac%7B1%7D%7B%5Cdelta%7D%20%5Cleft(%20%5Cfrac%7BB(0,T)%7D%7BB(0,T+%5Cdelta)%7D%20-%201%20%5Cright)%0A"></p>
<p>De ce fait, le facteur d‚Äôactualisation est : <img src="https://latex.codecogs.com/png.latex?%0AB(0,T+%5Cdelta)%20=%20%5Cfrac%7BB(0,T)%7D%7B1%20+%20%5Cdelta%20(1-%20Future)%7D%0A"></p>
<div id="de84dd5e" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des facteurs d'actualisation pour les Futures</span></span>
<span id="cb6-2"></span>
<span id="cb6-3">fut <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df[new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'FUT'</span>]</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># concat √† mm</span></span>
<span id="cb6-6">df_ZC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([df_ZC, fut], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb6-7"></span>
<span id="cb6-8">mm_len <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(mm)</span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(mm_len, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(df_ZC)):</span>
<span id="cb6-11">    df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span>
<span id="cb6-12">    df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.log(df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>]</span></code></pre></div>
</div>
</section>
<section id="extraction-du-taux-zero-coupon-sur-le-segment-swap" class="level4">
<h4 class="anchored" data-anchor-id="extraction-du-taux-zero-coupon-sur-le-segment-swap">Extraction du taux zero coupon sur le segment swap</h4>
<p>Pour le segment swap payeur, on a :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ASwap(t,%20T_0,%20T_n)%20=%20B(t,%20T_0)%E2%88%92B(t,%20T_n)%E2%88%92K%20%C3%97lvl(t)%20=%200,%0A"></p>
<p>avec K le taux fixe du swap qui fait que la PV du swap vaut 0 et <img src="https://latex.codecogs.com/png.latex?lvl(t)=%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Cdelta_i%20B(t,%20T_i)"> le taux de march√© √† la maturit√© <img src="https://latex.codecogs.com/png.latex?T_n">. De ce fait, le facteur d‚Äôactualisation est : <img src="https://latex.codecogs.com/png.latex?%0AB(0,T_n)%20=%20%5Cfrac%7B1%20-%20K%20%5Csum_%7Bi=1%7D%5E%7Bn-1%7D%20%5Cdelta_i%20B(0,T_i)%7D%7B1%20+%20K%7D%0A"></p>
<div id="99d72d61" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des facteurs d'actualisation pour les Swaps</span></span>
<span id="cb7-2">swap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df[new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SWAP'</span>]</span>
<span id="cb7-3">fut_len <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(fut)</span>
<span id="cb7-4"></span>
<span id="cb7-5">df_ZC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([df_ZC, swap], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(mm_len<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>fut_len, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(df_ZC)):</span>
<span id="cb7-8">    T_n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©cup√®re la valeur de T actuelle</span></span>
<span id="cb7-9">    mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> T_n) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S√©lectionne uniquement les T entiers &lt; T_n</span></span>
<span id="cb7-10">    df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(df_ZC.loc[mask, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].fillna(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>])</span>
<span id="cb7-11">    df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.log(df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> T_n</span></code></pre></div>
</div>
<div id="52810de8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb8-2">plt.plot(df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>], df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe de taux z√©ro coupon'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb8-3">plt.plot(new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>], new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_h"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux de march√©'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb8-4">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>)</span>
<span id="cb8-5">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>)</span>
<span id="cb8-6">plt.legend()</span>
<span id="cb8-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe de taux z√©ro coupon discr√©tis√©e'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Text(0.5, 1.0, 'Courbe de taux z√©ro coupon discr√©tis√©e')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-9-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Comme on peut le constater, le mode d‚Äôinterpolation a un impact significatif sur le calcul des taux de march√© car il affecte la forme de la courbe des taux et donc la valorisation des instruments financiers.</p>
</section>
</section>
<section id="i.3.-construction-de-la-courbe-des-taux-forward" class="level3">
<h3 class="anchored" data-anchor-id="i.3.-construction-de-la-courbe-des-taux-forward">I.3. Construction de la courbe des taux forward</h3>
<p>A partir de la courbe des taux z√©ro-coupon issue de la m√©thode de bootstrapping, nous souhaitons tracer la courbe des taux forwards de tenor 3M en fonction de la maturit√© √† l‚Äôaide des m√©thodes d‚Äôinterpolation lin√©aire et par spline, avec une discr√©tisation de 0.1 an.</p>
<p>Pour tracer la courbe taux forward, on utilisera la formule suivante pour calculer les taux forward :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL_0(T,T+%5Cdelta)%20=%20%5Cfrac%7B1%7D%7B%5Cdelta%7D%20(%5Cfrac%7BB(0,T)%7D%7BB(0,T+%5Cdelta)%7D%20-%201)%0A"> avec <img src="https://latex.codecogs.com/png.latex?%5Cdelta%20=%200.25">.</p>
<p>Pour le segment swap, il s‚Äôagira d‚Äôinterpoler les taux z√©ro-coupon implicites pour avoir des tx forwards 3M. # changer la discretisatio √† 1an ce qui est diff√©rent du t√©nor.</p>
<div id="8dfb90bb" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">df_ZC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]}), df_ZC], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
</div>
<div id="c03baeff" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">new_df_ZC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> interpolate_and_update_df(df_ZC, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>, kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'linear'</span>, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb11-2"></span>
<span id="cb11-3">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3 mois = 0.25 an</span></span>
<span id="cb11-4"></span>
<span id="cb11-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> compute_forward_rates(R, T_range, tau):</span>
<span id="cb11-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">""" Calcule les taux forward pour chaque maturit√© """</span></span>
<span id="cb11-7">    fwd_rates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-8">    T_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(T_range)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb11-10">        T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T_range[i]</span>
<span id="cb11-11">        T_tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> tau</span>
<span id="cb11-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> T_tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(T_range):</span>
<span id="cb11-13">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># √âviter d'extrapoler au-del√† des donn√©es disponibles</span></span>
<span id="cb11-14">        B_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T)</span>
<span id="cb11-15">        R_T_tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.interp(T_tau, T_range, R) </span>
<span id="cb11-16">        B_T_tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>R_T_tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> T_tau)</span>
<span id="cb11-17"></span>
<span id="cb11-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Formule du taux forward instantan√©</span></span>
<span id="cb11-19">        fwd_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (B_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_T_tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> tau</span>
<span id="cb11-20">        fwd_rates.append(fwd_rate)</span>
<span id="cb11-21">        T_values.append(T)</span>
<span id="cb11-22"></span>
<span id="cb11-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>: T_values, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_fwd"</span>: fwd_rates})</span>
<span id="cb11-24"></span>
<span id="cb11-25">fwd_rates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_forward_rates(new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>], new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>], tau)</span>
<span id="cb11-26"></span>
<span id="cb11-27">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb11-28">plt.plot(fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>],fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_fwd"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb11-29">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>)</span>
<span id="cb11-30">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb11-31">plt.legend()</span>
<span id="cb11-32">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe des taux forward avec interpolation lin√©aire'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>Text(0.5, 1.0, 'Courbe des taux forward avec interpolation lin√©aire')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-11-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1f4ffa0d" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1">new_df_ZC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> interpolate_and_update_df(df_ZC, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>, kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cubic'</span>, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb13-2"></span>
<span id="cb13-3">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3 mois = 0.25 an</span></span>
<span id="cb13-4">fwd_rates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_forward_rates(new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>], new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>], tau)</span>
<span id="cb13-5"></span>
<span id="cb13-6">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb13-7">plt.plot(fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>],fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_fwd"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb13-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>)</span>
<span id="cb13-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb13-10">plt.legend()</span>
<span id="cb13-11">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe des taux forward avec interpolation par spline'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>Text(0.5, 1.0, 'Courbe des taux forward avec interpolation par spline')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-12-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Lorsqu‚Äôon utilise une interpolation lin√©aire, on obtient une courbe plus discontinue. La courbe a une structure en marches d‚Äôescalier. Il y a des sauts brusques lorsque l‚Äôon passe d‚Äôun intervalle √† un autre. En effet, par nature, l‚Äôinterpolation lin√©aire qui ne prend pas en compte les points interm√©diaires. En interpolant avec une fonction spline, on obtient une courbe plus lisse et continue.Elle est plus coh√©rente avec l‚Äô√©volution naturelle des taux d‚Äôint√©r√™t. En effet, la fonction spline est une fonction polynomiale qui passe par tous les points de la courbe. Elle est plus flexible et permet de mieux capturer les variations des taux d‚Äôint√©r√™t.</p>
<p>Nous sommes int√©ress√©s √† ce qui pourrait se passer lorsque nous shiftons le taux de swap 5Y de 10 points de base. Cela permet de d√©terminer la sensibilit√© de la courbe des taux forward aux variations des taux de swap et donc donner des indications sur comment hedger ce risque.</p>
<p>Nous allons donc calculer le taux forward 3M pour les deux courbes de taux forward et comparer les r√©sultats.</p>
<div id="697cbf23" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">choc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb15-2">new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_s"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx_h'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>choc <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx_h'</span>], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># plot</span></span>
<span id="cb15-5">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb15-6">plt.plot(new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>], new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_s"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux de march√© shift√©s'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>)</span>
<span id="cb15-7">plt.plot(new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>], new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_h"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux de march√©'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>)</span>
<span id="cb15-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Maturit√©'</span>)</span>
<span id="cb15-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux de march√©'</span>)</span>
<span id="cb15-10">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe des taux de march√©'</span>)</span>
<span id="cb15-11">plt.legend()</span>
<span id="cb15-12">plt.grid()</span>
<span id="cb15-13">plt.show()</span>
<span id="cb15-14"></span>
<span id="cb15-15">new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_s"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>choc <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> x[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tx'</span>], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3b1d5be1" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des facteurs d'actualisation pour les Money Market</span></span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb16-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb16-4"></span>
<span id="cb16-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> compute_discount_factors(new_df, col_T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>, col_tx<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx"</span>):</span>
<span id="cb16-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcule les facteurs d'actualisation (B) et les taux z√©ro-coupon (R) </span></span>
<span id="cb16-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    √† partir des taux du march√© pour les instruments MM, FUT et SWAP.</span></span>
<span id="cb16-9"></span>
<span id="cb16-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Param√®tres :</span></span>
<span id="cb16-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - new_df : DataFrame contenant les taux du march√© avec les colonnes sp√©cifi√©es.</span></span>
<span id="cb16-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - col_T : Nom de la colonne contenant les maturit√©s (ex: "T").</span></span>
<span id="cb16-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - col_tx : Nom de la colonne contenant les taux du march√© (ex: "tx").</span></span>
<span id="cb16-14"></span>
<span id="cb16-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retourne :</span></span>
<span id="cb16-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - df_ZC : DataFrame contenant les facteurs d'actualisation et les taux z√©ro-coupon.</span></span>
<span id="cb16-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb16-18"></span>
<span id="cb16-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --- Extraction des donn√©es du march√© mon√©taire (MM) ---</span></span>
<span id="cb16-20">    mm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df[new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'MM'</span>].copy()</span>
<span id="cb16-21">    mm.loc[:, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mm[col_tx] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> mm[col_T])</span>
<span id="cb16-22">    mm.loc[:, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.log(mm[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> mm[col_T]</span>
<span id="cb16-23"></span>
<span id="cb16-24">    df_ZC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mm.copy()</span>
<span id="cb16-25"></span>
<span id="cb16-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --- Extraction des donn√©es Futures (FUT) ---</span></span>
<span id="cb16-27">    fut <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df[new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'FUT'</span>].copy()</span>
<span id="cb16-28">    df_ZC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([df_ZC, fut], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb16-29"></span>
<span id="cb16-30">    mm_len <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(mm)</span>
<span id="cb16-31"></span>
<span id="cb16-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --- Calcul des facteurs d'actualisation pour les Futures ---</span></span>
<span id="cb16-33">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(mm_len, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(df_ZC)):</span>
<span id="cb16-34">        df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df_ZC.loc[i, col_tx]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>)</span>
<span id="cb16-35">        df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.log(df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df_ZC.loc[i, col_T]</span>
<span id="cb16-36"></span>
<span id="cb16-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --- Extraction des donn√©es Swaps (SWAP) ---</span></span>
<span id="cb16-38">    swap <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> new_df[new_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'type'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'SWAP'</span>].copy()</span>
<span id="cb16-39">    fut_len <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(fut)</span>
<span id="cb16-40">    df_ZC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([df_ZC, swap], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb16-41"></span>
<span id="cb16-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --- Calcul des facteurs d'actualisation pour les Swaps ---</span></span>
<span id="cb16-43">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(mm_len <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> fut_len, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(df_ZC)):</span>
<span id="cb16-44">        T_n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[i, col_T]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Maturit√© actuelle</span></span>
<span id="cb16-45">        mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df_ZC[col_T] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> T_n) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (df_ZC[col_T] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S√©lection des T entiers &lt; T_n</span></span>
<span id="cb16-46"></span>
<span id="cb16-47">        sum_B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(df_ZC.loc[mask, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].fillna(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb16-48">        df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df_ZC.loc[i, col_tx] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sum_B) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> df_ZC.loc[i, col_tx])</span>
<span id="cb16-49">        df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.log(df_ZC.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> T_n</span>
<span id="cb16-50"></span>
<span id="cb16-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df_ZC</span>
<span id="cb16-52"></span>
<span id="cb16-53"></span>
<span id="cb16-54">df_ZC_s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_discount_factors(new_df, col_T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>, col_tx<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_s"</span>)</span>
<span id="cb16-55">df_ZC_s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pd.concat([pd.DataFrame({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>: [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]}), df_ZC_s], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb16-56"></span>
<span id="cb16-57">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb16-58">plt.plot(df_ZC_s.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>], df_ZC_s.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe de taux z√©ro coupon shift√©'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb16-59">plt.plot(df_ZC.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>], df_ZC.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe de taux z√©ro coupon non shift√©'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb16-60">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>)</span>
<span id="cb16-61">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>)</span>
<span id="cb16-62">plt.legend()</span>
<span id="cb16-63">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe de taux z√©ro coupon discr√©tis√©e'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Text(0.5, 1.0, 'Courbe de taux z√©ro coupon discr√©tis√©e')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="be28652f" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">new_df_ZC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> interpolate_and_update_df(df_ZC_s, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>, kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'linear'</span>, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb18-2"></span>
<span id="cb18-3">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3 mois = 0.25 an</span></span>
<span id="cb18-4">fwd_rates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_forward_rates(new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>], new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>], tau)</span>
<span id="cb18-5"></span>
<span id="cb18-6">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb18-7">plt.plot(fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>],fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_fwd"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb18-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>)</span>
<span id="cb18-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb18-10">plt.legend()</span>
<span id="cb18-11">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe des taux forward avec interpolation par spline'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Text(0.5, 1.0, 'Courbe des taux forward avec interpolation par spline')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-15-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="3760de2a" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">new_df_ZC<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> interpolate_and_update_df(df_ZC_s, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>, kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'cubic'</span>, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, step<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb20-2"></span>
<span id="cb20-3">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3 mois = 0.25 an</span></span>
<span id="cb20-4">fwd_rates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_forward_rates(new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R'</span>], new_df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>], tau)</span>
<span id="cb20-5"></span>
<span id="cb20-6">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb20-7">plt.plot(fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"T"</span>],fwd_rates[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tx_fwd"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb20-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>)</span>
<span id="cb20-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Taux forward'</span>)</span>
<span id="cb20-10">plt.legend()</span>
<span id="cb20-11">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Courbe des taux forward avec interpolation par spline'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>Text(0.5, 1.0, 'Courbe des taux forward avec interpolation par spline')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>En shiftant le taux de swap 5Y, la courbe de forward baisse brusquement pour T=5Y. Il y a une d√©formation locale de la courbe des taux forward. Cela signifie que la courbe des taux forward est sensible aux variations des taux de swap. En effet, les taux swap sont des instruments financiers qui permettent de se couvrir contre les variations des taux d‚Äôint√©r√™t.</p>
</section>
</section>
<section id="ii.-valorisation-de-swaptions-et-de-caplets" class="level2">
<h2 class="anchored" data-anchor-id="ii.-valorisation-de-swaptions-et-de-caplets">II. Valorisation de swaptions et de caplets</h2>
<ol type="1">
<li><p>Pour coter les caplets/floorlets et swaptions, le mod√®le de Black est souvent utilis√©. Ce mod√®le est bas√© sur l‚Äôhypoth√®se que les taux d‚Äôint√©r√™t sont log-normalement distribu√©s. Il permet de calculer le prix d‚Äôun caplet/floorlet et d‚Äôun swaption en fonction des taux d‚Äôint√©r√™t et de la volatilit√© implicite.</p></li>
<li><p>L‚ÄôEDS (Equation Diff√©rentielle Stochastique) de Black est donn√©e par :</p></li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0AdL(t)%20=%20%5Csigma%20L(t)%20dW(t)%0A"></p>
<p>avec <img src="https://latex.codecogs.com/png.latex?L(t)"> le taux, <img src="https://latex.codecogs.com/png.latex?%5Csigma"> la volatilit√© du taux et <img src="https://latex.codecogs.com/png.latex?W(t)"> un mouvement brownien. En utilisant le changement de num√©raire, ce taux est une martingale sous la mesure du numeraire (probabilit√© risque neutre). Cela permet de calculer le prix d‚Äôun caplet/floorlet ou d‚Äôune swaption.</p>
<p><strong>Caplets et Floorlets</strong></p>
<ol start="3" type="1">
<li>Pour un caplet, le prix est donn√© par la formule suivante :</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0ACaplet(t,T_%7Bi-1%7D,T_i)%20=%20N%20%5Cdelta_i%20B(t,T_i)%20%5Cleft%5B%20L_i(t)%20%5Cphi(d)%20-%20K%20%5Cphi%20(d%20-%20%5Csigma_i%20%5Csqrt%7BT_%7Bi-1%7D-t%7D%20)%5Cright%5D%0A"></p>
<p>avec <img src="https://latex.codecogs.com/png.latex?d%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt%7BT_%7Bi-1%7D-t%7D%7D%20%5Cleft(%20%5Cln%20%5Cleft(%20%5Cfrac%7BL_i(t)%7D%7BK%7D%20%5Cright)%20+%20%5Cfrac%7B%5Csigma%5E2(T_%7Bi-1%7D-t)%7D%7B2%7D%20%5Cright)">, <img src="https://latex.codecogs.com/png.latex?L_i(t)"> le taux forward 3M √† la date t, <img src="https://latex.codecogs.com/png.latex?K"> le strike du caplet, <img src="https://latex.codecogs.com/png.latex?N"> le nominal, <img src="https://latex.codecogs.com/png.latex?%5Cdelta_i"> la p√©riode de capitalisation, <img src="https://latex.codecogs.com/png.latex?B(t,T_i)"> le facteur d‚Äôactualisation √† la maturit√© <img src="https://latex.codecogs.com/png.latex?T_i">, <img src="https://latex.codecogs.com/png.latex?%5Csigma_i"> la volatilit√© du taux forward 3M √† la maturit√© <img src="https://latex.codecogs.com/png.latex?T_i"> et <img src="https://latex.codecogs.com/png.latex?%5Cphi"> la fonction de r√©partition de la loi normale standard.</p>
<p>Pour un floorlet, le prix est donn√© par la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AFloorlet(t,T_%7Bi-1%7D,T_i)%20=%20N%20%5Cdelta_i%20B(t,T_i)%20%5Cleft%5B%20K%20%5Cphi%20(d%20-%20%5Csigma_i%20%5Csqrt(T_%7Bi-1%7D-t)%20)%20-%20L_i(t)%20%5Cphi(d)%20%5Cright%5D%0A"></p>
<p><strong>Swaptions</strong></p>
<p>Pour un swaption donneur, le prix est donn√© par la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BSwaption%7D_t%20=%20%5Cleft(%20%5Csum_%7Bj=1%7D%5E%7Bn%7D%20N%20%5Cdelta%20B(t,%20T_j)%20%5Cright)%20%5Cleft%5B%20F_S(t)%20%5CPhi(d)%20-%20K%20%5CPhi(d%20-%20%5Csigma_S%20%5Csqrt%7BT_0%20-%20t%7D)%20%5Cright%5D%0A"></p>
<p>avec <img src="https://latex.codecogs.com/png.latex?F_S(t)"> le taux swap √† la date t, <img src="https://latex.codecogs.com/png.latex?K"> le strike du swaption, <img src="https://latex.codecogs.com/png.latex?N"> le nominal, <img src="https://latex.codecogs.com/png.latex?%5Cdelta"> la p√©riode de capitalisation, <img src="https://latex.codecogs.com/png.latex?B(t,T_j)"> le facteur d‚Äôactualisation √† la maturit√© <img src="https://latex.codecogs.com/png.latex?T_j">, <img src="https://latex.codecogs.com/png.latex?%5Csigma_S"> la volatilit√© du taux swap et <img src="https://latex.codecogs.com/png.latex?%5CPhi"> la fonction de r√©partition de la loi normale standard.</p>
<p>d est donn√© par la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ad%20=%20%5Cfrac%7B1%7D%7B%5Csigma_S%20%5Csqrt%7BT_0%20-%20t%7D%7D%20%5Cleft(%20%5Cln%20%5Cleft(%20%5Cfrac%7BF_S(t)%7D%7BK%7D%20%5Cright)%20+%20%5Cfrac%7B%5Csigma_S%5E2(T_0%20-%20t)%7D%7B2%7D%20%5Cright)%0A"></p>
<p>Pour un swaption receveur, le prix est donn√© par la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BSwaption%7D_t%20=%20%5Cleft(%20%5Csum_%7Bj=1%7D%5E%7Bn%7D%20N%20%5Cdelta%20B(t,%20T_j)%20%5Cright)%20%5Cleft%5B%20K%20%5CPhi(d%20-%20%5Csigma_S%20%5Csqrt%7BT_0%20-%20t%7D)%20-%20F_S(t)%20%5CPhi(d)%20%5Cright%5D%0A"></p>
<p>Il s‚Äôagit, √† partir des cotations d√©crites dans le tableau ci-dessous et de la courbe des taux z√©ro-coupon construite pr√©c√©demment, calculer les prix de march√© de caplets sur euribor12M, ce qui implique une p√©riode de capitalisation annuelle, de maturit√© T = 5Y, i.e.&nbsp;pay√© √† 6Y, et de strikes K associ√©s au tableau. Nous souhaitons ainsi calculer : - Le prix des caplets Caplet(t, 5Y, 6Y) pour les strikes du tableau ci-dessous. - Le prix des swaptions Swaption(t, 5Y, 6Y) pour les strikes du tableau ci-dessous.</p>
<div id="6f63b268" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">vol_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_excel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data/Data_tx.xlsx'</span>, sheet_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'vol'</span>)</span>
<span id="cb22-2">vol_data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Strike en bps et en rel. / fwd</th>
<th data-quarto-table-cell-role="th">Vols Caplets</th>
<th data-quarto-table-cell-role="th">Vols Swaptions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-100</td>
<td>0.311859</td>
<td>0.311859</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-50</td>
<td>0.283274</td>
<td>0.283274</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-25</td>
<td>0.265921</td>
<td>0.265921</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0.250000</td>
<td>0.250000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>25</td>
<td>0.243451</td>
<td>0.243451</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>50</td>
<td>0.249019</td>
<td>0.249019</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>100</td>
<td>0.271828</td>
<td>0.271828</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="3d96f7f3" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb23-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb23-3"></span>
<span id="cb23-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> price_oplet(N, delta_i, B_t_Ti, L_i_t, K, sigma_i, Ti, t, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>):</span>
<span id="cb23-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb23-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcule la valeur d'un caplet selon le mod√®le de Black.</span></span>
<span id="cb23-7"></span>
<span id="cb23-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Param√®tres :</span></span>
<span id="cb23-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - N : Notional</span></span>
<span id="cb23-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - delta_i : P√©riode du caplet </span></span>
<span id="cb23-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - B_t_Ti : Facteur d'actualisation B(t, Ti)</span></span>
<span id="cb23-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - L_i_t : Taux forward Li(t)</span></span>
<span id="cb23-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - K : Strike du caplet</span></span>
<span id="cb23-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - sigma_i : Volatilit√© implicite</span></span>
<span id="cb23-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Ti_1 : Date de d√©but de la p√©riode</span></span>
<span id="cb23-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Ti : Date de fin de la p√©riode</span></span>
<span id="cb23-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - t : Temps actuel</span></span>
<span id="cb23-18"></span>
<span id="cb23-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retourne :</span></span>
<span id="cb23-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Valeur du caplet</span></span>
<span id="cb23-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb23-22">    Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> delta_i</span>
<span id="cb23-23">    d1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.log(L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t))</span>
<span id="cb23-24">    d2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> d1</span>
<span id="cb23-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> option_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>:</span>
<span id="cb23-26">        price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B_t_Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(d1) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d2))</span>
<span id="cb23-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> option_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'floorlet'</span>:</span>
<span id="cb23-28">        price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> B_t_Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(d2) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>d1))</span>
<span id="cb23-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> price</span>
<span id="cb23-30"></span>
<span id="cb23-31"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> vol_data.index:</span>
<span id="cb23-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Notional</span></span>
<span id="cb23-33">    N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>  </span>
<span id="cb23-34"></span>
<span id="cb23-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># P√©riode du caplet</span></span>
<span id="cb23-36">    delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span>
<span id="cb23-37"></span>
<span id="cb23-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Maturit√© du caplet</span></span>
<span id="cb23-39">    T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> </span>
<span id="cb23-40"></span>
<span id="cb23-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Facteur d'actualisation B(t, Ti)</span></span>
<span id="cb23-42">    B_t_Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb23-43"></span>
<span id="cb23-44">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Taux forward Li(t)</span></span>
<span id="cb23-45">    L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>delta_i) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> T, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb23-46"></span>
<span id="cb23-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike du caplet</span></span>
<span id="cb23-48">    K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Strike en bps et en rel. / fwd'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb23-49"></span>
<span id="cb23-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Volatilit√© implicite</span></span>
<span id="cb23-51">    sigma_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vols Caplets"</span>]  </span>
<span id="cb23-52"></span>
<span id="cb23-53">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Date de d√©but de la p√©riode</span></span>
<span id="cb23-54">    Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> delta_i</span>
<span id="cb23-55"></span>
<span id="cb23-56">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Temps actuel</span></span>
<span id="cb23-57">    t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb23-58"></span>
<span id="cb23-59">    caplet_price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> price_oplet(N, delta_i, B_t_Ti, L_i_t, K, sigma_i, Ti, t, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>)</span>
<span id="cb23-60">    vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Caplet Price MKT'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> caplet_price</span>
<span id="cb23-61"></span>
<span id="cb23-62">vol_data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Strike en bps et en rel. / fwd</th>
<th data-quarto-table-cell-role="th">Vols Caplets</th>
<th data-quarto-table-cell-role="th">Vols Swaptions</th>
<th data-quarto-table-cell-role="th">Caplet Price MKT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-100</td>
<td>0.311859</td>
<td>0.311859</td>
<td>0.012511</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-50</td>
<td>0.283274</td>
<td>0.283274</td>
<td>0.009788</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-25</td>
<td>0.265921</td>
<td>0.265921</td>
<td>0.008419</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0.250000</td>
<td>0.250000</td>
<td>0.007137</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>25</td>
<td>0.243451</td>
<td>0.243451</td>
<td>0.006185</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>50</td>
<td>0.249019</td>
<td>0.249019</td>
<td>0.005661</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>100</td>
<td>0.271828</td>
<td>0.271828</td>
<td>0.005167</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="ccc3e980" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># pricer les swaptions</span></span></code></pre></div>
</div>
</section>
<section id="iii.-mod√®le-de-hull-white" class="level2">
<h2 class="anchored" data-anchor-id="iii.-mod√®le-de-hull-white">III. Mod√®le de Hull-White</h2>
<section id="iii.1-du-mod√®le-hjm-vers-le-mod√®le-hullwhite" class="level4">
<h4 class="anchored" data-anchor-id="iii.1-du-mod√®le-hjm-vers-le-mod√®le-hullwhite">III.1 Du mod√®le HJM vers le mod√®le Hull&amp;White</h4>
<p>Pour une maturit√© <img src="https://latex.codecogs.com/png.latex?T"> fix√©e, Heath, Jarrow et Morton ont suppos√© que le taux forward instantan√© √©volue selon la dynamique suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Adf(t,%20T)%20=%20%5Calpha(t,%20T)%5C,%20dt%20+%20%5Csigma(t,%20T)%5C,%20dW_t%20%5Cquad%20(1)%0A"></p>
<p>La dynamique (1) ne se place pas forc√©ment dans un cadre sans opportunit√© d‚Äôarbitrage. Les auteurs ont montr√© que le processus <img src="https://latex.codecogs.com/png.latex?%5Calpha"> ne pouvait pas √™tre choisi arbitrairement et que, pour qu‚Äôil existe une unique mesure martingale √©quivalente, <img src="https://latex.codecogs.com/png.latex?%5Calpha"> devait √™tre li√© √† la volatilit√© du z√©ro coupon.</p>
<p>Supposons donc l‚Äôexistence d‚Äôune unique mesure martingale √©quivalente <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BQ%7D"> (mesure risque-neutre) dont le num√©raire est l‚Äôactif sans risque.</p>
<p>On suppose que le prix du z√©ro coupon (payant une unit√© de devise en date <img src="https://latex.codecogs.com/png.latex?T">) √©volue sous <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BQ%7D"> selon l‚ÄôEDS :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7BdB(t,%20T)%7D%7BB(t,%20T)%7D%20=%20r_t%5C,%20dt%20+%20%5CGamma(t,%20T)%5C,%20dW_t%5EQ%20%5Cquad%20(2)%0A"></p>
<p>Par d√©finition, on sait que $ B(t, T) = e^{-_t^T f(t,s), ds}$ et que $ f(t, T) = -_T (B(t, T)). $</p>
<p>En appliquant le lemme d‚ÄôIt√¥, on obtient : $ df(t, T) = (t, T), _T (t, T), dt - _T (t, T), dW_t^Q. $</p>
<p>En posant $ -_T (t, T) = (t, T), $ nous obtenons :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Adf(t,%20T)%20=%20%5Cgamma(t,%20T)%20%5Cint_t%5ET%20%5Cgamma(t,%20u)%5C,%20du%20%5C,%20dt%20+%20%5Cgamma(t,%20T)%5C,%20dW_t%5EQ%20%5Cquad%20(3)%0A"></p>
<p>Apr√®s int√©gration, on retrouve finalement :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(t,%20T)%20=%20f(0,%20T)%20+%20%5Cint_0%5Et%20%5Cgamma(s,%20T)%20%5Cleft(%20%5Cint_s%5ET%20%5Cgamma(s,%20u)%5C,%20du%20%5Cright)%20ds%20+%20%5Cint_0%5Et%20%5Cgamma(s,%20T)%5C,%20dW_s%5EQ%20%5Cquad%20(4)%0A"></p>
</section>
<section id="iii.2-hypoth√®ses-du-mod√®le-hullwhite" class="level4">
<h4 class="anchored" data-anchor-id="iii.2-hypoth√®ses-du-mod√®le-hullwhite">III.2 Hypoth√®ses du mod√®le Hull&amp;White</h4>
<p>On suppose que le mod√®le HJM est gaussien, lin√©aire et calibrable. Ces hypoth√®ses permettent d‚Äô√©crire :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cgamma(t,%20T)%20=%20%5Csigma(t)%5C,%20e%5E%7B-%5Clambda%20(T-t)%7D%20%20%5Cquad%20%5Ctext%7B%20et%7D%20%5Cquad%20%5CGamma(t,%20T)%20=%20%5Cfrac%7B%5Csigma(t)%7D%7B%5Clambda%7D%5CBigl(e%5E%7B-%5Clambda%20(T-t)%7D%20-%201%5CBigr)%0A"></p>
<p>o√π la fonction de volatilit√© instantan√©e <img src="https://latex.codecogs.com/png.latex?%5Csigma(t)"> est constante par morceaux.</p>
</section>
<section id="iii.3-construction-de-la-formule-z√©ro-coupon" class="level4">
<h4 class="anchored" data-anchor-id="iii.3-construction-de-la-formule-z√©ro-coupon">III.3 Construction de la formule z√©ro-coupon</h4>
<p>Dans le cadre du mod√®le Hull&amp;White, la dynamique du taux court instantan√© <img src="https://latex.codecogs.com/png.latex?r_t"> s‚Äô√©crit :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Adr_t%20=%20%5Cleft%5B%5Clambda%5Cbigl(f(0,t)%20-%20r_t%5Cbigr)%20+%20%5Cpartial_t%20f(0,t)%20+%20%5Cint_0%5Et%20%5Csigma%5E2(s)%5C,%20e%5E%7B-2%5Clambda%20(t-s)%7D%20ds%20%5Cright%5D%20dt%20+%20%5Csigma(t)%5C,%20dW_t%5EQ%20%5Cquad%20(5)%0A"></p>
<p>On introduit alors une nouvelle variable d‚Äô√©tat : $ X_t = r_t - f(0,t)$</p>
<p>La dynamique de <img src="https://latex.codecogs.com/png.latex?X_t"> devient :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AdX_t%20=%20%5Cleft%5B%5Cvarphi(t)%20-%20%5Clambda%20X_t%5Cright%5D%20dt%20+%20%5Csigma(t)%5C,%20dW_t%5EQ%20%5Cquad%20(8)%0A"></p>
<p>avec $ (t) = _0^t ^2(s), e^{-2(t-s)} ds. $</p>
<p>La formule du prix du z√©ro coupon s‚Äôexprime alors comme une fonction d√©terministe de <img src="https://latex.codecogs.com/png.latex?X_t"> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AB(t,%20T)%20=%20%5Cfrac%7BB(0,T)%7D%7BB(0,t)%7D%20%5Cexp%5C!%5CBiggl%5C%7B%20-%5Cfrac%7B1%7D%7B2%5Cbeta%5E2(t,T)%7D%20%5Cvarphi(t)%20-%20%5Cbeta(t,T)%20X_t%20%5CBiggr%5C%7D%20%5Cquad%20(9)%0A"></p>
<p>o√π $ (t, T) = . $</p>
<ol type="1">
<li>A quelle cat√©gorie de mod√®le appartient le mod√®le Hull&amp;White? Justifier.</li>
</ol>
<p>Le mod√®le Hull &amp; White est un mod√®le √† structure √† terme aÔ¨Éne, i.e.&nbsp;un mod√®le de taux d‚Äôint√©r√™t pour lequel le taux z√©ro-coupon continu R(t, T ) est une fonction aÔ¨Éne du taux court r (t).</p>
<p>Il ressemble √† un processus d‚ÄôOrnstein-Uhlenbeck ou mean reversing process, qui est un processus gaussien d√©finit de la mani√®re suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AdY_t%20=%20-%20%5Ctheta%20%5Cleft%5BY_t%20-%20%5Cmu%20%5Cright%5D%20dt%20+%20%5Csigma%20dW_t,%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Ctheta,%20%5Cmu,%20%5Csigma"> sont des param√®tres d√©terministes et <img src="https://latex.codecogs.com/png.latex?W_t"> est le processus de Wiener.</p>
<p>Dans notre cas, on a <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20%5Clambda">, <img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%20%5Cfrac%7B%5Cphi(t)%7D%7B%5Clambda%7D"> et <img src="https://latex.codecogs.com/png.latex?%5Csigma%20=%20%5Csigma(t)">. De ce fait, la moyenne et la variance d√©pend du temps et le param√®tre de vitesse de retour √† la moyenne est constant.</p>
<ol start="2" type="1">
<li>D√©terminer la loi du processus <img src="https://latex.codecogs.com/png.latex?X_t%7CX_s">?</li>
</ol>
<p>Sous la probabilit√© risque neute <img src="https://latex.codecogs.com/png.latex?%5Cmathbb%7BQ%7D">, le processus <img src="https://latex.codecogs.com/png.latex?X_t"> s‚Äôecrit :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AdX_t%20=%20%5Cleft(%5Cphi(t)-%20%5Clambda%20X_t%20%5Cright)%20dt%20+%20%5Csigma(t)%20dW_t%5EQ,%0A"></p>
<p>avec <img src="https://latex.codecogs.com/png.latex?%5Cphi(t)%20=%20%5Cint_0%5Et%20%5Csigma%5E2(s)%20e%5E%7B-2%5Clambda(t-s)%7D%20ds">.</p>
<p>Posons <img src="https://latex.codecogs.com/png.latex?K_t%20=%20e%5E%7B%5Clambda%20t%7D%20X_t%20%20=%20f(X_t,%20t)%5Cimplies%20X_t%20=%20e%5E%7B-%5Clambda%20t%7D%20K_t">, par la formule d‚ÄôIt√¥, on a :</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0Adf(X_t,%20t)%20&amp;=%20e%5E%7B%5Clambda%20t%7D%20dX_t%20+%20de%5E%7B%5Clambda%20t%7D%20X_t%20%5C%5C%0A&amp;=%20e%5E%7B%5Clambda%20t%7D%20%5Cleft(%20%5Cphi(t)%20-%20%5Clambda%20X_t%20%5Cright)%20dt%20+%20e%5E%7B%5Clambda%20t%7D%20%5Csigma(t)%20dW_t%5EQ%20+%20e%5E%7B%5Clambda%20t%7D%20X_t%20dt%20%5C%5C%0A&amp;=%20e%5E%7B%5Clambda%20t%7D%5Cphi(t)%20dt%20+%20e%5E%7B%5Clambda%20t%7D%5Csigma(t)dW_t%5EQ%20%5C%5C%0A&amp;%5Cimplies%20f(X_t,%20t)%20=%20K_t%20=%20e%5E%7B-%20%5Clambda%20t%7DK_s%20%20+%20%5Cint_s%5Et%20e%5E%7B-%5Clambda(t-u)%7D%5Cphi(u)%20du%20+%20%5Cint_s%5Et%20e%5E%7B-%5Clambda(t-u)%7D%5Csigma(u)dW_u%5EQ%20%5C%5C%0A&amp;%5CLeftrightarrow%20X_t%20=%20X_s%20e%5E%7B-%5Clambda%20(t-s)%7D%20+%20%5Cint_s%5Et%20e%5E%7B-%5Clambda%20(t-u)%7D%20%5Cphi(u)%20%20du%20+%20%5Cint_s%5Et%20e%5E%7B-%5Clambda%20(t-u)%7D%20%5Csigma(u)%20dW_u%5ET%0A%5Cend%7Baligned%7D">
<p>De ce fait, on en d√©duit que $X_t|X_s ( X_s e^{-(t-s)} + _s^t e^{-(t-u)} (u) du, _s^t e^{-2 (t-u)} (u)^2 d ) $.</p>
</section>
<section id="iii.4-dynamique-des-taux-forwards" class="level4">
<h4 class="anchored" data-anchor-id="iii.4-dynamique-des-taux-forwards">III.4 Dynamique des taux forwards</h4>
<p>On note ensuite <img src="https://latex.codecogs.com/png.latex?L_i(t)"> le taux LIBOR forward √† la date <img src="https://latex.codecogs.com/png.latex?t"> qui fixe en <img src="https://latex.codecogs.com/png.latex?T_i"> et paie en <img src="https://latex.codecogs.com/png.latex?T_%7Bi+1%7D">. Sous l‚Äôhypoth√®se d‚Äôabsence d‚Äôopportunit√© d‚Äôarbitrage, ce taux s‚Äôexprime √† partir de la courbe de taux : √é <img src="https://latex.codecogs.com/png.latex?%0AL_i(t)%20=%20%5Cfrac%7B1%7D%7B%5Cdelta_i%7D%5Cleft(%5Cfrac%7BB(t,%20T_i)%7D%7BB(t,%20T_%7Bi+1%7D)%7D%20-%201%5Cright)%20%20=%20%5Cfrac%7B1%7D%7B%5Cdelta_i%7D%5Cleft(Z_t-%201%5Cright)%20,%0A"></p>
<p>Pour connaitre la dynamique des taux forwards, on applique le lemme d‚ÄôIt√¥ au processus :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AZ_t%20=%20%5Cfrac%7BB(t,%20T_i)%7D%7BB(t,%20T_%7Bi+1%7D)%7D.%0A"></p>
<blockquote class="blockquote">
<p>Rappel du lemme d‚ÄôIt√¥ : Consid√©rons deux actifs <img src="https://latex.codecogs.com/png.latex?X"> et <img src="https://latex.codecogs.com/png.latex?Y"> et posons <img src="https://latex.codecogs.com/png.latex?Z%20=%20%5Cfrac%7BX%7D%7BY%7D"> (la valeur de <img src="https://latex.codecogs.com/png.latex?X"> exprim√©e en num√©raire <img src="https://latex.codecogs.com/png.latex?Y">). Le lemme d‚ÄôIt√¥ nous donne l‚Äô√©volution de <img src="https://latex.codecogs.com/png.latex?Z"> par :</p>
<img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7BdZ%7D%7BZ%7D%20=%20%5Cleft(%5Cfrac%7BdX%7D%7BX%7D%20-%20%5Cfrac%7BdY%7D%7BY%7D%5Cright)%20-%20%5Cleft%5Clangle%20%5Cfrac%7BdX%7D%7BX%7D%20-%20%5Cfrac%7BdY%7D%7BY%7D,%5C,%20%5Cfrac%7BdY%7D%7BY%7D%5Cright%5Crangle.%0A">
</blockquote>
<p>En appliquant le lemme d‚ÄôIt√¥ √† <img src="https://latex.codecogs.com/png.latex?Z_t">, on obtient :</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cfrac%7BdZ_t%7D%7BZ_t%7D%20&amp;=%20%5Cfrac%7BdB(t,%20T_i)%7D%7BB(t,%20T_i)%7D%20-%20%5Cfrac%7BdB(t,%20T_%7Bi+1%7D)%7D%7BB(t,%20T_%7Bi+1%7D)%7D%20%5C%5C%0A&amp;-%20%5Cfrac%7B1%7D%7B%5Ccancel%7BB(t,T_%7Bi+1%7D)%5E2%7D%7D%20%5Ccancel%7BB(t,T_%7Bi+1%7D)%5E2%7D%20%5C,%20%5CGamma(t,T_i,T_%7Bi+1%7D)%5E2%20%5C,%20dt%20%5C%5C%0A&amp;-%20%20%5Cfrac%7B-1%7D%7B%5Ccancel%7BB(t,T_i)B(t,T_%7Bi+1%7D)%7D%7D%20%5Ccancel%7BB(t,T_i)B(t,T_%7Bi+1%7D)%7D%5C,%5CGamma(t,T_i)%5CGamma(t,T_%7Bi+1%7D)%5C,dt%5C%5C%0A&amp;=%20%5CGamma(t,T_i,T_%7Bi+1%7D)%5Cleft(%5CGamma(t,T_%7Bi+1%7D)%20-%20%5CGamma(t,T_i)%5Cright)dt%20+%20%5Cleft(%5CGamma(t,T_i)%20-%20%5CGamma(t,T_%7Bi+1%7D)%5Cright)dW_t%5EQ%5C%5C%0A&amp;%5Cimplies%20%5Cfrac%7BdZ_t%7D%7BZ_t%7D%20=%20%5Cmu(t,T_i,T_%7Bi+1%7D)%5C,dt%20+%20%5Csigma(t,T_i,T_%7Bi+1%7D)%5C,dW_t%5EQ%0A%5Cend%7Baligned%7D">
<p>avec</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Bcases%7D%0A%5Csigma(t,T_i,T_%7Bi+1%7D)%20=%20%5CGamma(t,T_i)%20-%20%5CGamma(t,T_%7Bi+1%7D)%5C%5C%0A%5Cmu(t,T_i,T_%7Bi+1%7D)%20=%20%5CGamma(t,T_i)%5Cleft(%5CGamma(t,T_%7Bi+1%7D)%20-%20%5CGamma(t,T_i)%20%5Cright)%20=%20-%20%5CGamma(t,T_i)%20%5Csigma(t,T_i,T_%7Bi+1%7D)%0A%5Cend%7Bcases%7D">
<p>De ce fait, on a :</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Cfrac%7BdZ_t%7D%7BZ_t%7D%20&amp;=%20-%20%5CGamma(t,T_i)%20%5Csigma(t,T_i,T_%7Bi+1%7D)%5C,dt%20+%20%5Csigma(t,T_i,T_%7Bi+1%7D)%5C,dW_t%5EQ%5C%5C%0A&amp;=%20%5Csigma(t,T_i,T_%7Bi+1%7D)%20%5Cunderbrace%7B%5Cleft(%20-%20%5CGamma(t,T_i)%5C,dt%20+%20dW_t%5EQ%20%5Cright)%7D_%7Bd%5Ctilde%7BW_t%7D%7D%5C%5C%0A&amp;=%20%5Csigma(t,T_i,T_%7Bi+1%7D)%20d%5Ctilde%7BW_t%7D%0A%5Cend%7Baligned%7D">
<p>o√π <img src="https://latex.codecogs.com/png.latex?d%5Ctilde%7BW_t%7D"> est un mouvement brownien selon le th√©or√®me de Girsanov.</p>
<p>La diffusion de <img src="https://latex.codecogs.com/png.latex?Z_t"> est une loi log-normale, sans drift sous la probabilit√© risque forward. De ce fait, il suit le mod√®le de Black pour la valorisation des options.</p>
<p>On peut √©crire ainsi la dynamique du taux forward <img src="https://latex.codecogs.com/png.latex?L_i(t)"> sous la probabilit√© risque forward :</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0AdL_i(t)%20&amp;=%20%5Cfrac%7BZ_t%7D%7B%5Cdelta_i%7D%20%5Csigma(t,T_i,T_%7Bi+1%7D)%20%20d%5Ctilde%7BW_t%7D%20%20%5C%5C%0A&amp;=%20(L_i(t)%20+%20%5Cfrac%7B1%7D%7B%5Cdelta_i%7D)%20%5Csigma(t,T_i,T_%7Bi+1%7D)%20%20d%5Ctilde%7BW_t%7D%0A%5Cend%7Baligned%7D">
</section>
<section id="iii.5-valorisation-des-instruments-de-calibration" class="level4">
<h4 class="anchored" data-anchor-id="iii.5-valorisation-des-instruments-de-calibration">III.5 Valorisation des instruments de calibration</h4>
<ol type="1">
<li><strong>Payoff d‚Äôun caplet vanille :</strong><br>
Le payoff d‚Äôun caplet sur le taux LIBOR <img src="https://latex.codecogs.com/png.latex?L_i(T_i)">, de maturit√© <img src="https://latex.codecogs.com/png.latex?T_i">, avec paiement en <img src="https://latex.codecogs.com/png.latex?T_%7Bi+1%7D"> et de strike <img src="https://latex.codecogs.com/png.latex?K"> est donn√© par :</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPayoff%7D%20=%20%5Cdelta_i%5C,%20%5Cmax%5CBigl(%20L_i(T_i)%20-%20K,%5C;%200%20%5CBigr).%0A"></p>
<ol start="2" type="1">
<li><strong>Formule de valorisation dans le cadre du mod√®le H&amp;W :</strong><br>
Il peut √™tre d√©montr√© que la formule de valorisation de ce caplet s‚Äôexprime de la mani√®re suivante :</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0AC%5CBigl(%20Z_t,%5C,%20%5Ctilde%7BK%7D,%5C,%20T_i,%5C,%20%5Csigma_i%5E*,%5C,%20B(t,%20T_%7Bi+1%7D)%20%5CBigr)%20%5Cquad%20(11)%0A"></p>
<p>avec :</p>
<ul>
<li>$ Z_t = $,</li>
<li>$ (_i^*)^2 = <em>t^{T_i} ( (s, T_i) - (s, T</em>{i+1}) )^2 ds = ^2(T_i, T_{i+1}), (T_i) $,</li>
<li>$ = 1 + _i K $,</li>
<li>$ C() $ d√©signe le prix d‚Äôun Call selon le cadre Black, en fonction du forward, du strike, de la maturit√©, de la volatilit√© et du facteur d‚Äôactualisation.</li>
</ul>
<p>En effet, on peut r√©√©crire le payoff d‚Äôun caplet sous la forme d‚Äôun Call sur <img src="https://latex.codecogs.com/png.latex?Z_t"> qui suit un mod√®le de Black :</p>
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Ctext%7BPayoff%7D%20&amp;=%20%5Cdelta_i%5C,%20%5Cmax%5CBigl(%20L_i(T_i)%20-%20K,%5C;%200%20%5CBigr)%20%5C%5C%0A&amp;=%20%5Cdelta_i%5C,%20%5Cmax%5CBigl(%20%5Cfrac%7BZ_t%7D%7B%5Cdelta_i%7D%20-%201%20-%20K;%200%20%5CBigr)%20%5C%5C%0A&amp;=%20%5Cdelta_i%5C,%20%5Cmax%5CBigl(%20%5Cfrac%7BZ_t%20-%201%20-%20%5Cdelta_i%20K%7D%7B%5Cdelta_i%7D;%200%20%5CBigr)%20%5C%5C%0A&amp;=%20%5Cmax%5CBigl(Z_t%20-%201%20-%20%5Cdelta_i%20K;%200%20%5CBigr)%20%5C%5C%0A%5Ctext%7BPayoff%7D%20&amp;=%20%5Cmax%5CBigl(%20Z_t%20-%20%5Ctilde%7BK%7D,%5C;%200%20%5CBigr)%20%5C%5C%0A%5Cend%7Baligned%7D">
</section>
<section id="iii.6.-calibration-du-mod√®le" class="level3">
<h3 class="anchored" data-anchor-id="iii.6.-calibration-du-mod√®le">III.6. Calibration du mod√®le</h3>
<p>Le mod√®le de Hull White permet d‚Äôavoir une formule ferm√©e pour le prix des caplets. De fait, puisqu‚Äôon a calcul√© les prix de march√© de caplets sur euribor12M, ce qui implique une p√©riode de capitalisation annuelle, de maturit√© T = 5Y, nous pouvons desormais calibrer le param√®tre de volatilit√© <img src="https://latex.codecogs.com/png.latex?%5Csigma_i%5E*"> avec la m√©thode de dichotomie et aussi extraire de mani√®re analytique la volatilit√© instantan√©e <img src="https://latex.codecogs.com/png.latex?%5Csigma(t)"> du mod√®le Hull&amp;White, qu‚Äôon supposera constante, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?%5Csigma(t)%20=%20%5Csigma">.</p>
<p>On pose √©galement, pour la calibration, <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%205%5C%25">.</p>
<p>Pour extraire la volatilit√© spot, nous utiliserons uniquement le prix de marche ATM.</p>
<div id="0ce72a16" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">caplet_price_MKT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vol_data.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Caplet Price MKT'</span>]</span>
<span id="cb25-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le prix de march√© caplet sur euribor 12M de maturit√© T=5Y est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>caplet_price_MKT<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le prix de march√© caplet sur euribor 12M de maturit√© T=5Y est de 0.7137%</code></pre>
</div>
</div>
<div id="e891e3ff" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb27-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb27-3"></span>
<span id="cb27-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> price_oplet_HW(N, delta_i, B_t_Ti, L_i_t, K, Ti, t, sigma_i, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'HW'</span>):</span>
<span id="cb27-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HW"</span> :</span>
<span id="cb27-6">        Z_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb27-7">        K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> K</span>
<span id="cb27-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> price_oplet(N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N, delta_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta_i, B_t_Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>B_t_Ti, L_i_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Z_t, K<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>K, sigma_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>sigma_i, Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Ti, t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>option_type)</span>
<span id="cb27-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb27-10">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> price_oplet(N<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>N, delta_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>delta_i, B_t_Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>B_t_Ti, L_i_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>L_i_t, K<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>K, sigma_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>sigma_i, Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>Ti, t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>t, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>option_type)</span></code></pre></div>
</div>
<div id="619bcf42" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> Dichotomie(N, delta_i, B_t_Ti, L_i_t, K, Ti, t,caplet_price_MKT,option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HW"</span>,tol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>, sigma_low<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, sigma_high<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb28-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb28-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extrait la volatilit√© implicite sigma en utilisant la m√©thode de dichotomie.</span></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb28-5">    fmin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> price_oplet_HW(N, delta_i, B_t_Ti, L_i_t, K, Ti, t, sigma_low, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>option_type, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model)</span>
<span id="cb28-6">    fmax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> price_oplet_HW(N, delta_i, B_t_Ti, L_i_t, K, Ti, t, sigma_high,option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>option_type, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model)</span>
<span id="cb28-7">    price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> caplet_price_MKT</span>
<span id="cb28-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> fmin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>price :</span>
<span id="cb28-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> sigma_low</span>
<span id="cb28-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> fmax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>price :</span>
<span id="cb28-11">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> sigma_high</span>
<span id="cb28-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb28-13">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> sigma_high<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>sigma_low<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span>tol:</span>
<span id="cb28-14">            sigma_mid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (sigma_low <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma_high) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb28-15">            fmin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> price_oplet_HW(N, delta_i, B_t_Ti, L_i_t, K, Ti, t, sigma_low, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>option_type, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model)</span>
<span id="cb28-16">            fmid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> price_oplet_HW(N, delta_i, B_t_Ti, L_i_t, K, Ti, t, sigma_mid,option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>option_type, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model)</span>
<span id="cb28-17">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ((fmin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> price) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (fmid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> price) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) : <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># jette la moiti√© de gauche</span></span>
<span id="cb28-18">                sigma_low <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_mid</span>
<span id="cb28-19">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>: <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># jette la moiti√© de droite</span></span>
<span id="cb28-20">                sigma_high <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_mid</span>
<span id="cb28-21">        sigma_mid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (sigma_low <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma_high) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb28-22">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> sigma_mid</span>
<span id="cb28-23">    </span>
<span id="cb28-24"></span>
<span id="cb28-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Notional</span></span>
<span id="cb28-26">N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>  </span>
<span id="cb28-27"></span>
<span id="cb28-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># P√©riode du caplet</span></span>
<span id="cb28-29">delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span>
<span id="cb28-30"></span>
<span id="cb28-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Maturit√© du caplet</span></span>
<span id="cb28-32">Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb28-33"></span>
<span id="cb28-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Facteur d'actualisation B(t, Ti)</span></span>
<span id="cb28-35">B_t_Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb28-36"></span>
<span id="cb28-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Taux forward Li(t)</span></span>
<span id="cb28-38">L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>delta_i) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb28-39"></span>
<span id="cb28-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike du caplet</span></span>
<span id="cb28-41">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> vol_data.loc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Strike en bps et en rel. / fwd'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb28-42"></span>
<span id="cb28-43">lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb28-44"></span>
<span id="cb28-45">sigma_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Dichotomie(N, delta_i, B_t_Ti, L_i_t, K, Ti, t,caplet_price_MKT, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>,model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HW"</span>)</span>
<span id="cb28-46"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√© implicite (en %) :"</span>, sigma_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Volatilit√© implicite (en %) : 0.9271045541763303</code></pre>
</div>
</div>
<div id="f4846b16" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1">beta_Ti_Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>  ((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta_i))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>lambda_)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb30-2">Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> delta_i</span>
<span id="cb30-3">phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(Ti_1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>t)))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>lambda_)</span>
<span id="cb30-4">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt((sigma_i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Ti_1)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (beta_Ti_Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> phi))</span>
<span id="cb30-5"></span>
<span id="cb30-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√© instantan√©e (en %) :"</span>, sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>) </span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Volatilit√© instantan√©e (en %) : 1.071446257025021</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Cette volatilit√© spot nous permet de valoriiser les caplets pour des strikes diff√©rents de l‚ÄôATM √† l‚Äôaide de la formule de valorisation ferm√©e du mod√®le Hull et White.</li>
</ol>
<div id="d44885fe" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> vol_data.index:</span>
<span id="cb32-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Notional</span></span>
<span id="cb32-3">    N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>  </span>
<span id="cb32-4"></span>
<span id="cb32-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># P√©riode du caplet</span></span>
<span id="cb32-6">    delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> </span>
<span id="cb32-7"></span>
<span id="cb32-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Maturit√© du caplet</span></span>
<span id="cb32-9">    Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb32-10"></span>
<span id="cb32-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Facteur d'actualisation B(t, Ti)</span></span>
<span id="cb32-12">    B_t_Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb32-13"></span>
<span id="cb32-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Taux forward Li(t)</span></span>
<span id="cb32-15">    L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>delta_i) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb32-16"></span>
<span id="cb32-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike du caplet</span></span>
<span id="cb32-18">    K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Strike en bps et en rel. / fwd'</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb32-19"></span>
<span id="cb32-20">    sigma_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_i</span>
<span id="cb32-21"></span>
<span id="cb32-22">    lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb32-23"></span>
<span id="cb32-24">    caplet_price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> price_oplet_HW(N, delta_i, B_t_Ti, L_i_t, K, Ti, t, sigma_i, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'HW'</span>)</span>
<span id="cb32-25">    vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Caplet Price HW'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> caplet_price</span>
<span id="cb32-26"></span>
<span id="cb32-27">vol_data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Strike en bps et en rel. / fwd</th>
<th data-quarto-table-cell-role="th">Vols Caplets</th>
<th data-quarto-table-cell-role="th">Vols Swaptions</th>
<th data-quarto-table-cell-role="th">Caplet Price MKT</th>
<th data-quarto-table-cell-role="th">Caplet Price HW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-100</td>
<td>0.311859</td>
<td>0.311859</td>
<td>0.012511</td>
<td>0.012015</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-50</td>
<td>0.283274</td>
<td>0.283274</td>
<td>0.009788</td>
<td>0.009389</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-25</td>
<td>0.265921</td>
<td>0.265921</td>
<td>0.008419</td>
<td>0.008215</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0.250000</td>
<td>0.250000</td>
<td>0.007137</td>
<td>0.007137</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>25</td>
<td>0.243451</td>
<td>0.243451</td>
<td>0.006185</td>
<td>0.006156</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>50</td>
<td>0.249019</td>
<td>0.249019</td>
<td>0.005661</td>
<td>0.005269</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>100</td>
<td>0.271828</td>
<td>0.271828</td>
<td>0.005167</td>
<td>0.003771</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>L‚Äôune des faiblesses du mod√®le de Hull et White est le fait qu‚Äôil n‚Äôarrive pas √† capter le smile de volatilit√©. En effet, la volatilit√© implicite extraite est un skew. Pour constater ce ph√©nom√®ne, nous inverserons la formule de Black pour les caplets et nous en d√©duirons la volatilit√© implicite pour chaque strike. Nous utiliserons toujours la m√©thode de dichotomie pour trouver la volatilit√© implicite.</p>
<div id="db972575" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> vol_data.index:</span>
<span id="cb33-2">    N <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb33-3">    delta_i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb33-4">    Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb33-5">    B_t_Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb33-6">    L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> delta_i) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb33-7">    K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Strike en bps et en rel. / fwd'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb33-8">    lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb33-9">    caplet_price_MKT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Caplet Price HW'</span>]</span>
<span id="cb33-10"></span>
<span id="cb33-11">    sigma_extracted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>  Dichotomie(N, delta_i, B_t_Ti, L_i_t, K, Ti, t, caplet_price_MKT, option_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'caplet'</span>, model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Black'</span>)</span>
<span id="cb33-12">    vol_data.loc[i, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Sigma_HW'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_extracted</span>
<span id="cb33-13"></span>
<span id="cb33-14">vol_data</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Strike en bps et en rel. / fwd</th>
<th data-quarto-table-cell-role="th">Vols Caplets</th>
<th data-quarto-table-cell-role="th">Vols Swaptions</th>
<th data-quarto-table-cell-role="th">Caplet Price MKT</th>
<th data-quarto-table-cell-role="th">Caplet Price HW</th>
<th data-quarto-table-cell-role="th">Sigma_HW</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-100</td>
<td>0.311859</td>
<td>0.311859</td>
<td>0.012511</td>
<td>0.012015</td>
<td>0.288669</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-50</td>
<td>0.283274</td>
<td>0.283274</td>
<td>0.009788</td>
<td>0.009389</td>
<td>0.267386</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-25</td>
<td>0.265921</td>
<td>0.265921</td>
<td>0.008419</td>
<td>0.008215</td>
<td>0.258287</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0.250000</td>
<td>0.250000</td>
<td>0.007137</td>
<td>0.007137</td>
<td>0.250009</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>25</td>
<td>0.243451</td>
<td>0.243451</td>
<td>0.006185</td>
<td>0.006156</td>
<td>0.242433</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>50</td>
<td>0.249019</td>
<td>0.249019</td>
<td>0.005661</td>
<td>0.005269</td>
<td>0.235466</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>100</td>
<td>0.271828</td>
<td>0.271828</td>
<td>0.005167</td>
<td>0.003771</td>
<td>0.223060</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="8c197db0" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb34-2">plt.plot(vol_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Strike en bps et en rel. / fwd"</span>], vol_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sigma_HW"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√© extraite'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb34-3">plt.plot(vol_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Strike en bps et en rel. / fwd"</span>], vol_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vols Caplets"</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√© de march√©'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb34-4">plt.legend()</span>
<span id="cb34-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Comparaison de la volatilit√© extraite par le mod√®le HW et la volatilit√© de march√©'</span>)</span>
<span id="cb34-6">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Strike en bps et en rel. / fwd '</span>)</span>
<span id="cb34-7">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√©'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Text(0, 0.5, 'Volatilit√©')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-26-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="0ba03b2d" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1">ATM  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> L_i_t</span></code></pre></div>
</div>
</section>
<section id="valorisation-dun-produit-structur√©" class="level3">
<h3 class="anchored" data-anchor-id="valorisation-dun-produit-structur√©">3.7 Valorisation d‚Äôun produit structur√©</h3>
<blockquote class="blockquote">
<p>Remarques pr√©liminaires :</p>
<ul>
<li>Nous garderons dans un premier temps la calibration ATM effectu√©e avec <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%205%5C%25">.</li>
<li>Pour la partie Monte-Carlo, nous admettrons que l‚ÄôEDS pour le processus <img src="https://latex.codecogs.com/png.latex?X_t"> sous la probabilit√© forward neutre <img src="https://latex.codecogs.com/png.latex?Q%5ET"> associ√©e au num√©raire <img src="https://latex.codecogs.com/png.latex?B(t,T)"> s‚Äô√©crit comme :</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%0AdX_t%20=%20%5Cleft%5B%5Cphi(t)%20+%20%5Csigma(t)%5CGamma(t,T)%20-%20%5Clambda%20X_t%5Cright%5D%20dt%20+%20%5Csigma(t)%20dW_t%5ET%20%5Ctag%7B12%7D%0A"></p>
O√π <img src="https://latex.codecogs.com/png.latex?W_t%5ET"> est un brownien sous <img src="https://latex.codecogs.com/png.latex?Q%5ET">.
</blockquote>
<p>Nous souhaitons valoriser un caplet de strike <img src="https://latex.codecogs.com/png.latex?K">, de dates de fixing <img src="https://latex.codecogs.com/png.latex?T_i%20=%205Y"> et de paiement <img src="https://latex.codecogs.com/png.latex?T_%7Bi+1%7D%20=%206Y"> et de barri√®re d√©sactivante <img src="https://latex.codecogs.com/png.latex?B"> (avec <img src="https://latex.codecogs.com/png.latex?B%20%3E%20K">).</p>
<ol type="1">
<li>√âcrire le payoff de l‚Äôoption et tracer la fonction de payoff en fonction de <img src="https://latex.codecogs.com/png.latex?L_i(T_i)">. Cette option est-elle plus ou moins ch√®re qu‚Äôun simple caplet de strike <img src="https://latex.codecogs.com/png.latex?K"> ?</li>
</ol>
<p>Le payoff de l‚Äôoption est donn√© par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPayoff%7D%20=%20%5Cdelta_i%5C,%20%5Cmax%5CBigl(%20L_i(T_i)%20-%20K,%5C;%200%20%5CBigr)%20%5Cmathbb%7B1%7D_%7BL_i(T_i)%20%3C%20B%7D%0A"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/attachment:image-2.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>image-2.png</figcaption>
</figure>
</div>
<p>Il est possible de d√©composer le payoff √† partir d‚Äôoptions vanilles et digitales :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPayoff%7D%20=%20C_K%20-%20CB%20-%20(B-K)%20%5Ctimes%20D_B%0A"></p>
<blockquote class="blockquote">
<p>Une option digitale est une option qui paie 1 si le sous-jacent est au-dessus d‚Äôun certain seuil et 0 sinon. De ce fait, le payoff de l‚Äôoption est donn√© par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AD_B%20=%20%5Cdelta_i%5C,%20%5Cmax%5CBigl(%20L_i(T_i)%20-%20K,%5C;%200%20%5CBigr)%20%5Cmathbb%7B1%7D_%7BL_i(T_i)%20%3E%20K%7D%0A"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/attachment:image.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
<p>Une option vanille est un contrat financier standardis√© qui donne le droit, mais non l‚Äôobligation, d‚Äôacheter (call) ou de vendre (put) un actif sous-jacent √† un prix fix√© (strike) √† une date donn√©e (maturit√©). De ce fait, dans le cas d‚Äôun call, le payoff de l‚Äôoption est donn√© par :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC_K%20=%20%5Cdelta_i%5C,%20%5Cmax%5CBigl(%20L_i(T_i)%20-%20K,%5C;%200%20%5CBigr)%0A"></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/attachment:Capture%20d‚ÄôeÃÅcran%202025-03-05%20aÃÄ%2000.17.09.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Capture d‚ÄôeÃÅcran 2025-03-05 aÃÄ 00.17.09.png</figcaption>
</figure>
</div>
</blockquote>
<ol start="3" type="1">
<li>Rappeler les principes du pricing par m√©thode de Monte-Carlo.</li>
</ol>
<p>La m√©thode de Monte-Carlo est une m√©thode num√©rique qui permet de pricer des produits financiers complexes lorsque les formules ferm√©es ne sont pas disponibles. Elle consiste √† simuler un grand nombre <img src="https://latex.codecogs.com/png.latex?N"> de trajectoires du processus stochastique et √† calculer la moyenne empiriques des payoffs actualis√©s pour obtenir le prix de l‚Äôoption.</p>
<ol start="4" type="1">
<li>Rappeler comment on simule une loi gaussienne √† partir d‚Äôune loi uniforme.</li>
</ol>
<p>Pour simuler une variable al√©atoire suivant une loi gaussienne standard <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BN%7D(0,1)"> √† partir d‚Äôune variable uniforme <img src="https://latex.codecogs.com/png.latex?U"> sur <img src="https://latex.codecogs.com/png.latex?%5B0,1%5D">, on applique l‚Äô<strong>inverse de la fonction de r√©partition de la loi gaussienne standard</strong> (aussi appel√©e la fonction quantile de la loi normale) :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AX%20=%20F%5E%7B-1%7D(U)%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?F"> est la fonction de r√©partition de la loi normale standard.</p>
<ol start="5" type="1">
<li>On consid√®re un caplet sur euribor12M √† barri√®re d√©sactivante de strike $ K = ATM - 100 bps$, de barri√®re <img src="https://latex.codecogs.com/png.latex?B%20=%20ATM%20+%20100%20bps"> et de maturit√© <img src="https://latex.codecogs.com/png.latex?T_i%20=%205Y">. Pour valoriser cette option, nous allons utiliser une m√©thode num√©rique de type Monte-Carlo. Pour cela, il est necessaire de connaire la loi de X_t sachant X_s. En nous aidant de la question pr√©c√©dente, on peut d√©duire que la loi de <img src="https://latex.codecogs.com/png.latex?X_t%7CX_s"> est une loi normale de param√®tres :</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0AX_t%7CX_s%20%5Csim%20%5Cmathcal%7BN%7D%5Cleft(%20X_s%20e%5E%7B-%5Clambda%20(t-s)%7D%20+%20%5Cint_s%5Et%20e%5E%7B-%5Clambda%20(t-u)%7D%20%5Cleft(%20%5Cphi(u)%20-%20%5Csigma%20%5CGamma(u,T)%20%5Cright)%20du,%20%5Cquad%20%5Cint_s%5Et%20e%5E%7B-2%20%5Clambda%20(t-u)%7D%20%5Csigma%5E2%20d%20%5Cright)%0A"></p>
<p>Pour valoriser cette option, nous pouvons directement utiliser la loi de <img src="https://latex.codecogs.com/png.latex?X_5%7CX_0"> pour simuler les trajectoires du taux court et calculer le payoff de l‚Äôoption ou diffuser progressivement le taux court en utilisant la loi de <img src="https://latex.codecogs.com/png.latex?X_t%7CX_s"> pour chaque pas de temps. Ensuite, il s‚Äôagira de calculer le payoff de l‚Äôoption √† chaque date, en faire la moyenne et l‚Äôactualiser pour obtenir le prix de l‚Äôoption.</p>
<section id="m√©thode-1-simulation-de-la-loi-de-x_5x_0" class="level5">
<h5 class="anchored" data-anchor-id="m√©thode-1-simulation-de-la-loi-de-x_5x_0">M√©thode 1 : Simulation de la loi de <img src="https://latex.codecogs.com/png.latex?X_5%7CX_0"></h5>
<div id="63fa14d7" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb37-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.integrate <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> quad</span>
<span id="cb37-3"></span>
<span id="cb37-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fonction phi(t) - variance cumul√©e</span></span>
<span id="cb37-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> phi(t, sigma, lambda_):</span>
<span id="cb37-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> lambda_)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> t))</span>
<span id="cb37-7"></span>
<span id="cb37-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fonction beta(t, T)</span></span>
<span id="cb37-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> beta(t, T, lambda_):</span>
<span id="cb37-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t))) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> lambda_</span>
<span id="cb37-11"></span>
<span id="cb37-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fonction gamma(t, T)</span></span>
<span id="cb37-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> gamma(t, T, sigma, lambda_):</span>
<span id="cb37-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> lambda_) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> t)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb37-15"></span>
<span id="cb37-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fonction B(t, T)</span></span>
<span id="cb37-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> B_t_T(t, T, B0_T, B0_t, X_t, sigma, lambda_):</span>
<span id="cb37-18">    beta_t_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> beta(t, T, lambda_)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb37-19">    phi_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(t, sigma, lambda_)</span>
<span id="cb37-20">    exponent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> beta_t_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> phi_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> beta_t_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> X_t</span>
<span id="cb37-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (B0_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B0_t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp(exponent)</span>
<span id="cb37-22"></span>
<span id="cb37-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fonction d'int√©gration avec param√®tres suppl√©mentaires</span></span>
<span id="cb37-24"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> integrand_mean(u, t, Xs, s, sigma, lambda_, T):</span>
<span id="cb37-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># t = borne sup</span></span>
<span id="cb37-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># s = borne inf</span></span>
<span id="cb37-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># T = maturit√©</span></span>
<span id="cb37-28">    Xt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> s))</span>
<span id="cb37-29">    exp_part <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> u))</span>
<span id="cb37-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> Xt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> exp_part <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (phi(u, sigma, lambda_) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> gamma(u, T, sigma, lambda_))</span>
<span id="cb37-31"></span>
<span id="cb37-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres</span></span>
<span id="cb37-33">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Ti_1  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb37-34">Xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  </span>
<span id="cb37-35">s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb37-36">t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Ti_1 </span>
<span id="cb37-37"></span>
<span id="cb37-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la moyenne conditionnelle</span></span>
<span id="cb37-39">mean_5_given_0, _ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quad(integrand_mean, s, t, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(t, Xs, s, sigma, lambda_, T))</span>
<span id="cb37-40"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Moyenne conditionnelle de X_5 | X_0 : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mean_5_given_0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb37-41"></span>
<span id="cb37-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la variance conditionnelle (ind√©pendant de gamma ici)</span></span>
<span id="cb37-43"></span>
<span id="cb37-44"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> compute_variance(sigma, lambda_, t, s):</span>
<span id="cb37-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> lambda_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> s))) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> lambda_)</span>
<span id="cb37-46">var_5_given_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_variance(sigma, lambda_, t, s)</span>
<span id="cb37-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># var_5_given_0 = (sigma**2) * (1 - np.exp(-2 * lambda_ * (t - s))) / (2 * lambda_)</span></span>
<span id="cb37-48"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Variance conditionnelle de X_5 | X_0 : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_5_given_0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Moyenne conditionnelle de X_5 | X_0 : 0.000000
Variance conditionnelle de X_5 | X_0 : 0.000452</code></pre>
</div>
</div>
<div id="25430e16" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1">Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb39-2">Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb39-3"></span>
<span id="cb39-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation Monte Carlo</span></span>
<span id="cb39-5">n_simulations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb39-6"></span>
<span id="cb39-7">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n_simulations)</span>
<span id="cb39-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_simulations):</span>
<span id="cb39-9">    phi_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(Ti_1, sigma, lambda_)</span>
<span id="cb39-10">    gamma_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gamma(Ti_1,Ti, sigma, lambda_)</span>
<span id="cb39-11"></span>
<span id="cb39-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Moyenne</span></span>
<span id="cb39-13">    mu_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mean_5_given_0</span>
<span id="cb39-14"></span>
<span id="cb39-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ecart-type</span></span>
<span id="cb39-16">    sigma_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(var_5_given_0)</span>
<span id="cb39-17"></span>
<span id="cb39-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># X_5|X_0</span></span>
<span id="cb39-19">    X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(mu_X, sigma_X)  </span>
<span id="cb39-20"></span>
<span id="cb39-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix B(5,6) selon Hull-White</span></span>
<span id="cb39-22">    B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,6)</span></span>
<span id="cb39-23">    B0_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti_1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,5)</span></span>
<span id="cb39-24"></span>
<span id="cb39-25">    B_5_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, B0_6, B0_5, X, sigma, lambda_)</span>
<span id="cb39-26">    B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, B0_5, B0_5, X, sigma, lambda_)</span>
<span id="cb39-27"></span>
<span id="cb39-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du taux forward L_i_t</span></span>
<span id="cb39-29">    L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_5_6) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb39-30">    bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb39-31"></span>
<span id="cb39-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition du strike</span></span>
<span id="cb39-33">    strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> bp</span>
<span id="cb39-34"></span>
<span id="cb39-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Barri√®re</span></span>
<span id="cb39-36">    B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bp</span>
<span id="cb39-37"></span>
<span id="cb39-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Payoff de l'option</span></span>
<span id="cb39-39">    payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.maximum(L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> strike, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> B)</span>
<span id="cb39-40">    payoffs[sim] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> payoff</span>
<span id="cb39-41"></span>
<span id="cb39-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix de l'option call</span></span>
<span id="cb39-43">call_price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(payoffs)</span>
<span id="cb39-44"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prix du call : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_price<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prix du call : 0.003007</code></pre>
</div>
</div>
</section>
<section id="m√©thode-2-methode-de-diffusion" class="level5">
<h5 class="anchored" data-anchor-id="m√©thode-2-methode-de-diffusion">M√©thode 2 : Methode de diffusion</h5>
<div id="5daac680" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation Monte Carlo</span></span>
<span id="cb41-2">n_simulations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb41-3"></span>
<span id="cb41-4">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n_simulations)</span>
<span id="cb41-5">X0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb41-6">Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb41-7">Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb41-8">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(Ti)</span>
<span id="cb41-9">X[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X0</span>
<span id="cb41-10"></span>
<span id="cb41-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_simulations):</span>
<span id="cb41-12">    phi_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(Ti_1, sigma, lambda_)</span>
<span id="cb41-13">    gamma_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gamma(Ti_1,Ti, sigma, lambda_)</span>
<span id="cb41-14"></span>
<span id="cb41-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,Ti):</span>
<span id="cb41-16">        t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i</span>
<span id="cb41-17">        s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb41-18">        T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> </span>
<span id="cb41-19">        Xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb41-20"></span>
<span id="cb41-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la moyenne conditionnelle</span></span>
<span id="cb41-22">        mu_X, _ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quad(integrand_mean, s, t, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(t, Xs, s, sigma, lambda_, T))</span>
<span id="cb41-23">        sigma_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(compute_variance(sigma, lambda_, t, s))</span>
<span id="cb41-24">        X[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(mu_X, sigma_X)</span>
<span id="cb41-25"></span>
<span id="cb41-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix B(5,6) selon Hull-White</span></span>
<span id="cb41-27">    B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,6)</span></span>
<span id="cb41-28">    B0_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti_1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,5)</span></span>
<span id="cb41-29"></span>
<span id="cb41-30">    B_5_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, B0_6, B0_5, X[Ti_1], sigma, lambda_)</span>
<span id="cb41-31">    B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, B0_5, B0_5, X[Ti_1], sigma, lambda_)</span>
<span id="cb41-32"></span>
<span id="cb41-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du taux forward L_i_t</span></span>
<span id="cb41-34">    L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_5_6) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb41-35">    bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb41-36"></span>
<span id="cb41-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition du strike</span></span>
<span id="cb41-38">    strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> bp</span>
<span id="cb41-39"></span>
<span id="cb41-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Barri√®re</span></span>
<span id="cb41-41">    B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bp</span>
<span id="cb41-42"></span>
<span id="cb41-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Payoff de l'option</span></span>
<span id="cb41-44">    payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.maximum(L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> strike, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> B)</span>
<span id="cb41-45">    payoffs[sim] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> payoff</span>
<span id="cb41-46"></span>
<span id="cb41-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix de l'option call</span></span>
<span id="cb41-48">call_price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(payoffs)</span>
<span id="cb41-49"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prix du call : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_price<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prix du call : 0.002987</code></pre>
</div>
</div>
<p>Nous constatons qu‚Äôavec les deux m√©thodes, nous obtenons des prix d‚Äôoptions similaires (diff√©rent de 0.2bps). Cela confirme que les deux m√©thodes convergent vers le m√™me r√©sultat.</p>
<p>En d√©g√©n√©rant le produit en faisant tendre la barri√®re √† <img src="https://latex.codecogs.com/png.latex?+%5Cinfty">, nous constatons que le prix de l‚Äôoption call est √©gal au prix de march√© du forward. En d√©g√©n√©rant le produit en faisant tendre la barri√®re √† 0, nous constatons que le prix de l‚Äôoption call est √©gal √† 0.</p>
<p>Cela est coh√©rent car lorsque la barri√®re est tr√®s √©lev√©e, le produit est √©quivalent √† un forward et lorsque la barri√®re est nulle, le produit est √©quivalent √† un call classique. La fonction que nous avons impl√©ment√© est donc coh√©rente et bien impl√©ment√©e.</p>
<div id="2dd13c2c" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1">Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb43-2">Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb43-3"></span>
<span id="cb43-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation Monte Carlo</span></span>
<span id="cb43-5">n_simulations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb43-6"></span>
<span id="cb43-7">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n_simulations)</span>
<span id="cb43-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_simulations):</span>
<span id="cb43-9">    phi_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(Ti_1, sigma, lambda_)</span>
<span id="cb43-10">    gamma_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gamma(Ti_1,Ti, sigma, lambda_)</span>
<span id="cb43-11"></span>
<span id="cb43-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Moyenne</span></span>
<span id="cb43-13">    mu_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mean_5_given_0</span>
<span id="cb43-14"></span>
<span id="cb43-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ecart-type</span></span>
<span id="cb43-16">    sigma_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(var_5_given_0)</span>
<span id="cb43-17"></span>
<span id="cb43-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># X_5|X_0</span></span>
<span id="cb43-19">    X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(mu_X, sigma_X)  </span>
<span id="cb43-20"></span>
<span id="cb43-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix B(5,6) selon Hull-White</span></span>
<span id="cb43-22">    B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,6)</span></span>
<span id="cb43-23">    B0_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti_1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,5)</span></span>
<span id="cb43-24"></span>
<span id="cb43-25">    B_5_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, B0_6, B0_5, X, sigma, lambda_)</span>
<span id="cb43-26">    B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, B0_5, B0_5, X, sigma, lambda_)</span>
<span id="cb43-27"></span>
<span id="cb43-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du taux forward L_i_t</span></span>
<span id="cb43-29">    L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_5_6) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb43-30">    bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb43-31"></span>
<span id="cb43-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition du strike</span></span>
<span id="cb43-33">    strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># - bp</span></span>
<span id="cb43-34"></span>
<span id="cb43-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Barri√®re</span></span>
<span id="cb43-36">    B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.inf<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ATM + bp</span></span>
<span id="cb43-37"></span>
<span id="cb43-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Payoff de l'option</span></span>
<span id="cb43-39">    payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.maximum(L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> strike, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> B)</span>
<span id="cb43-40">    payoffs[sim] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> payoff</span>
<span id="cb43-41"></span>
<span id="cb43-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix de l'option call</span></span>
<span id="cb43-43">call_price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(payoffs)</span>
<span id="cb43-44"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prix du call : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_price<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prix du call : 0.007089</code></pre>
</div>
</div>
<p>Nous rendons la barri√®re ‚Äòbermud√©enne‚Äô en √©tendant la condition de d√©sactivation aux dates 1Y, 2Y, 3Y, 4Y et 5Y. De ce fait, le payoff de cette option s‚Äô√©crit :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BPayoff%7D%20=%20%5Cdelta_i%20%5Cmax%5CBigl(%20L_i(T_i)%20-%20K,%5C;%200%20%5CBigr)%20%5Cmathbb%7B1%7D_%7Bmax_%7Bi=1,%5Cdots,5%7D(L_i(T_i)%20%3C%20B)%7D%0A"></p>
<div id="aa3259a1" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Option bermudienne</span></span>
<span id="cb45-2"></span>
<span id="cb45-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation Monte Carlo</span></span>
<span id="cb45-4">n_simulations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb45-5"></span>
<span id="cb45-6">payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n_simulations)</span>
<span id="cb45-7">X0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb45-8">Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb45-9">Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb45-10">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(Ti)</span>
<span id="cb45-11">X[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X0</span>
<span id="cb45-12"></span>
<span id="cb45-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_simulations):</span>
<span id="cb45-14">    phi_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(Ti_1, sigma, lambda_)</span>
<span id="cb45-15">    gamma_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gamma(Ti_1,Ti, sigma, lambda_)</span>
<span id="cb45-16">    L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(Ti_1)</span>
<span id="cb45-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,Ti):</span>
<span id="cb45-18">        t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i</span>
<span id="cb45-19">        s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb45-20">        T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> </span>
<span id="cb45-21">        Xs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X[s]</span>
<span id="cb45-22"></span>
<span id="cb45-23">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la moyenne conditionnelle</span></span>
<span id="cb45-24">        mu_X, _ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quad(integrand_mean, s, t, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(t, Xs, s, sigma, lambda_, T))</span>
<span id="cb45-25">        sigma_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(compute_variance(sigma, lambda_, t, s))</span>
<span id="cb45-26">        X[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(mu_X, sigma_X)</span>
<span id="cb45-27"></span>
<span id="cb45-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix B(5,6) selon Hull-White</span></span>
<span id="cb45-29">        Bi_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> t, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,6)</span></span>
<span id="cb45-30">        Bi_s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> s, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,5)</span></span>
<span id="cb45-31"></span>
<span id="cb45-32">        B_s_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(s, t, Bi_t, Bi_s, X[i], sigma, lambda_)</span>
<span id="cb45-33">        B_s_s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(s, s, Bi_s, Bi_s, X[i], sigma, lambda_)</span>
<span id="cb45-34"></span>
<span id="cb45-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du taux forward L_i_t</span></span>
<span id="cb45-36">        L_i_t[i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>s)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((B_s_s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_s_t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb45-37">    </span>
<span id="cb45-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix B(5,6) selon Hull-White</span></span>
<span id="cb45-39">    B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,6)</span></span>
<span id="cb45-40">    B0_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti_1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,5)</span></span>
<span id="cb45-41"></span>
<span id="cb45-42">    B_5_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, B0_6, B0_5, X[Ti_1], sigma, lambda_)</span>
<span id="cb45-43">    B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, B0_5, B0_5, X[Ti_1], sigma, lambda_)</span>
<span id="cb45-44"></span>
<span id="cb45-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du taux forward L_i_t</span></span>
<span id="cb45-46">    L_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_5_6) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb45-47">    bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb45-48"></span>
<span id="cb45-49"></span>
<span id="cb45-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition du strike</span></span>
<span id="cb45-51">    strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> bp</span>
<span id="cb45-52"></span>
<span id="cb45-53">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Barri√®re</span></span>
<span id="cb45-54">    B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bp</span>
<span id="cb45-55"></span>
<span id="cb45-56">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Payoff de l'option</span></span>
<span id="cb45-57">    payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.maximum(L_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> strike, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(L_i_t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> B)</span>
<span id="cb45-58">    payoffs[sim] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> payoff</span>
<span id="cb45-59"></span>
<span id="cb45-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix de l'option call</span></span>
<span id="cb45-61">call_price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(payoffs)</span>
<span id="cb45-62"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prix du call : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_price<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Prix du call : 0.003046</code></pre>
</div>
</div>
<p>L‚Äôun des param√®tres important du mod√®le de Hull et White est la mean reversion <img src="https://latex.codecogs.com/png.latex?%5Clambda">, qui caract√©rise la force de rappel √† la moyenne du processus. Ce param√®tre a un impact positive sur la valorisation de l‚Äôoption, comme nous pouvons l‚Äôobserver dans la figure ci dessous .</p>
<div id="01c6ed8c" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Liste des lambda √† tester</span></span>
<span id="cb47-2">lambdas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exemple de grille de lambda</span></span>
<span id="cb47-3">results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb47-4"></span>
<span id="cb47-5">Ti_1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb47-6">Ti <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb47-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Boucle principale sur les lambdas</span></span>
<span id="cb47-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> lambda_ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> lambdas:</span>
<span id="cb47-9">    n_touched <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb47-10">    payoffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n_simulations)</span>
<span id="cb47-11"></span>
<span id="cb47-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_simulations):</span>
<span id="cb47-13">        phi_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi(Ti_1, sigma, lambda_)</span>
<span id="cb47-14">        gamma_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gamma(Ti_1,Ti, sigma, lambda_)</span>
<span id="cb47-15"></span>
<span id="cb47-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Moyenne</span></span>
<span id="cb47-17">        mu_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mean_5_given_0</span>
<span id="cb47-18"></span>
<span id="cb47-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ecart-type</span></span>
<span id="cb47-20">        sigma_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(var_5_given_0)</span>
<span id="cb47-21"></span>
<span id="cb47-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># X_5|X_0</span></span>
<span id="cb47-23">        X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(mu_X, sigma_X)  </span>
<span id="cb47-24"></span>
<span id="cb47-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix B(5,6) selon Hull-White</span></span>
<span id="cb47-26">        B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,6)</span></span>
<span id="cb47-27">        B0_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df_ZC.loc[df_ZC[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'T'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> Ti_1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'B'</span>].values[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># B(0,5)</span></span>
<span id="cb47-28"></span>
<span id="cb47-29">        B_5_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, B0_6, B0_5, X, sigma, lambda_)</span>
<span id="cb47-30">        B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B_t_T(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, B0_5, B0_5, X, sigma, lambda_)</span>
<span id="cb47-31"></span>
<span id="cb47-32">        L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((B_5_5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> B_5_6) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb47-33">        bp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb47-34">        strike <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> bp</span>
<span id="cb47-35">        B <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ATM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bp</span>
<span id="cb47-36"></span>
<span id="cb47-37">        payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.maximum(L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> strike, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (L_i_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> B)</span>
<span id="cb47-38">        payoffs[sim] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> payoff</span>
<span id="cb47-39"></span>
<span id="cb47-40">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># V√©rification de la barri√®re</span></span>
<span id="cb47-41">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(L_i_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> B):</span>
<span id="cb47-42">            n_touched <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb47-43"></span>
<span id="cb47-44">    prob_toucher_barriere <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n_touched <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_simulations</span>
<span id="cb47-45"></span>
<span id="cb47-46">    call_price <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> B0_6 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(payoffs)</span>
<span id="cb47-47">    results.append((lambda_, call_price,prob_toucher_barriere))</span></code></pre></div>
</div>
<div id="8ebfc2c1" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optionnel : Graphique de la sensibilit√©</span></span>
<span id="cb48-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb48-3"></span>
<span id="cb48-4">lambdas, prices, probabilities <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>results)</span>
<span id="cb48-5">plt.plot(lambdas, prices, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb48-6">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lambda (Mean Reversion)'</span>)</span>
<span id="cb48-7">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Prix de l</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">option'</span>)</span>
<span id="cb48-8">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Sensibilit√© du prix √† la mean reversion (Œª)'</span>)</span>
<span id="cb48-9">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb48-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>De plus, plus le param√®tre de mean reversion <img src="https://latex.codecogs.com/png.latex?%5Clambda"> est √©lev√©, plus la probabilit√© de toucher la barri√®re est faible. Inversement, une faible mean reversion laisse plus de libert√© au processus pour explorer des valeurs extr√™mes, augmentant ainsi la probabilit√© de franchir la barri√®re.</p>
<div id="9ef01162" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1">plt.plot(lambdas, probabilities, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb49-2">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Lambda (Mean Reversion)'</span>)</span>
<span id="cb49-3">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Probabilit√© de toucher la barri√®re'</span>)</span>
<span id="cb49-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Probabilit√© de toucher la barri√®re en fonction de la mean reversion (Œª)'</span>)</span>
<span id="cb49-5">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb49-6">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>proc-sto</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/pj_courbe_tx.html</guid>
  <pubDate>Mon, 03 Mar 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>TP3:M√©thodes d‚Äôune calcul d‚Äôune VaR dynamique (bas√© sur GARCH)</title>
  <dc:creator>Cheryl Kouadio</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch.html</link>
  <description><![CDATA[ 




<p>Ce TP est une continuit√© du TP-1 et du TP-2 dans lequel on souhaitait impl√©menter la VaR (Value at Risk) et l‚ÄôES (Expected Shortfall) en utilisant les m√©thodes classiques propos√©es dans la r√©glementation b√¢loise, i.e.&nbsp;la m√©thode historique, param√©trique et bootstrap (TP1). Cependant, une limite de ces m√©thodes est qu‚Äôelles ne prennent pas en compte la queue de distribution de la perte. Pour rem√©dier √† cela, nous avons utilis√© des m√©thodes avec la th√©orie des valeurs extr√™mes, i.e.&nbsp;l‚Äôapproche Block Maxima et l‚Äôapproche Peaks Over Threshold (TP2). Jusqu‚Äô√† maintenant, on consid√©rait que la s√©rie est iid. Cependant, dans la r√©alit√©, les s√©ries financi√®res sont souvent caract√©ris√©es par une d√©pendance temporelle et une volatilit√© conditionnelle.</p>
<p>Dans le cadre du TP3, il s‚Äôagira de prendre en compte la d√©pendance temporelle et la volatilit√© conditionnelle dans les s√©ries temporelles financi√®res. Pour ce faire, nous utiliserons un mod√®le de VAR dynamique avec le mod√®le GARCH.</p>
<p>Le mod√®le GARCH (Generalized Autoregressive Conditional Heteroskedasticity) est un mod√®le de volatilit√© conditionnelle qui permet de mod√©liser la volatilit√© des rendements financiers. Il a √©t√© introduit par Bollerslev en 1986. Le mod√®le GARCH est une extension du mod√®le ARCH (Autoregressive Conditional Heteroskedasticity) introduit par Engle en 1982. Le mod√®le GARCH est d√©fini par les √©quations suivantes:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ar_t%20=%20%5Cmu_t%20+%20%5Cepsilon_t%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cepsilon_t%20=%20%5Csigma_t%20z_t%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma_t%5E2%20=%20%5Comega%20+%20%5Csum%20%5Calpha_i%20%5Cepsilon_%7Bt-i%7D%5E2%20+%20%5Csum%20%5Cbeta_i%20%5Csigma_%7Bt-i%7D%5E2%0A"></p>
<p>Dans ce mod√®le <img src="https://latex.codecogs.com/png.latex?%5Cmu_t"> est un param√®tre de tendance moyenne √† identifier, <img src="https://latex.codecogs.com/png.latex?%5Cepsilon_t"> est le r√©sidu, <img src="https://latex.codecogs.com/png.latex?%5Csigma_t%5E2"> est la variance conditionnelle, <img src="https://latex.codecogs.com/png.latex?z_t"> est un bruit blanc, <img src="https://latex.codecogs.com/png.latex?%5Comega"> est un param√®tre de constante, <img src="https://latex.codecogs.com/png.latex?%5Calpha_i"> et <img src="https://latex.codecogs.com/png.latex?%5Cbeta_i"> sont les param√®tres du mod√®le GARCH √† identifier.</p>
<div id="1c2c7d17" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des librairies</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yfinance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> yf</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-6">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tqdm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tqdm</span></code></pre></div>
</div>
<div id="3f60d09d" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import des donn√©es du CAC 40</span></span>
<span id="cb2-2">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.download(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FCHI"</span>,start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008-01-01"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des rendements logarithmiques</span></span>
<span id="cb2-5">data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>].shift(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retirer la premi√®re ligne</span></span>
<span id="cb2-8">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.dropna()</span>
<span id="cb2-9">data.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.columns.get_level_values(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="e067cd30" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>]][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'15-10-2008'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'26-07-2022'</span>]</span>
<span id="cb4-2">data_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>]</span>
<span id="cb4-3"></span>
<span id="cb4-4">test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>]][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'27-07-2022'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'11-06-2024'</span>]</span>
<span id="cb4-5">data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> test[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>]</span></code></pre></div>
</div>
<section id="i.-impl√©mentation-de-la-var-dynamique" class="level2">
<h2 class="anchored" data-anchor-id="i.-impl√©mentation-de-la-var-dynamique">I. Impl√©mentation de la VaR dynamique</h2>
<section id="i.1.-pertinence-du-mod√®le-ar1-garch11" class="level3">
<h3 class="anchored" data-anchor-id="i.1.-pertinence-du-mod√®le-ar1-garch11">I.1. Pertinence du mod√®le AR(1)-GARCH(1,1)</h3>
<p>Le mod√®le AR(1)-GARCH(1,1) est le mod√®le qui, en pratique, est utilis√© pour r√©aliser la VaR dynamique. Cependant, il n‚Äôest pas tout le temps adapt√© aux donn√©es financi√®res. Dans ce TP, nous allons commencer par tester l‚Äô√©ligibilit√© de ce mod√®le dans le cadre des donn√©es que nous poss√©dons.</p>
<div id="c32bd353" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb5-2">plt.plot(data_train, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Train'</span>)</span>
<span id="cb5-3">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'CAC 40 Log Returns'</span>)</span>
<span id="cb5-4">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="afffaccb" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## ACF et PACF</span></span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.graphics.tsaplots <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plot_acf, plot_pacf</span>
<span id="cb6-3"></span>
<span id="cb6-4">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb6-5">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">221</span>)</span>
<span id="cb6-6">plot_acf(data_train, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.gca(), lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span>
<span id="cb6-7">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">222</span>)</span>
<span id="cb6-8">plot_pacf(data_train, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.gca(), lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>)</span>
<span id="cb6-9">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Dans la s√©rie temporelle que nous poss√©dons, nous constatons que la s√©rie peut √™tre mod√©liser par un AR(1). Pour un test plus rigoureux de cette hypoth√®se, nous allons utiliser la m√©thode de Lljung Box afin de d√©terminer le meilleur mod√®le qui puisse mod√©liser la s√©rie. Ainsi, pour un ordre pmax = 2 et qmax=2, nous allons : 1. Estimer les param√®tres du mod√®le ARMA(p,q) pour chaque combinaison de p et q 2. Calculer la statistique de Ljung Box pour chaque combinaison de p et q afin d‚Äôexaminer si les r√©sidus d‚Äôun mod√®le sont du bruit blanc 3. Filtrer les mod√®les pour lesquels les r√©sidus sont du bruit blanc 4. Choisir le meilleur mod√®le en utilisant le crit√®re d‚ÄôAkaike</p>
<div id="ebdd8eac" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> statsmodels.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sm</span>
<span id="cb7-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.tsa.arima.model <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ARIMA</span>
<span id="cb7-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> boxcox</span>
<span id="cb7-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.stats.diagnostic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> acorr_ljungbox</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres du mod√®le</span></span>
<span id="cb7-9">p_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb7-10">q_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb7-11">best_aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.inf</span>
<span id="cb7-12">best_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-13"></span>
<span id="cb7-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Chargement de la s√©rie temporelle (remplacer par la vraie s√©rie data_unindex)</span></span>
<span id="cb7-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exemple fictif avec des donn√©es al√©atoires</span></span>
<span id="cb7-16">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb7-17">data_unindex <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_train.copy()</span>
<span id="cb7-18">data_unindex.reset_index(drop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-19"></span>
<span id="cb7-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©ation de la matrice pour stocker les AIC</span></span>
<span id="cb7-21">aic_matrix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(np.nan, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(p_max<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)], </span>
<span id="cb7-22">                          columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"q=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>q<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(q_max<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)])</span>
<span id="cb7-23"></span>
<span id="cb7-24">bb_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(p_max<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)], </span>
<span id="cb7-25">                          columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"q=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>q<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(q_max<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)])</span>
<span id="cb7-26"></span>
<span id="cb7-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Boucle pour estimer les mod√®les et stocker les AIC</span></span>
<span id="cb7-28"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(p_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb7-29">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(q_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb7-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb7-31">            model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ARIMA(data_unindex, order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(p, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, q))</span>
<span id="cb7-32">            out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.fit()</span>
<span id="cb7-33">            aic_matrix.loc[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"q=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>q<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> out.aic  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stockage de l'AIC</span></span>
<span id="cb7-34">            </span>
<span id="cb7-35">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test de la blancheur des r√©sidus</span></span>
<span id="cb7-36">            ljung_box_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> acorr_ljungbox(out.resid, lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], return_df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb7-37">            p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ljung_box_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lb_pvalue'</span>].iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb7-38"></span>
<span id="cb7-39">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>:</span>
<span id="cb7-40">                bb_test.loc[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"q=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>q<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-41">            </span>
<span id="cb7-42">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mise √† jour du meilleur mod√®le</span></span>
<span id="cb7-43">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> out.aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> best_aic :</span>
<span id="cb7-44">                best_aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> out.aic</span>
<span id="cb7-45">                best_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (p, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, q)</span>
<span id="cb7-46">                </span>
<span id="cb7-47">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb7-48">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Erreur avec (p=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, q=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>q<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-49"></span>
<span id="cb7-50"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Meilleur mod√®le ARIMA: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>best_order<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> avec AIC=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>best_aic<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-51"></span>
<span id="cb7-52"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb7-53"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Matrice des AIC:"</span>)</span>
<span id="cb7-54"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(aic_matrix)</span>
<span id="cb7-55"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb7-56"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Matrice des test de Lljung box (1 lorsque r√©sidus non autocorr√©l√©s):"</span>)</span>
<span id="cb7-57"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(bb_test)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Meilleur mod√®le ARIMA: (0, 0, 0) avec AIC=-20100.176479566246
==============================
Matrice des AIC:
              q=0           q=1           q=2
p=0 -20100.176480 -20098.205891 -20097.679059
p=1 -20098.227385 -20099.862840 -20097.046957
p=2 -20097.887027 -20098.545030 -20094.033191
==============================
Matrice des test de Lljung box (1 lorsque r√©sidus non autocorr√©l√©s):
     q=0  q=1  q=2
p=0    1    1    1
p=1    1    1    1
p=2    1    1    1</code></pre>
</div>
</div>
<div id="23af8a54" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb9-2">q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb9-3"></span>
<span id="cb9-4">AR1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ARIMA(data_unindex, order<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(p, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, q))</span>
<span id="cb9-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(AR1.fit().summary())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               SARIMAX Results                                
==============================================================================
Dep. Variable:             log_return   No. Observations:                 3523
Model:                 ARIMA(1, 0, 0)   Log Likelihood               10052.114
Date:                Wed, 11 Feb 2026   AIC                         -20098.227
Time:                        03:02:56   BIC                         -20079.726
Sample:                             0   HQIC                        -20091.627
                               - 3523                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0001      0.000      0.621      0.535      -0.000       0.001
ar.L1         -0.0037      0.012     -0.321      0.748      -0.027       0.019
sigma2         0.0002   2.16e-06     89.947      0.000       0.000       0.000
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):              7957.49
Prob(Q):                              1.00   Prob(JB):                         0.00
Heteroskedasticity (H):               0.61   Skew:                            -0.30
Prob(H) (two-sided):                  0.00   Kurtosis:                        10.34
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).</code></pre>
</div>
</div>
<p>En utilisant la m√©thode √©nonc√©e plus haut, nous constatons que le mod√®le ARMA(0,0) est le meilleur mod√®le. En effet, c‚Äôest le mod√®le avec le crit√®re d‚ÄôAkaike le plus faible. Cela porte √† croire que la tendance moyenne de la s√©rie est constante. Nous allons tout de m√™me utiliser un mod√®le AR(1) pour la mod√©liser. En effet, c‚Äôest le deuxi√®me mod√®le avec un AIC faible.</p>
<p>Dans la s√©rie des r√©sidus, nous constatons des clusters de volatilit√© ce qui est signe d‚Äôune volatilit√© conditionnelle, et donc de la pr√©sence d‚Äôun GARCH. De plus, dans la s√©rie des r√©sidus du log-rendement, nous constatons une faible autocorr√©lation, ce qui les fait ressembler √† du bruit blanc. Toutefois, lorsque l‚Äôon examine ces r√©sidus au carr√©, la s√©rie temporelle pr√©sente g√©n√©ralement une forte autocorr√©lation, mise en √©vidence par la pr√©sence de grappes de volatilit√©. Cela sugg√®re que les rendements repr√©sentent un processus h√©t√©rosc√©dastique, ce qui rend le mod√®le GARCH particuli√®rement pertinent dans le cadre de notre √©tude.</p>
<div id="845e1e1c" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">AR1_resid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AR1.fit().resid</span>
<span id="cb11-2">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb11-3">plt.plot(AR1_resid)</span>
<span id="cb11-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R√©sidus du mod√®le AR(1)"</span>)</span>
<span id="cb11-5">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="5a439764" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb12-2">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">221</span>)</span>
<span id="cb12-3">plot_acf(AR1_resid, lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.gca())</span>
<span id="cb12-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACF des r√©sidus AR(1)"</span>)</span>
<span id="cb12-5">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">222</span>)</span>
<span id="cb12-6">plot_acf(AR1_resid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.gca())</span>
<span id="cb12-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACF des r√©sidus AR(1) au carr√©"</span>)</span>
<span id="cb12-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Motiv√©s par les commentaires de (Franke, H√§rdle et Hafner 2004) sugg√©rant que, dans les applications pratiques, les mod√®les GARCH avec des ordres plus petits d√©crivent souvent suffisamment les donn√©es et que dans la plupart des cas GARCH(1,1) est ad√©quat, nous avons consid√©r√© quatre combinaisons diff√©rentes de p=0, 1 et q=1, 2 pour chaque p√©riode afin d‚Äôentra√Æner le mod√®le GARCH, en supposant que les r√©sidus standardis√©s suivent une distribution normale.</p>
<div id="ebb581f4" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb13-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> arch <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> arch_model</span>
<span id="cb13-4"></span>
<span id="cb13-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> find_garch(p_min, p_max, q_min, q_max, data, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>):</span>
<span id="cb13-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb13-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Trouve le meilleur mod√®le GARCH(p, q) en minimisant l'AIC.</span></span>
<span id="cb13-8"></span>
<span id="cb13-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Param√®tres :</span></span>
<span id="cb13-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - p_min, p_max : Bornes pour p (ordre de l'AR dans la variance)</span></span>
<span id="cb13-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - q_min, q_max : Bornes pour q (ordre de MA dans la variance)</span></span>
<span id="cb13-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - data : S√©rie temporelle utilis√©e pour l'estimation</span></span>
<span id="cb13-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - dist : Distribution des erreurs ("normal", "t", "ged", etc.)</span></span>
<span id="cb13-14"></span>
<span id="cb13-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retour :</span></span>
<span id="cb13-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - DataFrame contenant les valeurs de AIC pour chaque combinaison (p, q)</span></span>
<span id="cb13-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Meilleur mod√®le GARCH trouv√© en fonction du crit√®re AIC</span></span>
<span id="cb13-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb13-19">    </span>
<span id="cb13-20">    best_aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.inf</span>
<span id="cb13-21">    best_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb13-22">    </span>
<span id="cb13-23">    results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb13-24"></span>
<span id="cb13-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> p <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(p_min, p_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb13-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> q <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(q_min, q_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb13-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb13-28">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sp√©cification du mod√®le GARCH(p, q)</span></span>
<span id="cb13-29">                garch_spec <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> arch_model(data, vol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Garch'</span>, p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>p, q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>q, mean<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Zero'</span>, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dist)</span>
<span id="cb13-30">                out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> garch_spec.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span>
<span id="cb13-31">                </span>
<span id="cb13-32">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de l'AIC</span></span>
<span id="cb13-33">                current_aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> out.aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data)</span>
<span id="cb13-34"></span>
<span id="cb13-35">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mettre √† jour le meilleur mod√®le si un plus petit AIC est trouv√©</span></span>
<span id="cb13-36">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> current_aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> best_aic:</span>
<span id="cb13-37">                    best_aic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> current_aic</span>
<span id="cb13-38">                    best_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (p, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, q)</span>
<span id="cb13-39">                </span>
<span id="cb13-40">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ajouter les r√©sultats dans la liste</span></span>
<span id="cb13-41">                results.append({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p'</span>: p, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'q'</span>: q, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'aic'</span>: current_aic, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'relative_gap'</span>: np.nan})</span>
<span id="cb13-42">            </span>
<span id="cb13-43">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb13-44">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Erreur pour (p=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, q=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>q<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>e<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-45">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span></span>
<span id="cb13-46">    </span>
<span id="cb13-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convertir en DataFrame</span></span>
<span id="cb13-48">    results_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(results)</span>
<span id="cb13-49"></span>
<span id="cb13-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculer l'√©cart relatif par rapport au meilleur AIC</span></span>
<span id="cb13-51">    results_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'relative_gap'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (results_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'aic'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> best_aic) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> best_aic</span>
<span id="cb13-52">    </span>
<span id="cb13-53">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> results_df, best_order</span>
<span id="cb13-54"></span>
<span id="cb13-55">results_df, best_garch_order <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> find_garch(p_min<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, p_max<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, q_min<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, q_max<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_unindex, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>)</span>
<span id="cb13-56"></span>
<span id="cb13-57"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Meilleur mod√®le GARCH: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>best_garch_order<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> avec AIC=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>best_aic<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-58"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>)</span>
<span id="cb13-59"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R√©sultats pour les mod√®les test√©s:"</span>)</span>
<span id="cb13-60">results_df.sort_values(by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'relative_gap'</span>, ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Meilleur mod√®le GARCH: (1, 0, 1) avec AIC=-20100.176479566246
==============================
R√©sultats pour les mod√®les test√©s:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">p</th>
<th data-quarto-table-cell-role="th">q</th>
<th data-quarto-table-cell-role="th">aic</th>
<th data-quarto-table-cell-role="th">relative_gap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>1</td>
<td>-7.493455e+07</td>
<td>-0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>1</td>
<td>-7.490963e+07</td>
<td>-0.033254</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2</td>
<td>-7.486519e+07</td>
<td>-0.092567</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>2</td>
<td>-7.483014e+07</td>
<td>-0.139333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>0</td>
<td>-7.189514e+07</td>
<td>-4.056091</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>0</td>
<td>-7.073946e+07</td>
<td>-5.598342</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>En utilisant le crit√®re AIC pour s√©lectionner le meilleur mod√®le, nous avons conclu que GARCH(1,1) est effectivement le meilleur mod√®le.</p>
<div id="19c942a1" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1">garch11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> arch_model(data_unindex, vol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Garch'</span>, p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, mean<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Zero'</span>, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'normal'</span>)</span>
<span id="cb15-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">78</span>)</span>
<span id="cb15-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R√©sum√© du mod√®le GARCH(1,1)"</span>)</span>
<span id="cb15-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">78</span>)</span>
<span id="cb15-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).summary())</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==============================================================================
R√©sum√© du mod√®le GARCH(1,1)
==============================================================================
                       Zero Mean - GARCH Model Results                        
==============================================================================
Dep. Variable:             log_return   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                      GARCH   Log-Likelihood:                10638.0
Distribution:                  Normal   AIC:                          -21270.1
Method:            Maximum Likelihood   BIC:                          -21251.6
                                        No. Observations:                 3523
Date:                Wed, Feb 11 2026   Df Residuals:                     3523
Time:                        03:02:56   Df Model:                            0
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      3.8930e-06  4.514e-10   8624.704      0.000 [3.892e-06,3.894e-06]
alpha[1]       0.1000  5.098e-03     19.615  1.161e-85   [9.001e-02,  0.110]
beta[1]        0.8800  7.520e-03    117.017      0.000     [  0.865,  0.895]
============================================================================

Covariance estimator: robust</code></pre>
</div>
</div>
<div id="4a26022f" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">cond_resid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).conditional_volatility <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Volatilit√© conditionnelle =&gt; sigma_t</span></span>
<span id="cb17-2">resid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).resid <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># r√©sidus du mod√®le =&gt; eps_t</span></span>
<span id="cb17-3">resid_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).std_resid  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># r√©sidus studentis√©s =&gt; eta_t</span></span>
<span id="cb17-4"></span>
<span id="cb17-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># jarque bera test</span></span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> jarque_bera</span>
<span id="cb17-8"></span>
<span id="cb17-9">jb_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> jarque_bera(resid_std)</span>
<span id="cb17-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"H0: Les r√©sidus studentis√©s suivent une loi normale"</span>)</span>
<span id="cb17-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Test de Jarque-Bera sur les r√©sidus studentis√©s: JB=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>jb_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, p-value=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>jb_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># reject the null hypothesis of normality for the distribution of the residuals, </span></span>
<span id="cb17-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># as a rule of thumb, which implies that the data to be fitted is not</span></span>
<span id="cb17-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normally distributed</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>H0: Les r√©sidus studentis√©s suivent une loi normale
Test de Jarque-Bera sur les r√©sidus studentis√©s: JB=848.8557767883675, p-value=4.71313744144075e-185</code></pre>
</div>
</div>
<div id="72102b00" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### y revenir</span></span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">### coeff &lt;1</span></span></code></pre></div>
</div>
<div id="9288da36" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test d'homosc√©dasticit√©</span></span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ljung-Box test sur r√©sidus</span></span>
<span id="cb20-3">lb_test_resid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> acorr_ljungbox(resid_std, lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)], return_df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb20-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ljung-Box Test sur r√©sidus:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, lb_test_resid)</span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ljung-Box test sur carr√©s des r√©sidus</span></span>
<span id="cb20-7">lb_test_resid_sq <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> acorr_ljungbox(resid_std<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)], return_df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb20-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ljung-Box Test sur carr√©s des r√©sidus:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, lb_test_resid_sq)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ljung-Box Test sur r√©sidus:
      lb_stat  lb_pvalue
1   0.028087   0.866904
2   0.572026   0.751253
3   0.690100   0.875530
4   1.235029   0.872298
5   2.199461   0.820914
6   2.491801   0.869384
7   2.828137   0.900433
8   2.941010   0.938005
9   3.793237   0.924486
10  4.644433   0.913631
11  4.727144   0.943657
12  6.763448   0.872842
Ljung-Box Test sur carr√©s des r√©sidus:
       lb_stat  lb_pvalue
1    0.280711   0.596235
2    0.339634   0.843819
3    6.670837   0.083163
4    7.395445   0.116409
5    8.091586   0.151260
6    8.233789   0.221471
7    8.724987   0.273009
8    9.386238   0.310768
9    9.938908   0.355454
10  11.579309   0.314198
11  13.394501   0.268325
12  13.845698   0.310670</code></pre>
</div>
</div>
<div id="e9956e1b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LM test pour les effets ARCH</span></span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.stats.diagnostic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> het_arch</span>
<span id="cb22-3"></span>
<span id="cb22-4">lm_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> het_arch(resid_std)</span>
<span id="cb22-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'LM Test Statistique: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%.3f</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">, p-value: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%.3f</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> (lm_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], lm_test[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LM Test Statistique: 12.218, p-value: 0.271</code></pre>
</div>
</div>
<div id="c9535184" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb24-2">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">221</span>)</span>
<span id="cb24-3">plot_acf(resid_std, lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.gca())</span>
<span id="cb24-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACF des r√©sidus studentis√©s"</span>)</span>
<span id="cb24-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R√©sidus studentis√©s du mod√®le GARCH(1,1)"</span>)</span>
<span id="cb24-6">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">222</span>)</span>
<span id="cb24-7">plot_pacf(resid_std, lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>plt.gca())</span>
<span id="cb24-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-17-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le mod√®le AR(1)-GARCH(1,1) estim√© est le suivant :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ar_t%20=%20%5Cmu_t%20+%20%5Cepsilon_t%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Cmu_t%20=%200.0001%20-%200.0037%20r_%7Bt-1%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cepsilon_t%20=%20%5Csigma_t%20%5Ceta_t%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csigma_t%5E2%20=%203.89%20%5Ctimes%2010%5E%7B-6%7D%20+%200.10%20%5Ctimes%20%5Cepsilon_%7Bt-i%7D%5E2%20+%200.88%20%5Ctimes%20%5Csigma_%7Bt-i%7D%5E2%0A"></p>
<p>avec <img src="https://latex.codecogs.com/png.latex?%5Ceta_t"> un bruit blanc suppos√©e gaussien.</p>
<p>Dans ce cas, nous rencontrons des probl√®mes au niveau de la significativit√© du coefficient AR(1). En effet, il aurait √©t√© plus judicieux de ne pas mod√©liser la tendance moyenne du rendement et la supposer constante. De plus, au niveau du GARCH(1,1), les r√©sidus sont bien des bruits blancs homosc√©dastiques (test de lljung box et test LM). Cependant, nous avons suppos√© que <img src="https://latex.codecogs.com/png.latex?%5Ceta_t"> est un bruit blanc gaussien. Cela n‚Äôest pas v√©rifi√©. Il aurait √©t√© judicieux de tester d‚Äôautres distributions telles que Students‚Äôs t (‚Äôt‚Äô, ‚Äòstudentst‚Äô), Skewed Student‚Äôs t (‚Äòskewstudent‚Äô, ‚Äòskewt‚Äô) ou encore Generalized Error Distribution (GED).</p>
<pre><code>**Test de Lagrange Multiplier (LM) pour l'effet ARCH**

Le test de Lagrange Multiplier (LM) pour l'effet ARCH est un outil statistique qui v√©rifie la pr√©sence d'effets ARCH (AutoRegressive Conditional Heteroskedasticity) dans une s√©rie temporelle.

L'effet ARCH se manifeste lorsque la variance d'une erreur est une fonction de ses erreurs pass√©es. Cette propri√©t√© est courante dans les s√©ries temporelles financi√®res, o√π de grandes variations des rendements sont souvent suivies par de grandes variations et vice versa.

Le test de LM v√©rifie l'hypoth√®se nulle que les erreurs sont homosc√©dastiques (variance constante). Si la p-value du test est inf√©rieure √† un seuil pr√©d√©fini (g√©n√©ralement 0,05), l'hypoth√®se nulle est rejet√©e, indiquant la pr√©sence d'effets ARCH.</code></pre>
<div id="26f4e731" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©ation de la figure avec des sous-graphiques align√©s verticalement</span></span>
<span id="cb26-2">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb26-3"></span>
<span id="cb26-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Premier graphique : CAC 40</span></span>
<span id="cb26-5">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">311</span>)</span>
<span id="cb26-6">plt.plot(resid) </span>
<span id="cb26-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R√©sidus du mod√®le AR(1)"</span>)</span>
<span id="cb26-8"></span>
<span id="cb26-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Deuxi√®me graphique : R√©sidus du mod√®le AR(1)</span></span>
<span id="cb26-10">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">312</span>)</span>
<span id="cb26-11">plt.plot(cond_resid)</span>
<span id="cb26-12">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatile conditionnelle du mod√®le GARCH(1,1)"</span>)</span>
<span id="cb26-13"></span>
<span id="cb26-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Troisi√®me graphique : R√©sidus studentis√©s du mod√®le GARCH(1,1)</span></span>
<span id="cb26-15">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">313</span>)</span>
<span id="cb26-16">plt.plot(resid_std, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'R√©sidus studentis√©s du mod√®le GARCH(1,1)'</span>)</span>
<span id="cb26-17">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"R√©sidus studentis√©s du mod√®le GARCH(1,1)"</span>)</span>
<span id="cb26-18"></span>
<span id="cb26-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage des graphiques</span></span>
<span id="cb26-20">plt.tight_layout()</span>
<span id="cb26-21">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="i.2.-dynamique-historique-de-mu_t-et-sigma_t" class="level3">
<h3 class="anchored" data-anchor-id="i.2.-dynamique-historique-de-mu_t-et-sigma_t">I.2. Dynamique historique de <img src="https://latex.codecogs.com/png.latex?%5Cmu_t"> et <img src="https://latex.codecogs.com/png.latex?%5Csigma_t"></h3>
<p><img src="https://latex.codecogs.com/png.latex?%0Ar_t%20=%20%5Cmu_t%20+%20%5Csigma_t%20%5Ctimes%20%5Cepsilon_t%0A%5Cquad%0A%5Ctext%7Bavec%7D%20%5Cquad%0A%5Cbegin%7Bcases%7D%0A%20%20%20%20%5Cmu_t%20=%20%5Cmu%20+%20%5Cvarphi%20r_%7Bt-1%7D%20%5C%5C%0A%20%20%20%20%5Csigma_t%5E2%20=%20%5Comega%20+%20a%20(r_%7Bt-1%7D%20-%20%5Cmu_%7Bt-1%7D)%5E2%20+%20b%20%5Csigma_%7Bt-1%7D%5E2%0A%5Cend%7Bcases%7D%0A"></p>
<p>Pour avoir la dynamique historique de <img src="https://latex.codecogs.com/png.latex?%5Cmu_t"> et <img src="https://latex.codecogs.com/png.latex?%5Csigma_t">, nous allons utiliser les donn√©es historiques de la s√©rie temporelle ainsi que les estimations des param√®tres <img src="https://latex.codecogs.com/png.latex?%5CTheta%20=%20(%5Cmu,%20%5Cvarphi,%20%5Comega,%20a,%20b)"> du mod√®le AR(1)-GARCH(1,1) que nous avons estim√© pr√©c√©demment par maximum de vraisemblance.</p>
<p>Pour <img src="https://latex.codecogs.com/png.latex?t=1">, nous allons initialiser <img src="https://latex.codecogs.com/png.latex?%5Cmu_1"> par la moyenne <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cmu%7D"> et <img src="https://latex.codecogs.com/png.latex?%5Csigma_1"> par la variance √† long terme <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Comega%7D%7B1%20-%20a%20-%20b%7D">.</p>
<div id="199501fd" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(AR1.fit().summary())</span>
<span id="cb27-2"></span>
<span id="cb27-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tester arima avec arch_model ou arch</span></span>
<span id="cb27-4">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AR1.fit().params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb27-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Param√®tre mu: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb27-6">phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AR1.fit().params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb27-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Param√®tre phi: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               SARIMAX Results                                
==============================================================================
Dep. Variable:             log_return   No. Observations:                 3523
Model:                 ARIMA(1, 0, 0)   Log Likelihood               10052.114
Date:                Wed, 11 Feb 2026   AIC                         -20098.227
Time:                        03:02:56   BIC                         -20079.726
Sample:                             0   HQIC                        -20091.627
                               - 3523                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0001      0.000      0.621      0.535      -0.000       0.001
ar.L1         -0.0037      0.012     -0.321      0.748      -0.027       0.019
sigma2         0.0002   2.16e-06     89.947      0.000       0.000       0.000
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):              7957.49
Prob(Q):                              1.00   Prob(JB):                         0.00
Heteroskedasticity (H):               0.61   Skew:                            -0.30
Prob(H) (two-sided):                  0.00   Kurtosis:                        10.34
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
Param√®tre mu: 0.00014959052741773347
Param√®tre phi: -0.003743634042716415</code></pre>
</div>
</div>
<div id="d8ac4b44" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).summary())</span>
<span id="cb29-2">omega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb29-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Param√®tre omega: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>omega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb29-4">a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb29-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Param√®tre alpha: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>a<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb29-6">b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> garch11.fit(disp<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>).params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb29-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Param√®tre beta: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>b<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Zero Mean - GARCH Model Results                        
==============================================================================
Dep. Variable:             log_return   R-squared:                       0.000
Mean Model:                 Zero Mean   Adj. R-squared:                  0.000
Vol Model:                      GARCH   Log-Likelihood:                10638.0
Distribution:                  Normal   AIC:                          -21270.1
Method:            Maximum Likelihood   BIC:                          -21251.6
                                        No. Observations:                 3523
Date:                Wed, Feb 11 2026   Df Residuals:                     3523
Time:                        03:02:57   Df Model:                            0
                              Volatility Model                              
============================================================================
                 coef    std err          t      P&gt;|t|      95.0% Conf. Int.
----------------------------------------------------------------------------
omega      3.8930e-06  4.514e-10   8624.704      0.000 [3.892e-06,3.894e-06]
alpha[1]       0.1000  5.098e-03     19.615  1.161e-85   [9.001e-02,  0.110]
beta[1]        0.8800  7.520e-03    117.017      0.000     [  0.865,  0.895]
============================================================================

Covariance estimator: robust
Param√®tre omega: 3.892997741815931e-06
Param√®tre alpha: 0.1
Param√®tre beta: 0.88</code></pre>
</div>
</div>
<div id="dd3db506" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">T_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_train)</span>
<span id="cb31-2">T_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_test)</span>
<span id="cb31-3"></span>
<span id="cb31-4">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> T_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> T_test</span>
<span id="cb31-5"></span>
<span id="cb31-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des s√©ries</span></span>
<span id="cb31-7">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([data_train, data_test], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb31-8">mu_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(T)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composante moyenne</span></span>
<span id="cb31-9">sigma2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(T)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance conditionnelle</span></span>
<span id="cb31-10"></span>
<span id="cb31-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Conditions initiales</span></span>
<span id="cb31-12">mu_t[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu</span>
<span id="cb31-13">sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> omega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> b)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance de long terme</span></span>
<span id="cb31-14"></span>
<span id="cb31-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation du mod√®le</span></span>
<span id="cb31-16"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, T):</span>
<span id="cb31-17">    mu_t[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Partie moyenne</span></span>
<span id="cb31-18">    sigma2[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> omega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (r[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu_t[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma2[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance conditionnelle</span></span>
<span id="cb31-19"></span>
<span id="cb31-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage des r√©sultats</span></span>
<span id="cb31-21">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>))</span>
<span id="cb31-22"></span>
<span id="cb31-23">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].plot(r, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb31-24">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements $r_t$"</span>)</span>
<span id="cb31-25">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend()</span>
<span id="cb31-26"></span>
<span id="cb31-27">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].plot(mu_t, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb31-28">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Composante moyenne $\mu_t$"</span>)</span>
<span id="cb31-29">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].legend()</span>
<span id="cb31-30"></span>
<span id="cb31-31">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].plot(np.sqrt(sigma2), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb31-32">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√© conditionnelle $\sigma_t$"</span>)</span>
<span id="cb31-33">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>].legend()</span>
<span id="cb31-34"></span>
<span id="cb31-35">plt.tight_layout()</span>
<span id="cb31-36">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-21-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>En analysant la dynamique de <img src="https://latex.codecogs.com/png.latex?%5Cmu_t">, nous constatons que la tendance moyenne est tr√®s semblable √† la s√©rie des log-rendements. Cela est d√ª au fait que le mod√®le AR(1) n‚Äôest pas pertinent pour mod√©liser la s√©rie. En effet, la s√©rie des log-rendements ressemble d√©j√† √† un bruit blanc. Par ailleurs, nous observons de fortes p√©riodes de volatilit√© dans la s√©rie des log-rendements pendant les p√©riodes de crises, i.e.&nbsp;2008-2009 qui correspond √† la crise des subprimes et 2020 qui correspond √† la crise du Covid-19. Le mod√®le GARCH semble bien capturer ces p√©riodes de volatilit√© dans la volatilit√© conditionnelle calibr√©e.</p>
</section>
<section id="i.3.-estimation-de-la-var" class="level3">
<h3 class="anchored" data-anchor-id="i.3.-estimation-de-la-var">I.3. Estimation de la VaR</h3>
<div id="734c03e8" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VaR historique</span></span>
<span id="cb32-2"></span>
<span id="cb32-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> historical_var(data, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>):</span>
<span id="cb32-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR historique</span></span>
<span id="cb32-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb32-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb32-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.percentile(data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha))</span>
<span id="cb32-10"></span>
<span id="cb32-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VaR gaussienne</span></span>
<span id="cb32-12"></span>
<span id="cb32-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> gaussian_var(data, alpha):</span>
<span id="cb32-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb32-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb32-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb32-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-19">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb32-20"></span>
<span id="cb32-21">    mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(data)</span>
<span id="cb32-22">    sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(data)</span>
<span id="cb32-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha))</span>
<span id="cb32-24"></span>
<span id="cb32-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loi de Skew Student par maximum de vraisemblance.</span></span>
<span id="cb32-26"></span>
<span id="cb32-27"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize</span>
<span id="cb32-28"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> t</span>
<span id="cb32-29"></span>
<span id="cb32-30"></span>
<span id="cb32-31"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_pdf(x, mu, sigma, gamma, nu ):</span>
<span id="cb32-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Compute the Skew Student-t probability density function (PDF).</span></span>
<span id="cb32-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-35">    </span>
<span id="cb32-36"></span>
<span id="cb32-37">    t_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt((nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ((x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb32-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PDF of the standard Student-t distribution</span></span>
<span id="cb32-39">    pdf_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.pdf(x , df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>nu,  loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mu, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>sigma)</span>
<span id="cb32-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CDF of the transformed Student-t distribution</span></span>
<span id="cb32-41">    cdf_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.cdf(t_x, df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb32-42"></span>
<span id="cb32-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Skew Student density function</span></span>
<span id="cb32-44">    density <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pdf_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cdf_t</span>
<span id="cb32-45"></span>
<span id="cb32-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> density</span>
<span id="cb32-47"></span>
<span id="cb32-48"></span>
<span id="cb32-49"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_log_likelihood(params, data):</span>
<span id="cb32-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la log-vraisemblance de la loi de Skew Student</span></span>
<span id="cb32-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    params [mu, sigma, gamma, nu]: les param√®tres de la loi</span></span>
<span id="cb32-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb32-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-55">    mu, sigma, gamma, nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params</span>
<span id="cb32-56">    density <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> skew_student_pdf(data , mu, sigma, gamma, nu)</span>
<span id="cb32-57">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log-vraisemblance</span></span>
<span id="cb32-58">    loglik <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(np.log(density))</span>
<span id="cb32-59">    </span>
<span id="cb32-60">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> loglik</span>
<span id="cb32-61"></span>
<span id="cb32-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimisation des param√®tres avec contraintes de positivit√© sur sigma et nu</span></span>
<span id="cb32-63"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_fit(data):</span>
<span id="cb32-64">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-65"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Estimation des param√®tres de la loi de Skew Student</span></span>
<span id="cb32-66"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-67">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial guess</span></span>
<span id="cb32-68">    x0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([np.mean(data), np.std(data), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb32-69"></span>
<span id="cb32-70">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># contraintes</span></span>
<span id="cb32-71">    bounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>), (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>), (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)]</span>
<span id="cb32-72"></span>
<span id="cb32-73">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># optimisation</span></span>
<span id="cb32-74">    res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize(skew_student_log_likelihood, x0, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(data), bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bounds)</span>
<span id="cb32-75"></span>
<span id="cb32-76">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> res.x</span>
<span id="cb32-77"></span>
<span id="cb32-78">params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> skew_student_fit(resid_std)</span>
<span id="cb32-79"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb32-80"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Les param√®tres estim√©s de la loi de Skew Student sont : "</span>)</span>
<span id="cb32-81"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb32-82"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mu : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb32-83"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sigma : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb32-84"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb32-85"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nu : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb32-86"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb32-87"></span>
<span id="cb32-88"></span>
<span id="cb32-89">params_sstd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb32-90">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], </span>
<span id="cb32-91">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb32-92">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb32-93">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nu"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb32-94">}</span>
<span id="cb32-95"></span>
<span id="cb32-96"></span>
<span id="cb32-97"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Int√©gration de la fonction de densit√©</span></span>
<span id="cb32-98"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> integrate</span>
<span id="cb32-99"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize_scalar</span>
<span id="cb32-100"></span>
<span id="cb32-101"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> integrale_SkewStudent(x,params):</span>
<span id="cb32-102">    borne_inf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.inf</span>
<span id="cb32-103">    resultat_integration, erreur <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> integrate.quad(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: skew_student_pdf(x, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params), borne_inf, x)</span>
<span id="cb32-104">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> resultat_integration</span>
<span id="cb32-105"></span>
<span id="cb32-106"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> fonc_minimize(x, alpha,params):</span>
<span id="cb32-107">    value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> integrale_SkewStudent(x,params)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha</span>
<span id="cb32-108">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(value)</span>
<span id="cb32-109"></span>
<span id="cb32-110"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_quantile(alpha,mu, sigma, gamma, nu ):</span>
<span id="cb32-111">    params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb32-112">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span> : mu ,</span>
<span id="cb32-113">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span> : sigma,</span>
<span id="cb32-114">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span> : gamma,</span>
<span id="cb32-115">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nu"</span> : nu</span>
<span id="cb32-116">    }</span>
<span id="cb32-117"></span>
<span id="cb32-118">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb32-119">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Veuillez entrer un niveau alpha entre 0 et 1"</span>)</span>
<span id="cb32-120">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb32-121">        resultat_minimisation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize_scalar(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: fonc_minimize(x, alpha,params))</span>
<span id="cb32-122">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> resultat_minimisation.x</span>
<span id="cb32-123">    </span>
<span id="cb32-124"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : √©crire une fonction qui calcule la VaR skew-student</span></span>
<span id="cb32-125"></span>
<span id="cb32-126"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sstd_var(alpha, params):</span>
<span id="cb32-127">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-128"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR skew student</span></span>
<span id="cb32-129"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb32-130"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb32-131"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-132"></span>
<span id="cb32-133">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>skew_student_quantile(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params)</span>
<span id="cb32-134"></span>
<span id="cb32-135"></span>
<span id="cb32-136"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#### A FAIRE VAR POT et BM</span></span>
<span id="cb32-137"></span>
<span id="cb32-138"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> genextreme <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gev</span>
<span id="cb32-139"></span>
<span id="cb32-140"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb32-141"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb32-142">neg_resid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>resid_std</span>
<span id="cb32-143"></span>
<span id="cb32-144"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_extremes(returns, block_size, min_last_block<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>):</span>
<span id="cb32-145">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-146"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extrait les valeurs extr√™mes d'une s√©rie de rendements par blocs.</span></span>
<span id="cb32-147"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb32-148"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Arguments :</span></span>
<span id="cb32-149"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    returns : pandas Series (index = dates, valeurs = rendements)</span></span>
<span id="cb32-150"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    block_size : int, taille du bloc en nombre de jours</span></span>
<span id="cb32-151"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    min_last_block : float, proportion minimale pour inclure le dernier bloc incomplet</span></span>
<span id="cb32-152"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb32-153"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retourne :</span></span>
<span id="cb32-154"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    maxima_sample : liste des valeurs maximales par bloc</span></span>
<span id="cb32-155"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    maxima_dates : liste des dates associ√©es aux valeurs maximales</span></span>
<span id="cb32-156"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-157">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(returns)</span>
<span id="cb32-158">    num_blocks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> block_size</span>
<span id="cb32-159"></span>
<span id="cb32-160">    maxima_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb32-161">    maxima_dates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb32-162"></span>
<span id="cb32-163">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_blocks):</span>
<span id="cb32-164">        block_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb32-165">        block_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb32-166">        block_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.iloc[block_start:block_end]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S√©lectionner le bloc avec les index</span></span>
<span id="cb32-167"></span>
<span id="cb32-168">        max_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb32-169">        max_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.idxmax()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©cup√©rer l'index de la valeur max</span></span>
<span id="cb32-170"></span>
<span id="cb32-171">        maxima_sample.append(max_value)</span>
<span id="cb32-172">        maxima_dates.append(max_date)</span>
<span id="cb32-173"></span>
<span id="cb32-174">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gestion du dernier bloc s'il reste des donn√©es suffisantes</span></span>
<span id="cb32-175">    block_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_blocks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb32-176">    block_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.iloc[block_start:]</span>
<span id="cb32-177"></span>
<span id="cb32-178">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(block_data) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> min_last_block <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size:</span>
<span id="cb32-179">        max_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb32-180">        max_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.idxmax()</span>
<span id="cb32-181">        </span>
<span id="cb32-182">        maxima_sample.append(max_value)</span>
<span id="cb32-183">        maxima_dates.append(max_date)</span>
<span id="cb32-184">        </span>
<span id="cb32-185">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pd.Series(maxima_sample, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>maxima_dates)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retourner une Series avec les dates comme index</span></span>
<span id="cb32-186"></span>
<span id="cb32-187"></span>
<span id="cb32-188"></span>
<span id="cb32-189"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> BM_var(alpha,s,shape,loc,scale):</span>
<span id="cb32-190">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-191"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb32-192"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance de la VaR</span></span>
<span id="cb32-193"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    s : le nombre de jours dans un bloc</span></span>
<span id="cb32-194"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-195">    alpha_bm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha)</span>
<span id="cb32-196"></span>
<span id="cb32-197">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> gev.ppf(alpha_bm, shape, loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loc, scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale),alpha_bm</span>
<span id="cb32-198"></span>
<span id="cb32-199">extremes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_extremes(neg_resid, block_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, min_last_block<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb32-200">params_gev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gev.fit(extremes)</span>
<span id="cb32-201"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb32-202"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Les param√®tres estim√©s de la loi de GEV sont : "</span>)</span>
<span id="cb32-203"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb32-204"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Shape (xi) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gev[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-205"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Localisation (mu) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gev[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-206"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Echelle (sigma) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gev[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-207"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb32-208"></span>
<span id="cb32-209"></span>
<span id="cb32-210"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> POT_var(data,alpha,u,shape,loc,scale):</span>
<span id="cb32-211">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb32-212"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb32-213"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance de la VaR</span></span>
<span id="cb32-214"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    s : le nombre de jours dans un bloc</span></span>
<span id="cb32-215"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb32-216">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data)</span>
<span id="cb32-217">    excess_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> u <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> u]</span>
<span id="cb32-218">    nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(excess_values)</span>
<span id="cb32-219"></span>
<span id="cb32-220">    alpha_pot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>nu</span>
<span id="cb32-221"></span>
<span id="cb32-222">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> genpareto.ppf(alpha_pot, shape, loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loc, scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> u,alpha_pot</span>
<span id="cb32-223"></span>
<span id="cb32-224"></span>
<span id="cb32-225">u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span></span>
<span id="cb32-226">excess_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> u <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> neg_resid <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> u]</span>
<span id="cb32-227"></span>
<span id="cb32-228"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> genpareto</span>
<span id="cb32-229"></span>
<span id="cb32-230">params_gpd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> genpareto.fit(excess_values)</span>
<span id="cb32-231"></span>
<span id="cb32-232"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afficher les param√®tres estim√©s</span></span>
<span id="cb32-233"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb32-234"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Param√®tres estim√©s de la distribution GPD:"</span>)</span>
<span id="cb32-235"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Shape (xi) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-236"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Localisation (mu) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-237"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Echelle (sigma) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb32-238"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Les param√®tres estim√©s de la loi de Skew Student sont : 
---------------
Mu :  0.4250705574852528
Sigma :  0.8686243849485155
Gamma :  -0.6074103171572136
Nu :  5.607563514180729
================================================================================
================================================================================
Les param√®tres estim√©s de la loi de GEV sont : 
---------------
Shape (xi) = -0.01
Localisation (mu) = 1.64
Echelle (sigma) = 0.72
================================================================================
================================================================================
Param√®tres estim√©s de la distribution GPD:
Shape (xi) = -0.04
Localisation (mu) = 0.00
Echelle (sigma) = 0.80
================================================================================</code></pre>
</div>
</div>
<div id="3eaf6947" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1">alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb34-2"></span>
<span id="cb34-3">var_hist_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> historical_var(resid_std, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span>
<span id="cb34-4">var_gauss_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gaussian_var(resid_std, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span>
<span id="cb34-5">var_sstd_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sstd_var(alpha, params_sstd)</span>
<span id="cb34-6">var_BM_train,_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BM_var(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gev)</span>
<span id="cb34-7">var_POT_train,_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> POT_var(neg_resid, alpha, u,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gpd)</span>
<span id="cb34-8"></span>
<span id="cb34-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># in a df</span></span>
<span id="cb34-10">var <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb34-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Historique'</span>: [var_hist_train],</span>
<span id="cb34-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gaussienne'</span>: [var_gauss_train],</span>
<span id="cb34-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Skew Student'</span>: [var_sstd_train],</span>
<span id="cb34-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Block Maxima'</span>: [var_BM_train],</span>
<span id="cb34-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Peak Over Threshold'</span>: [var_POT_train]</span>
<span id="cb34-16">})</span>
<span id="cb34-17"></span>
<span id="cb34-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb34-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value at Risk sur les r√©sidus studentis√©s (en %) pour h=1j"</span>)</span>
<span id="cb34-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>var,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb34-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Value at Risk sur les r√©sidus studentis√©s (en %) pour h=1j
   Historique  Gaussienne  Skew Student  Block Maxima  Peak Over Threshold
0      264.12      229.76        280.29        268.68               284.98
================================================================================</code></pre>
</div>
</div>
<section id="a.-var-historique-dynamique" class="level4">
<h4 class="anchored" data-anchor-id="a.-var-historique-dynamique">a. VaR historique dynamique</h4>
<div id="ce51448a" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1">var_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(T_test)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Composante moyenne</span></span>
<span id="cb36-2">nb_exp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb36-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(T_test):</span>
<span id="cb36-4">    var_t[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (mu_t[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>T_train] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.sqrt(sigma2[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>T_train])<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>var_hist_train)</span>
<span id="cb36-5">    nb_exp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> (r[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>T_train] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> var_t[t]).astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb36-6">    </span>
<span id="cb36-7">var_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Series(var_t, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_test.index)</span>
<span id="cb36-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Nombre d'exceptions = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>nb_exp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> sur </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>T_test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> jours"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nombre d'exceptions = 4 sur 586 jours</code></pre>
</div>
</div>
<div id="33fb3547" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb38-2">plt.plot(data_train, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Train'</span>)</span>
<span id="cb38-3">plt.plot(data_test, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Test'</span>)</span>
<span id="cb38-4">plt.plot(var_t, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'VaR dynamique'</span>)</span>
<span id="cb38-5">plt.axvline(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_test.index[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>)</span>
<span id="cb38-6">plt.legend()</span>
<span id="cb38-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'S√©rie des log-rendements et VaR dynamique'</span>)</span>
<span id="cb38-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e676e120" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb39-2">plt.plot(data_test, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"orange"</span>)</span>
<span id="cb39-3">plt.plot(var_t, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb39-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Zoom sur la VaR dynamique'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>Text(0.5, 1.0, 'Zoom sur la VaR dynamique')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch_files/figure-html/cell-26-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="60666494" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># backtest √† faire (optionnel)</span></span></code></pre></div>
</div>


</section>
</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>risques-fin</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_garch.html</guid>
  <pubDate>Thu, 27 Feb 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>TP2:M√©thodes bas√©es sur la th√©orie des valeurs extr√™mes</title>
  <dc:creator>Cheryl Kouadio</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt.html</link>
  <description><![CDATA[ 




<p>Ce TP est une continuit√© du TP-1 dans lequel on souhaitait impl√©menter la VaR (Value at Risk) et l‚ÄôES (Expected Shortfall) en utilisant les m√©thodes classiques propos√©es dans la r√©glementation b√¢loise, i.e.&nbsp;la m√©thode historique, param√©trique et bootstrap. Cependant, une limite de ces m√©thodes est qu‚Äôelles ne prennent pas en compte la queue de distribution de la perte. Pour rem√©dier √† cela, on peut utiliser des m√©thodes avec la th√©orie des valeurs extr√™mes, i.e.&nbsp;l‚Äôapproche Block Maxima et l‚Äôapproche Peaks Over Threshold.</p>
<div id="37b4a204" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des librairies</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yfinance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> yf</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-6">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tqdm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tqdm</span></code></pre></div>
</div>
<div id="3d66944c" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import des donn√©es du CAC 40</span></span>
<span id="cb2-2">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.download(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FCHI"</span>,start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008-01-01"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des rendements logarithmiques</span></span>
<span id="cb2-5">data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>].shift(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retirer la premi√®re ligne</span></span>
<span id="cb2-8">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.dropna()</span>
<span id="cb2-9">data.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.columns.get_level_values(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="9b49fdeb" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>]][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'15-10-2008'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'26-07-2022'</span>]</span>
<span id="cb4-2">data_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>]</span>
<span id="cb4-3">neg_data_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>data_train</span>
<span id="cb4-4"></span>
<span id="cb4-5">test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>]][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'27-07-2022'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'11-06-2024'</span>]</span>
<span id="cb4-6">data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> test[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>]</span>
<span id="cb4-7">neg_data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>data_test</span></code></pre></div>
</div>
<section id="i.-impl√©mentation-de-la-var-avec-la-th√©orie-des-valeurs-extr√™mes" class="level2">
<h2 class="anchored" data-anchor-id="i.-impl√©mentation-de-la-var-avec-la-th√©orie-des-valeurs-extr√™mes">I. Impl√©mentation de la VaR avec la th√©orie des valeurs extr√™mes</h2>
<section id="i.1.-var-tve-approche-maxima-par-bloc" class="level3">
<h3 class="anchored" data-anchor-id="i.1.-var-tve-approche-maxima-par-bloc">I.1. VaR TVE : Approche Maxima par bloc</h3>
<p>L‚Äôapproche des Block Maxima (BM) est une m√©thode mod√©lise les maxima des rendements sur des blocs de taille fixe <img src="https://latex.codecogs.com/png.latex?s"> en utilisant la distribution GEV. Le seuil de confiance <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B%5Ctext%7BGEV%7D%7D"> est ajust√© pour correspondre √† l‚Äôhorizon temporel de la VaR via la relation :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B1%7D%7B1-%5Calpha_%7B%5Ctext%7BVaR%7D%7D%7D%20=%20s%20%5Ctimes%20%5Cfrac%7B1%7D%7B1-%5Calpha_%7B%5Ctext%7BGEV%7D%7D%7D.%0A"></p>
<p>Nous allons dans ce projet une taille de blocs <img src="https://latex.codecogs.com/png.latex?s%20=%2021"> jours ouvr√©s comme ce qui souvent utilis√© en pratique. De ce fait, nous parvenons √† construire 239 blocs de taille 21 et un bloc de taille De fait, la Value-at-Risk sur un horizon 1 et pour un niveau de confiance $ _{}$ est :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVaR%7D_h(%5Calpha_%7B%5Ctext%7BVaR%7D%7D)%20=%20G%5E%7B-1%7D_%7B(%5Chat%20%5Cmu,%20%5Chat%20%5Csigma,%20%5Chat%20%5Cxi)%7D(%5Calpha_%7B%5Ctext%7BGEV%7D%7D),%0A"></p>
<p>o√π G est la fonction de r√©partition de la GEV (<img src="https://latex.codecogs.com/png.latex?%5Chat%20%5Cmu,%20%5Chat%20%5Csigma,%20%5Chat%20%5Cxi">) estim√©e.</p>
</section>
<section id="i.1.1.-construction-de-l√©chantillon-de-maxima-sur-data_train" class="level3">
<h3 class="anchored" data-anchor-id="i.1.1.-construction-de-l√©chantillon-de-maxima-sur-data_train">I.1.1. Construction de l‚Äô√©chantillon de maxima sur data_train</h3>
<div id="6bf1bfce" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_extremes(returns, block_size, min_last_block<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>):</span>
<span id="cb5-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extrait les valeurs extr√™mes d'une s√©rie de rendements par blocs.</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Arguments :</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    returns : pandas Series (index = dates, valeurs = rendements)</span></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    block_size : int, taille du bloc en nombre de jours</span></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    min_last_block : float, proportion minimale pour inclure le dernier bloc incomplet</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retourne :</span></span>
<span id="cb5-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    maxima_sample : liste des valeurs maximales par bloc</span></span>
<span id="cb5-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    maxima_dates : liste des dates associ√©es aux valeurs maximales</span></span>
<span id="cb5-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb5-17">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(returns)</span>
<span id="cb5-18">    num_blocks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">//</span> block_size</span>
<span id="cb5-19"></span>
<span id="cb5-20">    maxima_sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-21">    maxima_dates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb5-22"></span>
<span id="cb5-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(num_blocks):</span>
<span id="cb5-24">        block_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb5-25">        block_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb5-26">        block_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.iloc[block_start:block_end]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S√©lectionner le bloc avec les index</span></span>
<span id="cb5-27"></span>
<span id="cb5-28">        max_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb5-29">        max_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.idxmax()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©cup√©rer l'index de la valeur max</span></span>
<span id="cb5-30"></span>
<span id="cb5-31">        maxima_sample.append(max_value)</span>
<span id="cb5-32">        maxima_dates.append(max_date)</span>
<span id="cb5-33"></span>
<span id="cb5-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gestion du dernier bloc s'il reste des donn√©es suffisantes</span></span>
<span id="cb5-35">    block_start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> num_blocks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size</span>
<span id="cb5-36">    block_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> returns.iloc[block_start:]</span>
<span id="cb5-37"></span>
<span id="cb5-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(block_data) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> min_last_block <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> block_size:</span>
<span id="cb5-39">        max_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb5-40">        max_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> block_data.idxmax()</span>
<span id="cb5-41">        </span>
<span id="cb5-42">        maxima_sample.append(max_value)</span>
<span id="cb5-43">        maxima_dates.append(max_date)</span>
<span id="cb5-44">        </span>
<span id="cb5-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> pd.Series(maxima_sample, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>maxima_dates)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retourner une Series avec les dates comme index</span></span>
<span id="cb5-46"></span>
<span id="cb5-47"></span>
<span id="cb5-48">extremes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_extremes(neg_data_train, block_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, min_last_block<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>)</span>
<span id="cb5-49"></span>
<span id="cb5-50">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb5-51">plt.plot(data_train, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>)</span>
<span id="cb5-52">plt.plot(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>extremes,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"."</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb5-53">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Series des rendements du CAC 40 avec les pertes extr√™mes"</span>)</span>
<span id="cb5-54">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>)</span>
<span id="cb5-55">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>)</span>
<span id="cb5-56">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Pour avoir une id√©e de la distribution GEV de la serie des pertes maximales de rendements du CAC 40 pour <img src="https://latex.codecogs.com/png.latex?s=21">, nous utilisons un Gumbel plot qui est un outil graphique pour juger de l‚Äôhypoth√®se <img src="https://latex.codecogs.com/png.latex?%5Cxi=0">, i.e.&nbsp;la distribution GEV se r√©duit √† la distribution de Gumbel.</p>
<p>Pour le construire, nous devons suivre les √©tapes suivantes :</p>
<ol type="1">
<li>calculer l‚Äôabscisse avec la s√©rie des maximas ordon√©es <img src="https://latex.codecogs.com/png.latex?R_%7B(1)%7D%20%5Cleq%20R_%7B(2)%7D%20%5Cleq%20%5Cldots%20%5Cleq%20R_%7B(n)%7D">.</li>
<li>calculer l‚Äôordonn√©e de la mani√®re suivante :</li>
</ol>
<p><img src="https://latex.codecogs.com/png.latex?%0A-%20log(-log(%5Cfrac%7Bi%20-%200.5%7D%7Bk%7D)),%20%5Cquad%20i%20=%201,%20%5Cldots,%20k.%0A"></p>
<p>Lorsque la distribution adapt√©e est celle de Gumbel alors le Gumbel plot est lin√©aire. Dans notre cas, nous constatons une courbure ce qui nous pousse √† conclure qu‚Äôune distribution Gumbel n‚Äôest pas adapt√©e dans la mod√©lisation des maxima des pertes de rendements du CAC 40. Une distribution Fr√©chet ou de Weibull serait plus adapt√©e.</p>
<div id="9421c345" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">quantiles_theoriques_gumbel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb6-2">k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(extremes)</span>
<span id="cb6-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(extremes)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb6-4">    val <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.log(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.log((i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>k))</span>
<span id="cb6-5">    quantiles_theoriques_gumbel.append(val)</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tracer le Gumbel plot</span></span>
<span id="cb6-8">plt.scatter(quantiles_theoriques_gumbel, np.sort(extremes), marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb6-9">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rendements CAC 40 - Gumbel plot'</span>)</span>
<span id="cb6-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="i.1.2.-estimation-des-param√®tres-de-la-loi-de-gev" class="level3">
<h3 class="anchored" data-anchor-id="i.1.2.-estimation-des-param√®tres-de-la-loi-de-gev">I.1.2. Estimation des param√®tres de la loi de GEV</h3>
<p>En estimant les param√®tres de la loi GEV, nous utilisons la m√©thode du maximum de vraisemblance. Les param√®tres estim√©s par maximisation de la fonction de vraisemblance sont les suivants <img src="https://latex.codecogs.com/png.latex?%5Cxi%20=%20-0.15,%20%5Cmu=0.02,%20%5Csigma=0.01">. Nous constatons par ailleurs que le param√®tre de forme <img src="https://latex.codecogs.com/png.latex?%5Cxi"> est n√©gatif ce qui est coh√©rent avec notre observation pr√©c√©dente.</p>
<div id="445b584c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> genextreme <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> gev</span>
<span id="cb7-2"></span>
<span id="cb7-3">params_gev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gev.fit(extremes)</span>
<span id="cb7-4"></span>
<span id="cb7-5">shape, loc, scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params_gev</span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afficher les param√®tres estim√©s</span></span>
<span id="cb7-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb7-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Param√®tres estim√©s de la distribution GEV"</span>)</span>
<span id="cb7-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb7-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Shape (xi) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>shape<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Loc (mu) =  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>loc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Scale (sigma) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>scale<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
Param√®tres estim√©s de la distribution GEV
==================================================
Shape (xi) = -0.15
Loc (mu) =  0.02
Scale (sigma) = 0.01
==================================================</code></pre>
</div>
</div>
<p>Pour accorder plus de poids √† cette observation, nous avons calcul√© un intervalle de confiance profil√© √† 95% pour le param√®tre de forme <img src="https://latex.codecogs.com/png.latex?%5Cxi">. Pour ce faire, nous avons suivi les √©tapes suivantes : 1. Estimation des param√®tres par maximum de vraisemblance : Nous avons estim√© <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cxi%7D">, <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cmu%7D"> et <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Csigma%7D"> en maximisant la log-vraisemblance de la loi GEV.</p>
<ol start="2" type="1">
<li><p>Construction du profil de vraisemblance : Nous avons fix√© <img src="https://latex.codecogs.com/png.latex?%5Cxi"> √† diff√©rentes valeurs autour de <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cxi%7D"> et, pour chacune, r√©estim√© <img src="https://latex.codecogs.com/png.latex?%5Cmu"> et <img src="https://latex.codecogs.com/png.latex?%5Csigma"> afin d‚Äôobtenir une log-vraisemblance profil√©e.</p></li>
<li><p>Seuil bas√© sur le test du rapport de vraisemblance : Le seuil critique est d√©termin√© par la statistique $ ^2(1) $ :<br>
<img src="https://latex.codecogs.com/png.latex?%0A%5Cmathcal%7BL%7D_%7B%5Cmax%7D%20-%20%5Cfrac%7B%5Cchi%5E2_%7B0.95,%201%7D%7D%7B2%7D%0A"></p></li>
<li><p>D√©termination des bornes de l‚ÄôIC : L‚Äôintervalle est form√© par les valeurs de <img src="https://latex.codecogs.com/png.latex?%5Cxi"> pour lesquelles la log-vraisemblance reste au-dessus de ce seuil.</p></li>
</ol>
<p>Cette approche permet une meilleure prise en compte de l‚Äôincertitude en √©vitant les approximations asymptotiques classiques. La mod√©lisation des maxima des pertes de rendements du CAC 40 par une distribution de Weibull serait plus adapt√©e.</p>
<p>Nous obtenons ainsi un intervalle de confiance √† 95% pour le param√®tre de forme <img src="https://latex.codecogs.com/png.latex?%5Cxi"> de <img src="https://latex.codecogs.com/png.latex?%5B-0.284,%20-0.039%5D">. Comme 0 n‚Äôappartient pas √† cet intervalle, nous pouvons rejeter l‚Äôhypoth√®se <img src="https://latex.codecogs.com/png.latex?%5Cxi=0">. De ce fait, la distribution de Weibull est plus adapt√©e pour mod√©liser les maxima des pertes de rendements du CAC 40 car <img src="https://latex.codecogs.com/png.latex?%5Cxi"> est n√©gatif.</p>
<div id="147a57e1" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize</span>
<span id="cb9-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> chi2</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fonction de log-vraisemblance</span></span>
<span id="cb9-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> gev_neg_log_likelihood(params, shape_fixed, data):</span>
<span id="cb9-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb9-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcule la log-vraisemblance n√©gative de la distribution GEV</span></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    en fixant le param√®tre 'shape'.</span></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb9-10">    loc, scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params</span>
<span id="cb9-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contrainte pour √©viter des valeurs invalides</span></span>
<span id="cb9-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.inf</span>
<span id="cb9-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(gev.logpdf(data, shape_fixed, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>loc, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>scale))</span>
<span id="cb9-14"></span>
<span id="cb9-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Log-vraisemblance maximale</span></span>
<span id="cb9-16">log_likelihood_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>gev_neg_log_likelihood([loc, scale], shape, extremes)</span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des IC profil√©s pour le param√®tre shape</span></span>
<span id="cb9-19">shape_grid <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(shape <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, shape <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plage autour de la valeur estim√©e</span></span>
<span id="cb9-20">profile_likelihood <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb9-21"></span>
<span id="cb9-22"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> s <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> shape_grid:</span>
<span id="cb9-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©optimiser loc et scale en fixant shape</span></span>
<span id="cb9-24">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize(</span>
<span id="cb9-25">        gev_neg_log_likelihood,</span>
<span id="cb9-26">        x0<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[loc, scale],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial guess for loc and scale</span></span>
<span id="cb9-27">        args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(s, extremes),  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fixer 'shape' √† la valeur actuelle</span></span>
<span id="cb9-28">        bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>), (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-5</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Contraintes sur loc et scale</span></span>
<span id="cb9-29">        method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'L-BFGS-B'</span></span>
<span id="cb9-30">    )</span>
<span id="cb9-31">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> result.success:</span>
<span id="cb9-32">        profile_likelihood.append(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>result.fun)</span>
<span id="cb9-33">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb9-34">        profile_likelihood.append(np.nan)</span>
<span id="cb9-35"></span>
<span id="cb9-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du seuil pour les IC</span></span>
<span id="cb9-37">chi2_threshold <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> log_likelihood_max <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> chi2.ppf(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb9-38"></span>
<span id="cb9-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©terminer les bornes des IC</span></span>
<span id="cb9-40">profile_likelihood <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array(profile_likelihood)</span>
<span id="cb9-41">valid_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.where(profile_likelihood <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> chi2_threshold)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb9-42"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(valid_points) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb9-43">    lower_bound <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> shape_grid[valid_points[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]]</span>
<span id="cb9-44">    upper_bound <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> shape_grid[valid_points[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb9-45">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"IC profil√© pour shape: [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lower_bound<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>upper_bound<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">]"</span>)</span>
<span id="cb9-46"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb9-47">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Impossible de d√©terminer des IC profil√©s avec les param√®tres actuels."</span>)</span>
<span id="cb9-48"></span>
<span id="cb9-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Trac√© du profil de log-vraisemblance</span></span>
<span id="cb9-50">plt.plot(shape_grid, profile_likelihood, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-likelihood"</span>)</span>
<span id="cb9-51">plt.axhline(chi2_threshold, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"95% Confidence threshold"</span>)</span>
<span id="cb9-52">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shape"</span>)</span>
<span id="cb9-53">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Profile log-likelihood"</span>)</span>
<span id="cb9-54">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Profile log-likelihood for shape parameter"</span>)</span>
<span id="cb9-55">plt.legend()</span>
<span id="cb9-56">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>IC profil√© pour shape: [-0.287, -0.042]</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="a.-validation-ex-ante" class="level4">
<h4 class="anchored" data-anchor-id="a.-validation-ex-ante">a. Validation ex-ante</h4>
<p>On remarque la loi GEV estim√©e par une weibull semble coller √† la distribution des rendements extr√™mes du CAC 40. De plus, en utilisant un QQ-plot, nous constatons que les quantiles th√©oriques de la GEV-Weibull et empiriques sembelnt align√©s sauf pour les quantiles √©l√©v√©s o√π l‚Äôon constate un d√©crochage.</p>
<div id="a28cdc63" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb11-2">plt.hist(extremes, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Maxima observ√©es'</span>)</span>
<span id="cb11-3"></span>
<span id="cb11-4">xmin, xmax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.xlim()</span>
<span id="cb11-5">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(xmin, xmax, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb11-6">p_gev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gev.pdf(x, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gev)</span>
<span id="cb11-7">plt.plot(x, p_gev, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GEV ajust√©e'</span>)</span>
<span id="cb11-8">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ajustement de la distribution GEV"</span>)</span>
<span id="cb11-9">plt.legend()</span>
<span id="cb11-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c14cfe3d" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1">niveaux_quantiles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span>
<span id="cb12-2">quantiles_empiriques_TVE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.quantile(extremes, niveaux_quantiles) </span>
<span id="cb12-3">quantiles_theoriques_GEV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gev.ppf(niveaux_quantiles, shape, loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loc, scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale)</span>
<span id="cb12-4"></span>
<span id="cb12-5">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb12-6">plt.scatter(quantiles_theoriques_GEV, quantiles_empiriques_TVE)</span>
<span id="cb12-7">plt.plot(quantiles_theoriques_GEV, quantiles_theoriques_GEV, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dashed'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Premi√®re bissectrice'</span>)</span>
<span id="cb12-8">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QQ Plot d'une mod√©lisation par loi GEV"</span>)</span>
<span id="cb12-9">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles th√©oriques (Loi GEV)'</span>)</span>
<span id="cb12-10">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles empiriques'</span>)</span>
<span id="cb12-11">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb12-12">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="b.-calcul-de-la-var-tve-par-mb" class="level4">
<h4 class="anchored" data-anchor-id="b.-calcul-de-la-var-tve-par-mb">b. Calcul de la VaR TVE par MB</h4>
<p>Pour calculer la VaR TVE pour un horizon de 1jour par MB, nous utilisons la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVaR%7D_h(%5Calpha_%7B%5Ctext%7BVaR%7D%7D)%20=%20G%5E%7B-1%7D_%7B(%5Chat%20%5Cmu,%20%5Chat%20%5Csigma,%20%5Chat%20%5Cxi)%7D(%5Calpha_%7B%5Ctext%7BGEV%7D%7D),%0A"></p>
<p>o√π G est la fonction de r√©partition de la GEV<img src="https://latex.codecogs.com/png.latex?(%5Chat%20%5Cmu,%20%5Chat%20%5Csigma,%20%5Chat%20%5Cxi)"> estim√©e, et <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B%5Ctext%7BGEV%7D%7D"> est ajust√© pour correspondre √† l‚Äôhorizon temporel de la VaR via la relation :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B1%7D%7B1-%5Calpha_%7B%5Ctext%7BVaR%7D%7D%7D%20=%20s%20%5Ctimes%20%5Cfrac%7B1%7D%7B1-%5Calpha_%7B%5Ctext%7BGEV%7D%7D%7D.%0A"></p>
<p>Pour convertir la VaR √† horizon 1jour en VaR √† horizon T jours, la m√©thode de scaling soul√®ve quelques questions, car elle repose essentiellement sur la normalit√© et l‚Äôind√©pendance des rendements ce qui n‚Äôest pas le cas en pratique. De ce fait, nous utiliserons la m√©thode alternative reposant sur la th√©orie des valeurs extr√™mes.</p>
<p>y revenir</p>
<div id="778b6ae0" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> BM_var(alpha,s,shape,loc,scale):</span>
<span id="cb13-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb13-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance de la VaR</span></span>
<span id="cb13-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    s : le nombre de jours dans un bloc</span></span>
<span id="cb13-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb13-7">    alpha_bm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha)</span>
<span id="cb13-8"></span>
<span id="cb13-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> gev.ppf(alpha_bm, shape, loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loc, scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale),alpha_bm</span>
<span id="cb13-10"></span>
<span id="cb13-11">alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb13-12">var_BM_train,alpha_bm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BM_var(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, shape, loc, scale)</span>
<span id="cb13-13"></span>
<span id="cb13-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR TVE pour h=1j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_BM_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR TVE pour h=10j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>alpha_bm)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>var_BM_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR TVE pour h=1j et alpha=0.99 est : 3.3274%
La VaR TVE pour h=10j et alpha=0.99 est : 20.5167%</code></pre>
</div>
</div>
</section>
</section>
<section id="i.1.3.-estimation-des-param√®tres-de-la-loi-de-ev" class="level3">
<h3 class="anchored" data-anchor-id="i.1.3.-estimation-des-param√®tres-de-la-loi-de-ev">I.1.3. Estimation des param√®tres de la loi de EV</h3>
<p>Bien que l‚Äôintervalle de confiance √† 95% pour le param√®tre de forme <img src="https://latex.codecogs.com/png.latex?%5Cxi"> de <img src="https://latex.codecogs.com/png.latex?%5B-0.284,%20-0.039%5D"> ne contienne pas 0, nous avons tout de m√™me estim√© les param√®tres de la loi EV pour comparer les r√©sultats avec ceux de la loi GEV. En estimant tout de m√™me les param√®tres de la loi EV, nous obtenons les param√®tres suivants : <img src="https://latex.codecogs.com/png.latex?%5Cmu=0.02,%20%5Csigma=0.01,%20%5Cxi=0">.</p>
<p>Nous constatons que la loi EV ne semble pas mal s‚Äôadapter √† la distribution des rendements extr√™mes du CAC 40.</p>
<div id="9235a30f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> gumbel_r</span>
<span id="cb15-2"></span>
<span id="cb15-3">params_gumbel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gumbel_r.fit(extremes)</span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afficher les param√®tres estim√©s</span></span>
<span id="cb15-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb15-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Param√®tres estim√©s de la distribution GEV GUMBEL"</span>)</span>
<span id="cb15-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb15-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Loc (mu) =  </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gumbel[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb15-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Scale (sigma) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gumbel[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb15-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
Param√®tres estim√©s de la distribution GEV GUMBEL
==================================================
Loc (mu) =  0.02
Scale (sigma) = 0.01
==================================================</code></pre>
</div>
</div>
<div id="e8a2ec52" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb17-2">plt.hist(extremes, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Maxima observ√©es'</span>)</span>
<span id="cb17-3"></span>
<span id="cb17-4">xmin, xmax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.xlim()</span>
<span id="cb17-5">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(xmin, xmax, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb17-6"></span>
<span id="cb17-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© GEV ajust√©e</span></span>
<span id="cb17-8">p_gev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gev.pdf(x, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gev)</span>
<span id="cb17-9">plt.plot(x, p_gev, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'k'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GEV ajust√©e'</span>)</span>
<span id="cb17-10"></span>
<span id="cb17-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© Gumbel ajust√©e</span></span>
<span id="cb17-12">p_gumbel <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gumbel_r.pdf(x, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gumbel)</span>
<span id="cb17-13">plt.plot(x, p_gumbel, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gumbel ajust√©e'</span>)</span>
<span id="cb17-14">title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comparaison GEV vs Gumbel"</span></span>
<span id="cb17-15">plt.title(title)</span>
<span id="cb17-16">plt.legend()</span>
<span id="cb17-17">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="81a72935" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">quantiles_theoriques_Gumb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gumbel_r.ppf(niveaux_quantiles, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gumbel)</span>
<span id="cb18-2"></span>
<span id="cb18-3">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb18-4">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb18-5">plt.scatter(quantiles_theoriques_GEV, quantiles_empiriques_TVE)</span>
<span id="cb18-6">plt.plot(quantiles_theoriques_GEV, quantiles_theoriques_GEV, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dashed'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Premi√®re bissectrice'</span>)</span>
<span id="cb18-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QQ Plot d'une mod√©lisation par loi GEV Weibull"</span>)</span>
<span id="cb18-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles th√©oriques'</span>)</span>
<span id="cb18-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles empiriques'</span>)</span>
<span id="cb18-10">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb18-11"></span>
<span id="cb18-12"></span>
<span id="cb18-13">plt.subplot(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb18-14">plt.scatter(quantiles_theoriques_Gumb, quantiles_empiriques_TVE)</span>
<span id="cb18-15">plt.plot(quantiles_theoriques_Gumb, quantiles_theoriques_Gumb, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'dashed'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Premi√®re bissectrice'</span>)</span>
<span id="cb18-16">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QQ Plot d'une mod√©lisation par loi Gumbel"</span>)</span>
<span id="cb18-17">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles th√©oriques'</span>)</span>
<span id="cb18-18">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles empiriques'</span>)</span>
<span id="cb18-19">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb18-20"></span>
<span id="cb18-21">plt.tight_layout()</span>
<span id="cb18-22">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1111bad6" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb19-2">var_BM_train,alpha_bm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BM_var(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>, shape<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params_gumbel[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>params_gumbel[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb19-3"></span>
<span id="cb19-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR TVE Gumbel pour h=1j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_BM_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR TVE Gumbel pour h=10j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>alpha_bm)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>var_BM_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR TVE Gumbel pour h=1j et alpha=0.99 est : 3.3513%
La VaR TVE Gumbel pour h=10j et alpha=0.99 est : 20.6638%</code></pre>
</div>
</div>
<p>De plus, les r√©sultats en terme de VaR sont tr√®s proches entre les deux mod√®les.</p>
</section>
</section>
<section id="i.2.-var-tve-approche-peak-over-threshold" class="level2">
<h2 class="anchored" data-anchor-id="i.2.-var-tve-approche-peak-over-threshold">I.2. VaR TVE : Approche Peak over threshold</h2>
<section id="i.2.1.-choix-du-seuil-u" class="level3">
<h3 class="anchored" data-anchor-id="i.2.1.-choix-du-seuil-u">I.2.1. Choix du seuil u</h3>
<p>Cette m√©thode est bas√©e sur la mod√©lisation de la distribution des exc√®s au-dessus d‚Äôun seuil √©lev√© de log-rendement n√©gatif (<img src="https://latex.codecogs.com/png.latex?u">), seuil d√©termin√© de mani√®re subjective √† partir de l‚Äôanalyse du mean residual life plot, en ajustant une distribution de Pareto g√©n√©ralis√©e (GPD). Dans le mean residual life plot, si les exc√®s au-del√† de ùíñ suivent une loi GPD, alors le mean-excess plot a un comportement lin√©aire. On cherche alors la valeur du seuil $$ pour laquelle le mean-excess plot est lin√©aire. Nous ne privil√©gions pas les seuils <img src="https://latex.codecogs.com/png.latex?u"> √©lev√©s puisque la moyenne est faite sur peu d‚Äôobservations.</p>
<p>Nous allons choisir un seuil <img src="https://latex.codecogs.com/png.latex?u%20=%200.03"> pour lequel le mean residual life plot est lin√©aire. Nous allons ensuite ajuster une distribution GPD pour les exc√®s au-dessus de ce seuil.</p>
<div id="e61484c3" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb21-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb21-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm, genpareto</span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> mean_residual_life_plot(data, tlim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, pscale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, nt<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, conf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, return_values<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb21-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Trace le Mean Residual Life (MRL) Plot pour identifier un seuil optimal pour une GPD.</span></span>
<span id="cb21-8"></span>
<span id="cb21-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Param√®tres :</span></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - data : array-like, donn√©es d'entr√©e.</span></span>
<span id="cb21-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - tlim : tuple (min, max), limites des seuils (si None, calcul√© automatiquement).</span></span>
<span id="cb21-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - pscale : bool, si True, utilise des quantiles au lieu de valeurs absolues.</span></span>
<span id="cb21-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - nt : int, nombre de seuils √† consid√©rer.</span></span>
<span id="cb21-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - conf : float, niveau de confiance pour l'intervalle (ex: 0.95 pour 95%).</span></span>
<span id="cb21-15"></span>
<span id="cb21-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retourne :</span></span>
<span id="cb21-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - Un graphique MRL avec l'intervalle de confiance.</span></span>
<span id="cb21-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb21-19"></span>
<span id="cb21-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Trier et filtrer les donn√©es</span></span>
<span id="cb21-21">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(data[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>np.isnan(data)])</span>
<span id="cb21-22">    nn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data)</span>
<span id="cb21-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> nn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>:</span>
<span id="cb21-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Les donn√©es contiennent trop peu de valeurs valides."</span>)</span>
<span id="cb21-25"></span>
<span id="cb21-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des seuils</span></span>
<span id="cb21-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> tlim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb21-28">        tlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (data[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], data[nn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># √âvite les 4 plus grandes valeurs</span></span>
<span id="cb21-29"></span>
<span id="cb21-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">all</span>(data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> tlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]):</span>
<span id="cb21-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">ValueError</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"La borne sup√©rieure du seuil est trop √©lev√©e."</span>)</span>
<span id="cb21-32"></span>
<span id="cb21-33">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pscale:</span>
<span id="cb21-34">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Travailler en quantiles au lieu de valeurs absolues</span></span>
<span id="cb21-35">        tlim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.mean(data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> tlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), np.mean(data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> tlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]))</span>
<span id="cb21-36">        pvec <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(tlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], tlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], nt)</span>
<span id="cb21-37">        thresholds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.quantile(data, pvec)</span>
<span id="cb21-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb21-39">        thresholds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(tlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], tlim[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], nt)</span>
<span id="cb21-40"></span>
<span id="cb21-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialiser les r√©sultats</span></span>
<span id="cb21-42">    mean_excess <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(nt)</span>
<span id="cb21-43">    lower_conf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(nt)</span>
<span id="cb21-44">    upper_conf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(nt)</span>
<span id="cb21-45"></span>
<span id="cb21-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du Mean Excess et de l'IC</span></span>
<span id="cb21-47">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, u <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(thresholds):</span>
<span id="cb21-48">        exceedances <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> u] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> u  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exc√®s au-dessus du seuil</span></span>
<span id="cb21-49">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(exceedances) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb21-50">            mean_excess[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.nan</span>
<span id="cb21-51">            lower_conf[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.nan</span>
<span id="cb21-52">            upper_conf[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.nan</span>
<span id="cb21-53">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span></span>
<span id="cb21-54">        </span>
<span id="cb21-55">        mean_excess[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(exceedances)</span>
<span id="cb21-56">        std_dev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(exceedances, ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb21-57">        margin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm.ppf((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> conf) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> std_dev <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.sqrt(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(exceedances))</span>
<span id="cb21-58">        </span>
<span id="cb21-59">        lower_conf[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mean_excess[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> margin</span>
<span id="cb21-60">        upper_conf[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mean_excess[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> margin</span>
<span id="cb21-61"></span>
<span id="cb21-62">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Trac√© du Mean Residual Life Plot</span></span>
<span id="cb21-63">    plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb21-64">    plt.plot(thresholds, mean_excess, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Excess"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb21-65">    plt.fill_between(thresholds, lower_conf, upper_conf, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>conf<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">% Confidence Interval"</span>)</span>
<span id="cb21-66">    plt.axhline(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'--'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span>
<span id="cb21-67">    plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Threshold"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> pscale <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Threshold Probability"</span>)</span>
<span id="cb21-68">    plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Excess"</span>)</span>
<span id="cb21-69">    plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Residual Life Plot"</span>)</span>
<span id="cb21-70">    plt.legend()</span>
<span id="cb21-71">    plt.show()</span>
<span id="cb21-72">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> return_values:</span>
<span id="cb21-73">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> thresholds, mean_excess, lower_conf, upper_conf</span>
<span id="cb21-74"></span>
<span id="cb21-75">mean_residual_life_plot(neg_data_train, tlim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08</span>])</span>
<span id="cb21-76"></span>
<span id="cb21-77"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># regarder quantile √† 5%</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="i.2.2.-estimation-des-param√®tres-de-la-loi-gpd" class="level3">
<h3 class="anchored" data-anchor-id="i.2.2.-estimation-des-param√®tres-de-la-loi-gpd">I.2.2. Estimation des param√®tres de la loi GPD</h3>
<p>En estimant les param√®tres de la loi GPD, nous utilisons la m√©thode du maximum de vraisemblance. Les param√®tres estim√©s par maximisation de la fonction de vraisemblance sont les suivants <img src="https://latex.codecogs.com/png.latex?%5Cxi%20=%201.33,%20%5Cmu%20%5Capprox%200.00,%20%5Csigma=0.01">. De ce fait, la distribution de Pareto g√©n√©ralis√©e est adapt√©e pour mod√©liser les exc√®s au-dessus du seuil <img src="https://latex.codecogs.com/png.latex?u%20=%200.03">.</p>
<div id="30468b6a" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span></span>
<span id="cb22-2">excess_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> u <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> neg_data_train <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> u]</span>
<span id="cb22-3"></span>
<span id="cb22-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> genpareto</span>
<span id="cb22-5"></span>
<span id="cb22-6">params_gpd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> genpareto.fit(excess_values)</span>
<span id="cb22-7"></span>
<span id="cb22-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afficher les param√®tres estim√©s</span></span>
<span id="cb22-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Param√®tres estim√©s de la distribution GPD:"</span>)</span>
<span id="cb22-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Shape (xi) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Localisation (mu) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb22-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Echelle (sigma) = </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>params_gpd[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Param√®tres estim√©s de la distribution GPD:
Shape (xi) = 1.33
Localisation (mu) = 0.00
Echelle (sigma) = 0.01</code></pre>
</div>
</div>
</section>
<section id="i.2.3.-validation-ex-ante" class="level3">
<h3 class="anchored" data-anchor-id="i.2.3.-validation-ex-ante">I.2.3. Validation ex-ante</h3>
<p>En comparant la distribution GPD estim√©e et la distribution empirique des exc√®s, nous constatons que la distribution ne semble pas correspondre. De plus, le QQ-plot estim√© indique que les quantiles th√©oriques de la loi GPD sont beaucoup plus grands que les quantiles empiriques observ√©s dans notre distribution des exc√®s. Nous concluons que la distribution GPD n‚Äôest pas adapt√©e pour mod√©liser les exc√®s au-dessus du seuil <img src="https://latex.codecogs.com/png.latex?u%20=%200.03">. Cela peut √™tre d√ª √† un mauvais choix du seuil <img src="https://latex.codecogs.com/png.latex?u">, une analyse plus aprofondie aurait √©t√© n√©cessaire pour choisir un seuil plus adapt√©.</p>
<div id="0f8baa49" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb24-2">plt.hist(excess_values, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Donn√©es observ√©es des exc√®s'</span>)</span>
<span id="cb24-3"></span>
<span id="cb24-4">xmin, xmax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.xlim()</span>
<span id="cb24-5">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(xmin, xmax, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb24-6"></span>
<span id="cb24-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© GPD ajust√©e</span></span>
<span id="cb24-8">p_gpd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> genpareto.pdf(x, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gpd)</span>
<span id="cb24-9">plt.plot(x, p_gpd, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'GPD ajust√©e'</span>)</span>
<span id="cb24-10"></span>
<span id="cb24-11">title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Distribution GPD"</span></span>
<span id="cb24-12">plt.title(title)</span>
<span id="cb24-13">plt.legend()</span>
<span id="cb24-14">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-18-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c1a7867c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1">niveaux_quantiles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>)</span>
<span id="cb25-2">quantiles_empiriques_POT <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.quantile(excess_values, niveaux_quantiles)</span>
<span id="cb25-3">quantiles_theoriques_GDP <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> genpareto.ppf(niveaux_quantiles, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gpd)</span>
<span id="cb25-4"></span>
<span id="cb25-5">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb25-6"></span>
<span id="cb25-7">plt.scatter(quantiles_theoriques_GDP, quantiles_empiriques_POT)</span>
<span id="cb25-8">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"QQ Plot d'une mod√©lisation par loi GPD"</span>)</span>
<span id="cb25-9">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles th√©oriques'</span>)</span>
<span id="cb25-10">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles empiriques'</span>)</span>
<span id="cb25-11">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb25-12">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="i.2.3.-calcul-de-la-var-pot-par-pot" class="level3">
<h3 class="anchored" data-anchor-id="i.2.3.-calcul-de-la-var-pot-par-pot">I.2.3. Calcul de la VaR POT par POT</h3>
<p>La Value-at-Risk sur un horizon 1 jour et pour un niveau de confiance <img src="https://latex.codecogs.com/png.latex?%7B%5Calpha%7D"> est alors obtenue par la formule :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVaR%7D_h(%5Calpha)%20=%20%5Chat%7BH%7D_%7B(%5Chat%7B%5Csigma%7D,%20%5Chat%7B%5Cxi%7D)%20%7D(%5Calpha_%7B%5Ctext%7BPOT%7D%7D)%5E%7B-1%7D%20+%20u,%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Chat%7BH%7D(%5Chat%7B%5Csigma%7D,%20%5Chat%7B%5Cxi%7D)"> est la fonction de r√©partition de la GPD(<img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Csigma%7D,%5Chat%7B%5Cxi%7D">) estim√©e, <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B%5Ctext%7BPOT%7D%7D"> est le quantile ajust√©, n√©cessaire pour adapter le calcul de la VaR dans le cadre de la distribution GPD.</p>
<p>Comme on ne se concentre que sur l‚Äô√©chantillon des exc√®s dans cette mod√©lisation, l‚Äôestimation de la VaR √† partir de la GPD ne doit pas se faire au niveau <img src="https://latex.codecogs.com/png.latex?%5Calpha">, mais √† un niveau ajust√© <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B%5Ctext%7BPOT%7D%7D"> d√©fini par la relation suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A1%20-%20%5Calpha_%7B%5Ctext%7BPOT%7D%7D%20=%20%5Cfrac%7Bn%7D%7BN_u%7D%20%5Ctimes%20(1%20-%20%5Calpha),%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?n"> repr√©sente le nombre total d‚Äôobservations, <img src="https://latex.codecogs.com/png.latex?N_u"> correspond au nombre d‚Äôexc√®s au-del√† du seuil <img src="https://latex.codecogs.com/png.latex?u">,</p>
<div id="cb60b2f0" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> POT_var(data,alpha,u,shape,loc,scale):</span>
<span id="cb26-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb26-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb26-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance de la VaR</span></span>
<span id="cb26-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    s : le nombre de jours dans un bloc</span></span>
<span id="cb26-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb26-7">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data)</span>
<span id="cb26-8">    excess_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> u <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> value <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> u]</span>
<span id="cb26-9">    nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(excess_values)</span>
<span id="cb26-10"></span>
<span id="cb26-11">    alpha_pot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>nu</span>
<span id="cb26-12"></span>
<span id="cb26-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> genpareto.ppf(alpha_pot, shape, loc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> loc, scale <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scale) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> u,alpha_pot</span>
<span id="cb26-14"></span>
<span id="cb26-15">alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb26-16">var_POT_train,alpha_pot <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> POT_var(neg_data_train, alpha, u,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>params_gpd)</span>
<span id="cb26-17"></span>
<span id="cb26-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR TVE pour h=1j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_POT_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb26-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR TVE pour h=10j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>alpha_pot)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>var_POT_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR TVE pour h=1j et alpha=0.99 est : 4.3634%
La VaR TVE pour h=10j et alpha=0.99 est : 17.3572%</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>risques-fin</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_evt.html</guid>
  <pubDate>Thu, 27 Feb 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>TP1:M√©thodes traditionnelles de calcul de la VaR et Expected Shortfall (ES)</title>
  <dc:creator>Cheryl Kouadio</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques.html</link>
  <description><![CDATA[ 




<p>Ce TP est fait dans le but de mod√©liser la Value at Risk qui est une mesure de risque financier. La Value at Risk (VaR) est une mesure essentielle du risque de march√© qui estime la perte potentielle maximale d‚Äôun portefeuille sur un horizon h donn√©, avec un certain niveau de confiance <img src="https://latex.codecogs.com/png.latex?%5Calpha">. La VaR est utilis√©e par les institutions financi√®res et les gestionnaires de risques pour √©valuer l‚Äôexposition aux pertes extr√™mes et ajuster leurs strat√©gies d‚Äôinvestissement. Elle est d√©finie comme suit :</p>
<p><img src="https://latex.codecogs.com/png.latex?VaR_%7B%5Calpha%7D(h)%20=%20inf%20%5C%7B%20l%20%5Cin%20%5Cmathbb%7BR%7D%20%7C%20P(PnL%20%5Cgeq%20-l)%20%5Cgeq%201%20-%20%5Calpha%20%5C%7D"></p>
<p>Le PnL repr√©sente le profit and loss, c‚Äôest-√†-dire la variation de la valeur du portefeuille. Dans notre cas, nous utilserons les rendements logarithmiques des actifs financiers, qui est stationnaire, pour calculer la VaR. Les rendements logarithmiques sont calcul√©s comme suit :</p>
<p><img src="https://latex.codecogs.com/png.latex?r_t%20=%20log(%5Cfrac%7BP_t%7D%7BP_%7Bt-1%7D%7D)%20%5Capprox%20%5Cfrac%7BP_t%20-%20P_%7Bt-1%7D%7D%7BP_%7Bt-1%7D%7D."></p>
<p>Cette mesure est pr√©f√©r√©e aux rendements simples car sa d√©composition en termes additifs permet de mieux mod√©liser les variations de prix des actifs financiers. De plus, en supposant la distribution identique et ind√©pendante des rendements, on peut facilement d√©terminer sa loi de probabilit√© et calculer la VaR.</p>
<p>Dans ce projet, nous explorerons plusieurs m√©thodes pour calculer la VaR, en tenant compte de la nature des rendements financiers et des hypoth√®ses sous-jacentes :</p>
<ul>
<li><strong>M√©thodes non param√©triques</strong> : VaR historique et VaR bootstrap.</li>
<li><strong>M√©thodes param√©triques</strong>: VaR gaussienne et VaR bas√©e sur une distribution Skew Student.</li>
<li><strong>M√©thodes avanc√©es</strong> : VaR avec pond√©ration exponentielle EWMA et VaR calcul√©e par diffusion d‚Äôactifs. En compl√©ment, nous calculerons √©galement l‚ÄôExpected Shortfall (ES), qui mesure la perte moyenne au-del√† du seuil de la VaR. Cette mesure est plus robuste, car elle int√®gre les queues de distribution et est particuli√®rement utile pour √©valuer les risques extr√™mes.</li>
</ul>
<div id="c449f234" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des librairies</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yfinance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> yf</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> tqdm <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tqdm</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> bootstrap</span>
<span id="cb1-8"></span>
<span id="cb1-9">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span></code></pre></div>
</div>
<div id="fb148365" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import des donn√©es du CAC 40</span></span>
<span id="cb2-2">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.download(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FCHI"</span>,start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2008-01-01"</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des rendements logarithmiques</span></span>
<span id="cb2-5">data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>].shift(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retirer la premi√®re ligne</span></span>
<span id="cb2-8">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.dropna()</span>
<span id="cb2-9">data.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.columns.get_level_values(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="56992603" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">data.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">log_return</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2008-01-03</td>
<td>5546.080078</td>
<td>5559.049805</td>
<td>5515.609863</td>
<td>5538.200195</td>
<td>117504500</td>
<td>-0.000771</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2008-01-04</td>
<td>5446.790039</td>
<td>5567.089844</td>
<td>5417.529785</td>
<td>5543.689941</td>
<td>162947200</td>
<td>-0.018065</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2008-01-07</td>
<td>5452.830078</td>
<td>5475.250000</td>
<td>5429.319824</td>
<td>5432.000000</td>
<td>181161800</td>
<td>0.001108</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2008-01-08</td>
<td>5495.669922</td>
<td>5533.930176</td>
<td>5471.140137</td>
<td>5476.509766</td>
<td>174857100</td>
<td>0.007826</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2008-01-09</td>
<td>5435.419922</td>
<td>5463.069824</td>
<td>5420.060059</td>
<td>5459.399902</td>
<td>198041500</td>
<td>-0.011024</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="i.-data-wrangling" class="level1">
<h1>I. Data wrangling</h1>
<p>Le jeu de donn√©es est constitu√© de 6 variables, √† savoir, le prix de cl√¥ture (Close), le volume des transactions (Volume), le prix d‚Äôouverture (Open), le prix le plus bas (Low), le prix le plus √©lev√© (High) et les rendements logarithmiques (log-return). Pour calculer les rendements sur lesquels nous nous sommes baser pour mesurer le risque du portefeuille, nous avons utilis√© le prix de cl√¥ture. Il aurait √©t√© id√©al de disposer des prix de cl√¥ture ajust√©s, i.e.&nbsp;les prix de cl√¥ture qui tiennent compte des dividendes et des √©ventuels splits. Cependant, en raison de l‚Äôindispobilit√© de ces donn√©es, nous avons utilis√© les prix de cl√¥ture bruts.</p>
<p>Sur tout l‚Äôhistorique du CAC 40, nous n‚Äôobservons aucune donn√©e manquante et aucune valeur aberrante (i.e.&nbsp;Prix de cl√¥ture n√©gatif). Nous avons donc pu calculer les rendements logarithmiques sans probl√®me.</p>
<div id="bade16ba" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">data.info()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
DatetimeIndex: 4630 entries, 2008-01-03 to 2026-02-10
Data columns (total 6 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   Close       4630 non-null   float64
 1   High        4630 non-null   float64
 2   Low         4630 non-null   float64
 3   Open        4630 non-null   float64
 4   Volume      4630 non-null   int64  
 5   log_return  4630 non-null   float64
dtypes: float64(5), int64(1)
memory usage: 253.2 KB</code></pre>
</div>
</div>
<div id="93de6eb3" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">data.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Price</th>
<th data-quarto-table-cell-role="th">Close</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">Open</th>
<th data-quarto-table-cell-role="th">Volume</th>
<th data-quarto-table-cell-role="th">log_return</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>4630.000000</td>
<td>4630.000000</td>
<td>4630.000000</td>
<td>4630.000000</td>
<td>4.630000e+03</td>
<td>4630.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5159.397158</td>
<td>5191.392396</td>
<td>5122.058257</td>
<td>5158.404029</td>
<td>1.059394e+08</td>
<td>0.000088</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>1461.767094</td>
<td>1464.656510</td>
<td>1461.496378</td>
<td>1462.353717</td>
<td>5.310210e+07</td>
<td>0.013605</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>2519.290039</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000e+00</td>
<td>-0.130983</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>3994.122559</td>
<td>4019.992432</td>
<td>3965.000000</td>
<td>3995.302490</td>
<td>6.965910e+07</td>
<td>-0.005908</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>4917.965088</td>
<td>4952.119873</td>
<td>4880.074951</td>
<td>4923.284912</td>
<td>9.485980e+07</td>
<td>0.000465</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>6231.207642</td>
<td>6266.062378</td>
<td>6175.047607</td>
<td>6217.902588</td>
<td>1.333100e+08</td>
<td>0.006684</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>8362.089844</td>
<td>8396.719727</td>
<td>8327.219727</td>
<td>8368.990234</td>
<td>5.312476e+08</td>
<td>0.105946</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="d513fa99" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check na</span></span>
<span id="cb8-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb8-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(data.isna().<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>())</span>
<span id="cb8-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Price
Close         0
High          0
Low           0
Open          0
Volume        0
log_return    0
dtype: int64
================================================================================</code></pre>
</div>
</div>
<p>Sur tout l‚Äôhistorique du CAC40, i.e.&nbsp;entre 1990 jusqu‚Äô√† r√©cemment, nous avons enregistr√© 5 p√©riodes de crise financi√®re. Ces p√©riodes sont les suivantes :</p>
<ul>
<li>1994 : Crise obligataire</li>
<li>2000 : Bulle Internet</li>
<li>2008 : Crise des subprimes</li>
<li>2011 : Crise de la dette souveraine</li>
<li>2020 : Crise du Covid-19</li>
</ul>
<p>Cela peut se r√©perer par les clusters de rendements observables sur le graphique ci-dessous. Comme on peut l‚Äôobserver, ces clusters de volatilit√© sont g√©n√©ralement associ√©s √† des p√©riodes o√π le rendement journalier chute brutalemment. Pour mesurer le risque de march√©, il peut √™tre utile de mod√©liser ces clusters de volatilit√© et de prendre en compte les queues de distribution √† travers des mod√®les GARCH par exemple.</p>
<p>Pour mod√©liser la VaR comme mesure de risque, il serait utile √©galement de prendre les √©v√©nements extr√™mes en consid√©ration. En effet, en observant la densit√© des rendements, on peut voir que la distribution des rendements est leptokurtique, c‚Äôest-√†-dire que les queues de distribution sont plus √©paisses que celles d‚Äôune distribution normale (kurtosis &gt; 3). Cela signifie que les √©v√©nements extr√™mes sont plus fr√©quents que ce que la distribution normale ne le sugg√®re. De plus, le coefficient d‚Äôasytmm√©trie est n√©gatif, ce qui signifie que la distribution des rendements est asym√©trique. Cela peut √™tre probl√©matique pour les m√©thodes param√©triques qui supposent, parfois, une distribution sym√©trique des rendements.</p>
<div id="5fc2d393" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">fig, ax1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb10-2"></span>
<span id="cb10-3">ax1.plot(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rendements logarithmiques'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb10-4">ax1.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Date'</span>)</span>
<span id="cb10-5">ax1.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rendements logarithmiques'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb10-6">ax1.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>, labelcolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb10-7"></span>
<span id="cb10-8">ax2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ax1.twinx()</span>
<span id="cb10-9">ax2.plot(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>], label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Prix historiques'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb10-10">ax2.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Prix historiques'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb10-11">ax2.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'y'</span>, labelcolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb10-12"></span>
<span id="cb10-13">fig.legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>, bbox_to_anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.12</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.89</span>))</span>
<span id="cb10-14">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Evolution des prix de cl√¥ture, rendements logarithmiques du CAC 40"</span>)</span>
<span id="cb10-15">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a975d26a" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© des rendements logarithmiques</span></span>
<span id="cb11-2">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb11-3">data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>].plot(kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kde'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb11-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Densit√© des rendements logarithmiques du CAC 40"</span>)</span>
<span id="cb11-5">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e7065a40" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Skewness</span></span>
<span id="cb12-2">skewness <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>].skew()</span>
<span id="cb12-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Skewness: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>skewness<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Kurtosis</span></span>
<span id="cb12-6">kurtosis <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>].kurtosis()</span>
<span id="cb12-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Kurtosis: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>kurtosis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Skewness: -0.28
Kurtosis: 8.48</code></pre>
</div>
</div>
<div id="48ab4a9f" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Autocorr√©lation et pacf</span></span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.graphics.tsaplots <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> plot_acf, plot_pacf</span>
<span id="cb14-3"></span>
<span id="cb14-4">fig, (ax1, ax2) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb14-5"></span>
<span id="cb14-6">plot_acf(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>], lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax1)</span>
<span id="cb14-7">plot_pacf(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>], lags<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, ax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax2)</span>
<span id="cb14-8"></span>
<span id="cb14-9">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Autocorr√©lation et PACF des rendements logarithmiques du CAC 40"</span>)</span>
<span id="cb14-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f98cfdff" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check for stationarity</span></span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> statsmodels.tsa.stattools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> adfuller</span>
<span id="cb15-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb15-4"></span>
<span id="cb15-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> adf_test(series, title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">''</span>):</span>
<span id="cb15-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb15-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Pass in a time series and an optional title, returns an Adataset report</span></span>
<span id="cb15-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb15-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Augmented Dickey-Fuller Test: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(title))</span>
<span id="cb15-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .dropna() handles differenced data</span></span>
<span id="cb15-11">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> adfuller(series.dropna(),autolag<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'AIC'</span>)</span>
<span id="cb15-12"></span>
<span id="cb15-13">    labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Adataset test statistic'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p-value'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'# lags used'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'# observations'</span>]</span>
<span id="cb15-14">    out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Series(result[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>],index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>labels)</span>
<span id="cb15-15"></span>
<span id="cb15-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> key,val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> result[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>].items():</span>
<span id="cb15-17">        out[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'critical value (</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">)'</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(key)]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>val</span>
<span id="cb15-18"></span>
<span id="cb15-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># .to_string() removes the line "dtype: float64"</span></span>
<span id="cb15-20">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>out<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>to_string()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>)</span>
<span id="cb15-21"></span>
<span id="cb15-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> result[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>:</span>
<span id="cb15-23">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Strong evidence against the null hypothesis"</span>)</span>
<span id="cb15-24">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reject the null hypothesis"</span>)</span>
<span id="cb15-25">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data has no unit root and is stationary"</span>)</span>
<span id="cb15-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb15-27">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weak evidence against the null hypothesis"</span>)</span>
<span id="cb15-28">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Fail to reject the null hypothesis"</span>)</span>
<span id="cb15-29">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Data has a unit root and is non-stationary"</span>)</span>
<span id="cb15-30"></span>
<span id="cb15-31"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb15-32">adf_test(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>], title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Prix de cl√¥ture'</span>)</span>
<span id="cb15-33"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb15-34">adf_test(data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log_return"</span>], title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Log-rendements'</span>)</span>
<span id="cb15-35"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Augmented Dickey-Fuller Test: Prix de cl√¥ture

Adataset test statistic      -0.664665
p-value                       0.855691
# lags used                   0.000000
# observations             4629.000000
critical value (1%)          -3.431763
critical value (5%)          -2.862165
critical value (10%)         -2.567102

Weak evidence against the null hypothesis
Fail to reject the null hypothesis
Data has a unit root and is non-stationary
================================================================================
Augmented Dickey-Fuller Test: Log-rendements

Adataset test statistic   -1.238290e+01
p-value                    4.982874e-23
# lags used                2.900000e+01
# observations             4.600000e+03
critical value (1%)       -3.431772e+00
critical value (5%)       -2.862169e+00
critical value (10%)      -2.567105e+00

Strong evidence against the null hypothesis
Reject the null hypothesis
Data has no unit root and is stationary
================================================================================</code></pre>
</div>
</div>
</section>
<section id="ii.-impl√©mentation-de-la-var" class="level1">
<h1>II. Impl√©mentation de la VaR</h1>
<p>On va prendre comme p√©riode d‚Äôapprentissage o√π la BCE fait baisser ses taux directeurs et comme p√©riode de (back-)test o√π la BCE fait augmenter ses taux directeurs. De ce fait, nous avons le d√©coupage suivant : - Train : 15 octobre 2008 - 26 juillet 2022 - Test : 28 juillet 2022 - 11 juin 2024</p>
<p>On va impl√©menter les diff√©rentes m√©thodes de calcul de la VaR et de l‚ÄôES sur le jeu de donn√©es du CAC 40. On va comparer les performances de ces m√©thodes en utilisant la p√©riode de test. On s‚Äôattend √† ce que les m√©thodes param√©triques soient moins performantes que les m√©thodes non param√©triques, car elles supposent une distribution des rendements qui n‚Äôest pas toujours v√©rifi√©e. De plus, les m√©thodes avanc√©es, comme l‚ÄôEWMA et la diffusion d‚Äôactifs, devraient √™tre plus performantes que les m√©thodes non param√©triques, car elles prennent en compte la dynamique des rendements et les corr√©lations entre les actifs. En g√©n√©ral, le backtest devrait √™tre v√©rifi√© puisque la p√©riode de test ne comporte aucune crise financi√®re.</p>
<div id="a1be9c32" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1">train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>]][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'15-10-2008'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'26-07-2022'</span>]</span>
<span id="cb17-2">data_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>]</span>
<span id="cb17-3"></span>
<span id="cb17-4">test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>]][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'27-07-2022'</span>:<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'11-06-2024'</span>]</span>
<span id="cb17-5">data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> test[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'log_return'</span>]</span></code></pre></div>
</div>
<section id="ii.1.-statistiques-descriptives" class="level2">
<h2 class="anchored" data-anchor-id="ii.1.-statistiques-descriptives">II.1. Statistiques descriptives</h2>
<p>Nous constatons que dans la p√©riode d‚Äôentrainement est plus volatile (std=1.39%). Cela s‚Äôexplique par le fait que la p√©riode d‚Äôentrainement prend en compte deux crises majeures : la crise des subprimes et la crise du Covid-19. Cela peut √©galement se voir √† travers les clusters de volatilit√© observables √† la suite de ces crises. Dans la p√©riode de test, aucun √©v√®nement majeur n‚Äôest observ√©, avec une plus faible volatilit√© observ√©e (std=0.08%).</p>
<p>On s‚Äôattend √† ce que la VaR entrain√©e sur la p√©riode d‚Äôentrainement performe tr√®s bien sur la p√©riode de test, mais on s‚Äôattend √©galement √† ce que la VaR entrain√©e sur la p√©riode de test performe moins bien sur la p√©riode d‚Äôentrainement.</p>
<div id="fac3bbd1" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb18-2">plt.plot(data_train, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Train'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'grey'</span>)</span>
<span id="cb18-3">plt.plot(data_test, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Test'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb18-4">plt.legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb18-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Donn√©es d'entrainement et de test"</span>)</span>
<span id="cb18-6">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2561fe16" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1">data_train.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>count    3523.000000
mean        0.000153
std         0.013953
min        -0.130983
25%        -0.006099
50%         0.000580
75%         0.006855
max         0.096169
Name: log_return, dtype: float64</code></pre>
</div>
</div>
<div id="3f4ec0fc" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1">data_test.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>count    586.000000
mean       0.000292
std        0.008947
min       -0.036484
25%       -0.004763
50%        0.000642
75%        0.005612
max        0.041504
Name: log_return, dtype: float64</code></pre>
</div>
</div>
</section>
<section id="ii.2.-var-non-param√©trique" class="level2">
<h2 class="anchored" data-anchor-id="ii.2.-var-non-param√©trique">II.2. VaR non param√©trique</h2>
<p>La VaR est une mesure de risque qui donne une estimation de la perte maximale que l‚Äôon peut subir avec un certain niveau de confiance <img src="https://latex.codecogs.com/png.latex?%5Calpha"> sur un horizon de temps donn√©. Par exemple, une VaR √† 5% sur 1 jour de 1000 euros signifie que 95% du temps, on ne perdra pas plus de 1000 euros sur un jour.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(%5Ctext%7BLoss%7D%20%3C%20%5Ctext%7BVaR%7D)%20=%20%5Calpha."></p>
<p>On peut √©galement raisonner en terme de gain, i.e.&nbsp;Profit and Loss (PnL).</p>
<p><img src="https://latex.codecogs.com/png.latex?P(%5Ctext%7BPnL%7D%20%3E%20-%20%5Ctext%7BVaR%7D)%20=%20%5Calpha."></p>
<p>La VaR peut se calculer suivant trois approches : 1. <strong>Approche historique</strong> : On se base sur les rendements pass√©s selon l‚Äôhorizon fix√© pour estimer la VaR, √† l‚Äôaide d‚Äôun quantile empirique d‚Äôordre <img src="https://latex.codecogs.com/png.latex?%5Calpha">. Autrement, on peut se baser sur les rendements journaliers et utiliser la m√©thode de <strong>scaling</strong>. 2. <strong>Approche bootstrap</strong> : On tire al√©atoirement des √©chantillons de rendements pass√©s avec remise, puis on prend le quantile empirique d‚Äôordre <img src="https://latex.codecogs.com/png.latex?%5Calpha"> pour calculer la VaR de chaque √©chantillon. La VaR finale est la moyenne des VaR obtenues.</p>
<section id="ii.2.1.-historique" class="level3">
<h3 class="anchored" data-anchor-id="ii.2.1.-historique">II.2.1. Historique</h3>
<div id="d02fc6bb" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : impl√©menter une fonction calculant la VaR historique</span></span>
<span id="cb23-2"></span>
<span id="cb23-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> historical_var(data, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>):</span>
<span id="cb23-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb23-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR historique</span></span>
<span id="cb23-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb23-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb23-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb23-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.percentile(data, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha))</span></code></pre></div>
</div>
<div id="b1b0fc65" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la VaR historique sur l'√©chantillon d'entrainement pour h=1j et alpha=0.99</span></span>
<span id="cb24-2">alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb24-3">var_hist_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> historical_var(data_train, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span>
<span id="cb24-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR historique pour h=1j et alpha=0.99 est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_hist_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR historique pour h=1j et alpha=0.99 est : 4.0850%</code></pre>
</div>
</div>
<p>On constate que la VaR historique pour une horizon de 1 jour et un niveau de confiance de 99% est de -4,09%. De ce fait, la perte maximale que l‚Äôon peut subir avec un niveau de confiance de 99% sur un jour est de 4,09%. Autrement dit, il y a 1 chance sur 100 que la perte soit sup√©rieure √† 4,09%. Cette perte peut se produire 2 √† 3 ans fois en une ann√©e (252 jours de trading).</p>
</section>
<section id="ii.2.2.-bootstrap" class="level3">
<h3 class="anchored" data-anchor-id="ii.2.2.-bootstrap">II.2.2. Bootstrap</h3>
<p>Pour l‚Äôimpl√©mentation de la VaR bootstrap, nous faisons le choix de faire un tirage de taille n=la taille de la s√©rie des rendements, avec remise. Ce choix est fait pour des raisons de simplicit√©. En ce qui concerne le choix du nombre d‚Äô√©chantillons, nous allons observer l‚Äô√©volution de de l‚Äôestimation de la VaR en fonction du nombre d‚Äô√©chantillons. Nous limiterons √† des √©chantillons compris entre 1000 et 10000, pour des raisons de temps computationnels, en ayant conscience que plus le nombre d‚Äô√©chantillons est grand, plus l‚Äôestimation de la VaR sera pr√©cise.</p>
<div id="5da3e799" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : impl√©menter une fonction calculant la VaR bootstrap et un IC</span></span>
<span id="cb26-2"></span>
<span id="cb26-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> bootstrap_var(data, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, M<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, seuil<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>):</span>
<span id="cb26-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb26-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR bootstrap</span></span>
<span id="cb26-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb26-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance de la VaR</span></span>
<span id="cb26-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    n : le nombre de simulations</span></span>
<span id="cb26-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    seuil : le seuil de l'intervalle de confiance</span></span>
<span id="cb26-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb26-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set seed</span></span>
<span id="cb26-12">    np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span>)</span>
<span id="cb26-13"></span>
<span id="cb26-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation du vecteur des VaR</span></span>
<span id="cb26-15">    var <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(M)</span>
<span id="cb26-16"></span>
<span id="cb26-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la VaR bootstrap</span></span>
<span id="cb26-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(M):</span>
<span id="cb26-19">        sample <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.choice(data, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data), replace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb26-20">        var[i] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.percentile(sample, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha))</span>
<span id="cb26-21"></span>
<span id="cb26-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de l'intervalle de confiance</span></span>
<span id="cb26-23">    lower <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.percentile(var, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>seuil)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb26-24">    upper <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.percentile(var, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(seuil <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>seuil)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb26-25"></span>
<span id="cb26-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.mean(var), lower, upper</span></code></pre></div>
</div>
<div id="1a41bce3" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Observer la variation de la VaR en fonction de M</span></span>
<span id="cb27-2">M_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb27-3">var_bs_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb27-4"></span>
<span id="cb27-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> M <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tqdm(M_values):</span>
<span id="cb27-6">    var_bs_train, _, _ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bootstrap_var(data_train, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha, M<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>M)</span>
<span id="cb27-7">    var_bs_values.append(var_bs_train)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|          | 0/900 [00:00&lt;?, ?it/s]  0%|          | 2/900 [00:00&lt;00:57, 15.54it/s]  0%|          | 4/900 [00:00&lt;00:58, 15.20it/s]  1%|          | 6/900 [00:00&lt;00:58, 15.25it/s]  1%|          | 8/900 [00:00&lt;00:58, 15.17it/s]  1%|          | 10/900 [00:00&lt;00:59, 15.02it/s]  1%|‚ñè         | 12/900 [00:00&lt;01:00, 14.72it/s]  2%|‚ñè         | 14/900 [00:00&lt;01:01, 14.52it/s]  2%|‚ñè         | 16/900 [00:01&lt;01:01, 14.34it/s]  2%|‚ñè         | 18/900 [00:01&lt;01:02, 14.16it/s]  2%|‚ñè         | 20/900 [00:01&lt;01:03, 13.92it/s]  2%|‚ñè         | 22/900 [00:01&lt;01:03, 13.73it/s]  3%|‚ñé         | 24/900 [00:01&lt;01:05, 13.47it/s]  3%|‚ñé         | 26/900 [00:01&lt;01:05, 13.29it/s]  3%|‚ñé         | 28/900 [00:01&lt;01:06, 13.10it/s]  3%|‚ñé         | 30/900 [00:02&lt;01:07, 12.88it/s]  4%|‚ñé         | 32/900 [00:02&lt;01:08, 12.70it/s]  4%|‚ñç         | 34/900 [00:02&lt;01:09, 12.52it/s]  4%|‚ñç         | 36/900 [00:02&lt;01:10, 12.26it/s]  4%|‚ñç         | 38/900 [00:02&lt;01:11, 12.07it/s]  4%|‚ñç         | 40/900 [00:03&lt;01:12, 11.91it/s]  5%|‚ñç         | 42/900 [00:03&lt;01:13, 11.72it/s]  5%|‚ñç         | 44/900 [00:03&lt;01:14, 11.57it/s]  5%|‚ñå         | 46/900 [00:03&lt;01:15, 11.38it/s]  5%|‚ñå         | 48/900 [00:03&lt;01:15, 11.22it/s]  6%|‚ñå         | 50/900 [00:03&lt;01:16, 11.05it/s]  6%|‚ñå         | 52/900 [00:04&lt;01:17, 10.90it/s]  6%|‚ñå         | 54/900 [00:04&lt;01:18, 10.75it/s]  6%|‚ñå         | 56/900 [00:04&lt;01:19, 10.62it/s]  6%|‚ñã         | 58/900 [00:04&lt;01:20, 10.47it/s]  7%|‚ñã         | 60/900 [00:04&lt;01:21, 10.32it/s]  7%|‚ñã         | 62/900 [00:05&lt;01:22, 10.18it/s]  7%|‚ñã         | 64/900 [00:05&lt;01:23, 10.04it/s]  7%|‚ñã         | 66/900 [00:05&lt;01:24,  9.92it/s]  7%|‚ñã         | 67/900 [00:05&lt;01:24,  9.87it/s]  8%|‚ñä         | 68/900 [00:05&lt;01:25,  9.78it/s]  8%|‚ñä         | 69/900 [00:05&lt;01:25,  9.72it/s]  8%|‚ñä         | 70/900 [00:05&lt;01:26,  9.63it/s]  8%|‚ñä         | 71/900 [00:06&lt;01:26,  9.56it/s]  8%|‚ñä         | 72/900 [00:06&lt;01:27,  9.50it/s]  8%|‚ñä         | 73/900 [00:06&lt;01:27,  9.41it/s]  8%|‚ñä         | 74/900 [00:06&lt;01:28,  9.36it/s]  8%|‚ñä         | 75/900 [00:06&lt;01:28,  9.31it/s]  8%|‚ñä         | 76/900 [00:06&lt;01:29,  9.24it/s]  9%|‚ñä         | 77/900 [00:06&lt;01:29,  9.17it/s]  9%|‚ñä         | 78/900 [00:06&lt;01:30,  9.12it/s]  9%|‚ñâ         | 79/900 [00:06&lt;01:30,  9.08it/s]  9%|‚ñâ         | 80/900 [00:07&lt;01:30,  9.01it/s]  9%|‚ñâ         | 81/900 [00:07&lt;01:31,  8.98it/s]  9%|‚ñâ         | 82/900 [00:07&lt;01:31,  8.90it/s]  9%|‚ñâ         | 83/900 [00:07&lt;01:32,  8.87it/s]  9%|‚ñâ         | 84/900 [00:07&lt;01:32,  8.82it/s]  9%|‚ñâ         | 85/900 [00:07&lt;01:32,  8.77it/s] 10%|‚ñâ         | 86/900 [00:07&lt;01:33,  8.70it/s] 10%|‚ñâ         | 87/900 [00:07&lt;01:34,  8.64it/s] 10%|‚ñâ         | 88/900 [00:07&lt;01:34,  8.59it/s] 10%|‚ñâ         | 89/900 [00:08&lt;01:34,  8.54it/s] 10%|‚ñà         | 90/900 [00:08&lt;01:35,  8.49it/s] 10%|‚ñà         | 91/900 [00:08&lt;01:35,  8.47it/s] 10%|‚ñà         | 92/900 [00:08&lt;01:35,  8.45it/s] 10%|‚ñà         | 93/900 [00:08&lt;01:35,  8.41it/s] 10%|‚ñà         | 94/900 [00:08&lt;01:36,  8.37it/s] 11%|‚ñà         | 95/900 [00:08&lt;01:36,  8.32it/s] 11%|‚ñà         | 96/900 [00:08&lt;01:37,  8.25it/s] 11%|‚ñà         | 97/900 [00:09&lt;01:37,  8.20it/s] 11%|‚ñà         | 98/900 [00:09&lt;01:38,  8.17it/s] 11%|‚ñà         | 99/900 [00:09&lt;01:38,  8.10it/s] 11%|‚ñà         | 100/900 [00:09&lt;01:38,  8.08it/s] 11%|‚ñà         | 101/900 [00:09&lt;01:39,  8.03it/s] 11%|‚ñà‚ñè        | 102/900 [00:09&lt;01:39,  8.01it/s] 11%|‚ñà‚ñè        | 103/900 [00:09&lt;01:39,  7.98it/s] 12%|‚ñà‚ñè        | 104/900 [00:09&lt;01:40,  7.95it/s] 12%|‚ñà‚ñè        | 105/900 [00:10&lt;01:40,  7.90it/s] 12%|‚ñà‚ñè        | 106/900 [00:10&lt;01:40,  7.87it/s] 12%|‚ñà‚ñè        | 107/900 [00:10&lt;01:41,  7.81it/s] 12%|‚ñà‚ñè        | 108/900 [00:10&lt;01:42,  7.70it/s] 12%|‚ñà‚ñè        | 109/900 [00:10&lt;01:43,  7.66it/s] 12%|‚ñà‚ñè        | 110/900 [00:10&lt;01:43,  7.63it/s] 12%|‚ñà‚ñè        | 111/900 [00:10&lt;01:44,  7.58it/s] 12%|‚ñà‚ñè        | 112/900 [00:10&lt;01:44,  7.56it/s] 13%|‚ñà‚ñé        | 113/900 [00:11&lt;01:45,  7.48it/s] 13%|‚ñà‚ñé        | 114/900 [00:11&lt;01:45,  7.43it/s] 13%|‚ñà‚ñé        | 115/900 [00:11&lt;01:49,  7.18it/s] 13%|‚ñà‚ñé        | 116/900 [00:11&lt;01:48,  7.23it/s] 13%|‚ñà‚ñé        | 117/900 [00:11&lt;01:47,  7.28it/s] 13%|‚ñà‚ñé        | 118/900 [00:11&lt;01:48,  7.19it/s] 13%|‚ñà‚ñé        | 119/900 [00:11&lt;01:48,  7.22it/s] 13%|‚ñà‚ñé        | 120/900 [00:12&lt;01:48,  7.18it/s] 13%|‚ñà‚ñé        | 121/900 [00:12&lt;01:48,  7.20it/s] 14%|‚ñà‚ñé        | 122/900 [00:12&lt;01:48,  7.16it/s] 14%|‚ñà‚ñé        | 123/900 [00:12&lt;01:49,  7.09it/s] 14%|‚ñà‚ñç        | 124/900 [00:12&lt;01:49,  7.11it/s] 14%|‚ñà‚ñç        | 125/900 [00:12&lt;01:50,  6.98it/s] 14%|‚ñà‚ñç        | 126/900 [00:12&lt;01:50,  7.01it/s] 14%|‚ñà‚ñç        | 127/900 [00:13&lt;01:51,  6.95it/s] 14%|‚ñà‚ñç        | 128/900 [00:13&lt;01:51,  6.92it/s] 14%|‚ñà‚ñç        | 129/900 [00:13&lt;01:53,  6.82it/s] 14%|‚ñà‚ñç        | 130/900 [00:13&lt;01:53,  6.81it/s] 15%|‚ñà‚ñç        | 131/900 [00:13&lt;01:52,  6.81it/s] 15%|‚ñà‚ñç        | 132/900 [00:13&lt;01:53,  6.79it/s] 15%|‚ñà‚ñç        | 133/900 [00:13&lt;01:52,  6.81it/s] 15%|‚ñà‚ñç        | 134/900 [00:14&lt;01:53,  6.75it/s] 15%|‚ñà‚ñå        | 135/900 [00:14&lt;01:53,  6.72it/s] 15%|‚ñà‚ñå        | 136/900 [00:14&lt;01:54,  6.66it/s] 15%|‚ñà‚ñå        | 137/900 [00:14&lt;01:56,  6.56it/s] 15%|‚ñà‚ñå        | 138/900 [00:14&lt;01:55,  6.61it/s] 15%|‚ñà‚ñå        | 139/900 [00:14&lt;01:56,  6.53it/s] 16%|‚ñà‚ñå        | 140/900 [00:15&lt;01:56,  6.53it/s] 16%|‚ñà‚ñå        | 141/900 [00:15&lt;01:55,  6.56it/s] 16%|‚ñà‚ñå        | 142/900 [00:15&lt;01:56,  6.48it/s] 16%|‚ñà‚ñå        | 143/900 [00:15&lt;01:56,  6.49it/s] 16%|‚ñà‚ñå        | 144/900 [00:15&lt;01:57,  6.44it/s] 16%|‚ñà‚ñå        | 145/900 [00:15&lt;01:57,  6.43it/s] 16%|‚ñà‚ñå        | 146/900 [00:15&lt;01:57,  6.44it/s] 16%|‚ñà‚ñã        | 147/900 [00:16&lt;01:58,  6.37it/s] 16%|‚ñà‚ñã        | 148/900 [00:16&lt;01:58,  6.33it/s] 17%|‚ñà‚ñã        | 149/900 [00:16&lt;02:02,  6.11it/s] 17%|‚ñà‚ñã        | 150/900 [00:16&lt;02:03,  6.09it/s] 17%|‚ñà‚ñã        | 151/900 [00:16&lt;02:01,  6.15it/s] 17%|‚ñà‚ñã        | 152/900 [00:16&lt;02:00,  6.21it/s] 17%|‚ñà‚ñã        | 153/900 [00:17&lt;02:01,  6.12it/s] 17%|‚ñà‚ñã        | 154/900 [00:17&lt;02:01,  6.14it/s] 17%|‚ñà‚ñã        | 155/900 [00:17&lt;02:00,  6.19it/s] 17%|‚ñà‚ñã        | 156/900 [00:17&lt;02:00,  6.20it/s] 17%|‚ñà‚ñã        | 157/900 [00:17&lt;02:01,  6.13it/s] 18%|‚ñà‚ñä        | 158/900 [00:17&lt;02:00,  6.14it/s] 18%|‚ñà‚ñä        | 159/900 [00:18&lt;02:00,  6.16it/s] 18%|‚ñà‚ñä        | 160/900 [00:18&lt;02:03,  5.99it/s] 18%|‚ñà‚ñä        | 161/900 [00:18&lt;02:03,  5.97it/s] 18%|‚ñà‚ñä        | 162/900 [00:18&lt;02:03,  5.98it/s] 18%|‚ñà‚ñä        | 163/900 [00:18&lt;02:02,  6.02it/s] 18%|‚ñà‚ñä        | 164/900 [00:18&lt;02:01,  6.05it/s] 18%|‚ñà‚ñä        | 165/900 [00:19&lt;02:02,  6.02it/s] 18%|‚ñà‚ñä        | 166/900 [00:19&lt;02:02,  5.99it/s] 19%|‚ñà‚ñä        | 167/900 [00:19&lt;02:02,  6.00it/s] 19%|‚ñà‚ñä        | 168/900 [00:19&lt;02:02,  6.00it/s] 19%|‚ñà‚ñâ        | 169/900 [00:19&lt;02:02,  5.99it/s] 19%|‚ñà‚ñâ        | 170/900 [00:19&lt;02:02,  5.98it/s] 19%|‚ñà‚ñâ        | 171/900 [00:20&lt;02:02,  5.97it/s] 19%|‚ñà‚ñâ        | 172/900 [00:20&lt;02:03,  5.92it/s] 19%|‚ñà‚ñâ        | 173/900 [00:20&lt;02:03,  5.89it/s] 19%|‚ñà‚ñâ        | 174/900 [00:20&lt;02:04,  5.85it/s] 19%|‚ñà‚ñâ        | 175/900 [00:20&lt;02:03,  5.85it/s] 20%|‚ñà‚ñâ        | 176/900 [00:21&lt;02:13,  5.42it/s] 20%|‚ñà‚ñâ        | 177/900 [00:21&lt;02:11,  5.49it/s] 20%|‚ñà‚ñâ        | 178/900 [00:21&lt;02:09,  5.56it/s] 20%|‚ñà‚ñâ        | 179/900 [00:21&lt;02:08,  5.60it/s] 20%|‚ñà‚ñà        | 180/900 [00:21&lt;02:10,  5.53it/s] 20%|‚ñà‚ñà        | 181/900 [00:21&lt;02:16,  5.27it/s] 20%|‚ñà‚ñà        | 182/900 [00:22&lt;02:13,  5.38it/s] 20%|‚ñà‚ñà        | 183/900 [00:22&lt;02:11,  5.46it/s] 20%|‚ñà‚ñà        | 184/900 [00:22&lt;02:09,  5.52it/s] 21%|‚ñà‚ñà        | 185/900 [00:22&lt;02:09,  5.51it/s] 21%|‚ñà‚ñà        | 186/900 [00:22&lt;02:09,  5.51it/s] 21%|‚ñà‚ñà        | 187/900 [00:23&lt;02:09,  5.51it/s] 21%|‚ñà‚ñà        | 188/900 [00:23&lt;02:08,  5.53it/s] 21%|‚ñà‚ñà        | 189/900 [00:23&lt;02:08,  5.53it/s] 21%|‚ñà‚ñà        | 190/900 [00:23&lt;02:08,  5.53it/s] 21%|‚ñà‚ñà        | 191/900 [00:23&lt;02:08,  5.53it/s] 21%|‚ñà‚ñà‚ñè       | 192/900 [00:23&lt;02:08,  5.49it/s] 21%|‚ñà‚ñà‚ñè       | 193/900 [00:24&lt;02:08,  5.48it/s] 22%|‚ñà‚ñà‚ñè       | 194/900 [00:24&lt;02:08,  5.48it/s] 22%|‚ñà‚ñà‚ñè       | 195/900 [00:24&lt;02:08,  5.47it/s] 22%|‚ñà‚ñà‚ñè       | 196/900 [00:24&lt;02:11,  5.35it/s] 22%|‚ñà‚ñà‚ñè       | 197/900 [00:24&lt;02:11,  5.35it/s] 22%|‚ñà‚ñà‚ñè       | 198/900 [00:25&lt;02:11,  5.35it/s] 22%|‚ñà‚ñà‚ñè       | 199/900 [00:25&lt;02:11,  5.35it/s] 22%|‚ñà‚ñà‚ñè       | 200/900 [00:25&lt;02:10,  5.36it/s] 22%|‚ñà‚ñà‚ñè       | 201/900 [00:25&lt;02:10,  5.36it/s] 22%|‚ñà‚ñà‚ñè       | 202/900 [00:25&lt;02:10,  5.35it/s] 23%|‚ñà‚ñà‚ñé       | 203/900 [00:25&lt;02:10,  5.34it/s] 23%|‚ñà‚ñà‚ñé       | 204/900 [00:26&lt;02:10,  5.33it/s] 23%|‚ñà‚ñà‚ñé       | 205/900 [00:26&lt;02:14,  5.16it/s] 23%|‚ñà‚ñà‚ñé       | 206/900 [00:26&lt;02:17,  5.05it/s] 23%|‚ñà‚ñà‚ñé       | 207/900 [00:26&lt;02:16,  5.07it/s] 23%|‚ñà‚ñà‚ñé       | 208/900 [00:26&lt;02:15,  5.11it/s] 23%|‚ñà‚ñà‚ñé       | 209/900 [00:27&lt;02:15,  5.12it/s] 23%|‚ñà‚ñà‚ñé       | 210/900 [00:27&lt;02:14,  5.11it/s] 23%|‚ñà‚ñà‚ñé       | 211/900 [00:27&lt;02:14,  5.13it/s] 24%|‚ñà‚ñà‚ñé       | 212/900 [00:27&lt;02:22,  4.83it/s] 24%|‚ñà‚ñà‚ñé       | 213/900 [00:27&lt;02:22,  4.84it/s] 24%|‚ñà‚ñà‚ñç       | 214/900 [00:28&lt;02:19,  4.91it/s] 24%|‚ñà‚ñà‚ñç       | 215/900 [00:28&lt;02:23,  4.77it/s] 24%|‚ñà‚ñà‚ñç       | 216/900 [00:28&lt;02:25,  4.69it/s] 24%|‚ñà‚ñà‚ñç       | 217/900 [00:28&lt;02:23,  4.75it/s] 24%|‚ñà‚ñà‚ñç       | 218/900 [00:29&lt;02:24,  4.72it/s] 24%|‚ñà‚ñà‚ñç       | 219/900 [00:29&lt;02:25,  4.67it/s] 24%|‚ñà‚ñà‚ñç       | 220/900 [00:29&lt;02:23,  4.74it/s] 25%|‚ñà‚ñà‚ñç       | 221/900 [00:29&lt;02:20,  4.82it/s] 25%|‚ñà‚ñà‚ñç       | 222/900 [00:29&lt;02:31,  4.47it/s] 25%|‚ñà‚ñà‚ñç       | 223/900 [00:30&lt;02:28,  4.55it/s] 25%|‚ñà‚ñà‚ñç       | 224/900 [00:30&lt;02:25,  4.63it/s] 25%|‚ñà‚ñà‚ñå       | 225/900 [00:30&lt;02:33,  4.41it/s] 25%|‚ñà‚ñà‚ñå       | 226/900 [00:30&lt;02:31,  4.44it/s] 25%|‚ñà‚ñà‚ñå       | 227/900 [00:31&lt;02:27,  4.55it/s] 25%|‚ñà‚ñà‚ñå       | 228/900 [00:31&lt;02:25,  4.63it/s] 25%|‚ñà‚ñà‚ñå       | 229/900 [00:31&lt;02:23,  4.69it/s] 26%|‚ñà‚ñà‚ñå       | 230/900 [00:31&lt;02:29,  4.48it/s] 26%|‚ñà‚ñà‚ñå       | 231/900 [00:31&lt;02:28,  4.51it/s] 26%|‚ñà‚ñà‚ñå       | 232/900 [00:32&lt;02:25,  4.59it/s] 26%|‚ñà‚ñà‚ñå       | 233/900 [00:32&lt;02:23,  4.65it/s] 26%|‚ñà‚ñà‚ñå       | 234/900 [00:32&lt;02:21,  4.70it/s] 26%|‚ñà‚ñà‚ñå       | 235/900 [00:32&lt;02:20,  4.73it/s] 26%|‚ñà‚ñà‚ñå       | 236/900 [00:32&lt;02:19,  4.75it/s] 26%|‚ñà‚ñà‚ñã       | 237/900 [00:33&lt;02:20,  4.72it/s] 26%|‚ñà‚ñà‚ñã       | 238/900 [00:33&lt;02:28,  4.45it/s] 27%|‚ñà‚ñà‚ñã       | 239/900 [00:33&lt;02:27,  4.48it/s] 27%|‚ñà‚ñà‚ñã       | 240/900 [00:33&lt;02:25,  4.55it/s] 27%|‚ñà‚ñà‚ñã       | 241/900 [00:34&lt;02:30,  4.36it/s] 27%|‚ñà‚ñà‚ñã       | 242/900 [00:34&lt;02:30,  4.38it/s] 27%|‚ñà‚ñà‚ñã       | 243/900 [00:34&lt;02:27,  4.44it/s] 27%|‚ñà‚ñà‚ñã       | 244/900 [00:34&lt;02:25,  4.51it/s] 27%|‚ñà‚ñà‚ñã       | 245/900 [00:34&lt;02:24,  4.53it/s] 27%|‚ñà‚ñà‚ñã       | 246/900 [00:35&lt;02:24,  4.54it/s] 27%|‚ñà‚ñà‚ñã       | 247/900 [00:35&lt;02:22,  4.57it/s] 28%|‚ñà‚ñà‚ñä       | 248/900 [00:35&lt;02:22,  4.59it/s] 28%|‚ñà‚ñà‚ñä       | 249/900 [00:35&lt;02:21,  4.59it/s] 28%|‚ñà‚ñà‚ñä       | 250/900 [00:36&lt;02:21,  4.59it/s] 28%|‚ñà‚ñà‚ñä       | 251/900 [00:36&lt;02:25,  4.47it/s] 28%|‚ñà‚ñà‚ñä       | 252/900 [00:36&lt;02:33,  4.21it/s] 28%|‚ñà‚ñà‚ñä       | 253/900 [00:36&lt;02:32,  4.23it/s] 28%|‚ñà‚ñà‚ñä       | 254/900 [00:37&lt;02:29,  4.32it/s] 28%|‚ñà‚ñà‚ñä       | 255/900 [00:37&lt;02:28,  4.36it/s] 28%|‚ñà‚ñà‚ñä       | 256/900 [00:37&lt;02:27,  4.38it/s] 29%|‚ñà‚ñà‚ñä       | 257/900 [00:37&lt;02:26,  4.39it/s] 29%|‚ñà‚ñà‚ñä       | 258/900 [00:37&lt;02:32,  4.22it/s] 29%|‚ñà‚ñà‚ñâ       | 259/900 [00:38&lt;02:37,  4.07it/s] 29%|‚ñà‚ñà‚ñâ       | 260/900 [00:38&lt;02:34,  4.15it/s] 29%|‚ñà‚ñà‚ñâ       | 261/900 [00:38&lt;02:30,  4.24it/s] 29%|‚ñà‚ñà‚ñâ       | 262/900 [00:38&lt;02:35,  4.10it/s] 29%|‚ñà‚ñà‚ñâ       | 263/900 [00:39&lt;02:37,  4.05it/s] 29%|‚ñà‚ñà‚ñâ       | 264/900 [00:39&lt;02:34,  4.11it/s] 29%|‚ñà‚ñà‚ñâ       | 265/900 [00:39&lt;02:37,  4.03it/s] 30%|‚ñà‚ñà‚ñâ       | 266/900 [00:39&lt;02:36,  4.06it/s] 30%|‚ñà‚ñà‚ñâ       | 267/900 [00:40&lt;02:32,  4.14it/s] 30%|‚ñà‚ñà‚ñâ       | 268/900 [00:40&lt;02:34,  4.09it/s] 30%|‚ñà‚ñà‚ñâ       | 269/900 [00:40&lt;02:39,  3.97it/s] 30%|‚ñà‚ñà‚ñà       | 270/900 [00:40&lt;02:36,  4.02it/s] 30%|‚ñà‚ñà‚ñà       | 271/900 [00:41&lt;02:38,  3.96it/s] 30%|‚ñà‚ñà‚ñà       | 272/900 [00:41&lt;02:40,  3.92it/s] 30%|‚ñà‚ñà‚ñà       | 273/900 [00:41&lt;02:35,  4.02it/s] 30%|‚ñà‚ñà‚ñà       | 274/900 [00:41&lt;02:33,  4.07it/s] 31%|‚ñà‚ñà‚ñà       | 275/900 [00:42&lt;02:31,  4.13it/s] 31%|‚ñà‚ñà‚ñà       | 276/900 [00:42&lt;02:30,  4.16it/s] 31%|‚ñà‚ñà‚ñà       | 277/900 [00:42&lt;02:39,  3.90it/s] 31%|‚ñà‚ñà‚ñà       | 278/900 [00:42&lt;02:37,  3.94it/s] 31%|‚ñà‚ñà‚ñà       | 279/900 [00:43&lt;02:34,  4.01it/s] 31%|‚ñà‚ñà‚ñà       | 280/900 [00:43&lt;02:32,  4.06it/s] 31%|‚ñà‚ñà‚ñà       | 281/900 [00:43&lt;02:30,  4.10it/s] 31%|‚ñà‚ñà‚ñà‚ñè      | 282/900 [00:43&lt;02:29,  4.13it/s] 31%|‚ñà‚ñà‚ñà‚ñè      | 283/900 [00:44&lt;02:37,  3.91it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 284/900 [00:44&lt;02:36,  3.95it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 285/900 [00:44&lt;02:33,  4.01it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 286/900 [00:44&lt;02:31,  4.04it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 287/900 [00:45&lt;02:33,  3.99it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 288/900 [00:45&lt;02:36,  3.90it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 289/900 [00:45&lt;02:34,  3.94it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 290/900 [00:45&lt;02:32,  3.99it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 291/900 [00:46&lt;02:45,  3.67it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 292/900 [00:46&lt;02:41,  3.76it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 293/900 [00:46&lt;02:38,  3.83it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 294/900 [00:47&lt;02:39,  3.80it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 295/900 [00:47&lt;02:41,  3.75it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 296/900 [00:47&lt;02:38,  3.82it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 297/900 [00:47&lt;02:35,  3.87it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 298/900 [00:48&lt;02:33,  3.92it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 299/900 [00:48&lt;02:41,  3.73it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 300/900 [00:48&lt;02:39,  3.75it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 301/900 [00:48&lt;02:36,  3.83it/s] 34%|‚ñà‚ñà‚ñà‚ñé      | 302/900 [00:49&lt;02:44,  3.65it/s] 34%|‚ñà‚ñà‚ñà‚ñé      | 303/900 [00:49&lt;02:43,  3.65it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 304/900 [00:49&lt;02:39,  3.73it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 305/900 [00:49&lt;02:40,  3.70it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 306/900 [00:50&lt;02:37,  3.76it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 307/900 [00:50&lt;02:39,  3.72it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 308/900 [00:50&lt;02:43,  3.62it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 309/900 [00:51&lt;02:40,  3.69it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 310/900 [00:51&lt;02:37,  3.75it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 311/900 [00:51&lt;02:38,  3.73it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 312/900 [00:51&lt;02:36,  3.76it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 313/900 [00:52&lt;02:35,  3.78it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 314/900 [00:52&lt;02:40,  3.65it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 315/900 [00:52&lt;02:42,  3.60it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 316/900 [00:52&lt;02:39,  3.66it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 317/900 [00:53&lt;02:42,  3.59it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 318/900 [00:53&lt;02:41,  3.60it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 319/900 [00:53&lt;02:38,  3.67it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 320/900 [00:54&lt;02:37,  3.68it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 321/900 [00:54&lt;02:35,  3.72it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 322/900 [00:54&lt;02:34,  3.75it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 323/900 [00:54&lt;02:39,  3.62it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 324/900 [00:55&lt;02:40,  3.59it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 325/900 [00:55&lt;02:38,  3.64it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 326/900 [00:55&lt;02:36,  3.66it/s] 36%|‚ñà‚ñà‚ñà‚ñã      | 327/900 [00:55&lt;02:35,  3.67it/s] 36%|‚ñà‚ñà‚ñà‚ñã      | 328/900 [00:56&lt;02:34,  3.69it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 329/900 [00:56&lt;02:34,  3.70it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 330/900 [00:56&lt;02:33,  3.71it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 331/900 [00:57&lt;02:35,  3.67it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 332/900 [00:57&lt;02:34,  3.68it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 333/900 [00:57&lt;02:34,  3.67it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 334/900 [00:57&lt;02:41,  3.50it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 335/900 [00:58&lt;02:39,  3.53it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 336/900 [00:58&lt;02:38,  3.56it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 337/900 [00:58&lt;02:37,  3.58it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 338/900 [00:58&lt;02:37,  3.57it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 339/900 [00:59&lt;02:41,  3.48it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 340/900 [00:59&lt;02:39,  3.52it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 341/900 [00:59&lt;02:44,  3.41it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 342/900 [01:00&lt;02:41,  3.45it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 343/900 [01:00&lt;02:46,  3.35it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 344/900 [01:00&lt;02:46,  3.34it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 345/900 [01:01&lt;02:42,  3.41it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 346/900 [01:01&lt;02:50,  3.25it/s] 39%|‚ñà‚ñà‚ñà‚ñä      | 347/900 [01:01&lt;02:48,  3.28it/s] 39%|‚ñà‚ñà‚ñà‚ñä      | 348/900 [01:01&lt;02:44,  3.36it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 349/900 [01:02&lt;02:49,  3.24it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 350/900 [01:02&lt;02:46,  3.31it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 351/900 [01:02&lt;02:42,  3.38it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 352/900 [01:03&lt;02:40,  3.42it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 353/900 [01:03&lt;02:38,  3.45it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 354/900 [01:03&lt;02:37,  3.48it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 355/900 [01:04&lt;02:36,  3.48it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 356/900 [01:04&lt;02:35,  3.49it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 357/900 [01:04&lt;02:38,  3.43it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 358/900 [01:04&lt;02:37,  3.43it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 359/900 [01:05&lt;02:43,  3.31it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 360/900 [01:05&lt;02:44,  3.28it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 361/900 [01:05&lt;02:41,  3.34it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 362/900 [01:06&lt;02:39,  3.37it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 363/900 [01:06&lt;02:45,  3.24it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 364/900 [01:06&lt;02:47,  3.21it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 365/900 [01:07&lt;02:43,  3.27it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 366/900 [01:07&lt;02:41,  3.31it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 367/900 [01:07&lt;02:39,  3.35it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 368/900 [01:08&lt;02:47,  3.18it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 369/900 [01:08&lt;02:43,  3.24it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 370/900 [01:08&lt;02:49,  3.13it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 371/900 [01:08&lt;02:44,  3.21it/s] 41%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 372/900 [01:09&lt;02:42,  3.25it/s] 41%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 373/900 [01:09&lt;02:49,  3.11it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 374/900 [01:09&lt;02:47,  3.15it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 375/900 [01:10&lt;02:43,  3.21it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 376/900 [01:10&lt;02:41,  3.24it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 377/900 [01:10&lt;02:39,  3.28it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 378/900 [01:11&lt;02:38,  3.30it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 379/900 [01:11&lt;02:36,  3.32it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 380/900 [01:11&lt;02:38,  3.28it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 381/900 [01:12&lt;02:37,  3.30it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 382/900 [01:12&lt;02:36,  3.31it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 383/900 [01:12&lt;02:36,  3.31it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 384/900 [01:12&lt;02:35,  3.31it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 385/900 [01:13&lt;02:36,  3.30it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 386/900 [01:13&lt;02:35,  3.30it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 387/900 [01:13&lt;02:35,  3.30it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 388/900 [01:14&lt;02:35,  3.30it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 389/900 [01:14&lt;02:35,  3.29it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 390/900 [01:14&lt;02:34,  3.29it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 391/900 [01:15&lt;02:41,  3.15it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 392/900 [01:15&lt;02:40,  3.16it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 393/900 [01:15&lt;02:39,  3.18it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 394/900 [01:16&lt;02:38,  3.19it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 395/900 [01:16&lt;02:38,  3.19it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 396/900 [01:16&lt;02:44,  3.06it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 397/900 [01:17&lt;02:44,  3.07it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 398/900 [01:17&lt;02:41,  3.11it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 399/900 [01:17&lt;02:49,  2.96it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 400/900 [01:18&lt;02:46,  3.00it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 401/900 [01:18&lt;02:49,  2.95it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 402/900 [01:18&lt;02:46,  3.00it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 403/900 [01:19&lt;02:43,  3.04it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 404/900 [01:19&lt;02:50,  2.91it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 405/900 [01:19&lt;02:46,  2.97it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 406/900 [01:20&lt;02:43,  3.02it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 407/900 [01:20&lt;02:41,  3.05it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 408/900 [01:20&lt;02:40,  3.07it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 409/900 [01:20&lt;02:38,  3.10it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 410/900 [01:21&lt;02:39,  3.07it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 411/900 [01:21&lt;02:38,  3.09it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 412/900 [01:21&lt;02:37,  3.10it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 413/900 [01:22&lt;02:37,  3.10it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 414/900 [01:22&lt;02:36,  3.11it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 415/900 [01:22&lt;02:35,  3.11it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 416/900 [01:23&lt;02:35,  3.10it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 417/900 [01:23&lt;02:35,  3.11it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 418/900 [01:23&lt;02:35,  3.10it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 419/900 [01:24&lt;02:35,  3.09it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 420/900 [01:24&lt;02:35,  3.08it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 421/900 [01:24&lt;02:35,  3.08it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 422/900 [01:25&lt;02:34,  3.08it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 423/900 [01:25&lt;02:35,  3.07it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 424/900 [01:25&lt;02:35,  3.06it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 425/900 [01:26&lt;02:36,  3.04it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 426/900 [01:26&lt;02:36,  3.03it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 427/900 [01:26&lt;02:36,  3.03it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 428/900 [01:27&lt;02:36,  3.02it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 429/900 [01:27&lt;02:37,  3.00it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 430/900 [01:27&lt;02:36,  3.00it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 431/900 [01:28&lt;02:36,  3.00it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 432/900 [01:28&lt;02:36,  3.00it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 433/900 [01:28&lt;02:35,  3.00it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 434/900 [01:29&lt;02:35,  2.99it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 435/900 [01:29&lt;02:35,  2.99it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 436/900 [01:29&lt;02:35,  2.98it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 437/900 [01:30&lt;02:34,  2.99it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 438/900 [01:30&lt;02:35,  2.97it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 439/900 [01:30&lt;02:35,  2.96it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 440/900 [01:31&lt;02:35,  2.96it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 441/900 [01:31&lt;02:35,  2.95it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 442/900 [01:31&lt;02:35,  2.95it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 443/900 [01:32&lt;02:35,  2.94it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 444/900 [01:32&lt;02:35,  2.93it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 445/900 [01:32&lt;02:35,  2.94it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 446/900 [01:33&lt;02:34,  2.93it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 447/900 [01:33&lt;02:35,  2.92it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 448/900 [01:33&lt;02:36,  2.89it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 449/900 [01:34&lt;02:38,  2.85it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 450/900 [01:34&lt;02:39,  2.83it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 451/900 [01:35&lt;02:39,  2.82it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 452/900 [01:35&lt;02:37,  2.84it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 453/900 [01:35&lt;02:36,  2.85it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 454/900 [01:36&lt;02:36,  2.86it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 455/900 [01:36&lt;02:35,  2.87it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 456/900 [01:36&lt;02:36,  2.84it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 457/900 [01:37&lt;02:35,  2.85it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 458/900 [01:37&lt;02:35,  2.85it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 459/900 [01:37&lt;02:34,  2.85it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 460/900 [01:38&lt;02:34,  2.85it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 461/900 [01:38&lt;02:34,  2.85it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 462/900 [01:38&lt;02:33,  2.85it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 463/900 [01:39&lt;02:33,  2.86it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 464/900 [01:39&lt;02:32,  2.86it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 465/900 [01:39&lt;02:33,  2.84it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 466/900 [01:40&lt;02:35,  2.78it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 467/900 [01:40&lt;02:35,  2.78it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 468/900 [01:41&lt;02:34,  2.79it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 469/900 [01:41&lt;02:43,  2.63it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 470/900 [01:41&lt;02:42,  2.65it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 471/900 [01:42&lt;02:39,  2.69it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 472/900 [01:42&lt;02:41,  2.65it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 473/900 [01:42&lt;02:40,  2.66it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 474/900 [01:43&lt;02:43,  2.61it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 475/900 [01:43&lt;02:40,  2.64it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 476/900 [01:44&lt;02:44,  2.58it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 477/900 [01:44&lt;02:41,  2.62it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 478/900 [01:44&lt;02:43,  2.59it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 479/900 [01:45&lt;02:44,  2.56it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 480/900 [01:45&lt;02:41,  2.60it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 481/900 [01:46&lt;02:46,  2.52it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 482/900 [01:46&lt;02:47,  2.50it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 483/900 [01:46&lt;02:42,  2.56it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 484/900 [01:47&lt;02:44,  2.52it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 485/900 [01:47&lt;02:42,  2.56it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 486/900 [01:48&lt;02:39,  2.60it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 487/900 [01:48&lt;02:36,  2.63it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 488/900 [01:48&lt;02:37,  2.61it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 489/900 [01:49&lt;02:35,  2.64it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 490/900 [01:49&lt;02:34,  2.66it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 491/900 [01:49&lt;02:33,  2.67it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 492/900 [01:50&lt;02:32,  2.68it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 493/900 [01:50&lt;02:35,  2.61it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 494/900 [01:51&lt;02:34,  2.63it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 495/900 [01:51&lt;02:33,  2.64it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 496/900 [01:51&lt;02:32,  2.65it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 497/900 [01:52&lt;02:31,  2.66it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 498/900 [01:52&lt;02:30,  2.67it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 499/900 [01:52&lt;02:30,  2.67it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 500/900 [01:53&lt;02:30,  2.66it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 501/900 [01:53&lt;02:29,  2.66it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 502/900 [01:54&lt;02:29,  2.65it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 503/900 [01:54&lt;02:29,  2.65it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 504/900 [01:54&lt;02:29,  2.65it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 505/900 [01:55&lt;02:28,  2.65it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 506/900 [01:55&lt;02:28,  2.65it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 507/900 [01:55&lt;02:28,  2.65it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 508/900 [01:56&lt;02:28,  2.64it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 509/900 [01:56&lt;02:28,  2.64it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 510/900 [01:57&lt;02:27,  2.64it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 511/900 [01:57&lt;02:28,  2.63it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 512/900 [01:57&lt;02:27,  2.63it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 513/900 [01:58&lt;02:27,  2.62it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 514/900 [01:58&lt;02:27,  2.62it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 515/900 [01:58&lt;02:27,  2.62it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 516/900 [01:59&lt;02:27,  2.60it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 517/900 [01:59&lt;02:27,  2.60it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 518/900 [02:00&lt;02:27,  2.59it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 519/900 [02:00&lt;02:27,  2.58it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 520/900 [02:00&lt;02:27,  2.58it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 521/900 [02:01&lt;02:26,  2.58it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 522/900 [02:01&lt;02:26,  2.58it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 523/900 [02:02&lt;02:26,  2.57it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 524/900 [02:02&lt;02:26,  2.57it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 525/900 [02:02&lt;02:26,  2.56it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 526/900 [02:03&lt;02:26,  2.56it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 527/900 [02:03&lt;02:25,  2.56it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 528/900 [02:04&lt;02:26,  2.55it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 529/900 [02:04&lt;02:25,  2.54it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 530/900 [02:04&lt;02:25,  2.54it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 531/900 [02:05&lt;02:25,  2.53it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 532/900 [02:05&lt;02:25,  2.54it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 533/900 [02:06&lt;02:25,  2.53it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 534/900 [02:06&lt;02:24,  2.52it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 535/900 [02:06&lt;02:24,  2.52it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 536/900 [02:07&lt;02:24,  2.52it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 537/900 [02:07&lt;02:24,  2.52it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 538/900 [02:08&lt;02:23,  2.52it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 539/900 [02:08&lt;02:23,  2.52it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 540/900 [02:08&lt;02:23,  2.51it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 541/900 [02:09&lt;02:22,  2.51it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 542/900 [02:09&lt;02:22,  2.51it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 543/900 [02:10&lt;02:22,  2.51it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 544/900 [02:10&lt;02:22,  2.49it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 545/900 [02:10&lt;02:23,  2.48it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 546/900 [02:11&lt;02:23,  2.47it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 547/900 [02:11&lt;02:25,  2.43it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 548/900 [02:12&lt;02:29,  2.36it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 549/900 [02:12&lt;02:27,  2.38it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 550/900 [02:12&lt;02:25,  2.40it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 551/900 [02:13&lt;02:25,  2.41it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 552/900 [02:13&lt;02:24,  2.41it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 553/900 [02:14&lt;02:23,  2.41it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 554/900 [02:14&lt;02:23,  2.41it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 555/900 [02:15&lt;02:22,  2.41it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 556/900 [02:15&lt;02:22,  2.41it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 557/900 [02:15&lt;02:22,  2.41it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 558/900 [02:16&lt;02:22,  2.40it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 559/900 [02:16&lt;02:22,  2.40it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 560/900 [02:17&lt;02:22,  2.39it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 561/900 [02:17&lt;02:21,  2.39it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 562/900 [02:17&lt;02:21,  2.39it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 563/900 [02:18&lt;02:21,  2.39it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 564/900 [02:18&lt;02:20,  2.39it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 565/900 [02:19&lt;02:20,  2.39it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 566/900 [02:19&lt;02:19,  2.39it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 567/900 [02:20&lt;02:19,  2.39it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 568/900 [02:20&lt;02:19,  2.37it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 569/900 [02:20&lt;02:19,  2.37it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 570/900 [02:21&lt;02:19,  2.37it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 571/900 [02:21&lt;02:19,  2.36it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 572/900 [02:22&lt;02:19,  2.36it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 573/900 [02:22&lt;02:19,  2.35it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 574/900 [02:23&lt;02:22,  2.29it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 575/900 [02:23&lt;02:21,  2.29it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 576/900 [02:23&lt;02:20,  2.31it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 577/900 [02:24&lt;02:18,  2.33it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 578/900 [02:24&lt;02:18,  2.33it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 579/900 [02:25&lt;02:18,  2.31it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 580/900 [02:25&lt;02:18,  2.31it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 581/900 [02:26&lt;02:17,  2.31it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 582/900 [02:26&lt;02:17,  2.32it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 583/900 [02:26&lt;02:16,  2.32it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 584/900 [02:27&lt;02:16,  2.31it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 585/900 [02:27&lt;02:16,  2.31it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 586/900 [02:28&lt;02:17,  2.29it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 587/900 [02:28&lt;02:16,  2.29it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 588/900 [02:29&lt;02:15,  2.30it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 589/900 [02:29&lt;02:15,  2.30it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 590/900 [02:29&lt;02:15,  2.29it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 591/900 [02:30&lt;02:14,  2.29it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 592/900 [02:30&lt;02:14,  2.29it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 593/900 [02:31&lt;02:15,  2.26it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 594/900 [02:31&lt;02:14,  2.27it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 595/900 [02:32&lt;02:14,  2.27it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 596/900 [02:32&lt;02:14,  2.27it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 597/900 [02:33&lt;02:15,  2.23it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 598/900 [02:33&lt;02:14,  2.24it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 599/900 [02:33&lt;02:13,  2.25it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 600/900 [02:34&lt;02:15,  2.22it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 601/900 [02:34&lt;02:13,  2.24it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 602/900 [02:35&lt;02:12,  2.24it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 603/900 [02:35&lt;02:16,  2.18it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 604/900 [02:36&lt;02:14,  2.20it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 605/900 [02:36&lt;02:15,  2.18it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 606/900 [02:37&lt;02:17,  2.14it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 607/900 [02:37&lt;02:16,  2.15it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 608/900 [02:38&lt;02:13,  2.18it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 609/900 [02:38&lt;02:11,  2.21it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 610/900 [02:39&lt;02:12,  2.19it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 611/900 [02:39&lt;02:11,  2.20it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 612/900 [02:40&lt;02:18,  2.07it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 613/900 [02:40&lt;02:18,  2.07it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 614/900 [02:40&lt;02:18,  2.07it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 615/900 [02:41&lt;02:14,  2.11it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 616/900 [02:41&lt;02:14,  2.12it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 617/900 [02:42&lt;02:12,  2.14it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 618/900 [02:42&lt;02:10,  2.16it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 619/900 [02:43&lt;02:09,  2.17it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 620/900 [02:43&lt;02:09,  2.17it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 621/900 [02:44&lt;02:08,  2.18it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 622/900 [02:44&lt;02:07,  2.18it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 623/900 [02:45&lt;02:07,  2.17it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 624/900 [02:45&lt;02:06,  2.18it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 625/900 [02:46&lt;02:05,  2.19it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 626/900 [02:46&lt;02:05,  2.18it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 627/900 [02:46&lt;02:04,  2.18it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 628/900 [02:47&lt;02:04,  2.19it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 629/900 [02:47&lt;02:03,  2.19it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 630/900 [02:48&lt;02:04,  2.17it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 631/900 [02:48&lt;02:03,  2.18it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 632/900 [02:49&lt;02:03,  2.18it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 633/900 [02:49&lt;02:02,  2.18it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 634/900 [02:50&lt;02:01,  2.18it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 635/900 [02:50&lt;02:01,  2.18it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 636/900 [02:51&lt;02:01,  2.17it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 637/900 [02:51&lt;02:01,  2.17it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 638/900 [02:52&lt;02:00,  2.17it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 639/900 [02:52&lt;02:00,  2.17it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 640/900 [02:52&lt;02:00,  2.16it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 641/900 [02:53&lt;02:00,  2.16it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 642/900 [02:53&lt;02:00,  2.15it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 643/900 [02:54&lt;02:00,  2.14it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 644/900 [02:54&lt;01:59,  2.14it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 645/900 [02:55&lt;01:59,  2.14it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 646/900 [02:55&lt;01:58,  2.14it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 647/900 [02:56&lt;01:58,  2.14it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 648/900 [02:56&lt;01:58,  2.13it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 649/900 [02:57&lt;01:57,  2.14it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 650/900 [02:57&lt;01:57,  2.13it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 651/900 [02:58&lt;01:56,  2.13it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 652/900 [02:58&lt;01:56,  2.13it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 653/900 [02:59&lt;01:56,  2.13it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 654/900 [02:59&lt;01:56,  2.12it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 655/900 [02:59&lt;01:55,  2.12it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 656/900 [03:00&lt;01:55,  2.11it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 657/900 [03:00&lt;01:54,  2.11it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 658/900 [03:01&lt;01:54,  2.11it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 659/900 [03:01&lt;01:54,  2.11it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 660/900 [03:02&lt;01:53,  2.11it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 661/900 [03:02&lt;01:53,  2.11it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 662/900 [03:03&lt;01:53,  2.10it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 663/900 [03:03&lt;01:52,  2.10it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 664/900 [03:04&lt;01:52,  2.10it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 665/900 [03:04&lt;01:52,  2.10it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 666/900 [03:05&lt;01:52,  2.09it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 667/900 [03:05&lt;01:51,  2.08it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 668/900 [03:06&lt;01:51,  2.08it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 669/900 [03:06&lt;01:51,  2.07it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 670/900 [03:07&lt;01:51,  2.07it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 671/900 [03:07&lt;01:50,  2.07it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 672/900 [03:08&lt;01:50,  2.07it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 673/900 [03:08&lt;01:49,  2.07it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 674/900 [03:09&lt;01:49,  2.06it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 675/900 [03:09&lt;01:49,  2.06it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 676/900 [03:10&lt;01:49,  2.05it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 677/900 [03:10&lt;01:48,  2.05it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 678/900 [03:11&lt;01:48,  2.05it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 679/900 [03:11&lt;01:47,  2.05it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 680/900 [03:12&lt;01:47,  2.05it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 681/900 [03:12&lt;01:46,  2.05it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 682/900 [03:13&lt;01:46,  2.04it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 683/900 [03:13&lt;01:46,  2.04it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 684/900 [03:13&lt;01:45,  2.04it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 685/900 [03:14&lt;01:45,  2.04it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 686/900 [03:14&lt;01:45,  2.03it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 687/900 [03:15&lt;01:44,  2.04it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 688/900 [03:15&lt;01:44,  2.04it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 689/900 [03:16&lt;01:44,  2.03it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 690/900 [03:16&lt;01:43,  2.03it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 691/900 [03:17&lt;01:43,  2.03it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 692/900 [03:17&lt;01:43,  2.02it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 693/900 [03:18&lt;01:43,  2.01it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 694/900 [03:18&lt;01:42,  2.01it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 695/900 [03:19&lt;01:42,  2.00it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 696/900 [03:19&lt;01:41,  2.00it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 697/900 [03:20&lt;01:41,  2.00it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 698/900 [03:20&lt;01:41,  2.00it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 699/900 [03:21&lt;01:40,  2.00it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 700/900 [03:21&lt;01:40,  2.00it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 701/900 [03:22&lt;01:39,  1.99it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 702/900 [03:22&lt;01:39,  1.99it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 703/900 [03:23&lt;01:38,  1.99it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 704/900 [03:23&lt;01:38,  1.99it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 705/900 [03:24&lt;01:38,  1.99it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 706/900 [03:24&lt;01:38,  1.98it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 707/900 [03:25&lt;01:37,  1.98it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 708/900 [03:25&lt;01:37,  1.97it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 709/900 [03:26&lt;01:36,  1.97it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 710/900 [03:27&lt;01:36,  1.97it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 711/900 [03:27&lt;01:35,  1.97it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 712/900 [03:28&lt;01:35,  1.97it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 713/900 [03:28&lt;01:34,  1.97it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 714/900 [03:29&lt;01:34,  1.97it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 715/900 [03:29&lt;01:34,  1.96it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 716/900 [03:30&lt;01:33,  1.96it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 717/900 [03:30&lt;01:33,  1.96it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 718/900 [03:31&lt;01:33,  1.95it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 719/900 [03:31&lt;01:32,  1.95it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 720/900 [03:32&lt;01:32,  1.94it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 721/900 [03:32&lt;01:32,  1.94it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 722/900 [03:33&lt;01:31,  1.95it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 723/900 [03:33&lt;01:30,  1.95it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 724/900 [03:34&lt;01:30,  1.94it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 725/900 [03:34&lt;01:30,  1.93it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 726/900 [03:35&lt;01:29,  1.93it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 727/900 [03:35&lt;01:29,  1.94it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 728/900 [03:36&lt;01:28,  1.94it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 729/900 [03:36&lt;01:28,  1.93it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 730/900 [03:37&lt;01:28,  1.93it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 731/900 [03:37&lt;01:27,  1.92it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 732/900 [03:38&lt;01:27,  1.92it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 733/900 [03:38&lt;01:27,  1.91it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 734/900 [03:39&lt;01:27,  1.90it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 735/900 [03:39&lt;01:26,  1.90it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 736/900 [03:40&lt;01:26,  1.90it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 737/900 [03:40&lt;01:25,  1.91it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 738/900 [03:41&lt;01:25,  1.90it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 739/900 [03:42&lt;01:24,  1.90it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 740/900 [03:42&lt;01:24,  1.90it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 741/900 [03:43&lt;01:23,  1.90it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 742/900 [03:43&lt;01:23,  1.90it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 743/900 [03:44&lt;01:22,  1.90it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 744/900 [03:44&lt;01:22,  1.90it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 745/900 [03:45&lt;01:21,  1.90it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 746/900 [03:45&lt;01:21,  1.89it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 747/900 [03:46&lt;01:21,  1.89it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 748/900 [03:46&lt;01:21,  1.87it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 749/900 [03:47&lt;01:20,  1.87it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 750/900 [03:47&lt;01:20,  1.87it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 751/900 [03:48&lt;01:19,  1.87it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 752/900 [03:48&lt;01:19,  1.87it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 753/900 [03:49&lt;01:18,  1.87it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 754/900 [03:50&lt;01:18,  1.87it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 755/900 [03:50&lt;01:17,  1.86it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 756/900 [03:51&lt;01:17,  1.86it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 757/900 [03:51&lt;01:16,  1.86it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 758/900 [03:52&lt;01:16,  1.86it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 759/900 [03:52&lt;01:15,  1.86it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 760/900 [03:53&lt;01:15,  1.86it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 761/900 [03:53&lt;01:14,  1.86it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 762/900 [03:54&lt;01:14,  1.85it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 763/900 [03:54&lt;01:13,  1.85it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 764/900 [03:55&lt;01:13,  1.85it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 765/900 [03:55&lt;01:13,  1.83it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 766/900 [03:56&lt;01:12,  1.84it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 767/900 [03:57&lt;01:12,  1.84it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 768/900 [03:57&lt;01:11,  1.84it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 769/900 [03:58&lt;01:12,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 770/900 [03:58&lt;01:11,  1.82it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 771/900 [03:59&lt;01:11,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 772/900 [03:59&lt;01:10,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 773/900 [04:00&lt;01:10,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 774/900 [04:00&lt;01:09,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 775/900 [04:01&lt;01:08,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 776/900 [04:02&lt;01:08,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 777/900 [04:02&lt;01:07,  1.81it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 778/900 [04:03&lt;01:07,  1.81it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 779/900 [04:03&lt;01:06,  1.81it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 780/900 [04:04&lt;01:06,  1.80it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 781/900 [04:04&lt;01:05,  1.81it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 782/900 [04:05&lt;01:05,  1.80it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 783/900 [04:05&lt;01:04,  1.80it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 784/900 [04:06&lt;01:04,  1.80it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 785/900 [04:07&lt;01:03,  1.81it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 786/900 [04:07&lt;01:03,  1.80it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 787/900 [04:08&lt;01:02,  1.81it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 788/900 [04:08&lt;01:02,  1.80it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 789/900 [04:09&lt;01:01,  1.80it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 790/900 [04:09&lt;01:01,  1.80it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 791/900 [04:10&lt;01:00,  1.79it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 792/900 [04:10&lt;01:00,  1.79it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 793/900 [04:11&lt;00:59,  1.79it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 794/900 [04:12&lt;00:59,  1.79it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 795/900 [04:12&lt;00:58,  1.79it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 796/900 [04:13&lt;00:58,  1.79it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 797/900 [04:13&lt;00:57,  1.79it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 798/900 [04:14&lt;00:57,  1.79it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 799/900 [04:14&lt;00:56,  1.79it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 800/900 [04:15&lt;00:56,  1.78it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 801/900 [04:15&lt;00:55,  1.77it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 802/900 [04:16&lt;00:55,  1.77it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 803/900 [04:17&lt;00:54,  1.76it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 804/900 [04:17&lt;00:54,  1.76it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 805/900 [04:18&lt;00:53,  1.76it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 806/900 [04:18&lt;00:53,  1.76it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 807/900 [04:19&lt;00:52,  1.76it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 808/900 [04:19&lt;00:52,  1.76it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 809/900 [04:20&lt;00:51,  1.75it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 810/900 [04:21&lt;00:51,  1.75it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 811/900 [04:21&lt;00:50,  1.75it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 812/900 [04:22&lt;00:50,  1.76it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 813/900 [04:22&lt;00:49,  1.75it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 814/900 [04:23&lt;00:49,  1.75it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 815/900 [04:23&lt;00:48,  1.75it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 816/900 [04:24&lt;00:48,  1.75it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 817/900 [04:25&lt;00:47,  1.74it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 818/900 [04:25&lt;00:46,  1.74it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 819/900 [04:26&lt;00:46,  1.74it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 820/900 [04:26&lt;00:45,  1.74it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 821/900 [04:27&lt;00:45,  1.73it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 822/900 [04:27&lt;00:45,  1.73it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 823/900 [04:28&lt;00:44,  1.73it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 824/900 [04:29&lt;00:43,  1.73it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 825/900 [04:29&lt;00:43,  1.73it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 826/900 [04:30&lt;00:42,  1.73it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 827/900 [04:30&lt;00:42,  1.72it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 828/900 [04:31&lt;00:41,  1.72it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 829/900 [04:32&lt;00:41,  1.72it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 830/900 [04:32&lt;00:40,  1.72it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 831/900 [04:33&lt;00:40,  1.72it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 832/900 [04:33&lt;00:39,  1.72it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 833/900 [04:34&lt;00:39,  1.72it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 834/900 [04:34&lt;00:38,  1.71it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 835/900 [04:35&lt;00:37,  1.71it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 836/900 [04:36&lt;00:37,  1.71it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 837/900 [04:36&lt;00:36,  1.71it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 838/900 [04:37&lt;00:36,  1.71it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 839/900 [04:37&lt;00:35,  1.70it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 840/900 [04:38&lt;00:35,  1.71it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 841/900 [04:39&lt;00:34,  1.71it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 842/900 [04:39&lt;00:33,  1.71it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 843/900 [04:40&lt;00:33,  1.71it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 844/900 [04:40&lt;00:32,  1.70it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 845/900 [04:41&lt;00:32,  1.70it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 846/900 [04:41&lt;00:31,  1.70it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 847/900 [04:42&lt;00:31,  1.70it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 848/900 [04:43&lt;00:30,  1.70it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 849/900 [04:43&lt;00:30,  1.70it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 850/900 [04:44&lt;00:29,  1.69it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 851/900 [04:44&lt;00:29,  1.69it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 852/900 [04:45&lt;00:28,  1.68it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 853/900 [04:46&lt;00:28,  1.67it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 854/900 [04:46&lt;00:27,  1.66it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 855/900 [04:47&lt;00:27,  1.67it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 856/900 [04:47&lt;00:26,  1.66it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 857/900 [04:48&lt;00:25,  1.67it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 858/900 [04:49&lt;00:25,  1.67it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 859/900 [04:49&lt;00:24,  1.67it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 860/900 [04:50&lt;00:23,  1.67it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 861/900 [04:50&lt;00:23,  1.67it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 862/900 [04:51&lt;00:22,  1.67it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 863/900 [04:52&lt;00:22,  1.67it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 864/900 [04:52&lt;00:21,  1.66it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 865/900 [04:53&lt;00:21,  1.66it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 866/900 [04:53&lt;00:20,  1.65it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 867/900 [04:54&lt;00:19,  1.66it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 868/900 [04:55&lt;00:19,  1.65it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 869/900 [04:55&lt;00:18,  1.65it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 870/900 [04:56&lt;00:18,  1.65it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 871/900 [04:57&lt;00:17,  1.64it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 872/900 [04:57&lt;00:17,  1.65it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 873/900 [04:58&lt;00:16,  1.64it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 874/900 [04:58&lt;00:15,  1.64it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 875/900 [04:59&lt;00:15,  1.63it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 876/900 [05:00&lt;00:14,  1.64it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 877/900 [05:00&lt;00:14,  1.63it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 878/900 [05:01&lt;00:13,  1.63it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 879/900 [05:01&lt;00:12,  1.63it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 880/900 [05:02&lt;00:12,  1.63it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 881/900 [05:03&lt;00:11,  1.63it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 882/900 [05:03&lt;00:11,  1.62it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 883/900 [05:04&lt;00:10,  1.62it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 884/900 [05:05&lt;00:09,  1.62it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 885/900 [05:05&lt;00:09,  1.62it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 886/900 [05:06&lt;00:08,  1.62it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 887/900 [05:06&lt;00:08,  1.62it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 888/900 [05:07&lt;00:07,  1.62it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 889/900 [05:08&lt;00:06,  1.62it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 890/900 [05:08&lt;00:06,  1.62it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 891/900 [05:09&lt;00:05,  1.61it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 892/900 [05:09&lt;00:04,  1.61it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 893/900 [05:10&lt;00:04,  1.61it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 894/900 [05:11&lt;00:03,  1.61it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 895/900 [05:11&lt;00:03,  1.60it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 896/900 [05:12&lt;00:02,  1.61it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 897/900 [05:13&lt;00:01,  1.60it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 898/900 [05:13&lt;00:01,  1.60it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 899/900 [05:14&lt;00:00,  1.60it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 900/900 [05:14&lt;00:00,  1.59it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 900/900 [05:14&lt;00:00,  2.86it/s]</code></pre>
</div>
</div>
<div id="5e4f5922" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb29-2">plt.plot(M_values, var_bs_values, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb29-3">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Nombre de simulations'</span>)</span>
<span id="cb29-4">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'VaR bootstrap'</span>)</span>
<span id="cb29-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation de la VaR bootstrap en fonction du nombre de simulations"</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>Text(0.5, 1.0, 'Variation de la VaR bootstrap en fonction du nombre de simulations')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Pour la taille de l‚Äôechantillon bootstrap, nous allons prendre M=8000 √©tant donn√© que la courbe semble se stabiliser √† partir de cette valeur. Avec ce choix, la VaR estim√© est de 4.11%% avec un intervalle de confiance √† 5% de [4.05%, 4.09%]. De plus, en ce qui concerne la VaR historique, nous constatons que l‚Äôestimation est contenu dans l‚Äôintervalle de confiance.</p>
<div id="67702b22" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">M<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8000</span></span>
<span id="cb31-2">var_bs_train, lower_ic,upper_ic <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bootstrap_var(data_train, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha, M<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>M)</span>
<span id="cb31-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR bootstrap pour h=1j et alpha=0.99 est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_bs_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb31-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"L'intervalle de confiance est : [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lower_ic<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>upper_ic<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">]"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR bootstrap pour h=1j et alpha=0.99 est : 4.1065%
L'intervalle de confiance est : [4.0536%, 4.0939%]</code></pre>
</div>
</div>
</section>
<section id="ii.2.3.-backtest" class="level3">
<h3 class="anchored" data-anchor-id="ii.2.3.-backtest">II.2.3. Backtest</h3>
<p>Pour l‚Äôexercice de backtest, il s‚Äôagit de : 1. D√©terminer si la proportion <img src="https://latex.codecogs.com/png.latex?p"> de violations de la VaR est coh√©rente avec le niveau de confiance, i.e.&nbsp;√©gale √† <img src="https://latex.codecogs.com/png.latex?1-%5Calpha">. Cela permet de v√©rifier si la mesure de risque est bien calibr√©e. Pour cela, nous pouvons avoir recours √† un test de proportion ou un test de ratio de vraisemblance.</p>
<pre><code>**Unconditional coverage test** :
Soit I la variable indicatrice de violation de la VaR, i.e. $I=1$ si la perte est sup√©rieure √† la VaR, et $I=0$ sinon. La proportion de violations de la VaR est donn√©e par :

$$p = \frac{1}{n} \sum_{i=1}^{n} I_i = \frac{Z}{n}$$

Sous H0, i.e. p=1-$\alpha$, Z $\sim$ Binomiale(n, 1-$\alpha$). En supposant que n est suffisamment grand, on peut approximer Z par une loi normale. Ainsi donc :
$$\frac{Z - n (1-\alpha)}{\sqrt{\alpha (1-\alpha) n}} \sim \mathcal{N}(n(1-\alpha), n\alpha(1-\alpha))$$

Sous cette hypoth√®se asymptotique, on peut calculer la statistique du ratio de vraisemblance suivant :
$$LR = -2 ln \left( \frac{L(H1)}{L(H0)} \right) =-2 ln \left( 1- (1-\alpha))^{n-e}(1-\alpha)^e \right) + 2 ln \left( (1-\frac{e}{n})^{n-e} (\frac{e}{n})^e  \right)  \sim \chi^2(1)$$

o√π e est le nombre de violations de la VaR. On rejette H0 si LR &gt; $\chi^2(1-\alpha)$.

**Test de proportion** :
$$
H_0 : p = p_0 = 1-\alpha \\ H_1 : p &gt; 1-\alpha
$$
On peut √©galement utiliser un test binomial pour tester si la proportion de violations de la VaR est √©gale √† $1-\alpha$. On peut calculer la statistique du test suivant :
$$Z = \frac{p - p_0}{\sqrt{p_0 (1-p_0) / n}} \sim \mathcal{N}(0,1)$$

On rejette H0 si Z &gt; $p_0+ \phi^{-1}(1-\alpha) \sqrt{p_0 (1-p_0)/n}$, o√π $\phi$ est la quantile de la loi normale standard.</code></pre>
<ol start="2" type="1">
<li><p>D√©terminer si, lorsqu‚Äôil y en a, les violations de VaR √† deux diff√©rents jours sont ind√©pendantes. Cela permet si la mesure de risque est capable de r√©agir aux chocs de march√© affectant la volatilit√© des rendements. Pour cela, nous utilisons un conditional coverage test.</p>
<p><strong>Conditional coverage test</strong> : y revenir</p></li>
</ol>
<div id="954b7432" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> stats</span>
<span id="cb34-2"></span>
<span id="cb34-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : impl√©menter une fonction calculant le nombre d'exception sur l'√©chantillon test</span></span>
<span id="cb34-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> exceptions(data, var):</span>
<span id="cb34-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb34-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul du nombre d'exception</span></span>
<span id="cb34-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb34-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    var : la VaR</span></span>
<span id="cb34-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb34-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>var)</span>
<span id="cb34-11"></span>
<span id="cb34-12"></span>
<span id="cb34-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : test de proportion binomiale</span></span>
<span id="cb34-14"></span>
<span id="cb34-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> binomial_test(n, p, p0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>):</span>
<span id="cb34-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb34-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Test de proportion binomiale</span></span>
<span id="cb34-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    H0 : p = p0</span></span>
<span id="cb34-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    H1 : p &gt; p0</span></span>
<span id="cb34-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    n : le nombre d'essais</span></span>
<span id="cb34-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    p : la proportion</span></span>
<span id="cb34-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb34-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb34-24"></span>
<span id="cb34-25">    z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p0) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.sqrt(p0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p0) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n)</span>
<span id="cb34-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#reject_zone = p0 + stats.norm.ppf(1 - alpha) * np.sqrt(p0 * (1 - p0) / n)</span></span>
<span id="cb34-27">    p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> stats.norm.cdf(z)</span>
<span id="cb34-28">    reject <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> alpha</span>
<span id="cb34-29"></span>
<span id="cb34-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des IC</span></span>
<span id="cb34-31">    lower <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> stats.norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n)</span>
<span id="cb34-32">    upper <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> stats.norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n)</span>
<span id="cb34-33"></span>
<span id="cb34-34">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> p_value, reject, lower, upper</span>
<span id="cb34-35"></span>
<span id="cb34-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unconditionnal coverage test ==&gt; to do.</span></span></code></pre></div>
</div>
<div id="a660e3eb" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backtest de la VaR historique</span></span>
<span id="cb35-2"></span>
<span id="cb35-3">exceptions_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> exceptions(data_test, var_hist_train)</span>
<span id="cb35-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le nombre d'exceptions sur l'√©chantillon de test est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>exceptions_test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb35-5"></span>
<span id="cb35-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb35-7">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_test)</span>
<span id="cb35-8">p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> exceptions_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n</span>
<span id="cb35-9">p_value, reject, lower,upper <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> binomial_test(n, p)</span>
<span id="cb35-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"H0 : le nombre d'exceptions est inf√©rieur ou √©gale √† </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb35-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"IC : [</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>lower<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">,</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>upper<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">]"</span>)</span>
<span id="cb35-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La p-value du test de proportion binomiale est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p_value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb35-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Rejet de l'hypoth√®se nulle : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>reject<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb35-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le nombre d'exceptions sur l'√©chantillon de test est : 0
================================================================================
H0 : le nombre d'exceptions est inf√©rieur ou √©gale √† 1.00%
IC : [0.00%,0.00%]
La p-value du test de proportion binomiale est : 0.9925
Rejet de l'hypoth√®se nulle : False
================================================================================</code></pre>
</div>
</div>
</section>
</section>
<section id="ii.3.-var-param√©trique" class="level2">
<h2 class="anchored" data-anchor-id="ii.3.-var-param√©trique">II.3. VaR param√©trique</h2>
<section id="ii.3.1.-validation-ex-ante" class="level3">
<h3 class="anchored" data-anchor-id="ii.3.1.-validation-ex-ante">II.3.1. Validation ex-ante</h3>
<p>Visuellement, les donn√©es ne semblent pas suivre une loi normale. En effet, les quantiles th√©oriques d‚Äôune loi normale ne collent pas avec les quantiles empiriques des rendements. Cela peut √™tre d√ª √† la pr√©sence de queues √©paisses observables sur l‚Äôestimation de la densit√© des rendements sur l‚Äô√©chantillon d‚Äôapprentissage, de pics, de clusters de volatilit√© que nous avons observ√©es plus haut. De plus, le skewness est n√©gatif ce qui indique une asym√©trie n√©gative des rendements. Enfin, le kurtosis est sup√©rieur √† 3, ce qui indique une distribution leptokurtique des rendements.</p>
<p>Nous allons tout de m√™me impl√©menter une VaR gaussienne pour voir comment elle se comporte dans le backtest.</p>
<div id="781daeeb" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test visuel d'ad√©quation de la loi normale</span></span>
<span id="cb37-2"></span>
<span id="cb37-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©er un Q-Q plot</span></span>
<span id="cb37-4">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb37-5">stats.probplot(data_train, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm"</span>, plot<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ax)</span>
<span id="cb37-6"></span>
<span id="cb37-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Personnalisation du graphique</span></span>
<span id="cb37-8">ax.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Q-Q Plot (Normal Distribution)"</span>)</span>
<span id="cb37-9">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Theoretical Quantiles"</span>)</span>
<span id="cb37-10">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample Quantiles"</span>)</span>
<span id="cb37-11"></span>
<span id="cb37-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Afficher le graphique</span></span>
<span id="cb37-13">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8b0a95a8" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© de l'echantillon train et l'√©chantillon de test</span></span>
<span id="cb38-2"></span>
<span id="cb38-3">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb38-4">data_train.plot(kind<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'kde'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Train'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb38-5">plt.legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'upper left'</span>)</span>
<span id="cb38-6">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Densit√© de l'√©chantillon d'entrainement"</span>)</span>
<span id="cb38-7">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="7b671a3f" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Skewness et kurtosis</span></span>
<span id="cb39-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb39-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Skewness de l'√©chantillon d'entrainement : "</span>, data_train.skew())</span>
<span id="cb39-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kurtosis de l'√©chantillon d'entrainement : "</span>, data_train.kurt())</span>
<span id="cb39-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Skewness de l'√©chantillon d'entrainement :  -0.2981820421484688
Kurtosis de l'√©chantillon d'entrainement :  7.353960005618779
================================================================================</code></pre>
</div>
</div>
<div id="b9670dff" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> kstest</span>
<span id="cb41-2"></span>
<span id="cb41-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Test de Kolmogorov-Smirnov</span></span>
<span id="cb41-4">ks_stat, ks_p_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kstest(data_train, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'norm'</span>)</span>
<span id="cb41-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb41-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"H0 : Les donn√©es suivent une loi normale"</span>)</span>
<span id="cb41-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Statistique de test : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ks_stat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb41-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"P-value : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ks_p_value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb41-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
H0 : Les donn√©es suivent une loi normale
Statistique de test : 0.4775
P-value : 0.0000
================================================================================</code></pre>
</div>
</div>
</section>
<section id="ii.3.2.-impl√©mentation-de-la-var" class="level3">
<h3 class="anchored" data-anchor-id="ii.3.2.-impl√©mentation-de-la-var">II.3.2. Impl√©mentation de la VaR</h3>
<section id="a.-m√©thode-scaling" class="level4">
<h4 class="anchored" data-anchor-id="a.-m√©thode-scaling">a. M√©thode scaling</h4>
<div id="1d8aff3c" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : √©crire une fonction qui calcule la VaR gaussienne</span></span>
<span id="cb43-2"></span>
<span id="cb43-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> gaussian_var(data, alpha):</span>
<span id="cb43-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb43-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne</span></span>
<span id="cb43-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb43-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb43-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb43-9">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb43-10"></span>
<span id="cb43-11">    mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(data)</span>
<span id="cb43-12">    sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(data)</span>
<span id="cb43-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha))</span></code></pre></div>
</div>
<div id="7a456048" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1">var_gauss_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gaussian_var(data_train, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span>
<span id="cb44-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR gaussienne pour h=1j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_gauss_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb44-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR historique pour h=10j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>var_gauss_train<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR gaussienne pour h=1j et alpha=0.99 est : 3.2302%
La VaR historique pour h=10j et alpha=0.99 est : 10.2148%</code></pre>
</div>
</div>
</section>
<section id="b.-m√©thode-de-diffusion-dun-actif" class="level4">
<h4 class="anchored" data-anchor-id="b.-m√©thode-de-diffusion-dun-actif">b. M√©thode de diffusion d‚Äôun actif</h4>
<p>Pour calculer la <strong>VaR gaussienne √† 10 jours</strong> par <strong>m√©thode de diffusion d‚Äôun actif</strong>, nous allons suivre les √©tapes suivantes :</p>
<p>L‚Äô√©volution du prix d‚Äôun actif suit un processus de type mouvement brownien g√©om√©trique : <img src="https://latex.codecogs.com/png.latex?%0AdS_t%20=%20%5Cmu%20S_t%20dt%20+%20%5Csigma%20S_t%20dW_t%20%3C=%3E%20S_t%20=%20S_%7Bt-1%7D%20e%5E%7B(%5Cmu%20-%20%5Cfrac%7B1%7D%7B2%7D%20%5Csigma%5E2)%20+%20%5Csigma%20W_t%7D%0A"> o√π $ S_t$ est le prix de l‚Äôactif √† l‚Äôinstant$ t$, $ $ est le rendement moyen estim√© (drift), $ $ est la volatilit√© du rendement, $ dW_t$ est un mouvement brownien standard.</p>
<p>On peut de ce fait calculer plusieurs trajectoires de rendements de <img src="https://latex.codecogs.com/png.latex?S_0"> et <img src="https://latex.codecogs.com/png.latex?S_%7B10%7D">, puis calculer la VaR √† partir de la s√©rie des rendements $ r_{10j} = (S_{10} / S_{0}) $ obtenus avec ces trajectoires.</p>
<p>En utilisant la m√©thode de scaling et la m√©thode de diffusion, nous obtenons sensiblement la m√™me VaR.</p>
<div id="c4561a82" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb46-2"></span>
<span id="cb46-3">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(data_train)</span>
<span id="cb46-4">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(data_train)</span>
<span id="cb46-5"></span>
<span id="cb46-6">return_sim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb46-7">T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb46-8">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb46-9">S0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>].iloc[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb46-10"></span>
<span id="cb46-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(M):</span>
<span id="cb46-12">    S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb46-13">    S[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S0</span>
<span id="cb46-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb46-15">        Wt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal()</span>
<span id="cb46-16">        S[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp((mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Wt)</span>
<span id="cb46-17"></span>
<span id="cb46-18">    return_sim.append(np.log(S[T]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>S0))</span>
<span id="cb46-19"></span>
<span id="cb46-20">var_gauss_diffusion <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gaussian_var(return_sim, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span>
<span id="cb46-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR gaussienne pour h=10j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_gauss_diffusion<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR gaussienne pour h=10j et alpha=0.99 est : 10.0053%</code></pre>
</div>
</div>
</section>
<section id="c.-m√©thode-ewma" class="level4">
<h4 class="anchored" data-anchor-id="c.-m√©thode-ewma">c.&nbsp;M√©thode EWMA</h4>
<p>La VaR EWMA est une m√©thode qui permet de calculer la VaR en surpond√©rant les rendements les plus r√©cents. Cela permet de donner plus de poids aux rendements les plus r√©cents, et donc de mieux capturer les changements de volatilit√©. La VaR EWMA est donn√©e par la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AVaR_%7Bt+1%7D%20=%20%5Cmu%20+%20%5Csigma%20%5Ctimes%20z_%7B%5Calpha%7D%0A"></p>
<div id="db2eae5a" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VaR la m√©thode EWMA (Exponential Weighting Moving Average)</span></span>
<span id="cb48-2"></span>
<span id="cb48-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> gaussian_var_ewma(data, alpha, lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.94</span>):</span>
<span id="cb48-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb48-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR gaussienne EWMA</span></span>
<span id="cb48-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb48-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb48-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    lambda_ : le param√®tre de lissage</span></span>
<span id="cb48-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb48-10"></span>
<span id="cb48-11">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>lambda_)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>i) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data))])</span>
<span id="cb48-12">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights)</span>
<span id="cb48-13"></span>
<span id="cb48-14">    mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(data[::<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> weights)</span>
<span id="cb48-15">    sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (data[::<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb48-16"></span>
<span id="cb48-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> stats.norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha)), mu, sigma</span>
<span id="cb48-18"></span>
<span id="cb48-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># y revenir</span></span></code></pre></div>
</div>
<div id="1505b88f" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1">lambdas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>]</span>
<span id="cb49-2">alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb49-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> stats</span>
<span id="cb49-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> l <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> lambdas:</span>
<span id="cb49-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb49-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lambda : "</span>, l)</span>
<span id="cb49-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb49-8">    var_gauss_emwa, mu, sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gaussian_var_ewma(data_train, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha, lambda_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>l)</span>
<span id="cb49-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR gaussienne EWMA pour h=1j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_gauss_emwa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb49-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La moyenne est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb49-11">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"L'√©cart-type est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb49-12"></span>
<span id="cb49-13">    n_exceptions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> exceptions(data_test, var_gauss_emwa)</span>
<span id="cb49-14">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le nombre d'exceptions sur l'√©chantillon de test est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>n_exceptions<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Lambda :  0.9
---------------
La VaR gaussienne EWMA pour h=1j et alpha=0.99 est : 2.3751%
La moyenne est : 0.1898%
L'√©cart-type est : 1.1025%
Le nombre d'exceptions sur l'√©chantillon de test est : 5
================================================================================
Lambda :  0.95
---------------
La VaR gaussienne EWMA pour h=1j et alpha=0.99 est : 2.8969%
La moyenne est : 0.0735%
L'√©cart-type est : 1.2768%
Le nombre d'exceptions sur l'√©chantillon de test est : 4
================================================================================
Lambda :  0.99
---------------
La VaR gaussienne EWMA pour h=1j et alpha=0.99 est : 3.3511%
La moyenne est : -0.0321%
L'√©cart-type est : 1.4267%
Le nombre d'exceptions sur l'√©chantillon de test est : 1</code></pre>
</div>
</div>
<p>Avec la m√©thode EWMA, nous observons une que la VaR diminue plus <img src="https://latex.codecogs.com/png.latex?%5Clambda"> augmente. Cela est d√ª au fait que plus <img src="https://latex.codecogs.com/png.latex?%5Clambda"> est grand, plus les rendements les plus r√©cents sont surpond√©r√©s, et donc la volatilit√© est plus faible, en raison de la fin de la p√©riode d‚Äôapprentissage.</p>
</section>
</section>
</section>
<section id="ii.4.-var-skew-student" class="level2">
<h2 class="anchored" data-anchor-id="ii.4.-var-skew-student">II.4. VaR skew-student</h2>
<section id="ii.4.1.-validation-ex-ante" class="level3">
<h3 class="anchored" data-anchor-id="ii.4.1.-validation-ex-ante">II.4.1. Validation ex-ante</h3>
<div id="22cd24b7" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ecrire une fonction permettant d‚Äôestimer les param√®tres d‚Äôune loi de Skew Student par maximum de vraisemblance.</span></span>
<span id="cb51-2"></span>
<span id="cb51-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize</span>
<span id="cb51-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> t</span>
<span id="cb51-5"></span>
<span id="cb51-6"></span>
<span id="cb51-7"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_pdf(x, mu, sigma, gamma, nu ):</span>
<span id="cb51-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb51-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Compute the Skew Student-t probability density function (PDF).</span></span>
<span id="cb51-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb51-11"></span>
<span id="cb51-12"></span>
<span id="cb51-13">    t_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt((nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ((x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb51-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PDF of the standard Student-t distribution</span></span>
<span id="cb51-15">    pdf_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.pdf(x , df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>nu,  loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mu, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>sigma)</span>
<span id="cb51-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># CDF of the transformed Student-t distribution</span></span>
<span id="cb51-17">    cdf_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> t.cdf(t_x, df<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb51-18"></span>
<span id="cb51-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Skew Student density function</span></span>
<span id="cb51-20">    density <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pdf_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> cdf_t</span>
<span id="cb51-21"></span>
<span id="cb51-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> density</span>
<span id="cb51-23"></span>
<span id="cb51-24"></span>
<span id="cb51-25"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_log_likelihood(params, data):</span>
<span id="cb51-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb51-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la log-vraisemblance de la loi de Skew Student</span></span>
<span id="cb51-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    params [mu, sigma, gamma, nu]: les param√®tres de la loi</span></span>
<span id="cb51-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb51-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb51-31">    mu, sigma, gamma, nu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params</span>
<span id="cb51-32">    density <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> skew_student_pdf(data , mu, sigma, gamma, nu)</span>
<span id="cb51-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># log-vraisemblance</span></span>
<span id="cb51-34">    loglik <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(np.log(density))</span>
<span id="cb51-35"></span>
<span id="cb51-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> loglik</span>
<span id="cb51-37"></span>
<span id="cb51-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimisation des param√®tres avec contraintes de positivit√© sur sigma et nu</span></span>
<span id="cb51-39"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_fit(data):</span>
<span id="cb51-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb51-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Estimation des param√®tres de la loi de Skew Student</span></span>
<span id="cb51-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb51-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial guess</span></span>
<span id="cb51-44">    x0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([np.mean(data), np.std(data), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb51-45"></span>
<span id="cb51-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># contraintes</span></span>
<span id="cb51-47">    bounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>), (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>), (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)]</span>
<span id="cb51-48"></span>
<span id="cb51-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># optimisation</span></span>
<span id="cb51-50">    res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize(skew_student_log_likelihood, x0, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(data), bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bounds)</span>
<span id="cb51-51"></span>
<span id="cb51-52">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> res.x</span>
<span id="cb51-53"></span>
<span id="cb51-54">params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> skew_student_fit(data_train)</span>
<span id="cb51-55"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb51-56"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Les param√®tres estim√©s de la loi de Skew Student sont : "</span>)</span>
<span id="cb51-57"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span>
<span id="cb51-58"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mu : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb51-59"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sigma : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb51-60"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gamma : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb51-61"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nu : "</span>, params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb51-62"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb51-63"></span>
<span id="cb51-64"></span>
<span id="cb51-65">params_sstd <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb51-66">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>],</span>
<span id="cb51-67">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb51-68">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>],</span>
<span id="cb51-69">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nu"</span> : params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb51-70">}</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Les param√®tres estim√©s de la loi de Skew Student sont : 
---------------
Mu :  0.0023247899830732325
Sigma :  0.008823850410822238
Gamma :  -0.23183614178494735
Nu :  2.9618421112435653
================================================================================</code></pre>
</div>
</div>
<div id="33712ed5" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb53" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Superposition de la densit√© th√©orique et des donn√©es</span></span>
<span id="cb53-2"></span>
<span id="cb53-3">x_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(data_train), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(data_train), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb53-4"></span>
<span id="cb53-5">theoretical_density <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> skew_student_pdf(x_values, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params_sstd)</span>
<span id="cb53-6">plt.figure(figsize <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb53-7">plt.hist(data_train, bins<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Donn√©es empiriques'</span>)</span>
<span id="cb53-8">plt.plot(x_values, theoretical_density, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© Skew Student'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb53-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© normale</span></span>
<span id="cb53-10">plt.plot(x_values, stats.norm.pdf(x_values, np.mean(data_train), np.std(data_train)), label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√© normale'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb53-11">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Rendements logarithmiques'</span>)</span>
<span id="cb53-12">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Densit√©'</span>)</span>
<span id="cb53-13">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comparaison entre les donn√©es et la densit√© th√©orique d'une loi de Skew Student"</span>)</span>
<span id="cb53-14">plt.legend()</span>
<span id="cb53-15"></span>
<span id="cb53-16">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Le graphique ci-dessus est satisfaisant. La densit√© th√©orique de la skew-student semble bien s‚Äôajuster aux donn√©es. La loi skew-student de param√®tres (<img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%200.002,%20%5Csigma%20=%200.009,%20%5Cgamma%20=%20-0.23,%20%5Cnu%20=%202.96">). Le <img src="https://latex.codecogs.com/png.latex?%5Cmu"> est le rendement moyen, <img src="https://latex.codecogs.com/png.latex?%5Csigma"> est l‚Äô√©cart-type, <img src="https://latex.codecogs.com/png.latex?%5Cgamma"> est le coefficient d‚Äôasym√©trie et <img src="https://latex.codecogs.com/png.latex?%5Cnu"> est le degr√© de libert√©. Le skewness est n√©gatif, ce qui indique une asym√©trie n√©gative des rendements, comme ce qu‚Äôon a observ√© plus haut.</p>
<p>Nous allons appuyer cette validation en utilisant le QQ-plot. La fonction quantile d‚Äôune loi skew-student n‚Äôest pas analytique. Pour ce faire, nous allons construire la fonction de repartition de la skew-student ainsi que la fonction quantile qui est l‚Äôinverse de cette fonction de repartition. Nous allons ensuite comparer les quantiles th√©oriques de la skew-student avec les quantiles empiriques des rendements.</p>
<p>En observant le QQ-plot, on constate que les quantiles th√©oriques de la skew-student collent bien avec les quantiles empiriques des rendements. Cela confirme que la skew-student est une bonne approximation de la distribution des rendements. Pour une validation plus rigoureuse, on peut utiliser un test de Kolmogorov-Smirnov pour tester si les rendements suivent une loi skew-student.</p>
<div id="52bc6f76" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb54" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">## Int√©gration de la fonction de densit√©</span></span>
<span id="cb54-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> integrate</span>
<span id="cb54-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize_scalar</span>
<span id="cb54-4"></span>
<span id="cb54-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> integrale_SkewStudent(x,params):</span>
<span id="cb54-6">    borne_inf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.inf</span>
<span id="cb54-7">    resultat_integration, erreur <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> integrate.quad(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: skew_student_pdf(x, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params), borne_inf, x)</span>
<span id="cb54-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> resultat_integration</span>
<span id="cb54-9"></span>
<span id="cb54-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> fonc_minimize(x, alpha,params):</span>
<span id="cb54-11">    value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> integrale_SkewStudent(x,params)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha</span>
<span id="cb54-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(value)</span>
<span id="cb54-13"></span>
<span id="cb54-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> skew_student_quantile(alpha,mu, sigma, gamma, nu ):</span>
<span id="cb54-15">    params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb54-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mu"</span> : mu ,</span>
<span id="cb54-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma"</span> : sigma,</span>
<span id="cb54-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span> : gamma,</span>
<span id="cb54-19">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nu"</span> : nu</span>
<span id="cb54-20">    }</span>
<span id="cb54-21"></span>
<span id="cb54-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb54-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Veuillez entrer un niveau alpha entre 0 et 1"</span>)</span>
<span id="cb54-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb54-25">        resultat_minimisation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize_scalar(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: fonc_minimize(x, alpha,params))</span>
<span id="cb54-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> resultat_minimisation.x</span></code></pre></div>
</div>
<div id="87e10501" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1">niveaux_quantiles <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span>)</span>
<span id="cb55-2">quantiles_empiriques <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.quantile(data_train, niveaux_quantiles)</span>
<span id="cb55-3">quantiles_theoriques <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [skew_student_quantile(alpha,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params_sstd) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> alpha <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tqdm(niveaux_quantiles)]</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>  0%|          | 0/999 [00:00&lt;?, ?it/s]  0%|          | 1/999 [00:00&lt;04:09,  3.99it/s]  0%|          | 2/999 [00:00&lt;04:01,  4.13it/s]  0%|          | 3/999 [00:00&lt;04:07,  4.02it/s]  0%|          | 4/999 [00:01&lt;04:47,  3.47it/s]  1%|          | 5/999 [00:01&lt;05:03,  3.28it/s]  1%|          | 6/999 [00:01&lt;05:04,  3.26it/s]  1%|          | 7/999 [00:02&lt;05:03,  3.26it/s]  1%|          | 8/999 [00:02&lt;05:09,  3.21it/s]  1%|          | 9/999 [00:02&lt;05:07,  3.22it/s]  1%|          | 10/999 [00:03&lt;05:12,  3.16it/s]  1%|          | 11/999 [00:03&lt;05:03,  3.25it/s]  1%|          | 12/999 [00:03&lt;05:08,  3.19it/s]  1%|‚ñè         | 13/999 [00:03&lt;05:15,  3.13it/s]  1%|‚ñè         | 14/999 [00:04&lt;05:22,  3.05it/s]  2%|‚ñè         | 15/999 [00:04&lt;05:07,  3.20it/s]  2%|‚ñè         | 16/999 [00:04&lt;05:09,  3.18it/s]  2%|‚ñè         | 17/999 [00:05&lt;05:10,  3.17it/s]  2%|‚ñè         | 18/999 [00:05&lt;05:13,  3.13it/s]  2%|‚ñè         | 19/999 [00:05&lt;05:18,  3.08it/s]  2%|‚ñè         | 20/999 [00:06&lt;05:10,  3.15it/s]  2%|‚ñè         | 21/999 [00:06&lt;05:10,  3.15it/s]  2%|‚ñè         | 22/999 [00:06&lt;05:17,  3.08it/s]  2%|‚ñè         | 23/999 [00:07&lt;05:10,  3.14it/s]  2%|‚ñè         | 24/999 [00:07&lt;05:07,  3.17it/s]  3%|‚ñé         | 25/999 [00:07&lt;05:08,  3.15it/s]  3%|‚ñé         | 26/999 [00:08&lt;05:14,  3.09it/s]  3%|‚ñé         | 27/999 [00:08&lt;05:12,  3.11it/s]  3%|‚ñé         | 28/999 [00:08&lt;05:12,  3.11it/s]  3%|‚ñé         | 29/999 [00:09&lt;05:19,  3.04it/s]  3%|‚ñé         | 30/999 [00:09&lt;05:15,  3.07it/s]  3%|‚ñé         | 31/999 [00:09&lt;05:23,  2.99it/s]  3%|‚ñé         | 32/999 [00:10&lt;05:31,  2.91it/s]  3%|‚ñé         | 33/999 [00:10&lt;05:36,  2.87it/s]  3%|‚ñé         | 34/999 [00:10&lt;05:40,  2.83it/s]  4%|‚ñé         | 35/999 [00:11&lt;05:44,  2.80it/s]  4%|‚ñé         | 36/999 [00:11&lt;05:56,  2.70it/s]  4%|‚ñé         | 37/999 [00:12&lt;06:03,  2.65it/s]  4%|‚ñç         | 38/999 [00:12&lt;06:13,  2.58it/s]  4%|‚ñç         | 39/999 [00:12&lt;06:19,  2.53it/s]  4%|‚ñç         | 40/999 [00:13&lt;06:07,  2.61it/s]  4%|‚ñç         | 41/999 [00:13&lt;06:08,  2.60it/s]  4%|‚ñç         | 42/999 [00:13&lt;06:12,  2.57it/s]  4%|‚ñç         | 43/999 [00:14&lt;06:13,  2.56it/s]  4%|‚ñç         | 44/999 [00:14&lt;06:09,  2.59it/s]  5%|‚ñç         | 45/999 [00:15&lt;06:03,  2.63it/s]  5%|‚ñç         | 46/999 [00:15&lt;05:58,  2.66it/s]  5%|‚ñç         | 47/999 [00:15&lt;05:45,  2.75it/s]  5%|‚ñç         | 48/999 [00:16&lt;05:49,  2.72it/s]  5%|‚ñç         | 49/999 [00:16&lt;06:01,  2.62it/s]  5%|‚ñå         | 50/999 [00:16&lt;05:54,  2.68it/s]  5%|‚ñå         | 51/999 [00:17&lt;05:52,  2.69it/s]  5%|‚ñå         | 52/999 [00:17&lt;05:54,  2.67it/s]  5%|‚ñå         | 53/999 [00:18&lt;05:54,  2.67it/s]  5%|‚ñå         | 54/999 [00:18&lt;05:42,  2.76it/s]  6%|‚ñå         | 55/999 [00:18&lt;05:40,  2.78it/s]  6%|‚ñå         | 56/999 [00:19&lt;05:44,  2.73it/s]  6%|‚ñå         | 57/999 [00:19&lt;05:54,  2.66it/s]  6%|‚ñå         | 58/999 [00:19&lt;05:51,  2.68it/s]  6%|‚ñå         | 59/999 [00:20&lt;05:42,  2.75it/s]  6%|‚ñå         | 60/999 [00:20&lt;05:45,  2.71it/s]  6%|‚ñå         | 61/999 [00:21&lt;05:42,  2.74it/s]  6%|‚ñå         | 62/999 [00:21&lt;05:49,  2.68it/s]  6%|‚ñã         | 63/999 [00:21&lt;05:50,  2.67it/s]  6%|‚ñã         | 64/999 [00:22&lt;05:54,  2.64it/s]  7%|‚ñã         | 65/999 [00:22&lt;05:47,  2.69it/s]  7%|‚ñã         | 66/999 [00:22&lt;05:45,  2.70it/s]  7%|‚ñã         | 67/999 [00:23&lt;05:49,  2.66it/s]  7%|‚ñã         | 68/999 [00:23&lt;05:48,  2.67it/s]  7%|‚ñã         | 69/999 [00:24&lt;05:58,  2.59it/s]  7%|‚ñã         | 70/999 [00:24&lt;05:54,  2.62it/s]  7%|‚ñã         | 71/999 [00:24&lt;06:05,  2.54it/s]  7%|‚ñã         | 72/999 [00:25&lt;05:56,  2.60it/s]  7%|‚ñã         | 73/999 [00:25&lt;05:58,  2.59it/s]  7%|‚ñã         | 74/999 [00:25&lt;05:55,  2.60it/s]  8%|‚ñä         | 75/999 [00:26&lt;05:56,  2.59it/s]  8%|‚ñä         | 76/999 [00:26&lt;06:00,  2.56it/s]  8%|‚ñä         | 77/999 [00:27&lt;05:56,  2.59it/s]  8%|‚ñä         | 78/999 [00:27&lt;05:59,  2.56it/s]  8%|‚ñä         | 79/999 [00:27&lt;06:04,  2.53it/s]  8%|‚ñä         | 80/999 [00:28&lt;06:01,  2.54it/s]  8%|‚ñä         | 81/999 [00:28&lt;05:58,  2.56it/s]  8%|‚ñä         | 82/999 [00:29&lt;05:57,  2.56it/s]  8%|‚ñä         | 83/999 [00:29&lt;05:51,  2.61it/s]  8%|‚ñä         | 84/999 [00:29&lt;05:48,  2.63it/s]  9%|‚ñä         | 85/999 [00:30&lt;05:41,  2.67it/s]  9%|‚ñä         | 86/999 [00:30&lt;05:41,  2.67it/s]  9%|‚ñä         | 87/999 [00:30&lt;05:47,  2.63it/s]  9%|‚ñâ         | 88/999 [00:31&lt;05:48,  2.62it/s]  9%|‚ñâ         | 89/999 [00:31&lt;05:43,  2.65it/s]  9%|‚ñâ         | 90/999 [00:32&lt;05:34,  2.72it/s]  9%|‚ñâ         | 91/999 [00:32&lt;05:35,  2.70it/s]  9%|‚ñâ         | 92/999 [00:32&lt;05:31,  2.73it/s]  9%|‚ñâ         | 93/999 [00:33&lt;05:22,  2.81it/s]  9%|‚ñâ         | 94/999 [00:33&lt;05:24,  2.79it/s] 10%|‚ñâ         | 95/999 [00:33&lt;05:35,  2.70it/s] 10%|‚ñâ         | 96/999 [00:34&lt;05:36,  2.69it/s] 10%|‚ñâ         | 97/999 [00:34&lt;05:44,  2.62it/s] 10%|‚ñâ         | 98/999 [00:35&lt;05:42,  2.63it/s] 10%|‚ñâ         | 99/999 [00:35&lt;05:38,  2.66it/s] 10%|‚ñà         | 100/999 [00:35&lt;05:27,  2.74it/s] 10%|‚ñà         | 101/999 [00:36&lt;05:27,  2.74it/s] 10%|‚ñà         | 102/999 [00:36&lt;05:24,  2.77it/s] 10%|‚ñà         | 103/999 [00:36&lt;05:26,  2.74it/s] 10%|‚ñà         | 104/999 [00:37&lt;05:23,  2.77it/s] 11%|‚ñà         | 105/999 [00:37&lt;05:20,  2.79it/s] 11%|‚ñà         | 106/999 [00:37&lt;05:28,  2.72it/s] 11%|‚ñà         | 107/999 [00:38&lt;05:30,  2.70it/s] 11%|‚ñà         | 108/999 [00:38&lt;05:37,  2.64it/s] 11%|‚ñà         | 109/999 [00:39&lt;05:36,  2.64it/s] 11%|‚ñà         | 110/999 [00:39&lt;05:40,  2.61it/s] 11%|‚ñà         | 111/999 [00:39&lt;05:45,  2.57it/s] 11%|‚ñà         | 112/999 [00:40&lt;05:50,  2.53it/s] 11%|‚ñà‚ñè        | 113/999 [00:40&lt;05:56,  2.49it/s] 11%|‚ñà‚ñè        | 114/999 [00:41&lt;05:52,  2.51it/s] 12%|‚ñà‚ñè        | 115/999 [00:41&lt;05:52,  2.51it/s] 12%|‚ñà‚ñè        | 116/999 [00:41&lt;05:49,  2.52it/s] 12%|‚ñà‚ñè        | 117/999 [00:42&lt;05:52,  2.50it/s] 12%|‚ñà‚ñè        | 118/999 [00:42&lt;05:49,  2.52it/s] 12%|‚ñà‚ñè        | 119/999 [00:43&lt;05:52,  2.49it/s] 12%|‚ñà‚ñè        | 120/999 [00:43&lt;05:48,  2.52it/s] 12%|‚ñà‚ñè        | 121/999 [00:43&lt;05:50,  2.50it/s] 12%|‚ñà‚ñè        | 122/999 [00:44&lt;06:05,  2.40it/s] 12%|‚ñà‚ñè        | 123/999 [00:44&lt;05:59,  2.44it/s] 12%|‚ñà‚ñè        | 124/999 [00:45&lt;05:57,  2.45it/s] 13%|‚ñà‚ñé        | 125/999 [00:45&lt;05:58,  2.44it/s] 13%|‚ñà‚ñé        | 126/999 [00:46&lt;05:58,  2.44it/s] 13%|‚ñà‚ñé        | 127/999 [00:46&lt;05:57,  2.44it/s] 13%|‚ñà‚ñé        | 128/999 [00:46&lt;05:54,  2.45it/s] 13%|‚ñà‚ñé        | 129/999 [00:47&lt;05:55,  2.44it/s] 13%|‚ñà‚ñé        | 130/999 [00:47&lt;05:53,  2.46it/s] 13%|‚ñà‚ñé        | 131/999 [00:48&lt;05:48,  2.49it/s] 13%|‚ñà‚ñé        | 132/999 [00:48&lt;05:40,  2.55it/s] 13%|‚ñà‚ñé        | 133/999 [00:48&lt;05:36,  2.58it/s] 13%|‚ñà‚ñé        | 134/999 [00:49&lt;05:29,  2.63it/s] 14%|‚ñà‚ñé        | 135/999 [00:49&lt;05:30,  2.61it/s] 14%|‚ñà‚ñé        | 136/999 [00:49&lt;05:32,  2.59it/s] 14%|‚ñà‚ñé        | 137/999 [00:50&lt;05:36,  2.56it/s] 14%|‚ñà‚ñç        | 138/999 [00:50&lt;05:34,  2.57it/s] 14%|‚ñà‚ñç        | 139/999 [00:51&lt;05:45,  2.49it/s] 14%|‚ñà‚ñç        | 140/999 [00:51&lt;05:50,  2.45it/s] 14%|‚ñà‚ñç        | 141/999 [00:51&lt;05:40,  2.52it/s] 14%|‚ñà‚ñç        | 142/999 [00:52&lt;05:34,  2.56it/s] 14%|‚ñà‚ñç        | 143/999 [00:52&lt;05:40,  2.51it/s] 14%|‚ñà‚ñç        | 144/999 [00:53&lt;05:31,  2.58it/s] 15%|‚ñà‚ñç        | 145/999 [00:53&lt;05:25,  2.62it/s] 15%|‚ñà‚ñç        | 146/999 [00:53&lt;05:19,  2.67it/s] 15%|‚ñà‚ñç        | 147/999 [00:54&lt;05:25,  2.62it/s] 15%|‚ñà‚ñç        | 148/999 [00:54&lt;05:46,  2.46it/s] 15%|‚ñà‚ñç        | 149/999 [00:55&lt;05:50,  2.43it/s] 15%|‚ñà‚ñå        | 150/999 [00:55&lt;05:54,  2.40it/s] 15%|‚ñà‚ñå        | 151/999 [00:55&lt;05:46,  2.45it/s] 15%|‚ñà‚ñå        | 152/999 [00:56&lt;05:38,  2.50it/s] 15%|‚ñà‚ñå        | 153/999 [00:56&lt;05:42,  2.47it/s] 15%|‚ñà‚ñå        | 154/999 [00:57&lt;05:47,  2.43it/s] 16%|‚ñà‚ñå        | 155/999 [00:57&lt;05:50,  2.41it/s] 16%|‚ñà‚ñå        | 156/999 [00:57&lt;05:53,  2.39it/s] 16%|‚ñà‚ñå        | 157/999 [00:58&lt;05:53,  2.38it/s] 16%|‚ñà‚ñå        | 158/999 [00:58&lt;05:47,  2.42it/s] 16%|‚ñà‚ñå        | 159/999 [00:59&lt;05:57,  2.35it/s] 16%|‚ñà‚ñå        | 160/999 [00:59&lt;06:03,  2.31it/s] 16%|‚ñà‚ñå        | 161/999 [01:00&lt;05:58,  2.34it/s] 16%|‚ñà‚ñå        | 162/999 [01:00&lt;06:08,  2.27it/s] 16%|‚ñà‚ñã        | 163/999 [01:01&lt;06:10,  2.25it/s] 16%|‚ñà‚ñã        | 164/999 [01:01&lt;06:17,  2.21it/s] 17%|‚ñà‚ñã        | 165/999 [01:01&lt;06:13,  2.23it/s] 17%|‚ñà‚ñã        | 166/999 [01:02&lt;06:08,  2.26it/s] 17%|‚ñà‚ñã        | 167/999 [01:02&lt;06:04,  2.28it/s] 17%|‚ñà‚ñã        | 168/999 [01:03&lt;06:09,  2.25it/s] 17%|‚ñà‚ñã        | 169/999 [01:03&lt;06:07,  2.26it/s] 17%|‚ñà‚ñã        | 170/999 [01:04&lt;06:06,  2.26it/s] 17%|‚ñà‚ñã        | 171/999 [01:04&lt;05:58,  2.31it/s] 17%|‚ñà‚ñã        | 172/999 [01:05&lt;06:04,  2.27it/s] 17%|‚ñà‚ñã        | 173/999 [01:05&lt;06:04,  2.27it/s] 17%|‚ñà‚ñã        | 174/999 [01:05&lt;05:58,  2.30it/s] 18%|‚ñà‚ñä        | 175/999 [01:06&lt;05:55,  2.32it/s] 18%|‚ñà‚ñä        | 176/999 [01:06&lt;06:04,  2.26it/s] 18%|‚ñà‚ñä        | 177/999 [01:07&lt;06:04,  2.25it/s] 18%|‚ñà‚ñä        | 178/999 [01:07&lt;05:53,  2.32it/s] 18%|‚ñà‚ñä        | 179/999 [01:08&lt;05:45,  2.37it/s] 18%|‚ñà‚ñä        | 180/999 [01:08&lt;05:50,  2.34it/s] 18%|‚ñà‚ñä        | 181/999 [01:08&lt;05:52,  2.32it/s] 18%|‚ñà‚ñä        | 182/999 [01:09&lt;06:00,  2.26it/s] 18%|‚ñà‚ñä        | 183/999 [01:09&lt;06:10,  2.20it/s] 18%|‚ñà‚ñä        | 184/999 [01:10&lt;06:03,  2.24it/s] 19%|‚ñà‚ñä        | 185/999 [01:10&lt;06:11,  2.19it/s] 19%|‚ñà‚ñä        | 186/999 [01:11&lt;06:19,  2.14it/s] 19%|‚ñà‚ñä        | 187/999 [01:11&lt;06:18,  2.14it/s] 19%|‚ñà‚ñâ        | 188/999 [01:12&lt;06:17,  2.15it/s] 19%|‚ñà‚ñâ        | 189/999 [01:12&lt;06:02,  2.23it/s] 19%|‚ñà‚ñâ        | 190/999 [01:13&lt;06:02,  2.23it/s] 19%|‚ñà‚ñâ        | 191/999 [01:13&lt;05:41,  2.37it/s] 19%|‚ñà‚ñâ        | 192/999 [01:13&lt;05:49,  2.31it/s] 19%|‚ñà‚ñâ        | 193/999 [01:14&lt;05:46,  2.32it/s] 19%|‚ñà‚ñâ        | 194/999 [01:14&lt;05:45,  2.33it/s] 20%|‚ñà‚ñâ        | 195/999 [01:15&lt;05:42,  2.35it/s] 20%|‚ñà‚ñâ        | 196/999 [01:15&lt;05:42,  2.35it/s] 20%|‚ñà‚ñâ        | 197/999 [01:15&lt;05:45,  2.32it/s] 20%|‚ñà‚ñâ        | 198/999 [01:16&lt;05:42,  2.34it/s] 20%|‚ñà‚ñâ        | 199/999 [01:16&lt;05:47,  2.30it/s] 20%|‚ñà‚ñà        | 200/999 [01:17&lt;05:49,  2.28it/s] 20%|‚ñà‚ñà        | 201/999 [01:17&lt;05:45,  2.31it/s] 20%|‚ñà‚ñà        | 202/999 [01:18&lt;05:50,  2.27it/s] 20%|‚ñà‚ñà        | 203/999 [01:18&lt;05:47,  2.29it/s] 20%|‚ñà‚ñà        | 204/999 [01:19&lt;05:39,  2.34it/s] 21%|‚ñà‚ñà        | 205/999 [01:19&lt;05:35,  2.37it/s] 21%|‚ñà‚ñà        | 206/999 [01:19&lt;05:29,  2.41it/s] 21%|‚ñà‚ñà        | 207/999 [01:20&lt;05:36,  2.35it/s] 21%|‚ñà‚ñà        | 208/999 [01:20&lt;05:40,  2.32it/s] 21%|‚ñà‚ñà        | 209/999 [01:21&lt;05:47,  2.28it/s] 21%|‚ñà‚ñà        | 210/999 [01:21&lt;05:45,  2.28it/s] 21%|‚ñà‚ñà        | 211/999 [01:22&lt;05:58,  2.20it/s] 21%|‚ñà‚ñà        | 212/999 [01:22&lt;05:53,  2.23it/s] 21%|‚ñà‚ñà‚ñè       | 213/999 [01:22&lt;05:43,  2.29it/s] 21%|‚ñà‚ñà‚ñè       | 214/999 [01:23&lt;05:46,  2.26it/s] 22%|‚ñà‚ñà‚ñè       | 215/999 [01:23&lt;05:49,  2.24it/s] 22%|‚ñà‚ñà‚ñè       | 216/999 [01:24&lt;05:43,  2.28it/s] 22%|‚ñà‚ñà‚ñè       | 217/999 [01:24&lt;05:43,  2.28it/s] 22%|‚ñà‚ñà‚ñè       | 218/999 [01:25&lt;05:43,  2.28it/s] 22%|‚ñà‚ñà‚ñè       | 219/999 [01:25&lt;05:25,  2.39it/s] 22%|‚ñà‚ñà‚ñè       | 220/999 [01:25&lt;05:27,  2.38it/s] 22%|‚ñà‚ñà‚ñè       | 221/999 [01:26&lt;05:31,  2.35it/s] 22%|‚ñà‚ñà‚ñè       | 222/999 [01:26&lt;05:40,  2.28it/s] 22%|‚ñà‚ñà‚ñè       | 223/999 [01:27&lt;05:46,  2.24it/s] 22%|‚ñà‚ñà‚ñè       | 224/999 [01:27&lt;05:44,  2.25it/s] 23%|‚ñà‚ñà‚ñé       | 225/999 [01:28&lt;05:50,  2.21it/s] 23%|‚ñà‚ñà‚ñé       | 226/999 [01:28&lt;05:42,  2.25it/s] 23%|‚ñà‚ñà‚ñé       | 227/999 [01:29&lt;05:42,  2.26it/s] 23%|‚ñà‚ñà‚ñé       | 228/999 [01:29&lt;05:44,  2.24it/s] 23%|‚ñà‚ñà‚ñé       | 229/999 [01:30&lt;05:55,  2.17it/s] 23%|‚ñà‚ñà‚ñé       | 230/999 [01:30&lt;06:04,  2.11it/s] 23%|‚ñà‚ñà‚ñé       | 231/999 [01:31&lt;06:10,  2.07it/s] 23%|‚ñà‚ñà‚ñé       | 232/999 [01:31&lt;06:01,  2.12it/s] 23%|‚ñà‚ñà‚ñé       | 233/999 [01:31&lt;05:50,  2.19it/s] 23%|‚ñà‚ñà‚ñé       | 234/999 [01:32&lt;05:43,  2.22it/s] 24%|‚ñà‚ñà‚ñé       | 235/999 [01:32&lt;05:39,  2.25it/s] 24%|‚ñà‚ñà‚ñé       | 236/999 [01:33&lt;05:49,  2.18it/s] 24%|‚ñà‚ñà‚ñé       | 237/999 [01:33&lt;05:58,  2.13it/s] 24%|‚ñà‚ñà‚ñç       | 238/999 [01:34&lt;06:08,  2.06it/s] 24%|‚ñà‚ñà‚ñç       | 239/999 [01:34&lt;06:19,  2.00it/s] 24%|‚ñà‚ñà‚ñç       | 240/999 [01:35&lt;06:23,  1.98it/s] 24%|‚ñà‚ñà‚ñç       | 241/999 [01:35&lt;06:23,  1.98it/s] 24%|‚ñà‚ñà‚ñç       | 242/999 [01:36&lt;06:25,  1.96it/s] 24%|‚ñà‚ñà‚ñç       | 243/999 [01:36&lt;06:32,  1.92it/s] 24%|‚ñà‚ñà‚ñç       | 244/999 [01:37&lt;06:36,  1.90it/s] 25%|‚ñà‚ñà‚ñç       | 245/999 [01:37&lt;06:31,  1.92it/s] 25%|‚ñà‚ñà‚ñç       | 246/999 [01:38&lt;06:34,  1.91it/s] 25%|‚ñà‚ñà‚ñç       | 247/999 [01:39&lt;06:32,  1.92it/s] 25%|‚ñà‚ñà‚ñç       | 248/999 [01:39&lt;06:45,  1.85it/s] 25%|‚ñà‚ñà‚ñç       | 249/999 [01:40&lt;06:53,  1.81it/s] 25%|‚ñà‚ñà‚ñå       | 250/999 [01:40&lt;06:50,  1.82it/s] 25%|‚ñà‚ñà‚ñå       | 251/999 [01:41&lt;06:54,  1.81it/s] 25%|‚ñà‚ñà‚ñå       | 252/999 [01:41&lt;06:45,  1.84it/s] 25%|‚ñà‚ñà‚ñå       | 253/999 [01:42&lt;06:51,  1.81it/s] 25%|‚ñà‚ñà‚ñå       | 254/999 [01:42&lt;06:58,  1.78it/s] 26%|‚ñà‚ñà‚ñå       | 255/999 [01:43&lt;06:59,  1.77it/s] 26%|‚ñà‚ñà‚ñå       | 256/999 [01:44&lt;06:55,  1.79it/s] 26%|‚ñà‚ñà‚ñå       | 257/999 [01:44&lt;06:35,  1.87it/s] 26%|‚ñà‚ñà‚ñå       | 258/999 [01:45&lt;06:27,  1.91it/s] 26%|‚ñà‚ñà‚ñå       | 259/999 [01:45&lt;06:28,  1.90it/s] 26%|‚ñà‚ñà‚ñå       | 260/999 [01:46&lt;06:20,  1.94it/s] 26%|‚ñà‚ñà‚ñå       | 261/999 [01:46&lt;06:12,  1.98it/s] 26%|‚ñà‚ñà‚ñå       | 262/999 [01:47&lt;05:59,  2.05it/s] 26%|‚ñà‚ñà‚ñã       | 263/999 [01:47&lt;05:55,  2.07it/s] 26%|‚ñà‚ñà‚ñã       | 264/999 [01:47&lt;05:50,  2.10it/s] 27%|‚ñà‚ñà‚ñã       | 265/999 [01:48&lt;05:47,  2.11it/s] 27%|‚ñà‚ñà‚ñã       | 266/999 [01:48&lt;05:46,  2.12it/s] 27%|‚ñà‚ñà‚ñã       | 267/999 [01:49&lt;05:42,  2.13it/s] 27%|‚ñà‚ñà‚ñã       | 268/999 [01:49&lt;05:49,  2.09it/s] 27%|‚ñà‚ñà‚ñã       | 269/999 [01:50&lt;05:48,  2.10it/s] 27%|‚ñà‚ñà‚ñã       | 270/999 [01:50&lt;05:52,  2.07it/s] 27%|‚ñà‚ñà‚ñã       | 271/999 [01:51&lt;05:49,  2.08it/s] 27%|‚ñà‚ñà‚ñã       | 272/999 [01:51&lt;05:58,  2.03it/s] 27%|‚ñà‚ñà‚ñã       | 273/999 [01:52&lt;05:59,  2.02it/s] 27%|‚ñà‚ñà‚ñã       | 274/999 [01:52&lt;05:55,  2.04it/s] 28%|‚ñà‚ñà‚ñä       | 275/999 [01:53&lt;05:55,  2.03it/s] 28%|‚ñà‚ñà‚ñä       | 276/999 [01:53&lt;06:01,  2.00it/s] 28%|‚ñà‚ñà‚ñä       | 277/999 [01:54&lt;05:53,  2.04it/s] 28%|‚ñà‚ñà‚ñä       | 278/999 [01:54&lt;05:59,  2.01it/s] 28%|‚ñà‚ñà‚ñä       | 279/999 [01:55&lt;06:01,  1.99it/s] 28%|‚ñà‚ñà‚ñä       | 280/999 [01:55&lt;06:07,  1.96it/s] 28%|‚ñà‚ñà‚ñä       | 281/999 [01:56&lt;06:07,  1.95it/s] 28%|‚ñà‚ñà‚ñä       | 282/999 [01:56&lt;06:14,  1.91it/s] 28%|‚ñà‚ñà‚ñä       | 283/999 [01:57&lt;06:15,  1.91it/s] 28%|‚ñà‚ñà‚ñä       | 284/999 [01:58&lt;06:32,  1.82it/s] 29%|‚ñà‚ñà‚ñä       | 285/999 [01:58&lt;06:44,  1.76it/s] 29%|‚ñà‚ñà‚ñä       | 286/999 [01:59&lt;06:34,  1.81it/s] 29%|‚ñà‚ñà‚ñä       | 287/999 [01:59&lt;06:41,  1.78it/s] 29%|‚ñà‚ñà‚ñâ       | 288/999 [02:00&lt;06:31,  1.81it/s] 29%|‚ñà‚ñà‚ñâ       | 289/999 [02:00&lt;06:35,  1.80it/s] 29%|‚ñà‚ñà‚ñâ       | 290/999 [02:01&lt;06:26,  1.83it/s] 29%|‚ñà‚ñà‚ñâ       | 291/999 [02:01&lt;06:34,  1.79it/s] 29%|‚ñà‚ñà‚ñâ       | 292/999 [02:02&lt;06:23,  1.84it/s] 29%|‚ñà‚ñà‚ñâ       | 293/999 [02:02&lt;06:15,  1.88it/s] 29%|‚ñà‚ñà‚ñâ       | 294/999 [02:03&lt;06:25,  1.83it/s] 30%|‚ñà‚ñà‚ñâ       | 295/999 [02:04&lt;06:16,  1.87it/s] 30%|‚ñà‚ñà‚ñâ       | 296/999 [02:04&lt;06:26,  1.82it/s] 30%|‚ñà‚ñà‚ñâ       | 297/999 [02:05&lt;06:19,  1.85it/s] 30%|‚ñà‚ñà‚ñâ       | 298/999 [02:05&lt;06:23,  1.83it/s] 30%|‚ñà‚ñà‚ñâ       | 299/999 [02:06&lt;06:19,  1.85it/s] 30%|‚ñà‚ñà‚ñà       | 300/999 [02:06&lt;06:27,  1.80it/s] 30%|‚ñà‚ñà‚ñà       | 301/999 [02:07&lt;06:31,  1.78it/s] 30%|‚ñà‚ñà‚ñà       | 302/999 [02:07&lt;06:30,  1.78it/s] 30%|‚ñà‚ñà‚ñà       | 303/999 [02:08&lt;06:39,  1.74it/s] 30%|‚ñà‚ñà‚ñà       | 304/999 [02:09&lt;06:29,  1.79it/s] 31%|‚ñà‚ñà‚ñà       | 305/999 [02:09&lt;06:18,  1.83it/s] 31%|‚ñà‚ñà‚ñà       | 306/999 [02:10&lt;06:08,  1.88it/s] 31%|‚ñà‚ñà‚ñà       | 307/999 [02:10&lt;06:05,  1.89it/s] 31%|‚ñà‚ñà‚ñà       | 308/999 [02:11&lt;05:53,  1.95it/s] 31%|‚ñà‚ñà‚ñà       | 309/999 [02:11&lt;05:59,  1.92it/s] 31%|‚ñà‚ñà‚ñà       | 310/999 [02:12&lt;06:05,  1.89it/s] 31%|‚ñà‚ñà‚ñà       | 311/999 [02:12&lt;06:11,  1.85it/s] 31%|‚ñà‚ñà‚ñà       | 312/999 [02:13&lt;06:12,  1.84it/s] 31%|‚ñà‚ñà‚ñà‚ñè      | 313/999 [02:13&lt;06:14,  1.83it/s] 31%|‚ñà‚ñà‚ñà‚ñè      | 314/999 [02:14&lt;06:08,  1.86it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 315/999 [02:14&lt;05:59,  1.90it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 316/999 [02:15&lt;05:59,  1.90it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 317/999 [02:15&lt;05:59,  1.90it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 318/999 [02:16&lt;05:55,  1.92it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 319/999 [02:16&lt;06:00,  1.89it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 320/999 [02:17&lt;06:01,  1.88it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 321/999 [02:18&lt;06:20,  1.78it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 322/999 [02:18&lt;06:07,  1.84it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 323/999 [02:19&lt;06:21,  1.77it/s] 32%|‚ñà‚ñà‚ñà‚ñè      | 324/999 [02:19&lt;06:19,  1.78it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 325/999 [02:20&lt;06:11,  1.81it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 326/999 [02:20&lt;06:06,  1.84it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 327/999 [02:21&lt;06:21,  1.76it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 328/999 [02:22&lt;06:11,  1.81it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 329/999 [02:22&lt;06:22,  1.75it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 330/999 [02:23&lt;06:13,  1.79it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 331/999 [02:23&lt;06:11,  1.80it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 332/999 [02:24&lt;06:11,  1.79it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 333/999 [02:24&lt;06:11,  1.79it/s] 33%|‚ñà‚ñà‚ñà‚ñé      | 334/999 [02:25&lt;06:02,  1.84it/s] 34%|‚ñà‚ñà‚ñà‚ñé      | 335/999 [02:25&lt;06:01,  1.83it/s] 34%|‚ñà‚ñà‚ñà‚ñé      | 336/999 [02:26&lt;06:03,  1.82it/s] 34%|‚ñà‚ñà‚ñà‚ñé      | 337/999 [02:26&lt;06:02,  1.83it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 338/999 [02:27&lt;06:04,  1.81it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 339/999 [02:28&lt;05:54,  1.86it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 340/999 [02:28&lt;05:47,  1.90it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 341/999 [02:29&lt;05:49,  1.88it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 342/999 [02:29&lt;05:48,  1.88it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 343/999 [02:30&lt;05:48,  1.88it/s] 34%|‚ñà‚ñà‚ñà‚ñç      | 344/999 [02:30&lt;05:50,  1.87it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 345/999 [02:31&lt;05:45,  1.89it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 346/999 [02:31&lt;05:45,  1.89it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 347/999 [02:32&lt;05:47,  1.88it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 348/999 [02:32&lt;05:46,  1.88it/s] 35%|‚ñà‚ñà‚ñà‚ñç      | 349/999 [02:33&lt;05:40,  1.91it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 350/999 [02:33&lt;05:38,  1.92it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 351/999 [02:34&lt;05:44,  1.88it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 352/999 [02:34&lt;05:46,  1.87it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 353/999 [02:35&lt;05:47,  1.86it/s] 35%|‚ñà‚ñà‚ñà‚ñå      | 354/999 [02:36&lt;05:43,  1.88it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 355/999 [02:36&lt;05:40,  1.89it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 356/999 [02:37&lt;05:40,  1.89it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 357/999 [02:37&lt;05:37,  1.90it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 358/999 [02:38&lt;05:43,  1.86it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 359/999 [02:38&lt;05:47,  1.84it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 360/999 [02:39&lt;05:40,  1.87it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 361/999 [02:39&lt;05:40,  1.87it/s] 36%|‚ñà‚ñà‚ñà‚ñå      | 362/999 [02:40&lt;05:36,  1.89it/s] 36%|‚ñà‚ñà‚ñà‚ñã      | 363/999 [02:40&lt;05:29,  1.93it/s] 36%|‚ñà‚ñà‚ñà‚ñã      | 364/999 [02:41&lt;05:23,  1.97it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 365/999 [02:41&lt;05:30,  1.92it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 366/999 [02:42&lt;05:29,  1.92it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 367/999 [02:42&lt;05:26,  1.93it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 368/999 [02:43&lt;05:23,  1.95it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 369/999 [02:43&lt;05:18,  1.98it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 370/999 [02:44&lt;05:17,  1.98it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 371/999 [02:44&lt;05:14,  2.00it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 372/999 [02:45&lt;05:17,  1.98it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 373/999 [02:45&lt;05:17,  1.97it/s] 37%|‚ñà‚ñà‚ñà‚ñã      | 374/999 [02:46&lt;05:16,  1.98it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 375/999 [02:46&lt;05:07,  2.03it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 376/999 [02:47&lt;05:04,  2.05it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 377/999 [02:47&lt;05:09,  2.01it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 378/999 [02:48&lt;05:05,  2.03it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 379/999 [02:48&lt;05:08,  2.01it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 380/999 [02:49&lt;05:14,  1.97it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 381/999 [02:49&lt;05:13,  1.97it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 382/999 [02:50&lt;05:07,  2.01it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 383/999 [02:50&lt;05:02,  2.04it/s] 38%|‚ñà‚ñà‚ñà‚ñä      | 384/999 [02:51&lt;05:07,  2.00it/s] 39%|‚ñà‚ñà‚ñà‚ñä      | 385/999 [02:51&lt;05:08,  1.99it/s] 39%|‚ñà‚ñà‚ñà‚ñä      | 386/999 [02:52&lt;05:11,  1.97it/s] 39%|‚ñà‚ñà‚ñà‚ñä      | 387/999 [02:52&lt;04:56,  2.06it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 388/999 [02:53&lt;05:05,  2.00it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 389/999 [02:53&lt;05:03,  2.01it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 390/999 [02:54&lt;05:04,  2.00it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 391/999 [02:54&lt;05:11,  1.95it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 392/999 [02:55&lt;05:14,  1.93it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 393/999 [02:55&lt;05:16,  1.91it/s] 39%|‚ñà‚ñà‚ñà‚ñâ      | 394/999 [02:56&lt;05:13,  1.93it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 395/999 [02:56&lt;05:09,  1.95it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 396/999 [02:57&lt;05:13,  1.92it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 397/999 [02:57&lt;05:14,  1.91it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 398/999 [02:58&lt;05:12,  1.92it/s] 40%|‚ñà‚ñà‚ñà‚ñâ      | 399/999 [02:59&lt;05:21,  1.87it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 400/999 [02:59&lt;05:18,  1.88it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 401/999 [03:00&lt;05:18,  1.88it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 402/999 [03:00&lt;05:15,  1.89it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 403/999 [03:01&lt;05:14,  1.90it/s] 40%|‚ñà‚ñà‚ñà‚ñà      | 404/999 [03:01&lt;05:10,  1.92it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 405/999 [03:02&lt;05:04,  1.95it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 406/999 [03:02&lt;05:02,  1.96it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 407/999 [03:03&lt;05:02,  1.96it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 408/999 [03:03&lt;04:57,  1.98it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 409/999 [03:04&lt;04:57,  1.98it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 410/999 [03:04&lt;05:00,  1.96it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 411/999 [03:05&lt;05:04,  1.93it/s] 41%|‚ñà‚ñà‚ñà‚ñà      | 412/999 [03:05&lt;04:59,  1.96it/s] 41%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 413/999 [03:06&lt;04:59,  1.96it/s] 41%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 414/999 [03:06&lt;04:56,  1.97it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 415/999 [03:07&lt;05:01,  1.93it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 416/999 [03:07&lt;05:05,  1.91it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 417/999 [03:08&lt;05:09,  1.88it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 418/999 [03:08&lt;05:03,  1.92it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 419/999 [03:09&lt;05:07,  1.89it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 420/999 [03:09&lt;05:08,  1.88it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 421/999 [03:10&lt;05:14,  1.84it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 422/999 [03:11&lt;05:17,  1.82it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 423/999 [03:11&lt;05:19,  1.80it/s] 42%|‚ñà‚ñà‚ñà‚ñà‚ñè     | 424/999 [03:12&lt;05:13,  1.84it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 425/999 [03:12&lt;05:13,  1.83it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 426/999 [03:13&lt;05:11,  1.84it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 427/999 [03:13&lt;05:13,  1.82it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 428/999 [03:14&lt;05:11,  1.83it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 429/999 [03:14&lt;05:23,  1.76it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 430/999 [03:15&lt;05:17,  1.79it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 431/999 [03:16&lt;05:08,  1.84it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 432/999 [03:16&lt;05:06,  1.85it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 433/999 [03:17&lt;05:00,  1.88it/s] 43%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 434/999 [03:17&lt;04:56,  1.91it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 435/999 [03:18&lt;05:06,  1.84it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 436/999 [03:18&lt;05:14,  1.79it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñé     | 437/999 [03:19&lt;05:20,  1.75it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 438/999 [03:19&lt;05:18,  1.76it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 439/999 [03:20&lt;05:10,  1.80it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 440/999 [03:20&lt;05:10,  1.80it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 441/999 [03:21&lt;05:00,  1.86it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 442/999 [03:22&lt;04:57,  1.87it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 443/999 [03:22&lt;04:58,  1.86it/s] 44%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 444/999 [03:23&lt;04:53,  1.89it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 445/999 [03:23&lt;04:54,  1.88it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 446/999 [03:24&lt;04:49,  1.91it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 447/999 [03:24&lt;04:54,  1.87it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 448/999 [03:25&lt;04:52,  1.89it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñç     | 449/999 [03:25&lt;04:52,  1.88it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 450/999 [03:26&lt;04:57,  1.84it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 451/999 [03:26&lt;05:00,  1.82it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 452/999 [03:27&lt;05:03,  1.80it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 453/999 [03:27&lt;05:04,  1.79it/s] 45%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 454/999 [03:28&lt;05:02,  1.80it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 455/999 [03:29&lt;05:00,  1.81it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 456/999 [03:29&lt;04:54,  1.84it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 457/999 [03:30&lt;04:53,  1.85it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 458/999 [03:30&lt;04:52,  1.85it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 459/999 [03:31&lt;05:03,  1.78it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 460/999 [03:31&lt;05:03,  1.77it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 461/999 [03:32&lt;05:02,  1.78it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñå     | 462/999 [03:32&lt;05:00,  1.79it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 463/999 [03:33&lt;05:00,  1.78it/s] 46%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 464/999 [03:34&lt;05:04,  1.76it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 465/999 [03:34&lt;04:55,  1.81it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 466/999 [03:35&lt;04:57,  1.79it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 467/999 [03:35&lt;04:48,  1.84it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 468/999 [03:36&lt;04:43,  1.87it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 469/999 [03:36&lt;04:45,  1.86it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 470/999 [03:37&lt;04:46,  1.85it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 471/999 [03:37&lt;04:48,  1.83it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 472/999 [03:38&lt;04:55,  1.78it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 473/999 [03:39&lt;04:57,  1.77it/s] 47%|‚ñà‚ñà‚ñà‚ñà‚ñã     | 474/999 [03:39&lt;04:44,  1.84it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 475/999 [03:40&lt;04:42,  1.85it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 476/999 [03:40&lt;04:39,  1.87it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 477/999 [03:41&lt;04:42,  1.84it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 478/999 [03:41&lt;04:47,  1.81it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 479/999 [03:42&lt;04:51,  1.79it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 480/999 [03:42&lt;04:41,  1.84it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 481/999 [03:43&lt;04:43,  1.83it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 482/999 [03:43&lt;04:39,  1.85it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 483/999 [03:44&lt;04:46,  1.80it/s] 48%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 484/999 [03:45&lt;04:39,  1.84it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 485/999 [03:45&lt;04:35,  1.87it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 486/999 [03:46&lt;04:31,  1.89it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñä     | 487/999 [03:46&lt;04:30,  1.90it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 488/999 [03:47&lt;04:26,  1.91it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 489/999 [03:47&lt;04:22,  1.94it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 490/999 [03:48&lt;04:21,  1.95it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 491/999 [03:48&lt;04:15,  1.99it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 492/999 [03:49&lt;04:15,  1.99it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 493/999 [03:49&lt;04:19,  1.95it/s] 49%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 494/999 [03:50&lt;04:22,  1.92it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 495/999 [03:50&lt;04:22,  1.92it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 496/999 [03:51&lt;04:20,  1.93it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 497/999 [03:51&lt;04:24,  1.90it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 498/999 [03:52&lt;04:24,  1.89it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñâ     | 499/999 [03:52&lt;04:14,  1.97it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 500/999 [03:53&lt;04:14,  1.96it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 501/999 [03:53&lt;04:05,  2.03it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 502/999 [03:54&lt;04:13,  1.96it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 503/999 [03:54&lt;04:11,  1.97it/s] 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 504/999 [03:55&lt;04:09,  1.98it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 505/999 [03:55&lt;04:10,  1.97it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 506/999 [03:56&lt;04:15,  1.93it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 507/999 [03:56&lt;04:12,  1.95it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 508/999 [03:57&lt;03:59,  2.05it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 509/999 [03:57&lt;03:57,  2.06it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 510/999 [03:58&lt;04:00,  2.03it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 511/999 [03:58&lt;03:56,  2.06it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 512/999 [03:59&lt;03:52,  2.09it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 513/999 [03:59&lt;03:52,  2.09it/s] 51%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 514/999 [04:00&lt;03:54,  2.07it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 515/999 [04:00&lt;04:03,  1.99it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 516/999 [04:01&lt;04:00,  2.01it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 517/999 [04:01&lt;04:01,  2.00it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 518/999 [04:02&lt;04:03,  1.98it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 519/999 [04:02&lt;04:00,  1.99it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 520/999 [04:03&lt;04:00,  1.99it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 521/999 [04:03&lt;03:58,  2.00it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 522/999 [04:04&lt;03:56,  2.02it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 523/999 [04:04&lt;04:01,  1.97it/s] 52%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè    | 524/999 [04:05&lt;04:03,  1.95it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 525/999 [04:05&lt;04:09,  1.90it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 526/999 [04:06&lt;04:08,  1.90it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 527/999 [04:06&lt;04:01,  1.95it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 528/999 [04:07&lt;04:06,  1.91it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 529/999 [04:07&lt;03:55,  2.00it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 530/999 [04:08&lt;04:03,  1.93it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 531/999 [04:08&lt;04:03,  1.92it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 532/999 [04:09&lt;04:05,  1.90it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 533/999 [04:09&lt;04:04,  1.91it/s] 53%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 534/999 [04:10&lt;04:00,  1.93it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 535/999 [04:10&lt;03:57,  1.95it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé    | 536/999 [04:11&lt;03:58,  1.94it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 537/999 [04:11&lt;03:55,  1.96it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 538/999 [04:12&lt;03:54,  1.97it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 539/999 [04:12&lt;03:56,  1.95it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 540/999 [04:13&lt;03:54,  1.96it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 541/999 [04:13&lt;03:53,  1.96it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 542/999 [04:14&lt;03:53,  1.96it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 543/999 [04:14&lt;03:52,  1.96it/s] 54%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 544/999 [04:15&lt;03:57,  1.91it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 545/999 [04:16&lt;04:00,  1.89it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 546/999 [04:16&lt;03:57,  1.90it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 547/999 [04:17&lt;03:56,  1.91it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 548/999 [04:17&lt;03:58,  1.89it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç    | 549/999 [04:18&lt;03:54,  1.92it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 550/999 [04:18&lt;03:50,  1.95it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 551/999 [04:19&lt;03:55,  1.90it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 552/999 [04:19&lt;03:51,  1.93it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 553/999 [04:20&lt;03:53,  1.91it/s] 55%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 554/999 [04:20&lt;03:51,  1.92it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 555/999 [04:21&lt;03:52,  1.91it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 556/999 [04:21&lt;03:52,  1.91it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 557/999 [04:22&lt;03:50,  1.92it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 558/999 [04:22&lt;03:49,  1.92it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 559/999 [04:23&lt;03:47,  1.93it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 560/999 [04:23&lt;03:48,  1.92it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå    | 561/999 [04:24&lt;03:46,  1.93it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 562/999 [04:24&lt;03:43,  1.96it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 563/999 [04:25&lt;03:52,  1.88it/s] 56%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 564/999 [04:26&lt;03:55,  1.85it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 565/999 [04:26&lt;04:02,  1.79it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 566/999 [04:27&lt;03:58,  1.82it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 567/999 [04:27&lt;03:52,  1.86it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 568/999 [04:28&lt;03:59,  1.80it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 569/999 [04:28&lt;04:08,  1.73it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 570/999 [04:29&lt;04:03,  1.77it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 571/999 [04:29&lt;03:56,  1.81it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 572/999 [04:30&lt;03:53,  1.83it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 573/999 [04:31&lt;03:54,  1.82it/s] 57%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã    | 574/999 [04:31&lt;03:54,  1.81it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 575/999 [04:32&lt;03:47,  1.86it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 576/999 [04:32&lt;03:42,  1.90it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 577/999 [04:33&lt;03:44,  1.88it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 578/999 [04:33&lt;03:42,  1.89it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 579/999 [04:34&lt;03:35,  1.94it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 580/999 [04:34&lt;03:37,  1.93it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 581/999 [04:35&lt;03:43,  1.87it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 582/999 [04:35&lt;03:35,  1.93it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 583/999 [04:36&lt;03:35,  1.93it/s] 58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 584/999 [04:36&lt;03:35,  1.92it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 585/999 [04:37&lt;03:36,  1.91it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 586/999 [04:37&lt;03:40,  1.87it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 587/999 [04:38&lt;03:41,  1.86it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 588/999 [04:38&lt;03:40,  1.87it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 589/999 [04:39&lt;03:34,  1.91it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 590/999 [04:39&lt;03:35,  1.90it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 591/999 [04:40&lt;03:40,  1.85it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 592/999 [04:41&lt;03:33,  1.91it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 593/999 [04:41&lt;03:36,  1.88it/s] 59%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 594/999 [04:42&lt;03:39,  1.84it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 595/999 [04:42&lt;03:42,  1.82it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 596/999 [04:43&lt;03:43,  1.80it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 597/999 [04:43&lt;03:47,  1.77it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 598/999 [04:44&lt;03:44,  1.79it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ    | 599/999 [04:45&lt;03:44,  1.78it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 600/999 [04:45&lt;03:42,  1.80it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 601/999 [04:46&lt;03:37,  1.83it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 602/999 [04:46&lt;03:34,  1.85it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 603/999 [04:47&lt;03:33,  1.86it/s] 60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 604/999 [04:47&lt;03:31,  1.87it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 605/999 [04:48&lt;03:30,  1.87it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 606/999 [04:48&lt;03:36,  1.82it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 607/999 [04:49&lt;03:31,  1.86it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 608/999 [04:49&lt;03:26,  1.89it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 609/999 [04:50&lt;03:23,  1.92it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 610/999 [04:50&lt;03:20,  1.94it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 611/999 [04:51&lt;03:18,  1.96it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 612/999 [04:51&lt;03:21,  1.92it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 613/999 [04:52&lt;03:17,  1.96it/s] 61%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 614/999 [04:52&lt;03:20,  1.92it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 615/999 [04:53&lt;03:11,  2.00it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 616/999 [04:53&lt;03:18,  1.93it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 617/999 [04:54&lt;03:17,  1.93it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 618/999 [04:54&lt;03:18,  1.92it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 619/999 [04:55&lt;03:13,  1.96it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 620/999 [04:55&lt;03:16,  1.93it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 621/999 [04:56&lt;03:13,  1.96it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 622/999 [04:56&lt;03:11,  1.97it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 623/999 [04:57&lt;03:12,  1.96it/s] 62%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè   | 624/999 [04:57&lt;03:10,  1.97it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 625/999 [04:58&lt;03:12,  1.94it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 626/999 [04:59&lt;03:12,  1.94it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 627/999 [04:59&lt;03:10,  1.96it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 628/999 [05:00&lt;03:11,  1.93it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 629/999 [05:00&lt;03:12,  1.92it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 630/999 [05:01&lt;03:12,  1.91it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 631/999 [05:01&lt;03:10,  1.94it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 632/999 [05:02&lt;03:02,  2.01it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 633/999 [05:02&lt;03:02,  2.00it/s] 63%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 634/999 [05:03&lt;03:02,  2.00it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 635/999 [05:03&lt;03:01,  2.00it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   | 636/999 [05:04&lt;03:03,  1.97it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 637/999 [05:04&lt;02:59,  2.01it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 638/999 [05:05&lt;03:02,  1.98it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 639/999 [05:05&lt;03:02,  1.97it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 640/999 [05:06&lt;03:02,  1.96it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 641/999 [05:06&lt;03:07,  1.91it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 642/999 [05:07&lt;03:08,  1.90it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 643/999 [05:07&lt;03:06,  1.91it/s] 64%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 644/999 [05:08&lt;03:05,  1.92it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 645/999 [05:08&lt;03:01,  1.95it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 646/999 [05:09&lt;03:04,  1.91it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 647/999 [05:09&lt;03:03,  1.92it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 648/999 [05:10&lt;02:56,  1.98it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç   | 649/999 [05:10&lt;02:53,  2.01it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 650/999 [05:11&lt;02:48,  2.07it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 651/999 [05:11&lt;02:50,  2.04it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 652/999 [05:12&lt;02:50,  2.03it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 653/999 [05:12&lt;02:53,  1.99it/s] 65%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 654/999 [05:13&lt;02:48,  2.05it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 655/999 [05:13&lt;02:44,  2.10it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 656/999 [05:14&lt;02:48,  2.03it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 657/999 [05:14&lt;02:49,  2.01it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 658/999 [05:15&lt;02:46,  2.05it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 659/999 [05:15&lt;02:44,  2.07it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 660/999 [05:16&lt;02:46,  2.04it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå   | 661/999 [05:16&lt;02:44,  2.05it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 662/999 [05:17&lt;02:45,  2.04it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 663/999 [05:17&lt;02:47,  2.00it/s] 66%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 664/999 [05:18&lt;02:49,  1.97it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 665/999 [05:18&lt;02:47,  2.00it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 666/999 [05:19&lt;02:46,  1.99it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 667/999 [05:19&lt;02:43,  2.03it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 668/999 [05:20&lt;02:43,  2.02it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 669/999 [05:20&lt;02:46,  1.98it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 670/999 [05:21&lt;02:46,  1.97it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 671/999 [05:21&lt;02:43,  2.01it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 672/999 [05:22&lt;02:38,  2.07it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 673/999 [05:22&lt;02:36,  2.08it/s] 67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 674/999 [05:23&lt;02:35,  2.09it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 675/999 [05:23&lt;02:34,  2.09it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 676/999 [05:23&lt;02:35,  2.08it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 677/999 [05:24&lt;02:36,  2.05it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 678/999 [05:24&lt;02:37,  2.04it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 679/999 [05:25&lt;02:36,  2.05it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 680/999 [05:25&lt;02:38,  2.02it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 681/999 [05:26&lt;02:35,  2.04it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 682/999 [05:26&lt;02:32,  2.08it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 683/999 [05:27&lt;02:35,  2.04it/s] 68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 684/999 [05:27&lt;02:35,  2.02it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 685/999 [05:28&lt;02:34,  2.04it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 686/999 [05:28&lt;02:34,  2.02it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 687/999 [05:29&lt;02:38,  1.97it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 688/999 [05:29&lt;02:39,  1.94it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 689/999 [05:30&lt;02:37,  1.96it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 690/999 [05:30&lt;02:38,  1.95it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 691/999 [05:31&lt;02:37,  1.95it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 692/999 [05:32&lt;02:36,  1.96it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 693/999 [05:32&lt;02:36,  1.96it/s] 69%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 694/999 [05:32&lt;02:32,  1.99it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 695/999 [05:33&lt;02:35,  1.96it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 696/999 [05:34&lt;02:38,  1.91it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 697/999 [05:34&lt;02:39,  1.90it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 698/999 [05:35&lt;02:38,  1.90it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ   | 699/999 [05:35&lt;02:39,  1.88it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 700/999 [05:36&lt;02:37,  1.90it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 701/999 [05:36&lt;02:36,  1.91it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 702/999 [05:37&lt;02:40,  1.85it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 703/999 [05:37&lt;02:39,  1.85it/s] 70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 704/999 [05:38&lt;02:37,  1.87it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 705/999 [05:38&lt;02:45,  1.77it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 706/999 [05:39&lt;02:39,  1.84it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 707/999 [05:40&lt;02:37,  1.85it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 708/999 [05:40&lt;02:33,  1.89it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 709/999 [05:41&lt;02:34,  1.87it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 710/999 [05:41&lt;02:37,  1.83it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 711/999 [05:42&lt;02:37,  1.83it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 712/999 [05:42&lt;02:35,  1.85it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 713/999 [05:43&lt;02:30,  1.90it/s] 71%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 714/999 [05:43&lt;02:32,  1.87it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 715/999 [05:44&lt;02:31,  1.87it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 716/999 [05:44&lt;02:33,  1.84it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 717/999 [05:45&lt;02:38,  1.78it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 718/999 [05:46&lt;02:37,  1.79it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 719/999 [05:46&lt;02:39,  1.75it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 720/999 [05:47&lt;02:43,  1.70it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 721/999 [05:47&lt;02:47,  1.66it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 722/999 [05:48&lt;02:50,  1.62it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 723/999 [05:49&lt;02:50,  1.62it/s] 72%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè  | 724/999 [05:49&lt;02:48,  1.63it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 725/999 [05:50&lt;02:46,  1.65it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 726/999 [05:50&lt;02:40,  1.70it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 727/999 [05:51&lt;02:41,  1.68it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 728/999 [05:52&lt;02:41,  1.67it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 729/999 [05:52&lt;02:41,  1.67it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 730/999 [05:53&lt;02:43,  1.64it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 731/999 [05:53&lt;02:41,  1.66it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 732/999 [05:54&lt;02:43,  1.64it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 733/999 [05:55&lt;02:41,  1.65it/s] 73%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 734/999 [05:55&lt;02:37,  1.69it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 735/999 [05:56&lt;02:34,  1.71it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé  | 736/999 [05:56&lt;02:40,  1.64it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 737/999 [05:57&lt;02:40,  1.63it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 738/999 [05:58&lt;02:54,  1.49it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 739/999 [05:59&lt;02:56,  1.47it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 740/999 [05:59&lt;02:56,  1.47it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 741/999 [06:00&lt;02:56,  1.46it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 742/999 [06:01&lt;02:53,  1.48it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 743/999 [06:01&lt;02:48,  1.52it/s] 74%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 744/999 [06:02&lt;02:49,  1.51it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 745/999 [06:03&lt;02:44,  1.54it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 746/999 [06:03&lt;02:41,  1.57it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 747/999 [06:04&lt;02:40,  1.57it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 748/999 [06:04&lt;02:44,  1.53it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç  | 749/999 [06:05&lt;02:41,  1.55it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 750/999 [06:06&lt;02:43,  1.52it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 751/999 [06:06&lt;02:43,  1.52it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 752/999 [06:07&lt;02:39,  1.54it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 753/999 [06:08&lt;02:40,  1.53it/s] 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 754/999 [06:08&lt;02:41,  1.52it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 755/999 [06:09&lt;02:40,  1.52it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 756/999 [06:10&lt;02:37,  1.55it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 757/999 [06:10&lt;02:42,  1.49it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 758/999 [06:11&lt;02:42,  1.48it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 759/999 [06:12&lt;02:38,  1.51it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 760/999 [06:12&lt;02:40,  1.49it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 761/999 [06:13&lt;02:43,  1.46it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 762/999 [06:14&lt;02:43,  1.45it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 763/999 [06:15&lt;02:46,  1.42it/s] 76%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 764/999 [06:15&lt;02:49,  1.38it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 765/999 [06:16&lt;02:45,  1.41it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 766/999 [06:17&lt;02:43,  1.43it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 767/999 [06:17&lt;02:43,  1.42it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 768/999 [06:18&lt;02:42,  1.42it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 769/999 [06:19&lt;02:41,  1.43it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 770/999 [06:20&lt;02:41,  1.42it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 771/999 [06:20&lt;02:35,  1.46it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 772/999 [06:21&lt;02:32,  1.49it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 773/999 [06:21&lt;02:31,  1.50it/s] 77%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã  | 774/999 [06:22&lt;02:32,  1.48it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 775/999 [06:23&lt;02:30,  1.49it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 776/999 [06:23&lt;02:31,  1.47it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 777/999 [06:24&lt;02:31,  1.47it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 778/999 [06:25&lt;02:33,  1.44it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 779/999 [06:26&lt;02:29,  1.47it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 780/999 [06:26&lt;02:27,  1.48it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 781/999 [06:27&lt;02:30,  1.44it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 782/999 [06:28&lt;02:29,  1.46it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 783/999 [06:28&lt;02:29,  1.45it/s] 78%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 784/999 [06:29&lt;02:28,  1.45it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 785/999 [06:30&lt;02:32,  1.41it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä  | 786/999 [06:31&lt;02:35,  1.37it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 787/999 [06:31&lt;02:32,  1.39it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 788/999 [06:32&lt;02:31,  1.39it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 789/999 [06:33&lt;02:30,  1.39it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 790/999 [06:33&lt;02:29,  1.39it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 791/999 [06:34&lt;02:25,  1.43it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 792/999 [06:35&lt;02:22,  1.45it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 793/999 [06:35&lt;02:20,  1.47it/s] 79%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 794/999 [06:36&lt;02:21,  1.45it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 795/999 [06:37&lt;02:17,  1.48it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 796/999 [06:37&lt;02:17,  1.48it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 797/999 [06:38&lt;02:17,  1.47it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 798/999 [06:39&lt;02:20,  1.43it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ  | 799/999 [06:40&lt;02:24,  1.38it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 800/999 [06:40&lt;02:26,  1.36it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 801/999 [06:41&lt;02:24,  1.37it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 802/999 [06:42&lt;02:23,  1.37it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 803/999 [06:43&lt;02:24,  1.36it/s] 80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 804/999 [06:43&lt;02:25,  1.34it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 805/999 [06:44&lt;02:24,  1.34it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 806/999 [06:45&lt;02:23,  1.34it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 807/999 [06:46&lt;02:20,  1.37it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 808/999 [06:46&lt;02:17,  1.38it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 809/999 [06:47&lt;02:15,  1.40it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 810/999 [06:48&lt;02:11,  1.44it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 811/999 [06:48&lt;02:11,  1.43it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 812/999 [06:49&lt;02:10,  1.43it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 813/999 [06:50&lt;02:10,  1.42it/s] 81%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 814/999 [06:50&lt;02:13,  1.39it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 815/999 [06:51&lt;02:15,  1.36it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 816/999 [06:52&lt;02:16,  1.34it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 817/999 [06:53&lt;02:16,  1.33it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 818/999 [06:54&lt;02:14,  1.35it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 819/999 [06:54&lt;02:17,  1.31it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 820/999 [06:55&lt;02:15,  1.32it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 821/999 [06:56&lt;02:13,  1.33it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 822/999 [06:57&lt;02:10,  1.35it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 823/999 [06:57&lt;02:09,  1.35it/s] 82%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè | 824/999 [06:58&lt;02:09,  1.35it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 825/999 [06:59&lt;02:10,  1.33it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 826/999 [06:59&lt;02:06,  1.37it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 827/999 [07:00&lt;02:01,  1.42it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 828/999 [07:01&lt;02:00,  1.41it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 829/999 [07:02&lt;02:01,  1.39it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 830/999 [07:02&lt;01:59,  1.42it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 831/999 [07:03&lt;01:56,  1.44it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 832/999 [07:04&lt;01:56,  1.43it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 833/999 [07:04&lt;01:51,  1.48it/s] 83%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 834/999 [07:05&lt;01:49,  1.51it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 835/999 [07:06&lt;01:50,  1.48it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé | 836/999 [07:06&lt;01:50,  1.48it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 837/999 [07:07&lt;01:51,  1.45it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 838/999 [07:08&lt;01:51,  1.44it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 839/999 [07:08&lt;01:51,  1.43it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 840/999 [07:09&lt;01:50,  1.44it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 841/999 [07:10&lt;01:48,  1.46it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 842/999 [07:10&lt;01:47,  1.46it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 843/999 [07:11&lt;01:45,  1.48it/s] 84%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 844/999 [07:12&lt;01:43,  1.50it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 845/999 [07:12&lt;01:40,  1.53it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 846/999 [07:13&lt;01:43,  1.48it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 847/999 [07:14&lt;01:42,  1.49it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 848/999 [07:14&lt;01:41,  1.48it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç | 849/999 [07:15&lt;01:42,  1.46it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 850/999 [07:16&lt;01:40,  1.48it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 851/999 [07:16&lt;01:41,  1.46it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 852/999 [07:17&lt;01:40,  1.46it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 853/999 [07:18&lt;01:38,  1.49it/s] 85%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 854/999 [07:18&lt;01:34,  1.53it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 855/999 [07:19&lt;01:34,  1.52it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 856/999 [07:20&lt;01:32,  1.55it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 857/999 [07:20&lt;01:29,  1.58it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 858/999 [07:21&lt;01:29,  1.57it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 859/999 [07:22&lt;01:29,  1.57it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 860/999 [07:22&lt;01:31,  1.52it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå | 861/999 [07:23&lt;01:32,  1.50it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 862/999 [07:24&lt;01:29,  1.54it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 863/999 [07:24&lt;01:29,  1.52it/s] 86%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 864/999 [07:25&lt;01:30,  1.48it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 865/999 [07:26&lt;01:31,  1.47it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 866/999 [07:26&lt;01:30,  1.48it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 867/999 [07:27&lt;01:30,  1.46it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 868/999 [07:28&lt;01:27,  1.50it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 869/999 [07:28&lt;01:26,  1.51it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 870/999 [07:29&lt;01:24,  1.53it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 871/999 [07:30&lt;01:24,  1.51it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 872/999 [07:30&lt;01:24,  1.50it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 873/999 [07:31&lt;01:24,  1.48it/s] 87%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã | 874/999 [07:32&lt;01:23,  1.50it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 875/999 [07:32&lt;01:23,  1.49it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 876/999 [07:33&lt;01:22,  1.48it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 877/999 [07:34&lt;01:23,  1.47it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 878/999 [07:34&lt;01:22,  1.47it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 879/999 [07:35&lt;01:21,  1.47it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 880/999 [07:36&lt;01:20,  1.47it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 881/999 [07:36&lt;01:20,  1.47it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 882/999 [07:37&lt;01:20,  1.46it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 883/999 [07:38&lt;01:18,  1.47it/s] 88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 884/999 [07:38&lt;01:17,  1.48it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 885/999 [07:39&lt;01:15,  1.52it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 886/999 [07:40&lt;01:14,  1.51it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 887/999 [07:40&lt;01:14,  1.51it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 888/999 [07:41&lt;01:16,  1.46it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 889/999 [07:42&lt;01:14,  1.48it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 890/999 [07:42&lt;01:12,  1.50it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 891/999 [07:43&lt;01:10,  1.54it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 892/999 [07:44&lt;01:08,  1.56it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 893/999 [07:44&lt;01:07,  1.57it/s] 89%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 894/999 [07:45&lt;01:07,  1.56it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 895/999 [07:46&lt;01:06,  1.56it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 896/999 [07:46&lt;01:05,  1.57it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 897/999 [07:47&lt;01:05,  1.57it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 898/999 [07:48&lt;01:04,  1.56it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ | 899/999 [07:48&lt;01:03,  1.57it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 900/999 [07:49&lt;01:02,  1.57it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 901/999 [07:49&lt;01:02,  1.56it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 902/999 [07:50&lt;01:02,  1.56it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 903/999 [07:51&lt;01:00,  1.58it/s] 90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 904/999 [07:51&lt;01:00,  1.58it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 905/999 [07:52&lt;01:00,  1.55it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 906/999 [07:53&lt;00:59,  1.56it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 907/999 [07:53&lt;00:58,  1.56it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 908/999 [07:54&lt;00:57,  1.57it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 909/999 [07:55&lt;00:58,  1.54it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 910/999 [07:55&lt;00:59,  1.51it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 911/999 [07:56&lt;00:58,  1.51it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 912/999 [07:57&lt;00:58,  1.50it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 913/999 [07:57&lt;00:57,  1.49it/s] 91%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 914/999 [07:58&lt;00:56,  1.52it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 915/999 [07:59&lt;00:55,  1.51it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 916/999 [07:59&lt;00:55,  1.51it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 917/999 [08:00&lt;00:54,  1.49it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 918/999 [08:01&lt;00:54,  1.49it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 919/999 [08:01&lt;00:53,  1.48it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 920/999 [08:02&lt;00:52,  1.51it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 921/999 [08:03&lt;00:50,  1.55it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 922/999 [08:03&lt;00:49,  1.56it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 923/999 [08:04&lt;00:48,  1.56it/s] 92%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè| 924/999 [08:04&lt;00:47,  1.57it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 925/999 [08:05&lt;00:47,  1.56it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 926/999 [08:06&lt;00:47,  1.55it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 927/999 [08:06&lt;00:46,  1.54it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 928/999 [08:07&lt;00:46,  1.54it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 929/999 [08:08&lt;00:45,  1.53it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 930/999 [08:08&lt;00:45,  1.53it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 931/999 [08:09&lt;00:44,  1.53it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 932/999 [08:10&lt;00:43,  1.54it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 933/999 [08:10&lt;00:43,  1.52it/s] 93%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 934/999 [08:11&lt;00:42,  1.53it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 935/999 [08:12&lt;00:41,  1.55it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé| 936/999 [08:12&lt;00:40,  1.54it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 937/999 [08:13&lt;00:39,  1.56it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 938/999 [08:13&lt;00:37,  1.61it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 939/999 [08:14&lt;00:37,  1.58it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 940/999 [08:15&lt;00:36,  1.60it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 941/999 [08:15&lt;00:35,  1.62it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 942/999 [08:16&lt;00:35,  1.60it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 943/999 [08:17&lt;00:35,  1.59it/s] 94%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 944/999 [08:17&lt;00:34,  1.58it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 945/999 [08:18&lt;00:34,  1.58it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 946/999 [08:19&lt;00:33,  1.59it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 947/999 [08:19&lt;00:30,  1.68it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 948/999 [08:20&lt;00:30,  1.65it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñç| 949/999 [08:20&lt;00:30,  1.65it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 950/999 [08:21&lt;00:30,  1.62it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 951/999 [08:22&lt;00:30,  1.56it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 952/999 [08:22&lt;00:30,  1.52it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 953/999 [08:23&lt;00:30,  1.51it/s] 95%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 954/999 [08:24&lt;00:30,  1.46it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 955/999 [08:24&lt;00:30,  1.45it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 956/999 [08:25&lt;00:29,  1.45it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 957/999 [08:26&lt;00:29,  1.43it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 958/999 [08:27&lt;00:28,  1.43it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 959/999 [08:27&lt;00:28,  1.42it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 960/999 [08:28&lt;00:26,  1.45it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå| 961/999 [08:29&lt;00:26,  1.44it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 962/999 [08:29&lt;00:25,  1.44it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 963/999 [08:30&lt;00:25,  1.41it/s] 96%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 964/999 [08:31&lt;00:25,  1.37it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 965/999 [08:32&lt;00:24,  1.39it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 966/999 [08:32&lt;00:23,  1.41it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 967/999 [08:33&lt;00:22,  1.44it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 968/999 [08:34&lt;00:21,  1.45it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 969/999 [08:34&lt;00:21,  1.41it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 970/999 [08:35&lt;00:20,  1.44it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 971/999 [08:36&lt;00:19,  1.44it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 972/999 [08:36&lt;00:18,  1.42it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 973/999 [08:37&lt;00:18,  1.42it/s] 97%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã| 974/999 [08:38&lt;00:18,  1.35it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 975/999 [08:39&lt;00:17,  1.36it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 976/999 [08:39&lt;00:16,  1.41it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 977/999 [08:40&lt;00:16,  1.36it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 978/999 [08:41&lt;00:15,  1.34it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 979/999 [08:42&lt;00:14,  1.37it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 980/999 [08:42&lt;00:13,  1.40it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 981/999 [08:43&lt;00:13,  1.38it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 982/999 [08:44&lt;00:12,  1.38it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 983/999 [08:44&lt;00:11,  1.41it/s] 98%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 984/999 [08:45&lt;00:10,  1.40it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 985/999 [08:46&lt;00:10,  1.39it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä| 986/999 [08:46&lt;00:09,  1.43it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 987/999 [08:47&lt;00:08,  1.42it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 988/999 [08:48&lt;00:07,  1.40it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 989/999 [08:49&lt;00:07,  1.42it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 990/999 [08:49&lt;00:06,  1.43it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 991/999 [08:50&lt;00:05,  1.41it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 992/999 [08:51&lt;00:04,  1.42it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 993/999 [08:51&lt;00:04,  1.38it/s] 99%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 994/999 [08:52&lt;00:03,  1.39it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 995/999 [08:53&lt;00:02,  1.42it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 996/999 [08:54&lt;00:02,  1.41it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 997/999 [08:54&lt;00:01,  1.39it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñâ| 998/999 [08:55&lt;00:00,  1.34it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 999/999 [08:56&lt;00:00,  1.39it/s]100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 999/999 [08:56&lt;00:00,  1.86it/s]</code></pre>
</div>
</div>
<div id="ebe9eacf" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb57-2">plt.scatter(quantiles_theoriques, quantiles_empiriques)</span>
<span id="cb57-3">plt.plot(quantiles_theoriques, quantiles_theoriques, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Premi√®re bissectrice'</span>)</span>
<span id="cb57-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'QQ Plot - Quantiles empiriques vs Quantiles th√©oriques'</span>)</span>
<span id="cb57-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles th√©oriques (distribution Skew Student)'</span>)</span>
<span id="cb57-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Quantiles empiriques'</span>)</span>
<span id="cb57-7">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb57-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="20dd39f6" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb58" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># # kstest y revenir</span></span>
<span id="cb58-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ks_stat, ks_p_value = kstest(data_train, skew_student_pdf, args=(**params_sstd,))</span></span>
<span id="cb58-3"></span>
<span id="cb58-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("="*80)</span></span>
<span id="cb58-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("H0 : Les donn√©es suivent une loi de Skew Student")</span></span>
<span id="cb58-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"Statistique de test : {ks_stat:.4f}")</span></span>
<span id="cb58-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(f"P-value : {ks_p_value:.4f}")</span></span>
<span id="cb58-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print("="*80)</span></span>
<span id="cb58-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A revoir</span></span></code></pre></div>
</div>
</section>
<section id="ii.4.2.-calcul-de-la-var-skew-student" class="level3">
<h3 class="anchored" data-anchor-id="ii.4.2.-calcul-de-la-var-skew-student">II.4.2. Calcul de la VaR Skew Student</h3>
<div id="5a000c54" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Objectif : √©crire une fonction qui calcule la VaR skew-student</span></span>
<span id="cb59-2"></span>
<span id="cb59-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sstd_var_fct(alpha, params):</span>
<span id="cb59-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb59-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de la VaR skew student</span></span>
<span id="cb59-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb59-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    alpha : le niveau de confiance</span></span>
<span id="cb59-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb59-9"></span>
<span id="cb59-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>skew_student_quantile(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params)</span></code></pre></div>
</div>
<div id="86892cb9" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb60" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1">sstd_var <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sstd_var_fct(alpha, params_sstd)</span>
<span id="cb60-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La VaR skew student pour h=1j et alpha=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>alpha<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sstd_var<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La VaR skew student pour h=1j et alpha=0.99 est : 4.2575%</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="iii.-impl√©mentation-de-les" class="level1">
<h1>III. Impl√©mentation de l‚ÄôES</h1>
<p>L‚Äôexpected shortfall (ES) est une mesure de risque qui donne une estimation de la perte moyenne au-del√† du seuil de la VaR. Par exemple, un ES √† 5% sur 1 jour de 1000 euros signifie que si la perte d√©passe 1000 euros, alors la perte moyenne sera de 1500 euros. L‚ÄôES est une mesure plus robuste que la VaR, car elle prend en compte les queues de distribution et est particuli√®rement utile pour √©valuer les risques extr√™mes. Elle est d√©finie comme suit :</p>
<p><img src="https://latex.codecogs.com/png.latex?ES_%7B%5Calpha%7D(h)%20=%20E(PnL%20%7C%20PnL%20%5Cleq%20-VaR_%7B%5Calpha%7D(h))"></p>
<p>/!&nbsp;La ES du cours est diff√©rente de celle ci. Elle est d√©finie comme suit : <img src="https://latex.codecogs.com/png.latex?ES_%7B%5Calpha%7D(h)%20=%20E(PnL%20-%20VaR%20%7C%20PnL%20%5Cleq%20-VaR_%7B%5Calpha%7D(h))%20=%20CTE%20-%20VaR"></p>
<p>Voir ce qui est fait dans le cadre r√©glementaire.</p>
<div id="79cc0359" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb62" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Expected Shortfall pour la VaR historique, bootstrap et gaussienne, et skew-student</span></span>
<span id="cb62-2"></span>
<span id="cb62-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> expected_shortfall(data, var):</span>
<span id="cb62-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb62-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcul de l'Expected Shortfall</span></span>
<span id="cb62-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    data : les rendements logarithmiques</span></span>
<span id="cb62-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    var : la VaR</span></span>
<span id="cb62-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb62-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>data[data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>var].mean()</span>
<span id="cb62-10"></span>
<span id="cb62-11">es_hist_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expected_shortfall(data_train, var_hist_train)</span>
<span id="cb62-12">es_bs_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expected_shortfall(data_train, var_bs_train)</span>
<span id="cb62-13">es_gauss_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expected_shortfall(data_train, var_gauss_train)</span>
<span id="cb62-14">es_sstd_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expected_shortfall(data_train, sstd_var)</span>
<span id="cb62-15"></span>
<span id="cb62-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># in a df</span></span>
<span id="cb62-17">es <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb62-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Historique'</span>: [es_hist_train],</span>
<span id="cb62-19">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Bootstrap'</span>: [es_bs_train],</span>
<span id="cb62-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gaussienne'</span>: [es_gauss_train],</span>
<span id="cb62-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Skew Student'</span>: [es_sstd_train]</span>
<span id="cb62-22">})</span>
<span id="cb62-23"></span>
<span id="cb62-24"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb62-25"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expected Shortfall empirique (en %) pour h=1j"</span>)</span>
<span id="cb62-26"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>es,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb62-27"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Expected Shortfall empirique (en %) pour h=1j
   Historique  Bootstrap  Gaussienne  Skew Student
0        5.47       5.51        4.47          5.68
================================================================================</code></pre>
</div>
</div>
<div id="f55c5a18" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb64" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> stats</span>
<span id="cb64-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> scipy.integrate <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> integrate</span>
<span id="cb64-3"></span>
<span id="cb64-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> expected_shortfall_theoretical(alpha, quantile_function, density_function,params):</span>
<span id="cb64-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb64-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Computes the Expected Shortfall (Conditional VaR) for a given distribution.</span></span>
<span id="cb64-7"></span>
<span id="cb64-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters:</span></span>
<span id="cb64-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - alpha (float): Confidence level (e.g., 0.99 for 99%)</span></span>
<span id="cb64-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - quantile_function (callable): Function to compute quantiles (e.g., skew_student_quantile)</span></span>
<span id="cb64-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - params (dict): Parameters of the distribution</span></span>
<span id="cb64-12"></span>
<span id="cb64-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb64-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - float: Expected Shortfall value</span></span>
<span id="cb64-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb64-16"></span>
<span id="cb64-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the Value at Risk (VaR) at level alpha</span></span>
<span id="cb64-18">    var_alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quantile_function(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>alpha, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params)</span>
<span id="cb64-19"></span>
<span id="cb64-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Expected Shortfall integral</span></span>
<span id="cb64-21">    integral_value, _ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> integrate.quad(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> density_function(x, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>params), <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inf"</span>), var_alpha)</span>
<span id="cb64-22"></span>
<span id="cb64-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute Expected Shortfall</span></span>
<span id="cb64-24">    es_alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>integral_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> alpha)</span>
<span id="cb64-25"></span>
<span id="cb64-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> es_alpha</span>
<span id="cb64-27"></span>
<span id="cb64-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute Expected Shortfall using the corrected function</span></span>
<span id="cb64-29">alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span></span>
<span id="cb64-30">es_sstd_theoretical <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expected_shortfall_theoretical(alpha,skew_student_quantile,skew_student_pdf, params_sstd)</span>
<span id="cb64-31"></span>
<span id="cb64-32">params_norm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb64-33">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loc"</span> : np.mean(data_train),</span>
<span id="cb64-34">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scale"</span> : np.std(data_train)</span>
<span id="cb64-35">}</span>
<span id="cb64-36"></span>
<span id="cb64-37">es_gauss_theoretical <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expected_shortfall_theoretical(alpha,stats.norm.ppf,stats.norm.pdf, params_norm)</span>
<span id="cb64-38"></span>
<span id="cb64-39">es_theoretical <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb64-40">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Gaussienne'</span>: [es_gauss_theoretical],</span>
<span id="cb64-41">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Skew Student'</span>: [es_sstd_theoretical]</span>
<span id="cb64-42">})</span>
<span id="cb64-43"></span>
<span id="cb64-44"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb64-45"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Expected Shortfall th√©orique (en %) pour h=1j"</span>)</span>
<span id="cb64-46"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>es_theoretical,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb64-47"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Expected Shortfall th√©orique (en %) pour h=1j
   Gaussienne  Skew Student
0         3.7          6.71
================================================================================</code></pre>
</div>
</div>
</section>
<section id="iv.protocole-de-backtesting" class="level1">
<h1>IV.Protocole de Backtesting</h1>
<p>L‚Äôexercice de backtesting consiste √† v√©rifier la capacit√© d‚Äôadaptation du mod√®le et sa viabilit√© en dehors de son cadre d‚Äôentra√Ænement. Il permet d‚Äô√©valuer la performance des mod√®les dans le temps. Id√©alement, il faudrait le realiser quotidiennement afin d‚Äô√©valuer s‚Äôil est utile ou non de recalibrer le mod√®le.</p>
<p>Dans le cadre de TP, nous n‚Äôavons pas observ√© d‚Äôexceptions avec l‚Äôutilisation de la VaR historique. Cela est probablement du √† la p√©riode d‚Äôapprentissage trop stricte. Notre mod√®le √©tait donc trop restrictif/conservateur ce qui peut t√©moigner de son incapacit√© d‚Äôadaptation. Pour ce faire, il aurait √©t√© necessaire de le recalibrer.</p>
<p>Sachant que les mod√®les sont √©valu√©s quotidiennement, √† quel moment doit-on consid√©rer qu‚Äôil est n√©cessaire de recalibrer le mod√®le ? Quels indicateurs pourrait-on mettre en place pour d√©terminer si tout est sous contr√¥le (VaR trop haute, trop basse) ou si un recalibrage est requis, sachant que le mod√®le est backtest√© chaque jour ?</p>
<p>Pour repondre √† ces questions, nous proposons le protocole de backtest ci-dessous :</p>
<ul>
<li><p>Dans la r√©glementation baloise, il est demand√© de tester les performances de la VaR sur les 250 jours suivants la date de r√©alisation du mod√®le. Dans ces 250 jours, on est cens√© observ√© 2 √† 3 exceptions, soit 1%. Lorsqu‚Äôil n‚Äôy a aucune exception sur cette p√©riode de temps, nous jugerons que le mod√®le est mal calibr√©.</p></li>
<li><p>Lorsqu‚Äôil y a des exceptions, nous pouvons comparer ces exceptions th√©oriques aux exceptions observ√©es √† l‚Äôaide d‚Äôun test de Kupiec/Unconditionnal coverage [1], une variante du test binomiale qui permet de tester sous l‚Äôhypoth√®se nulle que le taux d‚Äôexception(p) est √©gal au niveau de confiance de la VaR (1-<img src="https://latex.codecogs.com/png.latex?%5Calpha">). La statistique de test suit une loi de khi-deux √† 1 degr√© de libert√©. Lorsque cette hypoth√®se est rejet√©e, cela signifie que le mod√®le est mal calibr√©. En effet, si une banque a trop d‚Äôexceptions, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?p%20%5Cgeq%201%20-%20%5Calpha">, cela signifie que son mod√®le sous-estime le risque, ce qui peut conduire √† une exigence de recalibrage ou une augmentation du capital r√©glementaire. Si une banque a trop peu d‚Äôexceptions (voire 0), i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?p%20%5Cleq%201%20-%20%5Calpha">, cela peut indiquer que son mod√®le est trop conservateur, ce qui immobilise trop de capital inutilement.</p></li>
<li><p>Puisqu‚Äôun seul test de backtesting n‚Äôest pas suffisant[2] pour juger la qualit√© d‚Äôun mod√®le de VaR, il serait pr√©f√©rable de combiner diff√©rentes m√©thodes. Pour ce faire, un autre test a √©t√© utilis√© pour juger de la necessit√© de recalibrage du mod√®le. Il s‚Äôagit du test de Christoffersen‚Äôs Interval Forecast/Independance test [3]. Ce test permet de v√©rifier si les exceptions sont ind√©pendantes et donc bien r√©parties dans le temps. En effet, si les exceptions sont concentr√©es dans un intervalle de temps, cela peut indiquer que le mod√®le est mal calibr√©. Sous l‚Äôhypoth√®se nulle, la statistique de test suit asymptotiquement une loi de khi-deux √† 1 degr√© de libert√©.</p></li>
<li><p>En couplant le test de Kupiec au test de Christoffersen [3], nous avons le test de conditional coverage mixte[3] qui suit une loi de khi-deux √† 2 degr√©s de libert√©.</p></li>
</ul>
<p>Pour la mise en place de ces tests statistiques, nous avons besoin d‚Äôune √©chantillon de taille suffisamment grande, i.e <img src="https://latex.codecogs.com/png.latex?N=30">. Pour ce faire, nous ne pourrons mettre en place ce protocole qu‚Äô√† partir du 30√®me jour de backtesting. Pour le backtest, nous avons fait le choix d‚Äôutiliser un expanding window, i.e.&nbsp;une fen√™tre d‚Äôapprentissage qui s‚Äôagrandit √† chaque p√©riode de recalibrage. Il aurait √©t√© plus pertinent de privil√©gier un rolling window, i.e.&nbsp;une fen√™tre d‚Äôapprentissage qui se d√©place √† chaque p√©riode de recalibrage, pour √©viter de bruiter les donn√©es.</p>
<p>PROBL√àME : au bout de 30j, s‚Äôil n‚Äôy a pas d‚Äôexceptions, on ne recalibre pas le mod√®le mais si au 31e jour il y a une exception, le test de kupiec echoue=&gt; recalibrage. <strong><em>References</em></strong>: - [1] Kupiec, P. ‚ÄúTechniques for Verifying the Accuracy of Risk Management Models.‚Äù Journal of Derivatives. Vol. 3, 1995, pp.&nbsp;73‚Äì84. - [2] Haas, M. ‚ÄúNew Methods in Backtesting.‚Äù Financial Engineering, Research Center Caesar, Bonn, 2001. - [3] Christoffersen, P. ‚ÄúEvaluating Interval Forecasts.‚Äù International Economic Review. Vol. 39, 1998, pp.&nbsp;841‚Äì862.</p>
<div id="f9751825" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb66" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb66-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb66-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> chi2</span>
<span id="cb66-4"></span>
<span id="cb66-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> Backtest:</span>
<span id="cb66-6">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, actual, forecast, alpha, alpha_test):</span>
<span id="cb66-7">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> actual.index</span>
<span id="cb66-8">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.actual <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> actual.values</span>
<span id="cb66-9">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.forecast <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> forecast</span>
<span id="cb66-10">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> alpha</span>
<span id="cb66-11">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> alpha_test</span>
<span id="cb66-12"></span>
<span id="cb66-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> hit_series(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb66-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">""" Returns a series of 1s (VaR breaches) and 0s (no breach) """</span></span>
<span id="cb66-15">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.actual <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.forecast).astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb66-16">    </span>
<span id="cb66-17">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> lr_bt(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb66-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">""" Back-test protocol """</span></span>
<span id="cb66-19">        hits <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.hit_series()  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S√©rie des violations de la VaR (1 si violation, 0 sinon)</span></span>
<span id="cb66-20">        transitions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> hits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> hits[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Diff√©rences entre valeurs successives (1 si passage de 0 √† 1, -1 si passage de 1 √† 0)</span></span>
<span id="cb66-21"></span>
<span id="cb66-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transition counts</span></span>
<span id="cb66-23">        n01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(transitions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 -&gt; 1</span></span>
<span id="cb66-24">        n10 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(transitions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 -&gt; 0</span></span>
<span id="cb66-25">        n11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>((transitions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (hits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 -&gt; 1</span></span>
<span id="cb66-26">        n00 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>((transitions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (hits[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0 -&gt; 0</span></span>
<span id="cb66-27">        </span>
<span id="cb66-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of observations in each state</span></span>
<span id="cb66-29">        n0, n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n00, n10 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n11</span>
<span id="cb66-30">        total_n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n1</span>
<span id="cb66-31">        </span>
<span id="cb66-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Probability estimates</span></span>
<span id="cb66-33">        p01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n00 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n01) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (n00 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n01) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb66-34">        p11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n10) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (n11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n10) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb66-35">        p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_n <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> total_n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb66-36">        </span>
<span id="cb66-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb66-38">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb66-39"></span>
<span id="cb66-40">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unconditional Coverage Test/Kupiec</span></span>
<span id="cb66-41">            uc_h0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha)</span>
<span id="cb66-42">            uc_h1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> n0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(p)</span>
<span id="cb66-43">            uc_stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (uc_h0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> uc_h1)</span>
<span id="cb66-44">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># uc_critical_val = chi2.ppf(self.alpha_test, 1)</span></span>
<span id="cb66-45">            uc_pval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> chi2.cdf(uc_stat, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb66-46">            </span>
<span id="cb66-47">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Independence Test/Christoffersen</span></span>
<span id="cb66-48">            ind_h0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (n00 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n01) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (n01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n11) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(p)</span>
<span id="cb66-49">            ind_h1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb66-50">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> p01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: ind_h1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> n01 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(p01)</span>
<span id="cb66-51">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p01) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: ind_h1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> n00 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p01)</span>
<span id="cb66-52">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> p11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: ind_h1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> n11 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(p11)</span>
<span id="cb66-53">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p11) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>: ind_h1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> n10 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p11)</span>
<span id="cb66-54">            ind_stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (ind_h0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ind_h1)</span>
<span id="cb66-55">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ind_critical_val = chi2.ppf(self.alpha_test, 1)</span></span>
<span id="cb66-56">            ind_pval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> chi2.cdf(ind_stat, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb66-57">            </span>
<span id="cb66-58">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Conditional Coverage Test/ Christoffersen &amp; Kupiec mixture</span></span>
<span id="cb66-59">            cc_stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> uc_stat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> ind_stat</span>
<span id="cb66-60">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># cc_critical_val = chi2.ppf(self.alpha_test, 2)</span></span>
<span id="cb66-61">            cc_pval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> chi2.cdf(cc_stat, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb66-62">            </span>
<span id="cb66-63">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store results in a DataFrame</span></span>
<span id="cb66-64">            df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb66-65">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Statistic"</span>: [uc_stat, cc_stat, ind_stat],</span>
<span id="cb66-66">                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># "Critical Value": [uc_critical_val, ind_critical_val, cc_critical_val],</span></span>
<span id="cb66-67">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span>: [uc_pval, cc_pval, ind_pval]</span>
<span id="cb66-68">            }, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unconditional"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Conditional"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Independence"</span>])</span>
<span id="cb66-69"></span>
<span id="cb66-70">            binomial_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.binomtest(n1, total_n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha, alternative<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'two-sided'</span>)</span>
<span id="cb66-71">            df.loc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Binomial"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [binomial_test.statistic, binomial_test.pvalue]</span>
<span id="cb66-72">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb66-73">            df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(np.nan, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Unconditional"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Conditional"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Independence"</span>], columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Statistic"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span>])</span>
<span id="cb66-74">            binomial_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.binomtest(n1, total_n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.alpha, alternative<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'two-sided'</span>)</span>
<span id="cb66-75">            df.loc[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Binomial"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [binomial_test.statistic, binomial_test.pvalue]</span>
<span id="cb66-76">        </span>
<span id="cb66-77">        </span>
<span id="cb66-78">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span></code></pre></div>
</div>
<div id="00b66711" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb67" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> daily_backtest(actual, forecast, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, alpha_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>,min_days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, max_days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>):</span>
<span id="cb67-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">""" Runs a growing backtest daily, starting at min_days up to max_days """</span></span>
<span id="cb67-3">    recalibration_needed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb67-4">    end_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(max_days,<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(actual))</span>
<span id="cb67-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> end <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(min_days, end_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>):</span>
<span id="cb67-6">        data_to_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> actual[:end]</span>
<span id="cb67-7">        var_to_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> forecast</span>
<span id="cb67-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_to_test) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>:</span>
<span id="cb67-9">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span></span>
<span id="cb67-10">        </span>
<span id="cb67-11">        bt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Backtest(actual<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_to_test, forecast<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>var_to_test, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha, alpha_test<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha_test)</span>
<span id="cb67-12">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bt.lr_bt()</span>
<span id="cb67-13">        </span>
<span id="cb67-14">        nb_exceptions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bt.hit_series().<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb67-15">        </span>
<span id="cb67-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># res=bootstrap((data_to_test,), statistic=lambda x: exceptions(x, var_to_test)/len(x), method='percentile', n_resamples=1000)</span></span>
<span id="cb67-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ci_lower, ci_upper = res.confidence_interval</span></span>
<span id="cb67-18"></span>
<span id="cb67-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if ci_lower &lt;= 1-alpha &lt;= ci_upper:</span></span>
<span id="cb67-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     print(f"Recalibration needed at {end} days: The conditional test failed.")</span></span>
<span id="cb67-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     recalibration_needed = True</span></span>
<span id="cb67-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     return recalibration_needed, end</span></span>
<span id="cb67-23"></span>
<span id="cb67-24">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># if "conditional" in result.index and result.loc["Independence", "p-value"] &lt; 0.05:</span></span>
<span id="cb67-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     print(f"Recalibration needed at {end} days: The Independence test failed.")</span></span>
<span id="cb67-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     recalibration_needed = True</span></span>
<span id="cb67-27">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     return recalibration_needed, end</span></span>
<span id="cb67-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># failed_tests = result.iloc[2:][result.iloc[2:]["p-value"] &lt; 0.05].index.tolist()</span></span>
<span id="cb67-29">        failed_tests <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result[result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>].index.tolist()</span>
<span id="cb67-30"></span>
<span id="cb67-31">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> failed_tests:</span>
<span id="cb67-32">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Recalibration needed at </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>end<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> days: The following tests failed: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">', '</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>join(failed_tests)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb67-33">            recalibration_needed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb67-34">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> recalibration_needed, end</span>
<span id="cb67-35">            </span>
<span id="cb67-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> max_days <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> nb_exceptions <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb67-37">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Recalibration needed at </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>end<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> days: No exceptions observed in the test window."</span>)</span>
<span id="cb67-38">            recalibration_needed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb67-39">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> recalibration_needed, end</span>
<span id="cb67-40">    </span>
<span id="cb67-41">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> recalibration_needed:</span>
<span id="cb67-42">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No recalibration needed in the tested period."</span>)</span></code></pre></div>
</div>
<div id="66855bba" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb68" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> iterative_backtest(data_train, data_test, var_model, alpha):</span>
<span id="cb68-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">""" Runs an iterative backtest with recalibration """</span></span>
<span id="cb68-3">    data_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_train.copy()</span>
<span id="cb68-4">    data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_test.copy()</span>
<span id="cb68-5"></span>
<span id="cb68-6">    var_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> var_model(data_train, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span>
<span id="cb68-7">    var_to_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> var_result[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(var_result, (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>)) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> var_result </span>
<span id="cb68-8">    </span>
<span id="cb68-9">    recalibration_points <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb68-10">    vars_stored <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [var_to_test]</span>
<span id="cb68-11">    </span>
<span id="cb68-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_test) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_test) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>:</span>
<span id="cb68-13">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>)</span>
<span id="cb68-14">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Old VaR to test: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_to_test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb68-15"></span>
<span id="cb68-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Run daily backtest correctly</span></span>
<span id="cb68-17">        res_backtest, index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> daily_backtest(data_test, var_to_test, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha, alpha_test<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, min_days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, max_days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>)</span>
<span id="cb68-18"></span>
<span id="cb68-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the index of recalibration</span></span>
<span id="cb68-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> res_backtest:</span>
<span id="cb68-21">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_test))</span>
<span id="cb68-22">            recalibration_points.append(index)</span>
<span id="cb68-23"></span>
<span id="cb68-24">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Expand training data and shrink test data</span></span>
<span id="cb68-25">            data_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([data_train, data_test.iloc[:index,]])</span>
<span id="cb68-26">            data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_test.iloc[index:,]</span>
<span id="cb68-27">            var_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> var_model(data_train, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span>
<span id="cb68-28">            var_to_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> var_result[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(var_result, (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>)) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> var_result </span>
<span id="cb68-29">            vars_stored.append(var_to_test)</span>
<span id="cb68-30"></span>
<span id="cb68-31">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"New VaR to test: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>var_to_test<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb68-32">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb68-33">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No recalibration needed."</span>)</span>
<span id="cb68-34">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb68-35"></span>
<span id="cb68-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> recalibration_points, vars_stored</span>
<span id="cb68-37"></span>
<span id="cb68-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Execute iterative backtest</span></span>
<span id="cb68-39">recalibration_points, vars_stored <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> iterative_backtest(data_train, data_test, gaussian_var_ewma, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>alpha)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
Old VaR to test: 2.7763%
Recalibration needed at 103 days: The following tests failed: Unconditional, Conditional
586
New VaR to test: 2.5925%
================================================================================
Old VaR to test: 2.5925%
Recalibration needed at 61 days: The following tests failed: Unconditional, Conditional
483
New VaR to test: 2.6675%
================================================================================
Old VaR to test: 2.6675%
Recalibration needed at 30 days: The following tests failed: Unconditional, Conditional
422
New VaR to test: 1.8885%
================================================================================
Old VaR to test: 1.8885%
Recalibration needed at 50 days: The following tests failed: Unconditional, Conditional
392
New VaR to test: 2.5369%
================================================================================
Old VaR to test: 2.5369%
Recalibration needed at 240 days: The following tests failed: Unconditional, Conditional
342
New VaR to test: 2.7075%</code></pre>
</div>
</div>
<div id="fc763664" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb70" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb70-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb70-3"></span>
<span id="cb70-4">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb70-5">data_test.reset_index(drop<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, inplace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb70-6">plt.plot(data_test, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Returns"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'blue'</span>)</span>
<span id="cb70-7">recab <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.cumsum(np.array(recalibration_points))</span>
<span id="cb70-8">vars_stored_neg <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.array(vars_stored)</span>
<span id="cb70-9"></span>
<span id="cb70-10">plt.scatter(recab, vars_stored_neg, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Recalibration points"</span>, zorder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb70-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(recab) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb70-12">    plt.step(recab, vars_stored_neg, where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'post'</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'solid'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VaR Adjusted"</span>)</span>
<span id="cb70-13">    plt.hlines(vars_stored_neg[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], xmin<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>recab[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], xmax<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(data_test), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'solid'</span>)</span>
<span id="cb70-14"></span>
<span id="cb70-15">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>)</span>
<span id="cb70-16">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"VaR / Returns"</span>)</span>
<span id="cb70-17">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Backtesting VaR with Recalibration Points"</span>)</span>
<span id="cb70-18">plt.legend()</span>
<span id="cb70-19">plt.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb70-20"></span>
<span id="cb70-21">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>paper</category>
  <category>risques-fin</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/risques_financiers/value-at-risk/var_classiques.html</guid>
  <pubDate>Thu, 27 Feb 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>APF filter</title>
  <dc:creator>-Cheryl Kouadio -Safa Bouzayene -Mariyam Ouyassin</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter.html</link>
  <description><![CDATA[ 




<section id="m√©thodes-√©tude-de-simulation-sur-la-performance-du-filtre-apf" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> M√©thodes : √©tude de simulation sur la performance du filtre APF</h1>
<section id="mod√®le-utilis√©" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="mod√®le-utilis√©"><span class="header-section-number">1.1</span> Mod√®le utilis√©</h2>
<p>Le filtre particulaire APF (Auxiliary Particle Filter) est un filtre particulaire qui utilise des particules auxiliaires pour estimer la densit√© de probabilit√© de l‚Äô√©tat cach√©. Il est utilis√© pour estimer l‚Äô√©tat cach√© d‚Äôun syst√®me dynamique non lin√©aire. Dans cet article, nous allons √©tudier la performance du filtre APF en utilisant un exemple simple.</p>
<p>Comme tout filtre particulaire, il est necessaire de sp√©cifier la distribution a priori de l‚Äô√©tat, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?p(x_0)">, la distribution de transition, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?p(v_t%7Cv_%7Bt-1%7D)"> et la vraisemblance, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?p(y_t%7Cv_t)">.</p>
<p>Dans le mod√®le de Heston sp√©cifi√© en (1), on consid√®re que : <img src="https://latex.codecogs.com/png.latex?%0Ap(v_t%7Cv_%7Bt-1%7D)=2c%5Cchi%5E2(2cx_k;%202q%20+%202;%202ce%5E%7B-%5Ckappa%20%5CDelta%7D%20x_%7Bk%E2%88%921%7D),%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?p(v_1)%20=%20%5CGamma(v_1;%20a,b)"> o√π <img src="https://latex.codecogs.com/png.latex?a%20=%20%5Cfrac%7B2%20%5Ckappa%20%5Ctheta%7D%7B%5Csigma%5E2%7D"> et <img src="https://latex.codecogs.com/png.latex?b%20=%20%5Cfrac%7B2%20%5Ckappa%7D%7B%5Csigma%5E2%7D">,</p>
<p>et <img src="https://latex.codecogs.com/png.latex?p(y_t)%7Cv_t)%20=%20N(0,h)">.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bcases%7D%0AdS_t%20=%20S_t%20%5Cleft(%20rds%20+%20%5Csqrt%7Bv_t%7D%20dW_t%5E1%20%5Cright)%20%5C%5C%0Adv_t%20=%20%5Ckappa%20(%5Ctheta%20-%20v_t)%20ds%20+%20%5Csigma%20%5Csqrt%7Bv_t%7D%20dW_t%5E2%20%5C%5C%0AdW_t%5E1%20dW_t%5E2%20=%20%5Crho%20ds%0A%5Cend%7Bcases%7D%0A%5Cquad%20(1)%0A"></p>
<p>Pour tester la pertinence de l‚ÄôAPF, nous allons utiliser les param√®tres suivants <img src="https://latex.codecogs.com/png.latex?%5CPhi%20=%20(%5Ctheta%20=%200.03,%20%5Ckappa%20=%204,%20%5Csigma%20=%200.4,%20%5Ckappa%20=%20-0.87,%20%5Crho%20=%200.5)">. Pour passer en temps discret et assurer la positivit√© de la volatilit√©, nous utilisosn le schema d‚Äôeuler (√† <img src="https://latex.codecogs.com/png.latex?%7Cv_t%7C">) suivant :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bcases%7D%0Ay_t%20=%20C(t,%20%5Ctheta,%20v_t,%20S_t,%20K,%20%5Ctau)%20+%20%5Cvarepsilon_t,%20%5C%5C%5B10pt%5D%0Av_t%20=%20%5Cleft%7C%20v_%7Bt-1%7D%20+%20%5Ckappa%20%5CDelta%20(%5Ctheta%20-%20v_%7Bt-1%7D)%20+%20%5Csigma%20%5Csqrt%7Bv_%7Bt-1%7D%5CDelta%7D%20(%5Crho%20w_t%5E1%20+%20%5Csqrt%7B1-%5Crho%5E2%7Dw_t%5E2)%20%5Cright%7C,%20%5C%5C%5B10pt%5D%0AS_t%20=%20S_%7Bt-1%7D%20%5Cleft(1%20+%20%5Cmu%20%5CDelta%20+%20%5Csqrt%7B%5CDelta%20v_t%7D%20w_t%5E1%20%5Cright),%20%5C%5C%5B10pt%5D%0A%5Cend%7Bcases%7D%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon_t%20%5Csim%20N(0,h=0.01)">, et <img src="https://latex.codecogs.com/png.latex?w_t%5E1,%20w_t%5E2"> sont des variables al√©atoires gaussiennes et ind√©pendantes.</p>
<div class="{callout-tip}">
<p>Nous avons utilis√© un sch√©ma d‚Äôeuler modifi√© pour garantir la positivit√© de la volatilit√©. En effet, la volatilit√© doit √™tre positive dans le mod√®le de Heston, et le sch√©ma d‚Äôeuler standard peut produire des valeurs n√©gatives. En prenant la valeur absolue de la volatilit√© √† chaque √©tape, nous nous assurons que les valeurs restent positives. Il aurait √©t√© √©galement possible d‚Äôutiliser le sch√©ma d‚Äôeuler √† <img src="https://latex.codecogs.com/png.latex?ln(v_t)"> (via le lemme de ito) pour garantir la positivit√© de la volatilit√©.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span>())</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">################ Simulation de la trajectoire de St et vt ################ </span></span>
<span id="cb1-4">Heston_sim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(N, kappa, theta, sigma, rho, v0, mu, tau, S0){</span>
<span id="cb1-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># N: Number of time steps</span></span>
<span id="cb1-6">  dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tau <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> N  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time step</span></span>
<span id="cb1-7"></span>
<span id="cb1-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store stock prices and volatilities</span></span>
<span id="cb1-9">  S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-10">  v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-11">  </span>
<span id="cb1-12">  S[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S0</span>
<span id="cb1-13">  v[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> v0</span>
<span id="cb1-14">  </span>
<span id="cb1-15">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>N){</span>
<span id="cb1-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate correlated Brownian motions</span></span>
<span id="cb1-17">    W1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-18">    W2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-19">    </span>
<span id="cb1-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Euler discretization of variance process (ensure non-negativity)</span></span>
<span id="cb1-21">    v[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(v[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v[t]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(v[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W2)</span>
<span id="cb1-22">    </span>
<span id="cb1-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Euler discretization of the stock price process </span></span>
<span id="cb1-24">    S[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>dt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(v[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W1)</span>
<span id="cb1-25">  }</span>
<span id="cb1-26">  </span>
<span id="cb1-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v_t =</span> v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S_t=</span>S))</span>
<span id="cb1-28">}</span></code></pre></div>
</div>
<p>Avec les √©tapes 1 et 2, nous obtenons les trajectoires de volatilit√© instantan√©e et de prix d‚Äôaction suivantes :</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb2-2">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">300</span></span>
<span id="cb2-3">theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span></span>
<span id="cb2-4">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb2-5">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb2-6">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb2-7">v0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span></span>
<span id="cb2-8">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb2-9">tau<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb2-10">S0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-11"></span>
<span id="cb2-12">res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Heston_sim</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N=</span>N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa=</span>kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta=</span>theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma=</span>sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho=</span>rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0=</span>v0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span>mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau=</span>tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0=</span>S0)</span>
<span id="cb2-13"></span>
<span id="cb2-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb2-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>v_t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Processus de volatilit√© simul√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time step"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>) </span>
<span id="cb2-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>S_t, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Processus de prix du sous-jacent simul√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time step"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix"</span>) </span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/heston-sim-plots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<section id="proc√©dure-de-simulation" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="proc√©dure-de-simulation"><span class="header-section-number">1.1.1</span> Proc√©dure de simulation</h3>
<p>La proc√©dure de simulation est la suivante :</p>
<ol type="1">
<li><p>Tout d‚Äôabord, une trajectoire de 300 pas de temps de la variance instantan√©e sera simul√©e pour un pas de 1 jour, en commen√ßant par <img src="https://latex.codecogs.com/png.latex?v_0"> = 0,03.</p></li>
<li><p>Conditionnellement √† cette trajectoire, une trajectoire correspondante du prix de l‚Äôaction sera alors g√©n√©r√©e.</p></li>
<li><p>Nous calculons, √† l‚Äôaide du mod√®le de Heston, les prix d‚Äôoptions bruit√©s pour trois types d‚Äôoptions diff√©rents : une option √† la monnaie (ATM), une option dans la monnaie (ITM) et une option mixte (50 % ITM / 50 % OTM).</p></li>
</ol>
<p>Nous avons choisi trois types d‚Äôoptions afin d‚Äôobserver comment le filtre APF se comporte dans diff√©rentes conditions de march√© :</p>
<ul>
<li>Option √† la monnaie (ATM) :
<ul>
<li>Prix d‚Äôexercice : <code>K = 1 √ó S_t</code></li>
<li>Temps avant l‚Äô√©ch√©ance : <code>œÑ = 0.5</code> Les options ATM sont souvent utilis√©es pour l‚Äôestimation de la volatilit√© implicite, car elles sont les plus liquides et pr√©sentent un delta proche de 0.5, ce qui les rend sensibles aux variations du sous-jacent.</li>
</ul></li>
<li>Option dans la monnaie (ITM) :
<ul>
<li>Prix d‚Äôexercice : <code>K = 0.95 √ó S_t</code></li>
<li>Temps avant l‚Äô√©ch√©ance : <code>œÑ = 0.5</code> Les options ITM ont une valeur intrins√®que √©lev√©e et une volatilit√© implicite plus stable. Elles sont moins sensibles aux fluctuations imm√©diates du march√© mais permettent d‚Äô√©valuer l‚Äôimpact du filtre APF dans des conditions de faible variance du prix d‚Äôoption.</li>
</ul></li>
<li>Option mixte (50 % ITM / 50 % OTM) :
<ul>
<li>Prix d‚Äôexercice : <code>K = 117</code></li>
<li>Temps avant l‚Äô√©ch√©ance : <code>œÑ = 0.5</code> Cette approche permet de tester le filtre APF dans un sc√©nario r√©aliste de portefeuille d‚Äôoptions o√π des positions ITM et OTM sont combin√©es. L‚Äôobjectif est d‚Äôanalyser si le filtre reste stable lorsque l‚Äôon m√©lange des options avec des sensibilit√©s diff√©rentes aux mouvements du sous-jacent et aux variations de volatilit√©.</li>
</ul></li>
</ul>
<p><strong>Pourquoi tester diff√©rentes configurations d‚Äôoptions ?</strong></p>
<p>L‚Äôobjectif de cette analyse est de v√©rifier comment le filtre APF se comporte en pr√©sence de conditions de march√© vari√©es :</p>
<ul>
<li>Options ATM : impact fort de la volatilit√©, mais moins sujettes au risque de gamma.</li>
<li>Options ITM : faible sensibilit√© √† la volatilit√© implicite, mais risque de couverture plus limit√©.</li>
<li>Options mixtes : √©valuation de la robustesse du filtre lorsque plusieurs types d‚Äôoptions coexistent dans un m√™me portefeuille.</li>
</ul>
<p>Ces tests permettent de comparer la pr√©cision du filtre en fonction de la position de l‚Äôoption par rapport au prix du sous-jacent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">################ Simulation du prix des options ATM ################ </span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/Heston_Call_Function.R"</span>)</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb3-4"></span>
<span id="cb3-5">v_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>v_t </span>
<span id="cb3-6">S_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>S_t</span>
<span id="cb3-7">h <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix d'option K=1*S, tau = 0.5 =&gt; A la monnaie</span></span>
<span id="cb3-10">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-11">tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb3-12">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-13">ATM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-14"></span>
<span id="cb3-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)){</span>
<span id="cb3-16">ATM[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> v_t[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S_t[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> K <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S_t[i])</span>
<span id="cb3-17">}</span>
<span id="cb3-18"></span>
<span id="cb3-19">res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ATM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ATM <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(h))</span>
<span id="cb3-20"></span>
<span id="cb3-21"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">################ Simulation du prix des options ITM ################ </span></span>
<span id="cb3-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix d'option K=0.95*S, tau = 0.5 =&gt; Hors de la monnaie</span></span>
<span id="cb3-23">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-24">tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb3-25">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span></span>
<span id="cb3-26"></span>
<span id="cb3-27">ITM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-28"></span>
<span id="cb3-29"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)){</span>
<span id="cb3-30">ITM[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> v_t[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S_t[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> K <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S_t[i])</span>
<span id="cb3-31">}</span>
<span id="cb3-32">res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ITM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ITM <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(h))</span>
<span id="cb3-33"></span>
<span id="cb3-34"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">################ Simulation du prix des options mixte ################ </span></span>
<span id="cb3-35"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(S_t)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  99.49  104.36  117.23  119.24  128.88  156.89 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix d'option K=117, tau = 0.5  =&gt; moiti√© ITM et moiti√© OTM</span></span>
<span id="cb5-2">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb5-3">tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb5-4">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">117</span></span>
<span id="cb5-5"></span>
<span id="cb5-6">MIXTE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)){</span>
<span id="cb5-9">MIXTE[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> v_t[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S_t[i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> K)</span>
<span id="cb5-10">}</span>
<span id="cb5-11">res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MIXTE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MIXTE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(h))</span></code></pre></div>
</div>
<section id="prix-doptions-simul√©s" class="level4" data-number="1.1.1.1">
<h4 data-number="1.1.1.1" class="anchored" data-anchor-id="prix-doptions-simul√©s"><span class="header-section-number">1.1.1.1</span> Prix d‚Äôoptions simul√©s</h4>
<p>En simulant le prix de ces options, nous constatons sans surprise que les options mixte ont un prix plus √©lev√© plus on se rapproche de la maturit√©. Cependant, les options ITM et ATM ont des prix plus stables, avec une l√©g√®re augmentation pour les options ITM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ITM)  </span>
<span id="cb6-2">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tau <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> N</span>
<span id="cb6-3">time_axis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out =</span> N)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Axe des temps, de 0 √† tau</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(time_axis,res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ITM, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Evolution du prix des options "</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>)</span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(time_axis,res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ATM, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(time_axis,res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MIXTE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'l'</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgreen"</span>)</span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend</span></span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topleft"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ITM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mixte"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'darkgreen'</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Types d'option"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="filtres-utilis√©s" class="level4" data-number="1.1.1.2">
<h4 data-number="1.1.1.2" class="anchored" data-anchor-id="filtres-utilis√©s"><span class="header-section-number">1.1.1.2</span> Filtres utilis√©s</h4>
<p>L‚Äôobjectif est de comparer les r√©sultats de l‚ÄôAPF sur du filtre particulaire bootstrap en termes d‚Äôerreurs d‚Äôajustement, mesur√©es par les erreurs quadratiques moyennes (RMSE) de l‚Äôajustement de la variance et de l‚Äôajustement des prix des options, dans diff√©rents cas de donn√©es.</p>
<p><strong>Filtre bootstrap :</strong></p>
<p>Le filtre boostrap fonctionne de la mani√®re suivante :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/data/bootstrap_filter.png" class="img-fluid figure-img"></p>
<figcaption>Bootstrap filter</figcaption>
</figure>
</div>
<p>Dans le cadre du mod√®le de heston, nous avons impl√©ment√© le filtre bootstrap de la mani√®re suivante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">BootstrapParticleFilter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(y, S, v, K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>) {</span>
<span id="cb7-2">  </span>
<span id="cb7-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres suppl√©mentaires</span></span>
<span id="cb7-4">  sigma_epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(h)</span>
<span id="cb7-5"></span>
<span id="cb7-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres de la loi stationnaire de v</span></span>
<span id="cb7-7">  alpha1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> theta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb7-8">  alpha2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> kappa)</span>
<span id="cb7-9"></span>
<span id="cb7-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation</span></span>
<span id="cb7-11">  n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(y)</span>
<span id="cb7-12">  v_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)</span>
<span id="cb7-13">  v_particle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb7-14">  w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb7-15">  w_normalized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb7-16"></span>
<span id="cb7-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtre particulaire bootstrap</span></span>
<span id="cb7-18">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb7-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb7-20">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des particules √† t = 0</span></span>
<span id="cb7-21">      v_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> alpha1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>alpha2)</span>
<span id="cb7-22">      </span>
<span id="cb7-23">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids initiaux bas√©s sur la densit√© de la loi stationnaire</span></span>
<span id="cb7-24">      w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dgamma</span>(v_particle[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> alpha1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>alpha2)</span>
<span id="cb7-25">      </span>
<span id="cb7-26">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalisation des poids</span></span>
<span id="cb7-27">      w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb7-28">      </span>
<span id="cb7-29">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation initiale</span></span>
<span id="cb7-30">      v_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v_particle[t, ])</span>
<span id="cb7-31">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb7-32">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># √âtape de pr√©diction (propagation des particules)</span></span>
<span id="cb7-33">      v_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, </span>
<span id="cb7-34">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt, </span>
<span id="cb7-35">                                    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt)))</span>
<span id="cb7-36">      </span>
<span id="cb7-37">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Calcul du prix du Call pour chaque particule</span></span>
<span id="cb7-38">      C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(M)</span>
<span id="cb7-39">      </span>
<span id="cb7-40">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Si K est un unique scalaire (strike constant), on le conserve</span></span>
<span id="cb7-41">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Si K est un vecteur, on prend K[t] comme strike au temps t</span></span>
<span id="cb7-42">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(K) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb7-43">          Kt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> K  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike constant</span></span>
<span id="cb7-44">      } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb7-45">          Kt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> K[t]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike sp√©cifique au temps t</span></span>
<span id="cb7-46">      }</span>
<span id="cb7-47">      </span>
<span id="cb7-48">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul pour chaque particule avec le bon strike</span></span>
<span id="cb7-49">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M) {</span>
<span id="cb7-50">          C[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, </span>
<span id="cb7-51">                                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> v_particle[t, i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> Kt)</span>
<span id="cb7-52">      }</span>
<span id="cb7-53"></span>
<span id="cb7-54">      </span>
<span id="cb7-55">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mise √† jour des poids (vraisemblance observation-conditionnelle)</span></span>
<span id="cb7-56">      w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(y[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> C, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_epsilon))</span>
<span id="cb7-57">      </span>
<span id="cb7-58">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalisation des poids</span></span>
<span id="cb7-59">      w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb7-60">      </span>
<span id="cb7-61">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©√©chantillonnage</span></span>
<span id="cb7-62">      index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> w_normalized[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb7-63">      v_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> v_particle[t, index]</span>
<span id="cb7-64">      </span>
<span id="cb7-65">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids uniformes apr√®s resampling</span></span>
<span id="cb7-66">      w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> M, M)</span>
<span id="cb7-67"></span>
<span id="cb7-68">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation de la volatilit√© instantan√©e</span></span>
<span id="cb7-69">      v_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v_particle[t, ])</span>
<span id="cb7-70">    }</span>
<span id="cb7-71">  }</span>
<span id="cb7-72"></span>
<span id="cb7-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(v_hat)</span>
<span id="cb7-74">}</span></code></pre></div>
</div>
<p><strong>Filtre APF :</strong></p>
<p>Le filtre particulaire auxilaire fonctionne de la mani√®re suivante :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/data/APF.png" class="img-fluid figure-img"></p>
<figcaption>APF</figcaption>
</figure>
</div>
<p>Dans le cadre du mod√®le de heston, nous avons impl√©ment√© le filtre APF de la mani√®re suivante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">APF_Heston <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(y, S, v,K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>, </span>
<span id="cb8-2">                       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.87</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>) {</span>
<span id="cb8-3">  </span>
<span id="cb8-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres de la loi stationnaire de v</span></span>
<span id="cb8-5">  sigma_epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(h)</span>
<span id="cb8-6">  alpha1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> theta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-7">  alpha2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> kappa)</span>
<span id="cb8-8"></span>
<span id="cb8-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des param√®tres</span></span>
<span id="cb8-10">  n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(y)</span>
<span id="cb8-11">  </span>
<span id="cb8-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des vecteurs/matrices</span></span>
<span id="cb8-13">  v_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)                   </span>
<span id="cb8-14">  v_particle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb8-15">  mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)        </span>
<span id="cb8-16">  py_mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M) </span>
<span id="cb8-17">  w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb8-18">  w_normalized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb8-19"></span>
<span id="cb8-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtre particulaire APF</span></span>
<span id="cb8-21">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb8-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb8-23">      </span>
<span id="cb8-24">      v_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> alpha1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>alpha2)</span>
<span id="cb8-25">      w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> M, M)</span>
<span id="cb8-26">      w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb8-27">      v_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v_particle[t, ])</span>
<span id="cb8-28">      </span>
<span id="cb8-29">    } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb8-30">      </span>
<span id="cb8-31">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Si K est un unique scalaire (strike constant), on le conserve</span></span>
<span id="cb8-32">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Si K est un vecteur, on prend K[t] comme strike au temps t</span></span>
<span id="cb8-33">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(K) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb8-34">          Kt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> K  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike constant</span></span>
<span id="cb8-35">      } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb8-36">          Kt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> K[t]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Strike sp√©cifique au temps t</span></span>
<span id="cb8-37">      }</span>
<span id="cb8-38">      </span>
<span id="cb8-39">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 - Pr√©-s√©lection</span></span>
<span id="cb8-40">      mu[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt)</span>
<span id="cb8-41">      </span>
<span id="cb8-42">      mean_pymu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(M)</span>
<span id="cb8-43">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M) {</span>
<span id="cb8-44">        mean_pymu[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, </span>
<span id="cb8-45">                                             <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> mu[t, i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> Kt)</span>
<span id="cb8-46">      }</span>
<span id="cb8-47">      py_mu[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(y[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mean_pymu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma_epsilon)</span>
<span id="cb8-48"></span>
<span id="cb8-49">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids pour la pr√©-s√©lection</span></span>
<span id="cb8-50">      w[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> py_mu[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> w_normalized[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ]</span>
<span id="cb8-51">      </span>
<span id="cb8-52">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2 - Resampling (√©chantillonnage)</span></span>
<span id="cb8-53">      index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> w[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ])</span>
<span id="cb8-54"></span>
<span id="cb8-55">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mise √† jour des particules</span></span>
<span id="cb8-56">      v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, index]</span>
<span id="cb8-57">      </span>
<span id="cb8-58">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3 - Propagation (√©volution des particules)</span></span>
<span id="cb8-59">      v_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, </span>
<span id="cb8-60">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt, </span>
<span id="cb8-61">                                   <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt)))</span>
<span id="cb8-62"></span>
<span id="cb8-63">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mise √† jour des poids</span></span>
<span id="cb8-64">      C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(M)</span>
<span id="cb8-65">      <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M) {</span>
<span id="cb8-66">        C[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, </span>
<span id="cb8-67">                                     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> v_particle[t, i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> Kt)</span>
<span id="cb8-68">      }</span>
<span id="cb8-69">      likelihood <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(y[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> C, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma_epsilon)</span>
<span id="cb8-70">      w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> likelihood <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (py_mu[t, index] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-12</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Protection pour √©viter la division par z√©ro</span></span>
<span id="cb8-71">      </span>
<span id="cb8-72">      w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb8-73">      v_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v_particle[t, ])</span>
<span id="cb8-74">    }</span>
<span id="cb8-75">  }</span>
<span id="cb8-76"></span>
<span id="cb8-77">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retourner les r√©sultats</span></span>
<span id="cb8-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(v_hat)</span>
<span id="cb8-79">}</span></code></pre></div>
</div>
<p><strong>Diff√©rence entre le filtre bootstrap et le filtre APF :</strong></p>
<p>Le filtre bootstrap et le filtre APF sont deux m√©thodes de filtrage particulaire qui permettent d‚Äôestimer l‚Äô√©tat cach√© d‚Äôun syst√®me dynamique non lin√©aire. La principale diff√©rence entre ces deux m√©thodes r√©side dans la mani√®re dont elles mettent √† jour les poids des particules, et ainsi comme la distribution d‚Äôimportance q est construite. Par d√©finition, les poids sont d√©finis par : <img src="https://latex.codecogs.com/png.latex?%0Aw(x_t)%20=%20w(x_%7Bt-1%7D)%20%5Cfrac%7Bp(y_t%7Cx_t)p(x_t%7Cx_%7Bt-1%7D)%7D%7Bq(x_t%7Cx_%7Bt-1%7D,y_t)%7D,%0A"> o√π <img src="https://latex.codecogs.com/png.latex?p(y_t%7Cx_t)"> est la vraisemblance, <img src="https://latex.codecogs.com/png.latex?p(x_t%7Cx_%7Bt-1%7D)"> est la distribution de transition, et <img src="https://latex.codecogs.com/png.latex?q(x_t%7Cx_%7Bt-1%7D,y_t)"> est la distribution d‚Äôimportance.</p>
<p>Dans le cadre du filtre bootstrap, la distribution d‚Äôimportance est d√©finie comme suit : <img src="https://latex.codecogs.com/png.latex?%0Aq(x_t%7Cx_%7Bt-1%7D,y_t)%20=%20p(x_t%7Cx_%7Bt-1%7D).%0A"> De ce fait, <img src="https://latex.codecogs.com/png.latex?w(x_t)%20=%20w(x_%7Bt-1%7D)%20p(y_t%7Cx_t)">.Cela signifie que les poids sont mis √† jour en fonction de la distribution de transition et de la vraisemblance.</p>
<p>Dans le cadre du filtre APF, la distribution d‚Äôimportance se rapproche de la distribution optimale, vu dans la litt√©rature comme √©tant <img src="https://latex.codecogs.com/png.latex?q(x_t%7Cx_%7Bt-1%7D,y_t)%20=%20p(x_t%7Cx_%7Bt-1%7D,y_t)">. De ce fait, les poids sont mis √† jour en fonction de la vraisemblance conditionnelle, ce qui permet d‚Äôam√©liorer la pr√©cision de l‚Äôestimation de l‚Äô√©tat cach√©, et donc de l‚Äôestimation de la volatilit√© dans notre cas.</p>
</section>
</section>
</section>
</section>
<section id="r√©sultats" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> R√©sultats</h1>
<section id="option-√†-la-monnaie-atm" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="option-√†-la-monnaie-atm"><span class="header-section-number">2.1</span> Option √† la monnaie (ATM)</h2>
<section id="filtre-bootstrap" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="filtre-bootstrap"><span class="header-section-number">2.1.1</span> Filtre bootstrap</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">##################### D√©finition des param√®tres #####################</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des param√®tres phi</span></span>
<span id="cb9-3">theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span></span>
<span id="cb9-4">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb9-5">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb9-6">lambda <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.87</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prime de risque</span></span>
<span id="cb9-7">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres de Heston </span></span>
<span id="cb9-10">h <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb9-11">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb9-12"></span>
<span id="cb9-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prix de call (y), du sous-jacent (S), et volatilit√© instantan√©e (v)</span></span>
<span id="cb9-14">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ATM</span>
<span id="cb9-15">S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>S_t</span>
<span id="cb9-16">v<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>v_t</span>
<span id="cb9-17"></span>
<span id="cb9-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des param√®tres</span></span>
<span id="cb9-19">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(y)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre d'observations</span></span>
<span id="cb9-20">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre de particules</span></span>
<span id="cb9-21">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres de l'option </span></span>
<span id="cb10-4">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S</span>
<span id="cb10-5">tau<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Exemple d'appel avec tes donn√©es "res"</span></span>
<span id="cb10-8">et_boot_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.time</span>({</span>
<span id="cb10-9">boot_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BootstrapParticleFilter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span>K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> h)</span>
<span id="cb10-10">})</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimation de la volatilit√© avec un filtre bootstrap"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(boot_atm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(et_boot_atm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>utilisateur     syst√®me      √©coul√© 
     12.028       0.739      12.971 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">rmse_boot_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((boot_atm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb14-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE :"</span>, rmse_boot_atm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE : 0.001402773</code></pre>
</div>
</div>
</section>
<section id="filtre-apf" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="filtre-apf"><span class="header-section-number">2.1.2</span> Filtre APF</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb16-2">et_apf_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.time</span>({</span>
<span id="cb16-3">apf_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">APF_Heston</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span>K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> h)</span>
<span id="cb16-4">})</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimation de la volatilit√© avec un filtre APF"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>)</span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(apf_atm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb17-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(et_apf_atm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>utilisateur     syst√®me      √©coul√© 
     23.965       1.410      25.782 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">rmse_apf_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((apf_atm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb20-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE :"</span>, rmse_apf_atm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE : 0.001889304</code></pre>
</div>
</div>
</section>
</section>
<section id="option-√†-la-monnaie-itm" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="option-√†-la-monnaie-itm"><span class="header-section-number">2.2</span> Option √† la monnaie (ITM)</h2>
<section id="filtre-bootstrap-1" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="filtre-bootstrap-1"><span class="header-section-number">2.2.1</span> Filtre bootstrap</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb22-2">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>ITM</span>
<span id="cb22-3">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S</span>
<span id="cb22-4"></span>
<span id="cb22-5">et_boot_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.time</span>({</span>
<span id="cb22-6">boot_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BootstrapParticleFilter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span>K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> h)</span>
<span id="cb22-7">})</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimation de la volatilit√© avec un filtre bootstrap"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>)</span>
<span id="cb23-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(boot_itm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb23-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(et_boot_itm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>utilisateur     syst√®me      √©coul√© 
     11.420       0.646      12.123 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">rmse_boot_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((boot_itm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb26-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE :"</span>, rmse_boot_itm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE : 0.00152023</code></pre>
</div>
</div>
</section>
<section id="apf" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="apf"><span class="header-section-number">2.2.2</span> APF</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">et_apf_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.time</span>({</span>
<span id="cb28-2">apf_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">APF_Heston</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span>K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> h)</span>
<span id="cb28-3">})</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimation de la volatilit√© avec un filtre APF"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>)</span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(apf_itm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb29-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(et_apf_itm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>utilisateur     syst√®me      √©coul√© 
     22.690       1.271      24.052 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1">rmse_apf_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((apf_itm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE :"</span>, rmse_apf_itm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE : 0.001850903</code></pre>
</div>
</div>
</section>
</section>
<section id="options-mixtes" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="options-mixtes"><span class="header-section-number">2.3</span> Options mixtes</h2>
<section id="filtre-bootstrap-2" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="filtre-bootstrap-2"><span class="header-section-number">2.3.1</span> Filtre bootstrap</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb34-2">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>MIXTE</span>
<span id="cb34-3">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">117</span></span>
<span id="cb34-4"></span>
<span id="cb34-5">et_boot_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.time</span>({</span>
<span id="cb34-6">boot_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BootstrapParticleFilter</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span>K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> h)</span>
<span id="cb34-7">})</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimation de la volatilit√© avec un filtre bootstrap"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>)</span>
<span id="cb35-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(boot_mixte, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb35-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(et_boot_mixte)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>utilisateur     syst√®me      √©coul√© 
     12.057       0.692      12.879 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">rmse_boot_mixte<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((boot_mixte <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb38-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE :"</span>, rmse_boot_mixte)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE : 0.01595637</code></pre>
</div>
</div>
</section>
<section id="apf-1" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="apf-1"><span class="header-section-number">2.3.2</span> APF</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1">et_apf_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">system.time</span>({</span>
<span id="cb40-2">apf_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">APF_Heston</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S=</span>S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v=</span>v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K=</span>K, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">M =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theta =</span> theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">kappa =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma =</span> sigma,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dt =</span> dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h =</span> h)</span>
<span id="cb40-3">})</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimation de la volatilit√© avec un filtre APF"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>)</span>
<span id="cb41-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(apf_mixte, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb41-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(et_apf_mixte)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>utilisateur     syst√®me      √©coul√© 
     23.758       1.300      25.226 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">rmse_apf_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((apf_mixte <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb44-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE :"</span>, rmse_apf_mixte)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE : 0.01475175</code></pre>
</div>
</div>
</section>
</section>
<section id="comparaison-des-performances" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="comparaison-des-performances"><span class="header-section-number">2.4</span> Comparaison des performances</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îÄ‚îÄ Attaching core tidyverse packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 2.0.0 ‚îÄ‚îÄ
‚úî dplyr     1.1.4     ‚úî readr     2.1.5
‚úî forcats   1.0.0     ‚úî stringr   1.5.1
‚úî ggplot2   3.5.1     ‚úî tibble    3.2.1
‚úî lubridate 1.9.4     ‚úî tidyr     1.3.1
‚úî purrr     1.0.2     
‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
‚úñ dplyr::filter() masks stats::filter()
‚úñ dplyr::lag()    masks stats::lag()
‚Ñπ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©ation du data.frame avec les colonnes demand√©es</span></span>
<span id="cb48-2">comp_perf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb48-3">    M√©thode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BOOT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BOOT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BOOT"</span>),</span>
<span id="cb48-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type_Option =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ITM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MIXTE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ITM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MIXTE"</span>),</span>
<span id="cb48-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">RMSE =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rmse_apf_atm, rmse_apf_itm, rmse_apf_mixte, rmse_boot_atm, rmse_boot_itm, rmse_boot_mixte)</span>
<span id="cb48-6">)</span>
<span id="cb48-7"></span>
<span id="cb48-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Conversion : M√©thode comme colonne</span></span>
<span id="cb48-9">comp_perf_wide <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb48-10">    comp_perf,</span>
<span id="cb48-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> M√©thode,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ce qui devient les colonnes</span></span>
<span id="cb48-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> RMSE      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ce qui remplit les cases</span></span>
<span id="cb48-13">)</span>
<span id="cb48-14"></span>
<span id="cb48-15">comp_perf_wide <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb48-16">    comp_perf_wide,</span>
<span id="cb48-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb48-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type_Option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Moyenne"</span>,</span>
<span id="cb48-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">APF =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rmse_apf_atm, rmse_apf_itm, rmse_apf_mixte), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb48-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BOOT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rmse_boot_atm, rmse_boot_itm, rmse_boot_mixte), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb48-21">    )</span>
<span id="cb48-22">)</span>
<span id="cb48-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage du r√©sultat</span></span>
<span id="cb48-24">comp_perf_wide</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 3
  Type_Option     APF    BOOT
  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;
1 ATM         0.00189 0.00140
2 ITM         0.00185 0.00152
3 MIXTE       0.0148  0.0160 
4 Moyenne     0.00616 0.00629</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Comparaison des temps d'ex√©cution</span></span>
<span id="cb50-2">comp_temps <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb50-3">    M√©thode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APF"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BOOT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BOOT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BOOT"</span>),</span>
<span id="cb50-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type_Option =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ITM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MIXTE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ITM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MIXTE"</span>),</span>
<span id="cb50-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Temps =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(et_apf_atm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_apf_itm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_apf_mixte[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_boot_atm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_boot_itm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_boot_mixte[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb50-6">)</span>
<span id="cb50-7"></span>
<span id="cb50-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Conversion : M√©thode comme colonne</span></span>
<span id="cb50-9">comp_temps_wide <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb50-10">    comp_temps,</span>
<span id="cb50-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> M√©thode,   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ce qui devient les colonnes</span></span>
<span id="cb50-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> Temps      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Ce qui remplit les cases</span></span>
<span id="cb50-13">)</span>
<span id="cb50-14"></span>
<span id="cb50-15">comp_temps_wide <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb50-16">    comp_temps_wide,</span>
<span id="cb50-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb50-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type_Option =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Moyenne"</span>,</span>
<span id="cb50-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">APF =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(et_apf_atm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_apf_itm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_apf_mixte[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb50-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BOOT =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(et_boot_atm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_boot_itm[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], et_boot_mixte[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb50-21">    )</span>
<span id="cb50-22">)</span>
<span id="cb50-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage du r√©sultat</span></span>
<span id="cb50-24">comp_temps_wide</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 3
  Type_Option   APF  BOOT
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 ATM          25.8  13.0
2 ITM          24.1  12.1
3 MIXTE        25.2  12.9
4 Moyenne      25.0  12.7</code></pre>
</div>
</div>
<p>En comparant les performances de l‚ÄôAPF √† celles du filtre bootstrap, nous constatons que les deux filtres ont des performances assez similaires en termes d‚Äôerreurs d‚Äôajustement (RMSE) pour les options ATM et ITM. Cependant, l‚ÄôAPF semble √™tre plus efficace pour les options mixtes, avec des erreurs d‚Äôajustement plus faibles que le filtre bootstrap. Cependant, en termes de temps d‚Äôex√©cution, le filtre bootstrap est plus rapide que l‚ÄôAPF pour les trois types d‚Äôoptions. En moyenne, l‚ÄôAPF est plus lent que le filtre bootstrap, mais offre une meilleure pr√©cision tout option confondue.</p>
<p>Pou connaitre la robustesse de ces estimations, nous avons fait du bootstrap pour estimer la distribution des RMSE, et ainsi obtenir des intervalles de confiance pour ces estimations, de m√™me que des p-valeurs. Le code ayant servi √† la simulation est disponible ici.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb52-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb52-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggpubr)</span>
<span id="cb52-4"></span>
<span id="cb52-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Charger les r√©sultats du bootstrap</span></span>
<span id="cb52-6">res_ATM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"results_sim/res_ATM_min.rds"</span>)</span>
<span id="cb52-7">res_ITM <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"results_sim/res_ITM_min.rds"</span>)</span>
<span id="cb52-8">res_MIXTE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"results_sim/res_MIXTE_min.rds"</span>)</span>
<span id="cb52-9"></span>
<span id="cb52-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraire les RMSE</span></span>
<span id="cb52-11">rmse_bootstrap_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res_ATM<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb52-12">rmse_apf_atm_b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res_ATM<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb52-13"></span>
<span id="cb52-14">rmse_bootstrap_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res_ITM<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb52-15">rmse_apf_itm_b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res_ITM<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb52-16"></span>
<span id="cb52-17">rmse_bootstrap_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res_MIXTE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb52-18">rmse_apf_mixte_b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> res_MIXTE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>t[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb52-19"></span>
<span id="cb52-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©er un dataframe avec les valeurs RMSE pour les trois sc√©narios</span></span>
<span id="cb52-21">df_rmse_boxplot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb52-22">  M√©thode <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bootstrap Filter"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"APF-Heston"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_bootstrap_atm), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_apf_atm_b), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_bootstrap_itm), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_apf_itm_b),<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_bootstrap_mixte), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_apf_mixte_b))),</span>
<span id="cb52-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">RMSE =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rmse_bootstrap_atm, rmse_apf_atm_b,</span>
<span id="cb52-24">           rmse_bootstrap_itm, rmse_apf_itm_b,</span>
<span id="cb52-25">           rmse_bootstrap_mixte, rmse_apf_mixte_b),</span>
<span id="cb52-26">  Sc√©nario <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ATM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ITM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ITM"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MIXTE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MIXTE"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">each =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_bootstrap_atm), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_apf_atm_b),</span>
<span id="cb52-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_bootstrap_itm), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_apf_itm_b),</span>
<span id="cb52-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_bootstrap_mixte), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(rmse_apf_mixte_b)))</span>
<span id="cb52-29">)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rep(c("Bootstrap Filter", "APF-Heston"), each =
c(length(rmse_bootstrap_atm), : seul le premier √©l√©ment de l'argument 'each'
est utilis√©</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rep(c("ATM", "ATM", "ITM", "ITM", "MIXTE", "MIXTE"), each =
c(length(rmse_bootstrap_atm), : seul le premier √©l√©ment de l'argument 'each'
est utilis√©</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des p-valeurs</span></span>
<span id="cb55-2"></span>
<span id="cb55-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kruskall wallis</span></span>
<span id="cb55-4">test_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kruskal.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(rmse_bootstrap_atm, rmse_apf_atm_b))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value</span>
<span id="cb55-5">test_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kruskal.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(rmse_bootstrap_itm, rmse_apf_itm_b))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value</span>
<span id="cb55-6">test_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kruskal.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(rmse_bootstrap_mixte, rmse_apf_mixte_b))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value</span>
<span id="cb55-7"></span>
<span id="cb55-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># test_atm &lt;- t.test(rmse_bootstrap_atm, rmse_apf_atm_b)$p.value</span></span>
<span id="cb55-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># test_itm &lt;- t.test(rmse_bootstrap_itm, rmse_apf_itm_b)$p.value</span></span>
<span id="cb55-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># test_mixte &lt;- t.test(rmse_bootstrap_mixte, rmse_apf_mixte_b)$p.value</span></span>
<span id="cb55-11"></span>
<span id="cb55-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cr√©ation du boxplot avec facet_wrap et ajout des p-valeurs en caption</span></span>
<span id="cb55-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(df_rmse_boxplot, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> M√©thode, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> RMSE, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> M√©thode)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_boxplot</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Sc√©nario, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comparaison des RMSE (Bootstrap vs APF) selon les sc√©narios"</span>,</span>
<span id="cb55-17">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M√©thode de Filtrage"</span>,</span>
<span id="cb55-18">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE"</span>,</span>
<span id="cb55-19">       <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-values t-test: ATM ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formatC</span>(test_atm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb55-20">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"| ITM ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formatC</span>(test_itm, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb55-21">                       <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"| MIXTE ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formatC</span>(test_mixte, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb55-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>,</span>
<span id="cb55-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Concat√©ner toutes les RMSE</span></span>
<span id="cb56-2">total_rmse_bootstrap <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rmse_bootstrap_atm, rmse_bootstrap_itm, rmse_bootstrap_mixte)</span>
<span id="cb56-3">total_rmse_apf <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(rmse_apf_atm_b, rmse_apf_itm_b, rmse_apf_mixte_b)</span>
<span id="cb56-4"></span>
<span id="cb56-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Kruskal wallis test</span></span>
<span id="cb56-6">global_pval <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kruskal.test</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(total_rmse_bootstrap, total_rmse_apf))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>p.value</span>
<span id="cb56-7"></span>
<span id="cb56-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># global_pval &lt;- t.test(total_rmse_bootstrap, total_rmse_apf)$p.value</span></span>
<span id="cb56-9"></span>
<span id="cb56-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Boxplot global</span></span>
<span id="cb56-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggboxplot</span>(df_rmse_boxplot, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M√©thode"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M√©thode"</span>,</span>
<span id="cb56-12">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M√©thode de Filtrage"</span>,</span>
<span id="cb56-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Comparaison des RMSE (Bootstrap vs APF) pour les trois sc√©narios"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb56-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p-values: Global ="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formatC</span>(global_pval, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb56-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Approche pvalue</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1">rmse_diff_atm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rmse_bootstrap_atm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rmse_apf_atm_b</span>
<span id="cb57-2">rmse_diff_atm_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rmse_boot_atm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rmse_apf_atm</span>
<span id="cb57-3"></span>
<span id="cb57-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(rmse_diff_atm_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> rmse_diff_atm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.84</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1">rmse_diff_itm <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rmse_bootstrap_itm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rmse_apf_itm_b</span>
<span id="cb59-2">rmse_diff_itm_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rmse_boot_itm <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rmse_apf_itm</span>
<span id="cb59-3"></span>
<span id="cb59-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(rmse_diff_itm_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> rmse_diff_itm)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.38</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1">rmse_diff_mixte <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rmse_bootstrap_mixte <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rmse_apf_mixte_b</span>
<span id="cb61-2">rmse_diff_mixte_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rmse_boot_mixte <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rmse_apf_mixte</span>
<span id="cb61-3"></span>
<span id="cb61-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(rmse_diff_mixte_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> rmse_diff_mixte)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="{callout-tip}">
<p><strong>Conclusion :</strong> L‚ÄôAPF est une m√©thode plus pr√©cise que le filtre bootstrap pour estimer la volatilit√© instantan√©e dans le cadre d‚Äôun mod√®le de Heston o√π le prix est bruit√© <img src="https://latex.codecogs.com/png.latex?h=0.01">, mais elle est √©galement plus lente en termes de temps d‚Äôex√©cution. Le choix entre ces deux m√©thodes d√©pendra donc des besoins sp√©cifiques de l‚Äôanalyse, en fonction de la pr√©cision et de la vitesse d‚Äôex√©cution requises.</p>
<p>Pour tester la robustesse de ces estimations, il aurait fallu faire du bootstrap afin d‚Äôestimer la distribution des RMSE, et ainsi obtenir des intervalles de confiance pour ces estimations.</p>
<p>Il aurait √©t√© interessant de tester les filtres dans d‚Äôautres cas de figures.</p>
</div>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>proc-sto</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/APF_filter.html</guid>
  <pubDate>Tue, 25 Feb 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Corr√©lation de Spearman vs corr√©lation de Pearson</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson.html</link>
  <description><![CDATA[ 




<section id="corr√©lation-de-spearman-vs-corr√©lation-de-pearson" class="level1">
<h1>Corr√©lation de Spearman vs corr√©lation de Pearson</h1>
<p>La corr√©lation de Spearman est une mesure de corr√©lation non param√©trique qui permet de mesurer la relation monotone entre deux variables. Elle est souvent utilis√©e pour mesurer la d√©pendance entre les variables al√©atoires. La corr√©lation de Spearman est bas√©e sur les rangs des observations et est moins sensible aux valeurs extr√™mes que la corr√©lation de Pearson. Elle est donc plus robuste et plus adapt√©e pour mesurer la d√©pendance entre les variables al√©atoires.</p>
<p>La corr√©lation de Pearson, quant √† elle, ne permet de comparer les d√©pendances <strong>lin√©aires</strong> des variables. De plus, elle ne permet de comparer les corr√©lation que lorsque les variables al√©atoires sont normales. En effet, soit (<img src="https://latex.codecogs.com/png.latex?X_1,X_2,X_3">), si <img src="https://latex.codecogs.com/png.latex?%5Crho(X_1,X_2)%20%3E%20%5Crho(X_1,X_3)">, cela ne veut dire que la corr√©lation entre <img src="https://latex.codecogs.com/png.latex?X_1"> et <img src="https://latex.codecogs.com/png.latex?X_2"> est plus forte que celle entre <img src="https://latex.codecogs.com/png.latex?X_1"> et <img src="https://latex.codecogs.com/png.latex?X_3"> que si ces variables sont gaussiennes.</p>
<p>Nous verrons dans la suite de ce document que la corr√©lation de Spearman est plus adapt√©e pour mesurer la d√©pendance entre les variables al√©atoires, car elle est une <strong>mesure de concordance</strong>. De ce fait, elle est d√©finit par une copule. Il n‚Äôen est pas ainsi pour la corr√©lation de Pearson.</p>
<section id="quest-ce-quune-mesure-de-concordance" class="level3">
<h3 class="anchored" data-anchor-id="quest-ce-quune-mesure-de-concordance">Qu‚Äôest ce qu‚Äôune mesure de concordance ?</h3>
<p>Une mesure de concordance est une mesure qui permet de quantifier la relation entre deux variables al√©atoires. Cinq propri√©t√©s sont g√©n√©ralement attribu√©es √† une mesure de concordance :</p>
<ul>
<li><p><strong>Sym√©trie</strong> : la mesure de concordance entre X et Y est la m√™me que celle entre Y et X.</p></li>
<li><p><strong>Normalisation</strong> : la mesure de concordance est comprise entre -1 et 1.</p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?%5Cdelta(X_1,%20X_2)%20=%201%20%5CLeftrightarrow%20(X_1,X_2)%20%5Coverset%7B%5Cmathcal%7BL%7D%7D%7B=%7D%20%20%5Cleft(%20F_1%5E%7B-1%7D(U),F_2%5E%7B-1%7D(U)%20%5Cright)"></p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?%5Cdelta(X_1,%20X_2)%20=%20-1%20%5CLeftrightarrow%20(X_1,X_2)%20%5Coverset%7B%5Cmathcal%7BL%7D%7D%7B=%7D%20%20%5Cleft(%20F_1%5E%7B-1%7D(U),F_2%5E%7B-1%7D(1-U)%20%5Cright)"></p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?%5Cdelta(f(X_1),%20X_2)%20=%20%5Cdelta(X_1,%20X_2)"> si <img src="https://latex.codecogs.com/png.latex?f"> est croissante; <img src="https://latex.codecogs.com/png.latex?%5Cdelta(f(X_1),%20X_2)%20=%20-%5Cdelta(X_1,%20X_2)"> si <img src="https://latex.codecogs.com/png.latex?f"> est d√©croissante.</p></li>
</ul>
<p>En raison des propri√©t√©s 3 et 4, la corr√©lation de pearson n‚Äôest pas une mesure de concordance lorsque les variables al√©atoires ne sont pas gaussiennes. En effet, la corr√©lation de pearson ne v√©rifie pas la propri√©t√© 3. C‚Äôest pourquoi, la corr√©lation de spearman est plus adapt√©e pour mesurer la d√©pendance entre les variables al√©atoires. Une mesure encore plus appropri√©e est la copule. La corr√©lation de spearman, quant √† elle, est une mesure de concordance.</p>
</section>
<section id="exemple" class="level3">
<h3 class="anchored" data-anchor-id="exemple">Exemple :</h3>
<p>Soit un vecteur gaussien X = (<img src="https://latex.codecogs.com/png.latex?X_1,%20X_2,%20X_3">) suivant une loi N(0,<img src="https://latex.codecogs.com/png.latex?%5CSigma">) avec :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5CSigma%20=%20%5Cbegin%7Bpmatrix%7D%0A1%20&amp;%200.4%20&amp;%200.2%20%5C%5C%0A0.4%20&amp;%201%20&amp;%20-0.8%20%5C%5C%0A0.2%20&amp;%20-0.8%20&amp;%201%0A%5Cend%7Bpmatrix%7D%0A"></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">m <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb1-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2000</span></span>
<span id="cb1-3">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-4">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mvrnorm</span>(n,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mu=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,m),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sigma=</span>sigma)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(X,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spearman"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>On cr√©e ensuite un vecteur Z constitu√© des fonctions de r√©partition des √©l√©ments de X. On constate que la corr√©lation de Spearman entre les √©l√©ments de Z ne change pas. Cel√† s‚Äôexplique par le fait que nous appliquons une fonction croissante √† chaque √©l√©ment de X. Cependant, la distribution de Z est diff√©rente de celle de X. En effet, les composantes de Z suivent une loi uniforme <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BU%7D(0,1)">.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">Z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pnorm</span>(X, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(Z,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spearman"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(Z,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>A partir de Z, nous construisons un vecteur W tel que les composantes de W suivent des lois marginales diff√©rentes, resp <img src="https://latex.codecogs.com/png.latex?%5Cbeta(0,1),%20%5Cgamma(2,1),%20%5Cbeta(2,1)">. La corr√©lation de Spearman entre les √©l√©ments de W ne change pas bien que la distribution des marginales ait chang√©, puisque nous appliquons une fonction croissante √† chaque √©l√©ment de Z.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">w1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qbeta</span>(Z[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-2">w2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qgamma</span>(Z[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-3">w3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qbeta</span>(Z[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-4">W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(w1,w2,w3)</span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb4-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(W,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spearman"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(W,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>On en conclut que la structure de d√©pendance d‚Äôun vecteur de variables al√©atoire peut √™tre isol√©e, caract√©ris√©ee, et mod√©lis√©e ind√©pendamment des lois marginales/distributions univari√©es des composantes du vecteur al√©atoire. Le concept de copule permet de mod√©liser cette structure de d√©pendance.</p>
<p>Si l‚Äôon utilise la correlation de Pearson, on constate que la corr√©lation entre les √©l√©ments de W et Z change. En effet, la corr√©lation de Pearson est une mesure de corr√©lation lin√©aire et ne permet pas de comparer, xdans tous les cas, les d√©pendances entre les variables al√©atoires.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(X,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(Z,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spearman"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pairs.panels</span>(W,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spearman"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>other</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/others/spearman-pearson.html</guid>
  <pubDate>Thu, 06 Feb 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Calibration avec le mod√®le d‚ÄôHeston</title>
  <link>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_heston.html</link>
  <description><![CDATA[ 




<p>Le but de ce TP est de calculer des prix d‚Äôoptions sous le mod√®le d‚ÄôHeston puis de calibrer ce mod√®le par filtrage. On consid√®re le mod√®le suivant :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bcases%7D%0AdS_s%20=%20S_s%20%5Cleft(%20rds%20+%20%5Csqrt%7Bv_s%7D%20dW_s%5E1%20%5Cright)%20%5C%5C%0Adv_s%20=%20%5Ckappa%20(%5Cbeta%20-%20v_s)%20ds%20+%20%5Csigma%20%5Csqrt%7Bv_s%7D%20dW_s%5E2%20%5C%5C%0AdW_s%5E1%20dW_s%5E2%20=%20%5Crho%20ds%0A%5Cend%7Bcases%7D%0A%5Cquad%20(1)%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?W_s%5E1"> et <img src="https://latex.codecogs.com/png.latex?W_s%5E2"> sont deux mouvements browniens et <img src="https://latex.codecogs.com/png.latex?r"> est le taux sans risque. Pour ce mod√®le, les rendements sont mod√©lis√©s par un mouvement brownien g√©om√©trique avec une variance stochastique.</p>
<p>La volatilit√© non observ√©e <img src="https://latex.codecogs.com/png.latex?v_t"> est d√©termin√©e par un processus stochastique de retour √† la moyenne (1) introduit en 1985 par Cox, Ingersoll et Ross pour la mod√©lisation des taux d‚Äôint√©r√™t √† court terme.</p>
<p>Le param√®tre <img src="https://latex.codecogs.com/png.latex?%5Ckappa"> est le param√®tre de retour √† la moyenne positive, <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> est le param√®tre positif √† long terme et <img src="https://latex.codecogs.com/png.latex?%5Ceta"> la volatilit√© positive du param√®tre de variance. De plus, Heston a introduit une corr√©lation entre les deux mouvements browniens <img src="https://latex.codecogs.com/png.latex?W_s%5E1"> et <img src="https://latex.codecogs.com/png.latex?W_s%5E2">, repr√©sent√©e par le param√®tre <img src="https://latex.codecogs.com/png.latex?%5Crho"> appartenant √† <img src="https://latex.codecogs.com/png.latex?%5B-1,1%5D">.</p>
<section id="pricing-dun-call" class="level1">
<h1>Pricing d‚Äôun call</h1>
<section id="avec-la-forme-close" class="level2">
<h2 class="anchored" data-anchor-id="avec-la-forme-close">Avec la forme close</h2>
<p>Soit un Call de strike K et √† √©ch√©ance <img src="https://latex.codecogs.com/png.latex?%5Ctau"> sous le mod√®le (1) avec les param√®tres suivants : <img src="https://latex.codecogs.com/png.latex?%5Ckappa"> = 4,<img src="https://latex.codecogs.com/png.latex?%5Cbeta"> = 0.03,<img src="https://latex.codecogs.com/png.latex?%5Csigma"> = 0.4,r =0.05,<img src="https://latex.codecogs.com/png.latex?%5Crho">=‚àí0.5,<img src="https://latex.codecogs.com/png.latex?%5Ctau"> = 1, <img src="https://latex.codecogs.com/png.latex?S_0"> = K=100,<img src="https://latex.codecogs.com/png.latex?v_0"> = <img src="https://latex.codecogs.com/png.latex?%5Cbeta">.</p>
<p>Pour calculer le prix d‚Äôun Call, on peut utiliser la formule close de Heston (Heston 1993) :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC(S_0,%20K,%20%5Ctau)%20=%20S_0%20P_1%20-%20K%20e%5E%7B-r%20%5Ctau%7D%20P_2%0A"></p>
<p>avec :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AP_j(x,%20%5Cnu,%20T,%20%5Cln(K))%20=%20%5Cfrac%7B1%7D%7B2%7D%20+%20%5Cfrac%7B1%7D%7B%5Cpi%7D%20%5Cint_0%5E%5Cinfty%20%5CRe%20%5Cleft(%20%5Cfrac%7Be%5E%7B-i%20%5Cln(K)%20u%7D%20f_j(x,%5Cnu,t,u)%7D%7Bi%20u%7D%20%5Cright)%20du%0A"></p>
<p>o√π :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ax%20=%20%5Cln(S_t),%20%5Cquad%20f(x,%5Cnu,t,u)%20=%20%5Cexp(C(t,u)%20+%20D(t,u)%20%5Cnu%20+%20i%20%5Cphi%20x)%0A"></p>
<p>et :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC(T-t%20=%20%5Ctau,%20%5Cphi)%20=%20r%20i%20%5Cphi%20t%20+%20%5Cfrac%7Ba%7D%7B%5Csigma%5E2%7D%20%5Cleft(%20(bj%20-%20%5Crho%20%5Csigma%20%5Cphi%20i%20+%20d)%5Ctau%20-%202%20%5Cln%20%5Cleft(%20%5Cfrac%7B1%20-%20g%20e%5E%7Bd%20%5Ctau%7D%7D%7B1%20-%20g%7D%20%5Cright)%20%5Cright)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0AD(T-t%20=%20%5Ctau,%20%5Cphi)%20=%20%5Cleft(%20%5Cfrac%7Bbj%20-%20%5Crho%20%5Csigma%20%5Cphi%20i%20+%20d%7D%7B%5Csigma%5E2%7D%20%5Cright)%20%5Cleft(%20%5Cfrac%7B1%20-%20e%5E%7Bd%20%5Ctau%7D%7D%7B1%20-%20g%20e%5E%7Bd%20%5Ctau%7D%7D%20%5Cright)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ag%20=%20%5Cfrac%7Bbj%20-%20%5Crho%20%5Csigma%20%5Cphi%20i%20+%20d%7D%7Bbj%20-%20%5Crho%20%5Csigma%20%5Cphi%20i%20-%20d%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ad%20=%20%5Csqrt%7B(%5Crho%20%5Csigma%20%5Cphi%20i%20-%20bj)%5E2%20-%20%5Csigma%5E2%20(2%20u_j%20%5Cphi%20i%20-%20%5Cphi%5E2)%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Au_1%20=%201/2,%20%5Cquad%20u_2%20=%20-1/2,%20a%20=%20%5Clambda,%20b%20=%20%5Ckappa%20%5Cbeta,%20%5Cquad%20t_1%20=%20%5Ckappa%20-%20%5Crho%20%5Csigma,%20%5Cquad%20t_2%20=%20%5Ckappa%0A"></p>
<p>Pour ce faire, nous allons utiliser la fonction <code>Heston_Call_Function.R</code> qui permet de calculer le prix d‚Äôun Call sous le mod√®le d‚ÄôHeston avec la formule close.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres</span></span>
<span id="cb1-2">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb1-3">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span></span>
<span id="cb1-4">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb1-5">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb1-6">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb1-7">tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-8">S0<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-9">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-10">v0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> beta</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import Heston_Call_Function.R</span></span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/Heston_Call_Function.R"</span>)</span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix du Call</span></span>
<span id="cb1-16">Call_Heston <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> v0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> K)</span>
<span id="cb1-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Le prix du Call est de "</span>, Call_Heston)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le prix du Call est de  9.410405</code></pre>
</div>
</div>
</section>
<section id="avec-la-m√©thode-de-monte-carlo-sch√©ma-deuler" class="level2">
<h2 class="anchored" data-anchor-id="avec-la-m√©thode-de-monte-carlo-sch√©ma-deuler">Avec la m√©thode de Monte Carlo (Sch√©ma d‚ÄôEuler)</h2>
<p>Lorsqu‚Äôon a pas acc√®s √† la formule close, on peut utiliser la m√©thode de Monte Carlo pour calculer le prix d‚Äôun Call. Il s‚Äôagit de simuler le mod√®le (1) et de calculer le prix du Call √† partir des simulations. Pour simuler le mod√®le (1), on peut utiliser la discr√©tisation d‚ÄôEuler du mod√®le de Heston (Euler and Milstein Discretization, Fabrice Douglas Rouah) ou utiliser la formule de Ito pour le mod√®le de Heston.</p>
<p>Dans notre cas, nous allons utiliser la discr√©tisation d‚ÄôEuler du mod√®le de Heston pour simuler le mod√®le (1) comme suit : <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bcases%7D%0AS_t%20=%20S_%7Bt-1%7D%20%5Cleft(1%20+%20r%20%5CDelta%20+%20%5Csqrt%7B%5CDelta%20v_t%7D%20W_t%5E1%20%5Cright)%20%5C%5C%5B10pt%5D%0Av_t%20=%20%5Cleft%7C%20v_%7Bt-1%7D%20+%20%5Ckappa%20%5CDelta%20(%5Cbeta%20-%20v_%7Bt-1%7D)%20+%20%5Csigma%20%5Csqrt%7Bv_%7Bt-1%7D%7D%20%5CDelta%20W_t%5E2%20%5Cright%7C%20%5C%5C%5B10pt%5D%0A%5Ctext%7BCov%7D(W_t%5E1,%20W_t%5E2)%20=%20%5Crho%0A%5Cend%7Bcases%7D%0A"></p>
<p>avec <img src="https://latex.codecogs.com/png.latex?W_t%5E1"> et <img src="https://latex.codecogs.com/png.latex?W_t%5E2"> des variables al√©atoires gaussiennes centr√©es r√©duites et corr√©l√©es entre elles telles que <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BCov%7D(W_t%5E1,%20W_t%5E2)%20=%20%5Crho">. De plus, <img src="https://latex.codecogs.com/png.latex?%5CDelta%20=%20%5Cfrac%7B%5Ctau%7D%7Bn%7D"> est le pas de discr√©tisation, avec <img src="https://latex.codecogs.com/png.latex?n"> le nombre de pas de discr√©tisation.</p>
<p>Dans notre cas, on d√©finit <img src="https://latex.codecogs.com/png.latex?n%20=%20100"> et on simule <img src="https://latex.codecogs.com/png.latex?M%20=%201000"> mod√®le (1) pour calculer le prix d‚Äôun Call.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">HestonCallMC <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(M, N, lambda, vbar, eta, rho, v0, r, tau, S0, K){</span>
<span id="cb3-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># M: Number of Monte Carlo simulations</span></span>
<span id="cb3-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># N: Number of time steps</span></span>
<span id="cb3-4">  </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb3-6">  dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tau <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> N  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Time step</span></span>
<span id="cb3-7"></span>
<span id="cb3-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store final stock prices</span></span>
<span id="cb3-9">  ST <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(M)</span>
<span id="cb3-10">  </span>
<span id="cb3-11">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M){</span>
<span id="cb3-12">    S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-13">    v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-14">    </span>
<span id="cb3-15">    S[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S0</span>
<span id="cb3-16">    v[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> v0</span>
<span id="cb3-17">    </span>
<span id="cb3-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>N){</span>
<span id="cb3-19">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate correlated Brownian motions</span></span>
<span id="cb3-20">      W1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-21">      W2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rho <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-22">      </span>
<span id="cb3-23">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Euler discretization of variance process (ensure non-negativity)</span></span>
<span id="cb3-24">      v[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(v[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> lambda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (vbar <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v[t]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> eta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(v[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W1)</span>
<span id="cb3-25">      </span>
<span id="cb3-26">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Euler discretization of the stock price process (log-normal form)</span></span>
<span id="cb3-27">      S[t<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>((r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v[t]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(v[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dt) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> W2)</span>
<span id="cb3-28">    }</span>
<span id="cb3-29">    </span>
<span id="cb3-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store final stock price</span></span>
<span id="cb3-31">    ST[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S[N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-32">  }</span>
<span id="cb3-33"></span>
<span id="cb3-34">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute Call option price using Monte Carlo method</span></span>
<span id="cb3-35">  Call <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(ST <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-36">  </span>
<span id="cb3-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(Call)</span>
<span id="cb3-38">}</span>
<span id="cb3-39"></span>
<span id="cb3-40">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb3-41">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-42">Call_Heston <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallMC</span>(M,N, kappa, beta, sigma, rho, v0, r, tau, S0, K)</span>
<span id="cb3-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Le prix du Call est de "</span>, Call_Heston)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le prix du Call est de  9.797915</code></pre>
</div>
</div>
</section>
</section>
<section id="calibration-du-mod√®le-dheston-avec-les-prix-doptions" class="level1">
<h1>Calibration du mod√®le d‚ÄôHeston avec les prix d‚Äôoptions</h1>
<p>On souhaite d√©sormais calibrer la volatilit√© sous le mod√®le d‚ÄôHeston √† partir de prix d‚Äôoptions. Pour cela, nous consid√©rons la version discr√©tis√©e par un sch√©ma d‚ÄôEuler (modifi√©) de (1). Plus pr√©cis√©ment, soit :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bcases%7D%0Ay_t%20=%20C(t,%20%5Ctheta,%20v_t,%20S_t,%20K,%20%5Ctau)%20+%20%5Csigma_%5Cvarepsilon%20%5Cvarepsilon_t%20%5C%5C%5B10pt%5D%0AS_t%20=%20S_%7Bt-1%7D%20%5Cleft(1%20+%20r%20%5CDelta%20+%20%5Csqrt%7B%5CDelta%20v_t%7D%20Z_t%5E1%20%5Cright)%20%5C%5C%5B10pt%5D%0Av_t%20=%20%5Cleft%7C%20v_%7Bt-1%7D%20+%20%5Clambda%20%5CDelta%20(%5Cbar%7Bv%7D%20-%20v_%7Bt-1%7D)%20+%20%5Ceta%20%5Csqrt%7Bv_%7Bt-1%7D%7D%20%5CDelta%20Z_t%5E2%20%5Cright%7C%20%5C%5C%5B10pt%5D%0A%5Ctext%7BCov%7D(Z_t%5E1,%20Z_t%5E2)%20=%20%5Crho%0A%5Cend%7Bcases%7D%0A"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Importation des donn√©es</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span>())</span>
<span id="cb5-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/dataP_B.csv"</span>)</span>
<span id="cb5-4">S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/dataS.csv"</span>)</span>
<span id="cb5-5">v <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.csv</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/dataV.csv"</span>)</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>HestonPB, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix des Calls"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_heston_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sous_jacent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix du sous-jacent"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_heston_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√© obs."</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_heston_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Prenons <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%20(%5Ckappa%20=%204,%20%5Csigma%20=%200.4,%20%5Cbeta%20=%200.03,%20%5Crho%20=%20-0.5)">, <img src="https://latex.codecogs.com/png.latex?%5Csigma_%5Cvarepsilon%20=%200.1">, <img src="https://latex.codecogs.com/png.latex?%5Ctau=1"> et <img src="https://latex.codecogs.com/png.latex?K=100">. Pour estimer la volatilit√©, nous allons utiliser un filtre particulaire bootstrap. Il est d√©fini comme suit :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/data/bootstrap_filter.png" class="img-fluid figure-img"></p>
<figcaption>Filtre bootstrap particulaire</figcaption>
</figure>
</div>
<p>La loi stationnaire de <img src="https://latex.codecogs.com/png.latex?v_t"> est une loi gamma de param√®tres <img src="https://latex.codecogs.com/png.latex?%5Calpha_1%20=%20%5Cfrac%7B2%20%5Ckappa%20%5Cbeta%7D%7B%5Csigma%5E2%7D"> et <img src="https://latex.codecogs.com/png.latex?%5Calpha_2%20=%20%5Cfrac%7B%5Csigma%5E2%7D%7B2%20%5Ckappa%7D">.</p>
<p>De plus, la densit√© de transition de <img src="https://latex.codecogs.com/png.latex?v_t%20%7C%20v_%7Bt-1%7D"> est une loi normale de moyenne <img src="https://latex.codecogs.com/png.latex?v_%7Bt-1%7D%20+%20%5Ckappa%20(%5Cbeta%20-%20v_%7Bt-1%7D)%20%5Ctau"> et de variance <img src="https://latex.codecogs.com/png.latex?%5Csigma%20%5Csqrt%7Bv_%7Bt-1%7D%20%5Ctau%7D">. En effet, nous utilisons le sch√©ma d‚ÄôEuler pour simuler <img src="https://latex.codecogs.com/png.latex?v_t">.</p>
<p>En ce qui concerne la loi de <img src="https://latex.codecogs.com/png.latex?y_t%20%7C%20v_t">, on suppose que <img src="https://latex.codecogs.com/png.latex?y_t"> suit une loi normale de moyenne <img src="https://latex.codecogs.com/png.latex?C(t,%20%5Ctheta,%20v_t,%20S_t,%20K,%20%5Ctau)"> et de variance <img src="https://latex.codecogs.com/png.latex?%5Csigma_%5Cvarepsilon%5E2">.</p>
<p>Ainsi, nous initialisons les particules <img src="https://latex.codecogs.com/png.latex?v_0"> selon la loi stationnaire de <img src="https://latex.codecogs.com/png.latex?v_t"> et nous utilisons le sch√©ma d‚ÄôEuler pour simuler <img src="https://latex.codecogs.com/png.latex?v_t"> et <img src="https://latex.codecogs.com/png.latex?S_t">. Ensuite, nous calculons les poids des particules en utilisant la vraisemblance de l‚Äôobservation <img src="https://latex.codecogs.com/png.latex?y_t"> et nous r√©√©chantillonnons les particules selon leurs poids. Enfin, nous estimons la volatilit√© <img src="https://latex.codecogs.com/png.latex?v_t"> √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t"> en utilisant les particules r√©√©chantillonn√©es.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Definition des variables</span></span>
<span id="cb9-2">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>HestonPB</span>
<span id="cb9-3">S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Sous_jacent</span>
<span id="cb9-4">v<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> v<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Var</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des param√®tres theta</span></span>
<span id="cb10-4">kappa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb10-5">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span></span>
<span id="cb10-6">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03</span></span>
<span id="cb10-7">rho <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb10-8">sigma_epsilon <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb10-9">tau <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-10">K <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb10-11">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb10-12"></span>
<span id="cb10-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import Heston_Call_Function.R</span></span>
<span id="cb10-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/Heston_Call_Function.R"</span>)</span>
<span id="cb10-15"></span>
<span id="cb10-16"></span>
<span id="cb10-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres loi stationnaire de v</span></span>
<span id="cb10-18">alpha1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>beta)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-19">alpha2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>kappa)</span>
<span id="cb10-20"></span>
<span id="cb10-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des param√®tres</span></span>
<span id="cb10-22">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(y)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre d'observations</span></span>
<span id="cb10-23">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre de particules</span></span>
<span id="cb10-24"></span>
<span id="cb10-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des matrices et vecteurs</span></span>
<span id="cb10-26">v_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)                   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation de x</span></span>
<span id="cb10-27">v_particle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Particules</span></span>
<span id="cb10-28">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids des particules</span></span>
<span id="cb10-29">w_normalized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids normalis√©s</span></span>
<span id="cb10-30"></span>
<span id="cb10-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtre particulaire bootstrap</span></span>
<span id="cb10-32"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb10-33">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb10-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des particules √† t = 0</span></span>
<span id="cb10-35">    v_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> alpha1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>alpha2)</span>
<span id="cb10-36">    </span>
<span id="cb10-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids initiaux (bas√©s sur la distribution de l'√©tat initial)</span></span>
<span id="cb10-38">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dgamma</span>(v_particle[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> alpha1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rate =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>alpha2)</span>
<span id="cb10-39">    </span>
<span id="cb10-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalisation des poids</span></span>
<span id="cb10-41">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb10-42">    </span>
<span id="cb10-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation initiale</span></span>
<span id="cb10-44">    v_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v_particle[t, ])</span>
<span id="cb10-45">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb10-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  √âtape de pr√©diction (√©chantillonnage de nouvelles particules)</span></span>
<span id="cb10-47">    v_particle[t,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> kappa <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (beta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(v_particle[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau)))</span>
<span id="cb10-48">    </span>
<span id="cb10-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Calcul du prix du Call pour chaque particule</span></span>
<span id="cb10-50">    C <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(M)</span>
<span id="cb10-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M) {</span>
<span id="cb10-52">      C[i] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HestonCallClosedForm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> kappa, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vbar =</span> beta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">eta =</span> sigma, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rho =</span> rho, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">v0 =</span> v_particle[t,i], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tau =</span> tau, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">S0 =</span> S[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">K =</span> K)</span>
<span id="cb10-53">    }</span>
<span id="cb10-54">    </span>
<span id="cb10-55">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Mise √† jour des poids avec la vraisemblance de l'observation</span></span>
<span id="cb10-56">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(y[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> C , <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_epsilon))</span>
<span id="cb10-57">    </span>
<span id="cb10-58">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Normalisation des poids</span></span>
<span id="cb10-59">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb10-60">    </span>
<span id="cb10-61">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  R√©√©chantillonnage des particules selon leurs poids</span></span>
<span id="cb10-62">    index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> w_normalized[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb10-63">    v_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> v_particle[t, index]</span>
<span id="cb10-64">    </span>
<span id="cb10-65">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©initialisation des poids apr√®s r√©√©chantillonnage (uniforme)</span></span>
<span id="cb10-66">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> M</span>
<span id="cb10-67">    </span>
<span id="cb10-68">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Estimation de x √† l'instant t (pond√©r√©e)</span></span>
<span id="cb10-69">    v_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v_particle[t, ])</span>
<span id="cb10-70">  }</span>
<span id="cb10-71">}</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(v, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimation de la volatilit√© avec un filtre bootstrap"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volatilit√©"</span>)</span>
<span id="cb11-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(v_hat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb11-3"></span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vol. est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_heston_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>paper</category>
  <category>proc-sto</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_heston.html</guid>
  <pubDate>Wed, 05 Feb 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Le risque de march√© en asset management</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-1.html</link>
  <description><![CDATA[ 




<p>La gestion d‚Äôactifs (ou <em>asset management</em>) est l‚Äôart de g√©rer un portefeuille d‚Äôactifs financiers. Il s‚Äôagit de g√©rer l‚Äôargent de clients ‚Äî particuliers ou institutionnels ‚Äî avec pour objectif principal de maximiser le rendement tout en minimisant le risque.</p>
<p><strong>Les √©tapes usuelles de gestion du risque</strong></p>
<ol type="1">
<li>Identification des risques</li>
</ol>
<p>On distingue g√©n√©ralement quatre grandes cat√©gories de risques :</p>
<ul>
<li>Risque de march√© : risque de perte en capital d√ª √† la variation des prix des actifs financiers.</li>
<li>Risque de cr√©dit : risque de d√©faut d‚Äôun √©metteur, par exemple une entreprise qui ne rembourse pas ses obligations.</li>
<li>Risque de liquidit√© : risque de ne pas pouvoir acheter ou vendre rapidement un actif sans influencer son prix de mani√®re significative.</li>
<li>Risque op√©rationnel : risque de perte r√©sultant de processus internes d√©faillants, d‚Äôerreurs humaines ou de pannes de syst√®mes.</li>
</ul>
<ol start="2" type="1">
<li>M√©triques de risque</li>
</ol>
<p>Ce sont des mesures quantitatives du risque. Parmi les plus utilis√©es : la volatilit√©, qui mesure la variation des rendements d‚Äôun actif par rapport √† sa moyenne; la Value at Risk (VaR), qui mesure la perte maximale anticip√©e sur un portefeuille, avec un certain niveau de confiance <img src="https://latex.codecogs.com/png.latex?%5Calpha">, sur un horizon <img src="https://latex.codecogs.com/png.latex?T">, la Tracking Error, qui mesure l‚Äô√©cart de performance entre un portefeuille et son indice de r√©f√©rence.</p>
<ol start="3" type="1">
<li>Encadrement du risque</li>
</ol>
<p>Il s‚Äôagit de mettre en place des r√®gles de gestion ou des limites pour √©viter des d√©rives du portefeuille. Cela peut inclure :</p>
<ul>
<li>des limites de taille de position,</li>
<li>la diversification (√©viter la concentration sur un petit nombre d‚Äôactifs),</li>
<li>l‚Äôusage de produits d√©riv√©s (options, futures) pour se couvrir contre les risques identifi√©s.</li>
</ul>
<p><strong>Constitution du portefeuille</strong></p>
<p>Dans notre √©tude, nous allons constituer un portefeuille de 10 actions choisies dans l‚Äôindice CAC 40, en leur attribuant des poids al√©atoires.</p>
<p>Les actifs retenus sont les suivants :</p>
<ul>
<li>Sanofi<br>
</li>
<li>Soci√©t√© G√©n√©rale<br>
</li>
<li>Thales<br>
</li>
<li>Engie<br>
</li>
<li>Capgemini<br>
</li>
<li>Carrefour<br>
</li>
<li>Orange<br>
</li>
<li>Accor<br>
</li>
<li>L‚ÄôOr√©al<br>
</li>
<li>Cr√©dit Agricole</li>
</ul>
<p>Puisque nous travaillons avec un portefeuille d‚Äôactions, donc le principal risque est le risque de march√© actions. Nous allons donc nous int√©resser √† trois indicateurs de risque : - la volatilit√© ex-ante, - la Value at Risk ex-ante, - la Tracking Error ex-ante<br>
c‚Äôest-√†-dire des mesures anticip√©es, bas√©es sur la composition actuelle du portefeuille, et non sur des donn√©es historiques (ex-post).</p>
<section id="r√©cup√©ration-des-donn√©es" class="level2">
<h2 class="anchored" data-anchor-id="r√©cup√©ration-des-donn√©es">R√©cup√©ration des donn√©es</h2>
<div id="e04410fe" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#------------------------------------#</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------- Package Imports ---------#</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#------------------------------------#</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-6">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yfinance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> yf </span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span></code></pre></div>
</div>
<div id="5bdb0f3c" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_data(start_date, end_date, index_ticker, tickers):</span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extraction de donn√©es de cours d'actions</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des prix historiques des composants</span></span>
<span id="cb2-6">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.download(tickers, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>start_date, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>end_date, auto_adjust <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>]</span>
<span id="cb2-7"></span>
<span id="cb2-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des prix historiques de l'indice CAC 40</span></span>
<span id="cb2-9">    index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.download(index_ticker, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>start_date, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>end_date, auto_adjust <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Close'</span>]</span>
<span id="cb2-10"></span>
<span id="cb2-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb2-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>: data,</span>
<span id="cb2-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"benchmark_data"</span>: index,</span>
<span id="cb2-14">    }</span></code></pre></div>
</div>
<div id="fdb028d3" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1">end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2025-01-27"</span>)</span>
<span id="cb3-2">start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4">selected_assets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SAN.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sanofi"</span>,</span>
<span id="cb3-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GLE.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Soci√©t√© g√©n√©rale"</span>,</span>
<span id="cb3-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HO.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Thales"</span>,</span>
<span id="cb3-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENGI.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Engie"</span>,</span>
<span id="cb3-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAP.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Capgemini"</span>,</span>
<span id="cb3-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CA.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Carrefour"</span>,</span>
<span id="cb3-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ORA.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Orange"</span>,</span>
<span id="cb3-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AC.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Accor"</span>,</span>
<span id="cb3-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L'Oreal"</span>,</span>
<span id="cb3-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACA.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cr√©dit agricole"</span></span>
<span id="cb3-15">}</span>
<span id="cb3-16"></span>
<span id="cb3-17">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FCHI"</span></span>
<span id="cb3-18"></span>
<span id="cb3-19">assets_ticker  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(selected_assets.keys())</span>
<span id="cb3-20"></span>
<span id="cb3-21">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_data(start_date,end_date, index, assets_ticker)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][**********************50%                       ]  5 of 10 completed[**********************50%                       ]  5 of 10 completed[**********************70%*********              ]  7 of 10 completed[**********************80%*************          ]  8 of 10 completed[**********************90%******************     ]  9 of 10 completed[*********************100%***********************]  10 of 10 completed
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="8f6d7311" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">portfolio_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>]</span>
<span id="cb5-2">portfolio_data.tail()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">AC.PA</th>
<th data-quarto-table-cell-role="th">ACA.PA</th>
<th data-quarto-table-cell-role="th">CA.PA</th>
<th data-quarto-table-cell-role="th">CAP.PA</th>
<th data-quarto-table-cell-role="th">ENGI.PA</th>
<th data-quarto-table-cell-role="th">GLE.PA</th>
<th data-quarto-table-cell-role="th">HO.PA</th>
<th data-quarto-table-cell-role="th">OR.PA</th>
<th data-quarto-table-cell-role="th">ORA.PA</th>
<th data-quarto-table-cell-role="th">SAN.PA</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2025-01-20</td>
<td>46.959301</td>
<td>13.270039</td>
<td>12.445763</td>
<td>158.253357</td>
<td>14.549852</td>
<td>28.472115</td>
<td>147.275269</td>
<td>334.734375</td>
<td>9.728536</td>
<td>94.679825</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2025-01-21</td>
<td>47.017685</td>
<td>13.265357</td>
<td>12.381419</td>
<td>159.719574</td>
<td>14.453160</td>
<td>28.331999</td>
<td>148.801163</td>
<td>335.127289</td>
<td>9.761625</td>
<td>94.842651</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2025-01-22</td>
<td>47.728012</td>
<td>13.167060</td>
<td>12.082685</td>
<td>158.839844</td>
<td>14.296611</td>
<td>28.331999</td>
<td>149.785629</td>
<td>343.426880</td>
<td>9.671809</td>
<td>94.679825</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2025-01-23</td>
<td>47.270679</td>
<td>13.335569</td>
<td>12.156219</td>
<td>160.403824</td>
<td>14.273589</td>
<td>28.974592</td>
<td>150.474777</td>
<td>348.239655</td>
<td>9.648173</td>
<td>95.675957</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2025-01-24</td>
<td>47.659897</td>
<td>13.316846</td>
<td>12.225158</td>
<td>163.727234</td>
<td>14.273589</td>
<td>29.051897</td>
<td>149.933319</td>
<td>352.070282</td>
<td>9.600902</td>
<td>95.934570</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="489ed357" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">benchmark_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"benchmark_data"</span>]</span>
<span id="cb6-2">benchmark_data.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">^FCHI</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-30</td>
<td>7082.009766</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-31</td>
<td>7082.419922</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-01</td>
<td>7077.109863</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-02-02</td>
<td>7166.270020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-03</td>
<td>7233.939941</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="bb3ff0c8" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># On attribue des poids √©quitables pour chaque action</span></span>
<span id="cb7-2">weights_by_asset <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {ticker: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(assets_ticker) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> assets_ticker}</span></code></pre></div>
</div>
<p>Pour connaitre la valeur totale des actifs du portefeuille, nous allons utiliser la notion d‚Äôasset under management (AUM) d√©fini comme suit :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AAUM(T_n)%20=%20%5Csum_%7Bi=1%7D%5E%7B10%7D%20%5Comega_i%20%5Ctimes%20P_i(T_n),%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Comega_i"> est le poids de l‚Äôactif <img src="https://latex.codecogs.com/png.latex?i"> dans le portefeuille et <img src="https://latex.codecogs.com/png.latex?P_i(T_n)"> est le prix de l‚Äôactif <img src="https://latex.codecogs.com/png.latex?i"> √† la date <img src="https://latex.codecogs.com/png.latex?T_n">.</p>
<p>Puisque les rendements sont les seuls facteurs de risque de l‚ÄôAUM, nous allons nous int√©resser √† la variation de l‚ÄôAUM entre deux dates <img src="https://latex.codecogs.com/png.latex?T_n"> et <img src="https://latex.codecogs.com/png.latex?T_%7Bn+1%7D">, soit :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5CDelta%20AUM(T_n,%20T_%7Bn+1%7D)%20=%20AUM(T_%7Bn+1%7D)%20-%20AUM(T_n)%20=%20%5Csum_%7Bi=1%7D%5E%7B10%7D%20%5Comega_i%20%5Ctimes%20(P_i(T_%7Bn+1%7D)%20-%20P_i(T_n)).%0A"></p>
<div id="ee2f561a" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">aum_series <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> portfolio_data.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> row: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights_by_asset[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> row[ticker] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights_by_asset), axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-2">aum_series</span>
<span id="cb8-3"></span>
<span id="cb8-4">AUM <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(aum_series, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AUM"</span>])</span>
<span id="cb8-5">AUM.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AUM</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-30</td>
<td>81.287687</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-31</td>
<td>81.069776</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-01</td>
<td>80.829767</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-02-02</td>
<td>81.927702</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-02-03</td>
<td>82.645898</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="b7e5ceee" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --------------------------------------------- #</span></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Evolution de la valeur totale du portefeuille</span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------------------- #</span></span>
<span id="cb9-4"></span>
<span id="cb9-5">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb9-6">plt.plot(AUM, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AUM"</span>)</span>
<span id="cb9-7">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Evolution de l'actif sous gestion"</span>)</span>
<span id="cb9-8">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>)</span>
<span id="cb9-9">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Valeur"</span>)</span>
<span id="cb9-10">plt.legend()</span>
<span id="cb9-11">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-1_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="73becae3" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># On s'interesse aux variations/rendements de l'AUM</span></span>
<span id="cb10-2">AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AUM"</span>].pct_change()</span>
<span id="cb10-3">AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>].head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>Date
2023-01-30         NaN
2023-01-31   -0.002681
2023-02-01   -0.002961
2023-02-02    0.013583
2023-02-03    0.008766
Name: Variation, dtype: float64</code></pre>
</div>
</div>
<section id="estimation-de-la-volatilit√©" class="level3">
<h3 class="anchored" data-anchor-id="estimation-de-la-volatilit√©">Estimation de la volatilit√©</h3>
<p>Pour estimer la volatilit√© du portefeuille, on peut calculer l‚Äô√©cart-type des variations de l‚ÄôAUM. On fait le choix de calculer une volatilit√© ex-ante en se basant sur les variation historiques des prix des actifs avec une profondeur historique de 2 ans. Vu qu‚Äôon a une volatilit√© quotidienne, on va l‚Äôannualiser en multipliant par <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B252%7D">.</p>
<p>En g√©n√©ral, sur le march√© action, la volatilit√© quotidienne est environ de 1% et la volatilit√© annuelle est entre 10% et 20%.</p>
<div id="7f6cd7f8" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la volatilit√© du portefeuille</span></span>
<span id="cb12-2">volatility_portfolio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>])</span>
<span id="cb12-3">annualized_volatility_portfolio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> volatility_portfolio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span>)</span>
<span id="cb12-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© de la performance quotidienne : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>volatility_portfolio <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© de la performance annuelle : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>annualized_volatility_portfolio <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Volatilit√© de la performance quotidienne :  0.87%
Volatilit√© de la performance annuelle :  13.76%</code></pre>
</div>
</div>
<div id="b871dc34" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la volatilit√© de l'indice CAC 40</span></span>
<span id="cb14-2"></span>
<span id="cb14-3">benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FCHI"</span>].pct_change()</span>
<span id="cb14-4">volatility_benchmark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>])</span>
<span id="cb14-5">annualized_volatility_benchmark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> volatility_benchmark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span>)</span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© de l'indice CAC 40 : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>volatility_benchmark <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb14-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Volatilit√© de l'indice CAC 40 annuelle : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>annualized_volatility_benchmark <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Volatilit√© de l'indice CAC 40 :  0.84%
Volatilit√© de l'indice CAC 40 annuelle :  13.37%</code></pre>
</div>
</div>
<p>Notre portefeuille nous fournit une volatatilit√© quotidienne sup√©rieure de 3bps √† la volatilit√© du CAC 40. On retrouve sur √† peu pr√®s la m√™me volatilit√© du portefeuille et celle du CAC 40. Il y a donc une certaine homog√©n√©it√© dans le portefeuille que nous avons constitu√©.</p>
<blockquote class="blockquote">
<p>üí° <em>Note : bp = 0,01%</em></p>
</blockquote>
</section>
<section id="estimation-de-la-tracking-errorerreur-de-suivi" class="level3">
<h3 class="anchored" data-anchor-id="estimation-de-la-tracking-errorerreur-de-suivi">Estimation de la tracking error/erreur de suivi</h3>
<p>La tracking error est une mesure de l‚Äô√©cart entre la performance d‚Äôun portefeuille et celle de son indice de r√©f√©rence. Elle est calcul√©e comme la volatilit√© de la diff√©rence entre les rendements du portefeuille et de l‚Äôindice de r√©f√©rence :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0ATE%20=%20%5Csqrt%7BVar(R_p%20-%20R_b)%7D%0A"></p>
<p>La tracking error mesure l‚Äôincercitude du portefeuille par rapport √† l‚Äôindice de r√©f√©rence, c‚Äôest une mesure relative. Plus la tracking error est √©lev√©e, plus le portefeuille est risqu√©. On ne souhaite sous ou sur-performer l‚Äôindice de r√©f√©rence. On souhaite suivre v√©ritablement l‚Äôindice de r√©f√©rence.</p>
<p>Pour l‚Äôannualiser, on multiplie par <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B252%7D"> en supposant que les performances quotidiennes sont ind√©pendantes et donc un utilise l‚Äôadditivit√© des variances.</p>
<div id="f9c02566" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1">performance_relative <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>]</span>
<span id="cb16-2"></span>
<span id="cb16-3">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb16-4">plt.plot(performance_relative, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Performance"</span>)</span>
<span id="cb16-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Performance du portefeuille par rapport √† l'indice CAC 40"</span>)</span>
<span id="cb16-6">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>)</span>
<span id="cb16-7">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Performance"</span>)</span>
<span id="cb16-8">plt.legend()</span>
<span id="cb16-9"></span>
<span id="cb16-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-1_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d6716176" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la tracking error</span></span>
<span id="cb17-2"></span>
<span id="cb17-3">TE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>]) </span>
<span id="cb17-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Tracking error : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>TE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb17-5"></span>
<span id="cb17-6">TE_annualized <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span>)</span>
<span id="cb17-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Tracking error annualis√© : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>TE_annualized <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tracking error :  0.51%
Tracking error annualis√© :  8.05%</code></pre>
</div>
</div>
</section>
<section id="estimation-de-la-value-at-risk-var" class="level3">
<h3 class="anchored" data-anchor-id="estimation-de-la-value-at-risk-var">Estimation de la Value-at-Risk (VaR)</h3>
<p>La VaR est une mesure de risque qui donne une estimation de la perte maximale que l‚Äôon peut subir avec un certain niveau de confiance <img src="https://latex.codecogs.com/png.latex?%5Calpha"> sur un horizon de temps donn√©. Par exemple, une VaR √† 5% sur 1 jour de 1000 euros signifie que 95% du temps, on ne perdra pas plus de 1000 euros sur un jour.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(%5Ctext%7BLoss%7D%20%3C%20%5Ctext%7BVaR%7D)%20=%20%5Calpha."></p>
<p>On peut √©galement raisonner en terme de gain, i.e.&nbsp;Profit and Loss (PnL).</p>
<p><img src="https://latex.codecogs.com/png.latex?P(%5Ctext%7BPnL%7D%20%3E%20-%20%5Ctext%7BVaR%7D)%20=%20%5Calpha."></p>
<p>La VaR peut se calculer suivant trois approches : 1. Approche historique : On se base sur les rendements pass√©s selon l‚Äôhorizon fix√© pour estimer la VaR, √† l‚Äôaide d‚Äôun quantile empirique d‚Äôordre <img src="https://latex.codecogs.com/png.latex?%5Calpha">. Autrement, on peut se baser sur les rendements journaliers et utiliser la m√©thode de rescaling, i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?VaR%20=%20%5Csigma%20%5Ctimes%20%5CPhi%5E%7B-1%7D(%5Calpha)">. 2. Approche param√©trique : On suppose que les rendements suivent une loi normale. 3. Approche Monte Carlo : On simule les rendements futurs.</p>
<p>Puisqu‚Äôon s‚Äôint√©resse √† un portefeuille d‚Äôactions qui a un indice de r√©f√©rence, on peut √©galement calculer la VaR relative. La VaR relative suit une philosophie proche du tracking error. Elle se calcule sur les √©carts entre le portefeuille et le benchmark. Elle sert √† mesurer de combien mon portefeuille sous-performe par rapport √† l‚Äôindice de r√©f√©rence.</p>
<div id="25d7d064" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --------------------------------- #</span></span>
<span id="cb19-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VaR historique</span></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># --------------------------------- #</span></span>
<span id="cb19-4"></span>
<span id="cb19-5">seuil <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-6"></span>
<span id="cb19-7">VaR_hist_portfolio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.percentile(AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>].dropna(), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> seuil))</span>
<span id="cb19-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR historique sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> VaR_hist_portfolio <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR historique sur 20 jours sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>VaR_hist_portfolio<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-10"></span>
<span id="cb19-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"=*="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb19-12"></span>
<span id="cb19-13">VaR_hist_benchmark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.percentile(benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>].dropna(), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> seuil))</span>
<span id="cb19-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR historique sur l'indice CAC 40 : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>VaR_hist_benchmark <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR historique sur 20 jours sur l'indice CAC 40 : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>VaR_hist_benchmark<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VaR historique sur le portefeuille :  2.31%
VaR historique sur 20 jours sur le portefeuille :  10.32%
=*==*==*==*==*==*==*==*==*==*=
VaR historique sur l'indice CAC 40 :  2.13%
VaR historique sur 20 jours sur l'indice CAC 40 :  9.53%</code></pre>
</div>
</div>
<div id="fbbd0ac9" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------- #</span></span>
<span id="cb21-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VaR param√©trique</span></span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------- #</span></span>
<span id="cb21-4"></span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PnL ~ N(mu, sigma) ==&gt; PnL = mu + sigma * Z, o√π Z ~ N(0,1)</span></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># P(PnL &gt; -VaR) = alpha &lt;=&gt; P(mu + sigma * Z &gt; -VaR) = alpha &lt;=&gt; P(Z &lt; (-VaR - mu) / sigma) = 1 - alpha</span></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Donc, -VaR = mu + sigma * quantile(1 - alpha), o√π quantile(1 - alpha) est le quantile de la loi normale standard</span></span>
<span id="cb21-8"></span>
<span id="cb21-9"></span>
<span id="cb21-10">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>].dropna())</span>
<span id="cb21-11"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mu sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-12">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(AUM[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>].dropna())</span>
<span id="cb21-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sigma sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-14"></span>
<span id="cb21-15">VaR_param_portfolio  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> seuil))</span>
<span id="cb21-16"></span>
<span id="cb21-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR param√©trique sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR_param_portfolio <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR param√©trique sur 20 jours sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR_param_portfolio <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-19"></span>
<span id="cb21-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"=*="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb21-21"></span>
<span id="cb21-22">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>].dropna())</span>
<span id="cb21-23"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mu sur le benchmark: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-24">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(benchmark_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>].dropna())</span>
<span id="cb21-25"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sigma sur le benchmark : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-26"></span>
<span id="cb21-27">VaR_param_benchmark  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> seuil))</span>
<span id="cb21-28"></span>
<span id="cb21-29"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR param√©trique sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR_param_benchmark <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb21-30"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR param√©trique sur 20 jours sur le portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR_param_benchmark <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mu sur le portefeuille :  0.00021
sigma sur le portefeuille :  0.0087
VaR param√©trique sur le portefeuille :  1.99%
VaR param√©trique sur 20 jours sur le portefeuille :  8.92%
=*==*==*==*==*==*==*==*==*==*=
mu sur le benchmark:  0.00026
sigma sur le benchmark :  0.0084
VaR param√©trique sur le portefeuille :  1.93%
VaR param√©trique sur 20 jours sur le portefeuille :  8.65%</code></pre>
</div>
</div>
<div id="77259174" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------- #</span></span>
<span id="cb23-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># VaR relative</span></span>
<span id="cb23-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------- #</span></span>
<span id="cb23-4"></span>
<span id="cb23-5">VaR_hist_relative <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.percentile(performance_relative.dropna(), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> seuil))</span>
<span id="cb23-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR historique relative : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> VaR_hist_relative <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb23-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR historique relative sur 20 jours : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>VaR_hist_relative<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb23-8"></span>
<span id="cb23-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"=*="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb23-10"></span>
<span id="cb23-11">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(performance_relative.dropna())</span>
<span id="cb23-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mu des performances relatives: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb23-13">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.std(performance_relative.dropna())</span>
<span id="cb23-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sigma des performances relatives : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sigma <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb23-15"></span>
<span id="cb23-16">VaR_param_relative  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.ppf(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> seuil))</span>
<span id="cb23-17"></span>
<span id="cb23-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR param√©trique relative : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR_param_relative <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb23-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"VaR param√©trique relative sur 20 jours : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>VaR_param_relative <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>sqrt(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: .2%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VaR historique relative :  1.08%
VaR historique relative sur 20 jours :  4.83%
=*==*==*==*==*==*==*==*==*==*=
mu des performances relatives: -4.7e-05
sigma des performances relatives :  0.0051
VaR param√©trique relative :  1.18%
VaR param√©trique relative sur 20 jours :  5.29%</code></pre>
</div>
</div>
</section>
</section>
<section id="stress-test" class="level1">
<h1>Stress test</h1>
<p>Pour tester la robustesse du portefeuille, on peut r√©aliser des stress tests. Ces tests permettent d‚Äô√©valuer la performance du portefeuille dans des conditions extr√™mes de march√©. Ils sont souvent utilis√©s pour √©valuer la r√©silience d‚Äôun portefeuille face √† des √©v√©nements de march√© inattendus ou extr√™mes.</p>
<p>Ils sont de deux natures :</p>
<ol type="1">
<li><p>Stress test historique : On soumet le portefeuille √† une p√©riode historique ou on estime avoir eu une condition extr√™me (Covid, Subprime crisis). On rejoue un sc√©nario qui s‚Äôest d√©j√† pass√©.</p></li>
<li><p>Stress test hypoth√©tique : On joue un sc√©nario qui ne s‚Äôest jamais r√©alis√©. Exemple, si les actions chutent de 40%, notre portefeuille d‚Äôaction chute de 40%.</p></li>
</ol>
<p>Dans notre cas, nous allons r√©aliser un stress test historique sur la crise de covid. Pour cela, nous allons extraire le prix des actifs du 19 f√©vrier 2020 et du 18 mars 2020. Nous allons ensuite calculer la performance du portefeuille sur cette p√©riode. On va √©galement calculer la performance du CAC 40 sur cette p√©riode pour voir si notre portefeuille a √©t√© plus ou moins r√©silient que le march√©.</p>
<div id="44a44227" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Recuperons les prix des actifs le 19/02/2020 et le 18/03/2020</span></span>
<span id="cb25-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># On va valoriser notre portefeuille √† ces dates et calculer les performances</span></span>
<span id="cb25-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># A ces dates, le CAC 40 a connu de fortes pertes pendant la COVID-19</span></span>
<span id="cb25-4"></span>
<span id="cb25-5"></span>
<span id="cb25-6">start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"19-02-2020"</span>, dayfirst<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb25-7">end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb25-8"></span>
<span id="cb25-9"></span>
<span id="cb25-10">data_1902 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_data(start_date,end_date, index, assets_ticker)</span>
<span id="cb25-11">portfolio_data_1902<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_1902[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>]</span>
<span id="cb25-12">benchmark_data_1902<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_1902[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'benchmark_data'</span>]</span>
<span id="cb25-13"></span>
<span id="cb25-14">start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.to_datetime(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18-03-2020"</span>, dayfirst<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb25-15">end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb25-16"></span>
<span id="cb25-17"></span>
<span id="cb25-18">data_1803 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_data(start_date,end_date, index, assets_ticker)</span>
<span id="cb25-19">portfolio_data_1803<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_1803[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>]</span>
<span id="cb25-20">benchmark_data_1803<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_1803[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'benchmark_data'</span>]</span>
<span id="cb25-21"></span>
<span id="cb25-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Concat√©ner les donn√©es des deux dates pour le portefeuille et le benchmark</span></span>
<span id="cb25-23">portfolio_data_stress <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([portfolio_data_1902, portfolio_data_1803], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb25-24">benchmark_data_stress <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([benchmark_data_1902, benchmark_data_1803], ignore_index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[                       0%                       ][**********            20%                       ]  2 of 10 completed[**********            20%                       ]  2 of 10 completed[**********            20%                       ]  2 of 10 completed[**********            20%                       ]  2 of 10 completed[**********************60%****                   ]  6 of 10 completed[**********************70%*********              ]  7 of 10 completed[**********************80%*************          ]  8 of 10 completed[**********************90%******************     ]  9 of 10 completed[*********************100%***********************]  10 of 10 completed
[*********************100%***********************]  1 of 1 completed
[                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][**********************70%*********              ]  7 of 10 completed[**********************80%*************          ]  8 of 10 completed[**********************80%*************          ]  8 of 10 completed[*********************100%***********************]  10 of 10 completed
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="6bf196ea" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stress test covid sur le portefeuille</span></span>
<span id="cb27-2">aum_series_stress <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> portfolio_data_stress.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> row: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(weights_by_asset[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> row[ticker] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights_by_asset), axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb27-3"></span>
<span id="cb27-4">AUM_stress <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(aum_series_stress, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AUM"</span>])</span>
<span id="cb27-5">AUM_stress[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AUM_stress[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AUM"</span>].pct_change()</span>
<span id="cb27-6"></span>
<span id="cb27-7">AUM_stress.iloc[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>AUM          42.829420
Variation    -0.305734
Name: 2020-03-18 00:00:00, dtype: float64</code></pre>
</div>
</div>
<div id="7f222860" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">benchmark_data_stress[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Variation"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>benchmark_data_stress[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FCHI"</span>].pct_change()</span>
<span id="cb29-2">benchmark_data_stress.iloc[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>Ticker
^FCHI        3754.840088
Variation      -0.385585
Name: 2020-03-18 00:00:00, dtype: float64</code></pre>
</div>
</div>
<p>Dans ce cas, nous constatons une perte d‚Äôenviron 30.64% sur le portefeuille et une perte de 38.55% sur le CAC 40. De ce fait, notre portefeuille a √©t√© plus r√©silient que le march√©. En effet, la perte du portefeuille est inf√©rieure √† celle du CAC 40. On peut donc conclure que notre portefeuille permet de mieux resister au stress test covid que le CAC 40.</p>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Le risque de march√© constitue un enjeu central dans la gestion d‚Äôactifs. Il est inh√©rent √† toute exposition aux march√©s financiers et doit, √† ce titre, √™tre mesur√©, surveill√© et encadr√© avec rigueur afin de pr√©server les int√©r√™ts des investisseurs.</p>
<p>Des outils tels que la volatilit√©, la tracking error et la Value at Risk (VaR) permettent de quantifier l‚Äôincertitude li√©e aux rendements du portefeuille et d‚Äôanticiper les pertes potentielles dans des conditions normales de march√©.</p>
<p>En compl√©ment, les stress tests jouent un r√¥le fondamental : ils permettent d‚Äô√©valuer la r√©silience du portefeuille face √† des sc√©narios extr√™mes, souvent absents des donn√©es historiques, mais pourtant plausibles dans un contexte de crise.</p>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>asset-management</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-1.html</guid>
  <pubDate>Sun, 26 Jan 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Risques de liquidit√© (profil d‚Äô√©coulement / de liquidation d‚Äôun portefeuille d‚Äôactifs)</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2.html</link>
  <description><![CDATA[ 




<p>Le risque de liquidit√© est l‚Äôune des quatre grandes cat√©gories de risques auxquels une banque peut √™tre expos√©e. Il concerne √† la fois la liquidit√© du march√© et le risque op√©rationnel de financement.</p>
<ul>
<li>La liquidit√© du march√© fait r√©f√©rence √† la capacit√© d‚Äôun investisseur √† acheter ou vendre un actif sans en affecter significativement le prix.</li>
<li>Le risque op√©rationnel de financement concerne la capacit√© √† lever des fonds pour financer ses activit√©s.</li>
</ul>
<p>Ainsi, le risque de liquidit√© est crucial dans la gestion d‚Äôun portefeuille, notamment en p√©riode de tensions sur les march√©s. Si un investisseur doit liquider un actif, il peut √™tre contraint de le vendre √† un prix inf√©rieur √† sa valeur fondamentale, entra√Ænant ainsi une perte importante.</p>
<p>Pour √©valuer ce risque, plusieurs indicateurs sont utilis√©s :</p>
<ul>
<li>le co√ªt de liquidit√©,</li>
<li>le profil d‚Äô√©coulement (ou profil de liquidation),</li>
<li>les gaps de liquidit√©,</li>
<li>les stress tests de liquidit√©.</li>
</ul>
<p>Dans le cadre de notre √©tude, nous nous concentrons sur le profil d‚Äô√©coulement d‚Äôun portefeuille compos√© de 10 actifs, et ce dans les quatre sc√©narios suivants :</p>
<p><strong>1. Conditions normales avec d√©formation :</strong> On consid√®re les volumes moyens de march√©, que l‚Äôon d√©forme pour obtenir les quantit√©s effectivement liquid√©es.<br>
La liquidation d√©bute avec les actifs les plus liquides et se termine avec les plus illiquides.<br>
Ce processus entra√Æne une d√©formation du portefeuille :<br>
les premiers investisseurs r√©cup√®rent une part plus liquide, tandis que ceux qui restent se retrouvent avec des actifs plus illiquides.</p>
<p><strong>2. Conditions normales sans d√©formation :</strong> Dans ce cas, on cherche √† pr√©server l‚Äô√©quilibre du portefeuille, afin de ne pas p√©naliser les investisseurs restants.<br>
La liquidation est r√©partie uniform√©ment, sans privil√©gier les actifs les plus liquides.</p>
<p><strong>3. Conditions stress√©es avec d√©formation :</strong> Les march√©s sont en tension, les volumes chutent drastiquement.<br>
On liquide en priorit√© les actifs les plus liquides, ce qui accentue l‚Äôilliquidit√© r√©siduelle du portefeuille.</p>
<p><strong>4. Conditions stress√©es sans d√©formation :</strong> M√™me en p√©riode de stress, on cherche √† conserver une proportionnalit√© √©quitable dans la liquidation, pour √©viter une concentration d‚Äôactifs illiquides pour les investisseurs restants.</p>
<p><strong>√âtapes de mise en ≈ìuvre</strong></p>
<p>Pour chaque sc√©nario, on proc√®de selon les √©tapes suivantes :</p>
<ol type="1">
<li><p>R√©cup√©ration des volumes journaliers sur une p√©riode historique de 3 mois, √† compter de la date d‚Äôaujourd‚Äôhui, i.e.&nbsp;le 28 mars 2025.</p></li>
<li><p>Calcul de l‚ÄôADV sur 3 mois <em>(Average Daily Volume)</em> :<br>
<img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BADV%7D_%7BT=3M%7D%20=%20%5Cfrac%7B1%7D%7BT%7D%20%5Csum_%7Bt=1%7D%5E%7BT%7D%20V_t,%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?V_t"> est le volume quotidien et <img src="https://latex.codecogs.com/png.latex?T"> le nombre de jours ouvr√©s sur les 3 mois.</p></li>
<li><p>G√©n√©ration des quantit√©s associ√©es √† chaque actif dans le portefeuille.</p></li>
<li><p>Pour obtenir un portefeuille ni trop liquide, ni trop illiquide, on applique la formule : <img src="https://latex.codecogs.com/png.latex?%0AQ_i%20=%201.5%20%5Ctimes%20%5Ctext%7Brandn%7D()%20%5Ctimes%20%5Ctext%7BADV%7D_%7B3M%7D%5E%7B(i)%7D,%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Brandn%7D()%20%5Csim%20%5Cmathcal%7BU%7D%5B0,%201%5D"> est une variable al√©atoire uniforme, et <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BADV%7D_%7B3M%7D%5E%7B(i)%7D"> l‚ÄôADV de l‚Äôactif <img src="https://latex.codecogs.com/png.latex?i">.</p></li>
<li><p>Calcul du profil de liquidation : Ce profil est construit en fonction de la quantit√© liquid√©e chaque jour, en tenant compte de la limite fix√©e par le volume moyen quotidien de chaque actif.</p></li>
</ol>
<p>Nous utiliserons un portefeuille fictif de 10 actifs du CAC, √† savoir :</p>
<ul>
<li>Sanofi</li>
<li>Societe Generale</li>
<li>Thales</li>
<li>Engie</li>
<li>Capgemini</li>
<li>Carrefour</li>
<li>Orange</li>
<li>Accor</li>
<li>L‚ÄôOreal</li>
<li>Cr√©dit agricole</li>
</ul>
<section id="r√©cup√©ration-des-donn√©es" class="level3">
<h3 class="anchored" data-anchor-id="r√©cup√©ration-des-donn√©es">R√©cup√©ration des donn√©es</h3>
<div id="bed95df7" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#------------------------------------#</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------- Package Imports ---------#</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#------------------------------------#</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-6">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> datetime <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> datetime, timedelta</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> yfinance <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> yf </span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span></code></pre></div>
</div>
<div id="7874b44e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_data(start_date, end_date, index_ticker, tickers, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>):</span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extraction de prix de cl√¥ture d'actions</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des volumes historiques des composants</span></span>
<span id="cb2-6">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.download(tickers, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>start_date, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>end_date, auto_adjust <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)[column]</span>
<span id="cb2-7"></span>
<span id="cb2-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extraction des volumes historiques de l'indice de ref√©rence</span></span>
<span id="cb2-9">    index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> yf.download(index_ticker, start<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>start_date, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>end_date, auto_adjust <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)[column]</span>
<span id="cb2-10"></span>
<span id="cb2-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb2-12">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>: data,</span>
<span id="cb2-13">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"benchmark_data"</span>: index,</span>
<span id="cb2-14">    }</span>
<span id="cb2-15"></span>
<span id="cb2-16">end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.now()</span>
<span id="cb2-17">start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span>)</span>
<span id="cb2-18"></span>
<span id="cb2-19">selected_assets <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb2-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SAN.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sanofi"</span>,</span>
<span id="cb2-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GLE.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Soci√©t√© g√©n√©rale"</span>,</span>
<span id="cb2-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HO.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Thales"</span>,</span>
<span id="cb2-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ENGI.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Engie"</span>,</span>
<span id="cb2-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CAP.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Capgemini"</span>,</span>
<span id="cb2-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CA.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Carrefour"</span>,</span>
<span id="cb2-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ORA.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Orange"</span>,</span>
<span id="cb2-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AC.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Accor"</span>,</span>
<span id="cb2-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OR.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L'Oreal"</span>,</span>
<span id="cb2-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ACA.PA"</span> : <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cr√©dit agricole"</span>,</span>
<span id="cb2-30">    }</span>
<span id="cb2-31"></span>
<span id="cb2-32">index <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^FCHI"</span></span>
<span id="cb2-33"></span>
<span id="cb2-34">assets_ticker  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(selected_assets.keys())</span>
<span id="cb2-35"></span>
<span id="cb2-36">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_data(start_date,end_date, index, assets_ticker, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Volume"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][                       0%                       ][**********************80%*************          ]  8 of 10 completed[**********************90%******************     ]  9 of 10 completed[*********************100%***********************]  10 of 10 completed
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="a532a5bb" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">portfolio_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>]</span>
<span id="cb4-2">portfolio_data.tail()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">AC.PA</th>
<th data-quarto-table-cell-role="th">ACA.PA</th>
<th data-quarto-table-cell-role="th">CA.PA</th>
<th data-quarto-table-cell-role="th">CAP.PA</th>
<th data-quarto-table-cell-role="th">ENGI.PA</th>
<th data-quarto-table-cell-role="th">GLE.PA</th>
<th data-quarto-table-cell-role="th">HO.PA</th>
<th data-quarto-table-cell-role="th">OR.PA</th>
<th data-quarto-table-cell-role="th">ORA.PA</th>
<th data-quarto-table-cell-role="th">SAN.PA</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2026-02-04</td>
<td>652002</td>
<td>8139828</td>
<td>4003844</td>
<td>1055505</td>
<td>7024229</td>
<td>3211658</td>
<td>262612</td>
<td>309740</td>
<td>8085866</td>
<td>2767517</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2026-02-05</td>
<td>677533</td>
<td>5694454</td>
<td>2079899</td>
<td>583137</td>
<td>6766158</td>
<td>3552763</td>
<td>320840</td>
<td>465105</td>
<td>4898256</td>
<td>2838101</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2026-02-06</td>
<td>464918</td>
<td>3678669</td>
<td>1912522</td>
<td>859927</td>
<td>4315366</td>
<td>4256053</td>
<td>287196</td>
<td>319279</td>
<td>5470913</td>
<td>2139471</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2026-02-09</td>
<td>565243</td>
<td>4255601</td>
<td>1525658</td>
<td>495323</td>
<td>2945488</td>
<td>2629828</td>
<td>219148</td>
<td>319083</td>
<td>4828547</td>
<td>1966157</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2026-02-10</td>
<td>649779</td>
<td>4146587</td>
<td>1789102</td>
<td>849739</td>
<td>3005299</td>
<td>2399520</td>
<td>201360</td>
<td>409816</td>
<td>3572279</td>
<td>2483671</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>L‚ÄôAverage Daily Volume (ADV) ou ATV (Average Traded Volume) est un indicateur cl√© en finance, qui permet de mesurer la liquidit√© d‚Äôun actif. Il est calcul√© en prenant la moyenne des volumes √©chang√©s sur une p√©riode donn√©e. Plus l‚ÄôADV est √©lev√©, plus l‚Äôactif est liquide, et plus il est facile de le vendre sans impacter le prix du march√©.</p>
<p>En g√©n√©ral, c‚Äôest l‚ÄôADV sur 3 mois qui est utilis√©, car il permet de lisser les variations quotidiennes et de donner une vision plus pr√©cise de la liquidit√© d‚Äôun actif.</p>
<p><img src="https://latex.codecogs.com/png.latex?ADV%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20V_i%7D%7Bn%7D,"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?V_i"> est le volume √©chang√© le jour <img src="https://latex.codecogs.com/png.latex?i">, et <img src="https://latex.codecogs.com/png.latex?n"> est le nombre de jours sur la p√©riode consid√©r√©e.</p>
<p>Dans le code ci-dessous, nous avons calcul√© l‚ÄôADV sur 3 mois pour chaque actif du portefeuille. Nous constatons que l‚Äôactif le plus liquide est <strong>Orange</strong>, avec un ADV d‚Äôenviron 7,7 million d‚Äôactions √©chang√©es par jour, tandis que l‚Äôactif le moins liquide est <strong>Thales</strong>, avec un ADV d‚Äôenviron 0,4 million d‚Äôactions √©chang√©es par jour. De ce fait, durant ces trois mois, l‚Äôaction Orange a √©t√© plus plus liquide que l‚Äôaction Thales.</p>
<div id="c502e83c" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------#</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des ADV 3Mois#</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------#</span></span>
<span id="cb5-4"></span>
<span id="cb5-5">adv_3m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {ticker : np.mean(portfolio_data[ticker]) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> assets_ticker}</span>
<span id="cb5-6">adv_3m</span>
<span id="cb5-7"></span>
<span id="cb5-8">ADV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame.from_dict(adv_3m, orient<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'index'</span>, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ADV'</span>])</span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># trier par ADV</span></span>
<span id="cb5-11">ADV.sort_values(by<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'ADV'</span>, ascending<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADV</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>4.132509e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>3.985574e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>3.587703e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>2.196726e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>2.101232e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.956711e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>5.840311e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>4.504017e+05</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>3.043389e+05</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>2.370661e+05</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Pour g√©n√©rer le volume d√©tenu dans notre portefeuille, nous allons utiliser la formule suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Ctext%7BVolume%20d%C3%A9tenu%7D%20=%201.5%20%5Ctimes%20%5Ctext%7Brandn()%7D%20%5Ctimes%20%5Ctext%7BADV%203M%7D%0A"></p>
<p>Cette formule sert √† simuler un portefeuille r√©aliste o√π les tailles de position sont ajust√©es √† la liquidit√© de chaque actif, avec une variabilit√© al√©atoire ma√Ætris√©e. Elle est simple, mais tr√®s utile pour tester des hypoth√®ses de liquidation, de stress, ou de concentration.</p>
<div id="84ecf470" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># G√©n√©ration des quantit√©s</span></span>
<span id="cb6-2">np.random.seed(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb6-3">ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>  <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.random.rand(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ADV"</span>])) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ADV"</span>])</span>
<span id="cb6-4">ADV</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADV</th>
<th data-quarto-table-cell-role="th">Quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.956711e+06</td>
<td>2044183.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>2.101232e+06</td>
<td>901868.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>2.370661e+05</td>
<td>80668.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>4.132509e+06</td>
<td>3417470.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>4.504017e+05</td>
<td>486075.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>2.196726e+06</td>
<td>1394173.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>3.985574e+06</td>
<td>5863363.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>5.840311e+05</td>
<td>599943.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>3.043389e+05</td>
<td>219549.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>3.587703e+06</td>
<td>2110202.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>En plus de la g√©n√©ration des quantit√©s, il est utile de connaitre la quantit√© qu‚Äôon peut liquider en une journ√©e. En effet, la liquidit√© d‚Äôun actif n‚Äôest pas infinie, et il est important de savoir combien on peut vendre sans impacter le prix de mani√®re significative. Pour cela, on utilise la notion de profondeur de march√©.</p>
<p>La profondeur de march√© est une quantit√© √† partir de laquelle on ne peut plus vendre sans impacter le prix de fa√ßon consid√©rable. On fait l‚Äôhypoth√®se que la profondeur de march√© est de 20%. Cela signifie que l‚Äôon peut vendre 20% de la quantit√© sans impacter le prix de fa√ßon consid√©rable. Au-del√†, le prix est impact√©. Cette profondeur est ce qui est observ√© en pratique dans les carnets d‚Äôordre √† tel point que l‚ÄôAMF le recommande.</p>
<p>A l‚Äôaide de cette profondeur de march√©, on peut d√©terminer la quantit√© liquidable en une journ√©e de la mani√®re suivante : <img src="https://latex.codecogs.com/png.latex?%0AADV%203M%20%5Ctimes%200.2%0A"></p>
<p>Le nombre de jours de liquidation peut √™tre ainsi d√©termin√© : <img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Ctext%7BQuantit%C3%A9%20%C3%A0%20liquider%7D%7D%7B%5Ctext%7BQuantit%C3%A9%20liquidable%20en%20une%20journ%C3%A9e%7D%7D%0A"></p>
<p>Ce nombre de jours est g√©n√©ralement arrondi √† l‚Äôentier sup√©rieur et floor√© √† 1. Plus ce nombre est √©lev√©, plus la liquidation sera longue, et plus le risque de march√© sera √©lev√©. En effet, plus la liquidation est longue, plus le risque de march√© est √©lev√©, car il y a plus de chances que le prix de l‚Äôactif √©volue entre le moment o√π l‚Äôinvestisseur d√©cide de liquider et le moment o√π la liquidation est termin√©e.</p>
<div id="de911882" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Quantit√© liquidable en 1 jour</span></span>
<span id="cb7-2">market_depth <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb7-3">ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity in 1day"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ADV"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> market_depth)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du nombre de jours de liquidation</span></span>
<span id="cb7-6">ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of liquidation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity in 1day"</span>]</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># floor to 1 and round</span></span>
<span id="cb7-9">ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of liquidation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of liquidation"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(x)))</span>
<span id="cb7-10">ADV</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ADV</th>
<th data-quarto-table-cell-role="th">Quantity</th>
<th data-quarto-table-cell-role="th">Quantity in 1day</th>
<th data-quarto-table-cell-role="th">Days of liquidation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.956711e+06</td>
<td>2044183.0</td>
<td>391342.0</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>2.101232e+06</td>
<td>901868.0</td>
<td>420246.0</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>2.370661e+05</td>
<td>80668.0</td>
<td>47413.0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>4.132509e+06</td>
<td>3417470.0</td>
<td>826502.0</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>4.504017e+05</td>
<td>486075.0</td>
<td>90080.0</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>2.196726e+06</td>
<td>1394173.0</td>
<td>439345.0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>3.985574e+06</td>
<td>5863363.0</td>
<td>797115.0</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>5.840311e+05</td>
<td>599943.0</td>
<td>116806.0</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>3.043389e+05</td>
<td>219549.0</td>
<td>60868.0</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>3.587703e+06</td>
<td>2110202.0</td>
<td>717541.0</td>
<td>3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="192e4eb1" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1">time_elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Days of liquidation'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb8-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Temps de liquidation du portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>time_elapsed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> jours"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 7 jours</code></pre>
</div>
</div>
<p>En calcucant le nombre de jours de liquidation pour chaque actif, on constate que les actifs qui se liquide le plus vite sont les actifs Thales et Soci√©t√© G√©n√©rale. L‚Äôactif qui quant √† lui prend le plus de temps √† se liquider est l‚Äôactif Orange. Cela peut sembler paradoxal, car Orange est l‚Äôactif le plus liquide,compte tenu de son ADV. Cependant, cela s‚Äôexplique par le fait que la quantit√© √† liquider est d√©pendante de l‚ÄôADV, et est de ce fait tr√®s importante, et que la profondeur de march√© est faible. En effet, m√™me si l‚ÄôADV est √©lev√©, la profondeur de march√© est faible, ce qui rend la liquidation plus difficile. Un actif avec un petit ADV peut se liquider plus vite simplement parce qu‚Äôon lui aura affect√© d‚Äôun petit coefficient al√©atoire, dans la g√©n√©ration des quantit√©s initiales.</p>
<blockquote class="blockquote">
<p>üí° La liquidit√© d‚Äôun portefeuille d√©pend de la liquidit√© intrins√®que des titres et la quantit√© de titres.</p>
</blockquote>
</section>
<section id="pr√©sence-de-d√©formation" class="level2">
<h2 class="anchored" data-anchor-id="pr√©sence-de-d√©formation">Pr√©sence de d√©formation</h2>
<p>La d√©formation dans le cadre de la liquidation d‚Äôun portefeuille d‚Äôactifs fait r√©f√©rence √† la mani√®re dont les quantit√©s liquid√©es sont r√©parties entre les diff√©rents actifs du portefeuille. En effet, lorsque l‚Äôon liquide un portefeuille, on ne peut pas simplement vendre tous les actifs en m√™me temps, compte tenu de leur liquidit√© respective. La d√©formation se produit lorsque l‚Äôon liquide d‚Äôabord les actifs les plus liquides, ce qui entra√Æne une concentration d‚Äôactifs illiquides dans le portefeuille restant. Cela peut avoir un impact significatif sur la valeur du portefeuille et sur le risque de liquidit√©.</p>
<section id="sous-conditions-normales-avec-d√©formation-waterfall-liquidation" class="level3">
<h3 class="anchored" data-anchor-id="sous-conditions-normales-avec-d√©formation-waterfall-liquidation">Sous conditions normales avec d√©formation (waterfall liquidation)</h3>
<p>Pour conna√Ætre la quantit√© d‚Äôactifs liquid√©s chaque jour, on fait l‚Äôhypoth√®se que les liquidations futures se feront aux prix observ√©s aujourd‚Äôhui. En pratique, ce que l‚Äôon peut r√©ellement liquider en une journ√©e correspond √† la quantit√© que l‚Äôon peut vendre sans impacter le prix, c‚Äôest-√†-dire min(quantit√© liquidable en 1 jour, quantit√© restant dans le portefeuille).</p>
<p>Sur cette base, on peut calculer la valeur de march√© du portefeuille, aussi bien au moment initial qu‚Äô√† chaque jour de liquidation. Cette valeur est g√©n√©ralement exprim√©e en pourcentage de l‚Äôencours total.</p>
<p>On peut ensuite calculer le cumul des pourcentages liquid√©s au fil des jours. Cette courbe cumulative repr√©sente ce que l‚Äôon appelle le profil d‚Äô√©coulement du portefeuille.</p>
<p>Dans le code ci-dessous, nous pr√©sentons les quantit√©s liquid√©es par jour pour chaque actif.</p>
<blockquote class="blockquote">
<p>üí° Par convention, le jour 0 correspond √† la quantit√© initialement d√©tenue dans le portefeuille, avant toute op√©ration de liquidation.</p>
</blockquote>
<div id="990d2342" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Liquidation du portefeuille</span></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb10-4"></span>
<span id="cb10-5">ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialement, rien n'est liquid√©</span></span>
<span id="cb10-6"></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Au jour 0, on a liquid√© 0. La colonne 0 sert de quantit√© initiale</span></span>
<span id="cb10-8">quantity_liquidated_per_day <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>]]</span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> (ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>]).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> : <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tant qu'il y a des liquidations √† faire</span></span>
<span id="cb10-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculer la quantit√© liquide au jour i</span></span>
<span id="cb10-12">    liquidated_today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.minimum(ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity in 1day"</span>], ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>])</span>
<span id="cb10-13">    </span>
<span id="cb10-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mettre √† jour les quantit√©s liquid√©es dans le DataFrame</span></span>
<span id="cb10-15">    ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> liquidated_today</span>
<span id="cb10-16">    </span>
<span id="cb10-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stocker les quantit√©s liquid√©es ce jour dans une liste</span></span>
<span id="cb10-18">    quantity_liquidated_per_day.append(liquidated_today)</span>
<span id="cb10-19"></span>
<span id="cb10-20">liquidation_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(quantity_liquidated_per_day).T</span>
<span id="cb10-21">liquidation_df.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(quantity_liquidated_per_day))]</span>
<span id="cb10-22"></span>
<span id="cb10-23">liquidation_df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>2044183.0</td>
<td>391342.0</td>
<td>391342.0</td>
<td>391342.0</td>
<td>391342.0</td>
<td>391342.0</td>
<td>87473.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>901868.0</td>
<td>420246.0</td>
<td>420246.0</td>
<td>61376.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>80668.0</td>
<td>47413.0</td>
<td>33255.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>3417470.0</td>
<td>826502.0</td>
<td>826502.0</td>
<td>826502.0</td>
<td>826502.0</td>
<td>111462.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>486075.0</td>
<td>90080.0</td>
<td>90080.0</td>
<td>90080.0</td>
<td>90080.0</td>
<td>90080.0</td>
<td>35675.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>1394173.0</td>
<td>439345.0</td>
<td>439345.0</td>
<td>439345.0</td>
<td>76138.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>5863363.0</td>
<td>797115.0</td>
<td>797115.0</td>
<td>797115.0</td>
<td>797115.0</td>
<td>797115.0</td>
<td>797115.0</td>
<td>797115.0</td>
<td>283558.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>599943.0</td>
<td>116806.0</td>
<td>116806.0</td>
<td>116806.0</td>
<td>116806.0</td>
<td>116806.0</td>
<td>15913.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>219549.0</td>
<td>60868.0</td>
<td>60868.0</td>
<td>60868.0</td>
<td>36945.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>2110202.0</td>
<td>717541.0</td>
<td>717541.0</td>
<td>675120.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="059e12c7" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1">end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> datetime.now()</span>
<span id="cb11-2">start_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> end_date <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> timedelta(days<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb11-3">price_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_data(start_date, end_date, index, assets_ticker, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Close"</span>)</span>
<span id="cb11-4"></span>
<span id="cb11-5">price_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>].head()</span>
<span id="cb11-6">price_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> price_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"portfolio_data"</span>].iloc[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].to_dict()</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb11-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Prix des actifs √† la date du jour"</span>)</span>
<span id="cb11-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"="</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb11-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker, price <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> price_dict.items():</span>
<span id="cb11-12">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le prix de l'actif </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>selected_assets[ticker]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>price<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> ‚Ç¨"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[                       0%                       ][**********            20%                       ]  2 of 10 completed[**************        30%                       ]  3 of 10 completed[**************        30%                       ]  3 of 10 completed[**********************50%                       ]  5 of 10 completed[**********************60%****                   ]  6 of 10 completed[**********************60%****                   ]  6 of 10 completed[**********************80%*************          ]  8 of 10 completed[**********************90%******************     ]  9 of 10 completed[*********************100%***********************]  10 of 10 completed
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
Prix des actifs √† la date du jour
==================================================
Le prix de l'actif Accor est de 49.15999984741211 ‚Ç¨
Le prix de l'actif Cr√©dit agricole est de 18.040000915527344 ‚Ç¨
Le prix de l'actif Carrefour est de 14.880000114440918 ‚Ç¨
Le prix de l'actif Capgemini est de 113.5999984741211 ‚Ç¨
Le prix de l'actif Engie est de 26.09000015258789 ‚Ç¨
Le prix de l'actif Soci√©t√© g√©n√©rale est de 73.41999816894531 ‚Ç¨
Le prix de l'actif Thales est de 252.5 ‚Ç¨
Le prix de l'actif L'Oreal est de 391.3999938964844 ‚Ç¨
Le prix de l'actif Orange est de 16.459999084472656 ‚Ç¨
Le prix de l'actif Sanofi est de 82.19999694824219 ‚Ç¨</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
</div>
<div id="929fb98a" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Valeur liquide des actions par jour de liquidation</span></span>
<span id="cb15-2">market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[</span>
<span id="cb15-3">    price_dict[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> liquidation_df.loc[ticker]</span>
<span id="cb15-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> selected_assets</span>
<span id="cb15-5">]</span>
<span id="cb15-6"></span>
<span id="cb15-7">market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(market_value, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>liquidation_df.columns)</span>
<span id="cb15-8">market_value</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>1.680318e+08</td>
<td>3.216831e+07</td>
<td>3.216831e+07</td>
<td>3.216831e+07</td>
<td>3.216831e+07</td>
<td>3.216831e+07</td>
<td>7.190280e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>6.621515e+07</td>
<td>3.085446e+07</td>
<td>3.085446e+07</td>
<td>4.506226e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>2.036867e+07</td>
<td>1.197178e+07</td>
<td>8.396888e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>8.916179e+07</td>
<td>2.156344e+07</td>
<td>2.156344e+07</td>
<td>2.156344e+07</td>
<td>2.156344e+07</td>
<td>2.908044e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>5.521812e+07</td>
<td>1.023309e+07</td>
<td>1.023309e+07</td>
<td>1.023309e+07</td>
<td>1.023309e+07</td>
<td>1.023309e+07</td>
<td>4.052680e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">CA.PA</td>
<td>2.074529e+07</td>
<td>6.537454e+06</td>
<td>6.537454e+06</td>
<td>6.537454e+06</td>
<td>1.132933e+06</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ORA.PA</td>
<td>9.651095e+07</td>
<td>1.312051e+07</td>
<td>1.312051e+07</td>
<td>1.312051e+07</td>
<td>1.312051e+07</td>
<td>1.312051e+07</td>
<td>1.312051e+07</td>
<td>1.312051e+07</td>
<td>4.667364e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">AC.PA</td>
<td>2.949320e+07</td>
<td>5.742183e+06</td>
<td>5.742183e+06</td>
<td>5.742183e+06</td>
<td>5.742183e+06</td>
<td>5.742183e+06</td>
<td>7.822831e+05</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">OR.PA</td>
<td>8.593148e+07</td>
<td>2.382373e+07</td>
<td>2.382373e+07</td>
<td>2.382373e+07</td>
<td>1.446027e+07</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ACA.PA</td>
<td>3.806805e+07</td>
<td>1.294444e+07</td>
<td>1.294444e+07</td>
<td>1.217917e+07</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="c0d795c9" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la valeur de march√© initiale et totale</span></span>
<span id="cb16-2">market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb16-3">total_market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_0.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb16-4"></span>
<span id="cb16-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f" La valeur de march√© initiale est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>total_market_value_0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">‚Ç¨"</span>)</span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)</span></span>
<span id="cb16-8">cumsum_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:].cumsum(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-9">cumsum_total_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).cumsum()</span>
<span id="cb16-10">cumsum_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([pd.DataFrame(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>market_value.index, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), cumsum_market_value], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-11">cumsum_total_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([pd.Series(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), cumsum_total_market_value])</span>
<span id="cb16-12"></span>
<span id="cb16-13">weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb16-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> assets_ticker :</span>
<span id="cb16-15">    weights[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (market_value_0.loc[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cumsum_market_value.loc[ticker]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (total_market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cumsum_total_market_value)</span>
<span id="cb16-16"></span>
<span id="cb16-17">weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(weights).T</span>
<span id="cb16-18">weights.head()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> La valeur de march√© initiale est de 669744530.421916‚Ç¨</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SAN.PA</td>
<td>0.250889</td>
<td>0.271301</td>
<td>0.309168</td>
<td>0.348018</td>
<td>0.367474</td>
<td>0.167474</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">GLE.PA</td>
<td>0.098866</td>
<td>0.070610</td>
<td>0.013435</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HO.PA</td>
<td>0.030413</td>
<td>0.016767</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ENGI.PA</td>
<td>0.133128</td>
<td>0.134985</td>
<td>0.137254</td>
<td>0.119067</td>
<td>0.027151</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">CAP.PA</td>
<td>0.082447</td>
<td>0.089829</td>
<td>0.103613</td>
<td>0.119298</td>
<td>0.133380</td>
<td>0.094394</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="972ab2c1" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Barplot empil√©</span></span>
<span id="cb18-4">bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb18-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> asset <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights.index:</span>
<span id="cb18-6">    plt.bar(</span>
<span id="cb18-7">        pd.to_numeric(weights.columns),  </span>
<span id="cb18-8">        weights.loc[asset],  </span>
<span id="cb18-9">        bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bottom,  </span>
<span id="cb18-10">        label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets[asset]  </span>
<span id="cb18-11">    )</span>
<span id="cb18-12">    bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weights.loc[asset] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> bottom <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> weights.loc[asset]</span>
<span id="cb18-13"></span>
<span id="cb18-14">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of Liquidation"</span>)</span>
<span id="cb18-15">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Portfolio Weights"</span>)</span>
<span id="cb18-16">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©formation du portefeuille"</span>)</span>
<span id="cb18-17">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb18-18">plt.legend(title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assets"</span>, bbox_to_anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper left"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, ncol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb18-19">plt.tight_layout()</span>
<span id="cb18-20"></span>
<span id="cb18-21">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Nous constatons avec ce profile de liquidation que les actifs les plus liquides sont liquid√©s en premier, ce qui entra√Æne une concentration d‚Äôactifs illiquides dans le portefeuille restant. Cela peut avoir un impact significatif sur la valeur du portefeuille et sur le risque de liquidit√©. En effet, √† la fin de la p√©riode de liquidation, le portefeuille est uniquement constitu√© de l‚Äôactif Orange, qui nous avons vu pr√©c√©demment est l‚Äôactif le plus illiquide.</p>
<blockquote class="blockquote">
üí° Bon √† savoir : Pour un fonds de droit fran√ßais r√©glement√©, il est interdit d‚Äôinvestir plus de 5‚ÄØ% du portefeuille dans un seul √©metteur. Cependant, √† titre exceptionnel, il est possible d‚Äôinvestir jusqu‚Äô√† 10‚ÄØ% dans certains titres, √† condition que la somme des expositions sup√©rieures √† 5‚ÄØ% ne d√©passe pas 40‚ÄØ% du portefeuille. C‚Äôest ce que l‚Äôon appelle la r√®gle des 5/10/40, un ratio r√©glementaire applicable aux OPC (organismes de placement collectif). Toutes les pertes li√©es √† un non-respect de ce ratio doivent √™tre support√©es par la soci√©t√© de gestion. De plus, tout d√©passement doit √™tre d√©clar√© √† l‚ÄôAMF.
</blockquote>
<div id="bef455f5" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Valeur liquide du portefeuille</span></span>
<span id="cb19-2">market_value_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame()</span>
<span id="cb19-3"></span>
<span id="cb19-4">market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculer la valeur liquide relative par rapport au jour 0</span></span>
<span id="cb19-7">market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"relative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>].iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb19-8"></span>
<span id="cb19-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculer la valeur cumul√©e liquide relative du portefeuille</span></span>
<span id="cb19-10">market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"relative value"</span>].cumsum() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb19-11"></span>
<span id="cb19-12">market_value_df</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">market_value</th>
<th data-quarto-table-cell-role="th">relative value</th>
<th data-quarto-table-cell-role="th">cumulative value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6.697445e+08</td>
<td>1.000000</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.689594e+08</td>
<td>0.252274</td>
<td>0.252274</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.653845e+08</td>
<td>0.246937</td>
<td>0.499211</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1.298741e+08</td>
<td>0.193916</td>
<td>0.693127</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>9.842074e+07</td>
<td>0.146953</td>
<td>0.840080</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>6.417214e+07</td>
<td>0.095816</td>
<td>0.935896</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2.514576e+07</td>
<td>0.037545</td>
<td>0.973441</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>1.312051e+07</td>
<td>0.019590</td>
<td>0.993031</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>4.667364e+06</td>
<td>0.006969</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="4a26781b" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1">market_value_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df.iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:]</span>
<span id="cb20-2"></span>
<span id="cb20-3">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb20-4">bars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.bar(market_value_df.index, market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skyblue"</span>)</span>
<span id="cb20-5"></span>
<span id="cb20-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> bar <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> bars:</span>
<span id="cb20-7">    height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bar.get_height()</span>
<span id="cb20-8">    plt.text(</span>
<span id="cb20-9">        bar.get_x() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bar.get_width() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Center text</span></span>
<span id="cb20-10">        height,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Position slightly above the bar</span></span>
<span id="cb20-11">        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>height<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Format with 2 decimal places</span></span>
<span id="cb20-12">        ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Center horizontally</span></span>
<span id="cb20-13">        va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bottom'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Position text at the bottom</span></span>
<span id="cb20-14">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb20-15">    )</span>
<span id="cb20-16"></span>
<span id="cb20-17">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days"</span>)</span>
<span id="cb20-18">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cumulative Value (%)"</span>)</span>
<span id="cb20-19">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Profil de liquidation du portefeuille"</span>)</span>
<span id="cb20-20">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb20-21"></span>
<span id="cb20-22">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Pour voir ce qui arrive au profil d‚Äô√©coulement lorsque les quantit√©s varient, on va utiliser un facteur de modulation de la quantit√©. Cela permet de d√©terminer quelle est la taille cible du portefeuille qui permet d‚Äôavoir la liquidit√© pour un certain niveau en nombre de jours qu‚Äôon se fixe. Cet exercice est fait une seule fois √† l‚Äôinitialisation du portefeuille.</p>
<p>Pour facilier l‚Äôimpl√©mentation, nous allons utiliser une fonction <code>liquidation_profile</code> qui va nous permettre de calculer le profil d‚Äô√©coulement du portefeuille, en int√©grant le facteur de modulation. Lorsqu‚Äôon ne souhaite pas de modulation, on peut simplement passer un facteur de modulation de 1.</p>
<div id="e1d99b5a" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> waterfall_liquidation(ADV, price_dict, selected_assets, fact_modulation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.30</span>, plot_graphs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>):</span>
<span id="cb21-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb21-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcule le profil de liquidation et visualise les graphiques des poids et des valeurs cumul√©es.</span></span>
<span id="cb21-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb21-5">    </span>
<span id="cb21-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des quantit√©s liquid√©es</span></span>
<span id="cb21-7">    ADV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV.copy()</span>
<span id="cb21-8">    ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> fact_modulation)</span>
<span id="cb21-9"></span>
<span id="cb21-10">    ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb21-11">    quantity_liquidated_per_day <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>]]</span>
<span id="cb21-12">    </span>
<span id="cb21-13">    time_elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> </span>
<span id="cb21-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des quantit√©s liquid√©es par jour</span></span>
<span id="cb21-15">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> (ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>]).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> :</span>
<span id="cb21-16">        liquidated_today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.minimum(</span>
<span id="cb21-17">            ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity in 1day"</span>], </span>
<span id="cb21-18">            ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>]</span>
<span id="cb21-19">        )</span>
<span id="cb21-20">        ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> liquidated_today</span>
<span id="cb21-21">        quantity_liquidated_per_day.append(liquidated_today)</span>
<span id="cb21-22">        time_elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb21-23">    </span>
<span id="cb21-24">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Temps de liquidation du portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>time_elapsed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> jours"</span>)</span>
<span id="cb21-25">    </span>
<span id="cb21-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Conversion des r√©sultats en DataFrame</span></span>
<span id="cb21-27">    liquidation_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(quantity_liquidated_per_day).T</span>
<span id="cb21-28">    liquidation_df.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(quantity_liquidated_per_day))]</span>
<span id="cb21-29">    </span>
<span id="cb21-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la valeur liquide par actif et par jour</span></span>
<span id="cb21-31">    market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb21-32">        price_dict[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> liquidation_df.loc[ticker]</span>
<span id="cb21-33">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> selected_assets</span>
<span id="cb21-34">    ]</span>
<span id="cb21-35">    market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(market_value, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>liquidation_df.columns)</span>
<span id="cb21-36">    </span>
<span id="cb21-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb21-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des poids par jour #</span></span>
<span id="cb21-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb21-40"></span>
<span id="cb21-41">    market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb21-42">    total_market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_0.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb21-43"></span>
<span id="cb21-44">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)</span></span>
<span id="cb21-45">    cumsum_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:].cumsum(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb21-46">    cumsum_total_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).cumsum()</span>
<span id="cb21-47">    cumsum_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([pd.DataFrame(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>market_value.index, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), cumsum_market_value], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb21-48">    cumsum_total_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([pd.Series(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), cumsum_total_market_value])</span>
<span id="cb21-49"></span>
<span id="cb21-50">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb21-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> selected_assets :</span>
<span id="cb21-52">        weights[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (market_value_0.loc[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cumsum_market_value.loc[ticker]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (total_market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cumsum_total_market_value)</span>
<span id="cb21-53"></span>
<span id="cb21-54">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(weights).T</span>
<span id="cb21-55">    </span>
<span id="cb21-56">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualisation des poids</span></span>
<span id="cb21-57">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> plot_graphs:</span>
<span id="cb21-58">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialiser le graphique</span></span>
<span id="cb21-59">        plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb21-60">        </span>
<span id="cb21-61"></span>
<span id="cb21-62">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Barplot empil√©</span></span>
<span id="cb21-63">        bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb21-64">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> asset <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights.index:</span>
<span id="cb21-65">            plt.bar(</span>
<span id="cb21-66">                pd.to_numeric(weights.columns), </span>
<span id="cb21-67">                weights.loc[asset],  </span>
<span id="cb21-68">                bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bottom, </span>
<span id="cb21-69">                label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets[asset]  </span>
<span id="cb21-70">            )</span>
<span id="cb21-71">            bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weights.loc[asset] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> bottom <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> weights.loc[asset]</span>
<span id="cb21-72"></span>
<span id="cb21-73">        plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of Liquidation"</span>)</span>
<span id="cb21-74">        plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Portfolio Weights"</span>)</span>
<span id="cb21-75">        plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©formation du portefeuille"</span>)</span>
<span id="cb21-76">        plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb21-77">        plt.legend(title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assets"</span>, bbox_to_anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper left"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, ncol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb21-78">        plt.tight_layout()</span>
<span id="cb21-79"></span>
<span id="cb21-80">        plt.show()</span>
<span id="cb21-81"></span>
<span id="cb21-82">    </span>
<span id="cb21-83">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb21-84">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   Profil de liquidation   #</span></span>
<span id="cb21-85">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb21-86"></span>
<span id="cb21-87">    market_value_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame()</span>
<span id="cb21-88">    market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb21-89">    </span>
<span id="cb21-90">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des valeurs relatives et cumul√©es</span></span>
<span id="cb21-91">    market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"relative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>].iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb21-92">    market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"relative value"</span>].cumsum() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb21-93">    market_value_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df.iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retirer le jour 0 pour l'analyse cumul√©e</span></span>
<span id="cb21-94">    </span>
<span id="cb21-95">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualisation de la valeur cumulative (barplot)</span></span>
<span id="cb21-96">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> plot_graphs:</span>
<span id="cb21-97">        plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb21-98">        bars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.bar(market_value_df.index, market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skyblue"</span>)</span>
<span id="cb21-99">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> bar <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> bars:</span>
<span id="cb21-100">            height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bar.get_height()</span>
<span id="cb21-101">            plt.text(</span>
<span id="cb21-102">                bar.get_x() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bar.get_width() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Center text</span></span>
<span id="cb21-103">                height,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Position slightly above the bar</span></span>
<span id="cb21-104">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>height<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Format with 2 decimal places</span></span>
<span id="cb21-105">                ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Center horizontally</span></span>
<span id="cb21-106">                va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bottom'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Position text at the bottom</span></span>
<span id="cb21-107">                fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb21-108">            )</span>
<span id="cb21-109">        plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days"</span>)</span>
<span id="cb21-110">        plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cumulative Value (%)"</span>)</span>
<span id="cb21-111">        plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Profil de liquidation du portefeuille"</span>)</span>
<span id="cb21-112">        plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb21-113">        plt.show()</span>
<span id="cb21-114"></span>
<span id="cb21-115">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> market_value_df, market_value, weights</span></code></pre></div>
</div>
<p>Nous constatons qu‚Äôen utilisant un facteur de modulation de 0.3, le temps de liquidation est r√©duit √† 3 jours, ce qui est plus rapide que le temps de liquidation initial de 8 jours. Cela montre l‚Äôimpact significatif de la modulation sur le profil de liquidation du portefeuille.</p>
<div id="29484170" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1">fact_modulation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3</span></span>
<span id="cb22-2">new_market_value_df, new_market_value, new_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> waterfall_liquidation(ADV, price_dict, selected_assets, fact_modulation, plot_graphs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 3 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-17-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-17-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sous-conditions-stress√©es-avec-d√©formation" class="level3">
<h3 class="anchored" data-anchor-id="sous-conditions-stress√©es-avec-d√©formation">Sous conditions stress√©es avec d√©formation</h3>
<p>Pour stresser le portefeuille, √† la baisse, on va diviser la profondeur de march√© par 2. Cela signifie que l‚Äôon peut vendre moins d‚Äôactifs sans impacter le prix de mani√®re significative. En cons√©quence, le temps de liquidation augmente, car il faut plus de temps pour liquider la m√™me quantit√© d‚Äôactifs. Il est √©galement possible d‚Äôavoir des conditions stress√©es √† la hausse, o√π l‚Äôon multiplie la profondeur de march√© par 2. Cela signifie que l‚Äôon peut vendre plus d‚Äôactifs sans impacter le prix de mani√®re significative. En cons√©quence, le temps de liquidation diminue, car il faut moins de temps pour liquider la m√™me quantit√© d‚Äôactifs.</p>
<p>Dans notre cas, en stressant le portefeuille √† la baisse, nous constatons que le temps de liquidation augmente. On passe de 8 jours de liquidatin √† 15 jours.</p>
<div id="a0269a81" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb24-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Stress Test</span></span>
<span id="cb24-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb24-4">ADV_stressed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV.copy()</span>
<span id="cb24-5"></span>
<span id="cb24-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Quantit√© journali√®re</span></span>
<span id="cb24-7">market_depth <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># On stresse la liquidit√© √† la baisse</span></span>
<span id="cb24-8">ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity in 1day"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ADV"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> market_depth)</span>
<span id="cb24-9"></span>
<span id="cb24-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du nombre de jours de liquidation</span></span>
<span id="cb24-11">ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of liquidation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity in 1day"</span>]</span>
<span id="cb24-12"></span>
<span id="cb24-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># floor to 1 and round</span></span>
<span id="cb24-14">ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of liquidation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of liquidation"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(x)))</span>
<span id="cb24-15"></span>
<span id="cb24-16">time_elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV_stressed[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Days of liquidation'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb24-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Temps de liquidation du portefeuille stress√©: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>time_elapsed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> jours"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille stress√©: 15 jours</code></pre>
</div>
</div>
<div id="5edb266f" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1">stressed_market_value_df, stressed_market_value, stressed_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> waterfall_liquidation(ADV<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ADV_stressed, price_dict<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>price_dict, selected_assets<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets, fact_modulation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, plot_graphs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 15 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-19-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-19-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="absence-de-d√©formation-du-portefeuille-pro-forma" class="level2">
<h2 class="anchored" data-anchor-id="absence-de-d√©formation-du-portefeuille-pro-forma">Absence de d√©formation du portefeuille (pro forma)</h2>
<p>Nous avons vu dans la section pr√©c√©dente que, lors de la liquidation d‚Äôun portefeuille, on a tendance √† commencer par les actifs les plus liquides. Cela conduit √† une concentration progressive d‚Äôactifs illiquides dans le portefeuille r√©siduel, ce qui peut affecter significativement sa valeur et accro√Ætre le risque de liquidit√©.</p>
<p>Dans cette section, nous allons √©tudier comment √©viter cette d√©formation en proc√©dant √† une liquidation proportionnelle : l‚Äôobjectif est de pr√©server la r√©partition initiale du portefeuille tout au long du processus de liquidation.</p>
<p>Pour cela, on commence par estimer, comme pr√©c√©demment, la quantit√© liquidable en un jour pour chaque titre. Cette estimation permet d‚Äôen d√©duire le pourcentage liquidable quotidien par rapport √† la position totale sur chaque actif. Si l‚Äôon souhaite que tous les titres soient liquid√©s √† la m√™me vitesse, il faut adopter le rythme de liquidation de l‚Äôactif le plus lent. Ainsi, on calcule le pourcentage liquidable en un jour pour chaque titre, puis on en retient le minimum. Ce minimum d√©finit alors le pourcentage quotidien de liquidation appliqu√© √† l‚Äôensemble du portefeuille. Ce proc√©d√© allonge la dur√©e totale de liquidation, mais il permet de conserver une structure de portefeuille stable. N√©anmoins, une l√©g√®re d√©formation peut subsister, notamment en raison des arrondis et des limites pratiques de liquidit√© sur certains actifs.</p>
<div id="3581d48b" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb28-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb28-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb28-4"></span>
<span id="cb28-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> pro_forma_liquidation(ADV, price_dict, selected_assets, fact_modulation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.30</span>, plot_graphs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>):</span>
<span id="cb28-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb28-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcule le profil de liquidation pro forma et visualise les graphiques des poids et des valeurs cumul√©es.</span></span>
<span id="cb28-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb28-9"></span>
<span id="cb28-10">    ADV <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV.copy()</span>
<span id="cb28-11">    ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> fact_modulation</span>
<span id="cb28-12"></span>
<span id="cb28-13">    time_elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Days of liquidation'</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb28-14"></span>
<span id="cb28-15">    ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb28-16">    quantity_liquidated_per_day <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>]]</span>
<span id="cb28-17">    </span>
<span id="cb28-18">    min_liquidated_today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.ones(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>]))</span>
<span id="cb28-19">    time_elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> </span>
<span id="cb28-20"></span>
<span id="cb28-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des quantit√©s liquid√©es par jour</span></span>
<span id="cb28-22">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> min_liquidated_today.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:  </span>
<span id="cb28-23"></span>
<span id="cb28-24">        liquidated_today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.minimum(</span>
<span id="cb28-25">            ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity in 1day"</span>], </span>
<span id="cb28-26">            ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>]</span>
<span id="cb28-27">        ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>]</span>
<span id="cb28-28">        min_liquidated_today <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(liquidated_today) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity"</span>])<span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># On liquide √† la vitesse de l'actif le moins liquide</span></span>
<span id="cb28-29">        ADV[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quantity liquidated"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> min_liquidated_today</span>
<span id="cb28-30">        quantity_liquidated_per_day.append(min_liquidated_today)</span>
<span id="cb28-31">        time_elapsed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb28-32">    </span>
<span id="cb28-33">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Temps de liquidation du portefeuille : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>time_elapsed<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> jours"</span>)</span>
<span id="cb28-34">    </span>
<span id="cb28-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Conversion des r√©sultats en DataFrame</span></span>
<span id="cb28-36">    liquidation_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(quantity_liquidated_per_day).T</span>
<span id="cb28-37">    liquidation_df.columns <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(quantity_liquidated_per_day))]</span>
<span id="cb28-38">    </span>
<span id="cb28-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la valeur liquide par actif et par jour</span></span>
<span id="cb28-40">    market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb28-41">        price_dict[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> liquidation_df.loc[ticker]</span>
<span id="cb28-42">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> selected_assets</span>
<span id="cb28-43">    ]</span>
<span id="cb28-44">    market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(market_value, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>liquidation_df.columns)</span>
<span id="cb28-45">    </span>
<span id="cb28-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb28-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des poids par jour</span></span>
<span id="cb28-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb28-49"></span>
<span id="cb28-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la valeur de march√© initiale et totale</span></span>
<span id="cb28-51">    market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb28-52">    total_market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_0.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb28-53"></span>
<span id="cb28-54">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la valeur de march√© cumul√©e (√† partir de la colonne 1)</span></span>
<span id="cb28-55">    cumsum_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:].cumsum(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb28-56">    cumsum_total_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.iloc[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).cumsum()</span>
<span id="cb28-57">    cumsum_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([pd.DataFrame(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>market_value.index, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), cumsum_market_value], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb28-58">    cumsum_total_market_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([pd.Series(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), cumsum_total_market_value])</span>
<span id="cb28-59">    </span>
<span id="cb28-60">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb28-61">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ticker <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> selected_assets :</span>
<span id="cb28-62">        weights[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (market_value_0.loc[ticker] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cumsum_market_value.loc[ticker]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (total_market_value_0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> cumsum_total_market_value)</span>
<span id="cb28-63"></span>
<span id="cb28-64">    weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(weights).T</span>
<span id="cb28-65"></span>
<span id="cb28-66">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> plot_graphs:</span>
<span id="cb28-67">        plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb28-68"></span>
<span id="cb28-69">        bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb28-70">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> asset <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> weights.index:</span>
<span id="cb28-71">            plt.bar(</span>
<span id="cb28-72">                pd.to_numeric(weights.columns), </span>
<span id="cb28-73">                weights.loc[asset],  </span>
<span id="cb28-74">                bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bottom, </span>
<span id="cb28-75">                label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets[asset]  </span>
<span id="cb28-76">            )</span>
<span id="cb28-77">            bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> weights.loc[asset] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> bottom <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> bottom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> weights.loc[asset]</span>
<span id="cb28-78"></span>
<span id="cb28-79">        plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days of Liquidation"</span>)</span>
<span id="cb28-80">        plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Portfolio Weights"</span>)</span>
<span id="cb28-81">        plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"D√©formation du portefeuille"</span>)</span>
<span id="cb28-82">        plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb28-83">        plt.legend(title<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assets"</span>, bbox_to_anchor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper left"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, ncol<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb28-84">        plt.tight_layout()</span>
<span id="cb28-85">        plt.show()</span>
<span id="cb28-86"></span>
<span id="cb28-87">    </span>
<span id="cb28-88">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb28-89">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   Profil de liquidation   #</span></span>
<span id="cb28-90">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#---------------------------#</span></span>
<span id="cb28-91">    </span>
<span id="cb28-92">    market_value_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame()</span>
<span id="cb28-93">    market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb28-94">    </span>
<span id="cb28-95">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul des valeurs relatives et cumul√©es</span></span>
<span id="cb28-96">    market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"relative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"market_value"</span>].iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb28-97">    market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"relative value"</span>].cumsum() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb28-98">    market_value_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> market_value_df.iloc[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Retirer le jour 0 pour l'analyse cumul√©e</span></span>
<span id="cb28-99">    </span>
<span id="cb28-100">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualisation de la valeur cumulative (barplot)</span></span>
<span id="cb28-101">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> plot_graphs:</span>
<span id="cb28-102">        plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb28-103">        bars <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.bar(market_value_df.index, market_value_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cumulative value"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"skyblue"</span>)</span>
<span id="cb28-104">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> bar <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> bars:</span>
<span id="cb28-105">            height <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bar.get_height()</span>
<span id="cb28-106">            plt.text(</span>
<span id="cb28-107">                bar.get_x() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> bar.get_width() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Center text</span></span>
<span id="cb28-108">                height,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Position slightly above the bar</span></span>
<span id="cb28-109">                <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>height<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Format with 2 decimal places</span></span>
<span id="cb28-110">                ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'center'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Center horizontally</span></span>
<span id="cb28-111">                va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'bottom'</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Position text at the bottom</span></span>
<span id="cb28-112">                fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span></span>
<span id="cb28-113">            )</span>
<span id="cb28-114">        plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Days"</span>)</span>
<span id="cb28-115">        plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cumulative Value (%)"</span>)</span>
<span id="cb28-116">        plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Profil de liquidation du portefeuille"</span>)</span>
<span id="cb28-117">        plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb28-118">        plt.show()</span>
<span id="cb28-119">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> market_value_df, market_value, weights</span></code></pre></div>
</div>
<section id="sous-condition-normale-sans-d√©formation" class="level3">
<h3 class="anchored" data-anchor-id="sous-condition-normale-sans-d√©formation">Sous condition normale sans d√©formation</h3>
<div id="310b4371" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1">proforma_market_value_df, proforma_market_value, proforma_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pro_forma_liquidation(ADV<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ADV, price_dict<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>price_dict, selected_assets<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets, fact_modulation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, plot_graphs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 9 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-21-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-21-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sous-conditions-stress√©es-sans-d√©formation" class="level3">
<h3 class="anchored" data-anchor-id="sous-conditions-stress√©es-sans-d√©formation">Sous conditions stress√©es sans d√©formation</h3>
<div id="e83d383e" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1">proforma_s_market_value_df, proforma_s_market_value, proforma_s_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pro_forma_liquidation(ADV<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ADV_stressed, price_dict<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>price_dict, selected_assets<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selected_assets, fact_modulation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, plot_graphs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Temps de liquidation du portefeuille : 16 jours</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-22-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2_files/figure-html/cell-22-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>La liquidation d‚Äôun portefeuille est un exercice complexe qui n√©cessite de prendre en compte plusieurs facteurs : la liquidit√© des actifs, la taille du portefeuille, et les conditions de march√©. En utilisant des outils tels que le profil d‚Äô√©coulement (ou profil de liquidation), les investisseurs peuvent mieux anticiper l‚Äôimpact potentiel de leurs transactions sur les prix de march√©, et ainsi minimiser l‚Äôeffet de march√©.</p>
<p>Le processus de liquidation choisi peut conduire √† des rythmes de sortie diff√©rents, et il est essentiel d‚Äôen tenir compte dans la gestion active du portefeuille.</p>
<p>Pour pr√©server la liquidit√© d‚Äôun portefeuille, notamment en p√©riode de tension sur les march√©s, plusieurs m√©canismes r√©glementaires et op√©rationnels existent. Ils visent √† prot√©ger les investisseurs restants et √† maintenir la qualit√© du portefeuille. En cas de crise financi√®re ou de forte volatilit√©, les soci√©t√©s de gestion de portefeuille (SGP) peuvent activer ces dispositifs, conform√©ment aux dispositions pr√©vues par la r√©glementation.</p>
<p>Ces mesures permettent d‚Äô√©viter des ventes forc√©es d‚Äôactifs et de limiter les effets de contagion sur le reste du portefeuille.</p>
<p><strong>Principaux m√©canismes de gestion de la liquidit√© :</strong></p>
<ol type="1">
<li><p>Les gates (plafonnement de rachat)</p>
<p>Les gates permettent de limiter les rachats quotidiens √† un certain pourcentage de l‚Äôactif net du fonds. En g√©n√©ral, si les rachats d√©passent 5‚ÄØ% de l‚Äôactif net, la SGP a le droit (mais non l‚Äôobligation) de n‚Äôhonorer que les premiers 5‚ÄØ% et de reporter le reste sur les jours suivants, en fonction des conditions de march√©.</p>
<p>Ce m√©canisme permet de r√©duire l‚Äôimpact sur les prix de march√©, en √©vitant une vente massive d‚Äôactifs en un seul jour. C‚Äôest une mesure de protection des porteurs restants, bien que son activation soit souvent per√ßue comme un signal n√©gatif.</p>
<p>L‚Äôexistence du m√©canisme des gates doit figurer dans le prospectus du fonds, sauf justification sp√©cifique de la SGP. Il convient de noter que l‚Äôactivation des gates est optionnelle.</p></li>
<li><p><strong>La suspension des souscriptions et des rachats</strong></p>
<p>Il s‚Äôagit d‚Äôune mesure plus radicale, qui consiste √† geler temporairement les op√©rations d‚Äôentr√©e et de sortie du fonds. Elle est utilis√©e dans des situations exceptionnelles, telles que des crises de march√© ou une volatilit√© extr√™me, lorsque la valorisation des actifs devient incertaine ou que la liquidit√© dispara√Æt. Ce m√©canisme vise √† : pr√©server l‚Äô√©galit√© de traitement entre les investisseurs, √©viter des ventes pr√©cipit√©es d‚Äôactifs, stabiliser la structure du portefeuille. La suspension doit √™tre justifi√©e et temporaire, et elle est lev√©e d√®s que les conditions de march√© se normalisent.</p></li>
<li><p><strong>Les m√©canismes de d√©formation du portefeuille</strong></p>
<p>Il s‚Äôagit de mesures proactives consistant √† adapter la composition du portefeuille lors des rachats, pour pr√©server la liquidit√© r√©siduelle. Concr√®tement, la SGP peut choisir de vendre en priorit√© les actifs les plus liquides, ce qui permet de r√©pondre rapidement aux demandes de rachat sans impacter significativement les prix. Ces m√©canismes sont particuli√®rement utilis√©s en cas de rachats massifs, pour : limiter l‚Äôimpact de march√©, prot√©ger les investisseurs restants, √©viter une d√©stabilisation du portefeuille.</p>
<p>N√©anmoins, cela entra√Æne une d√©formation du portefeuille, c‚Äôest-√†-dire que les investisseurs qui restent se retrouvent avec une part moins liquide du portefeuille initial. Ce compromis doit √™tre g√©r√© avec prudence.</p></li>
</ol>


</section>

 ]]></description>
  <category>paper</category>
  <category>asset-management</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/gestion_actifs/TP-2.html</guid>
  <pubDate>Sun, 26 Jan 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Calibration du mod√®le √† volatilit√© stochastique de Taylor : Filtre particulaire</title>
  <link>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2.html</link>
  <description><![CDATA[ 




<section id="estimation-du-mod√®le-sv-de-taylor-par-filtrage-particulaire-part-2-a" class="level1">
<h1>Estimation du mod√®le SV de Taylor par filtrage particulaire (Part 2-a)</h1>
<p>Le mod√®le classique de volatilit√© stochastique est d√©fini par les √©quations suivantes :</p>
<ol type="1">
<li><p><strong>Processus des rendements</strong> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%20r_t%20=%20%5Cexp(x_t%20/%202)%20%5Ccdot%20%5Cvarepsilon_t,%20%5Cquad%20%5Cvarepsilon_t%20%5Csim%20N(0,1)%20"></p></li>
<li><p><strong>Processus de la volatilit√© logarithmique</strong> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%20x_t%20=%20%5Cmu%20+%20%5Cphi%20x_%7Bt-1%7D%20+%20%5Csigma_t%20%5Ceta_t,%20%5Cquad%20%5Ceta_t%20%5Csim%20N(0,1)%20"></p></li>
</ol>
<ul>
<li><p>( x_t ) suit un processus autor√©gressif de premier ordre (<strong>AR(1)</strong>) et suit une distribution normale conditionnelle : <img src="https://latex.codecogs.com/png.latex?%20p(x_t)%20%5Csim%20N(%5Cfrac%7B%5Cmu%7D%7B1-%5Cphi%7D%20,%20%5Cfrac%7B%5Csigma_t%5E2%7D%7B1-%5Cphi%5E2%7D)%20"></p>
<p><img src="https://latex.codecogs.com/png.latex?%20x_t%20%7C%20x_%7Bt-1%7D%20%5Csim%20N(%5Cmu%20+%20%5Cphi%20x_%7Bt-1%7D,%20%5Csigma_t%5E2)%20"></p></li>
<li><p>( r_t ) suit une distribution <strong>normale conditionnelle</strong> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%20r_t%20%7C%20x_t%20%5Csim%20N(0,%20%5Cexp(x_t))%20"></p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation d'un mod√®le √† vol stochastique de Taylor</span></span>
<span id="cb1-4">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span></span>
<span id="cb1-5">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb1-6">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span></span>
<span id="cb1-7">sigma_squared <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.09</span></span>
<span id="cb1-8"></span>
<span id="cb1-9">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Log-volatilit√©</span></span>
<span id="cb1-10">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rendements simul√©s</span></span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb1-13">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb1-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© de transition stationnaire de x_t</span></span>
<span id="cb1-15">    x[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb1-16">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb1-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># √âvolution de l'√©tat</span></span>
<span id="cb1-18">    x[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-19">  }</span>
<span id="cb1-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation des rendements</span></span>
<span id="cb1-21">  r[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-22">}</span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extraction dans fichier csv</span></span>
<span id="cb1-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(r, x), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"true_sv_taylor.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√© simul√©"</span>)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements simul√©s"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<section id="filtre-bootstrap-avec-les-rendements" class="level2">
<h2 class="anchored" data-anchor-id="filtre-bootstrap-avec-les-rendements">Filtre bootstrap avec les rendements</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mu,phi,sigma_squared)</span>
<span id="cb3-2">params</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.80  0.90  0.09</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define parameters (ensure they are properly initialized)</span></span>
<span id="cb5-4">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb5-5">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb5-6">sigma_squared <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]</span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Definition des variables</span></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des param√®tres</span></span>
<span id="cb5-10">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(r)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre d'observations</span></span>
<span id="cb5-11">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre de particules</span></span>
<span id="cb5-12"></span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des matrices et vecteurs</span></span>
<span id="cb5-14">x_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)                   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation de x</span></span>
<span id="cb5-15">x_particle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Particules</span></span>
<span id="cb5-16">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids des particules</span></span>
<span id="cb5-17">w_normalized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids normalis√©s</span></span>
<span id="cb5-18"></span>
<span id="cb5-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtre particulaire bootstrap</span></span>
<span id="cb5-20"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb5-21">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb5-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des particules √† t = 0</span></span>
<span id="cb5-23">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb5-24">    </span>
<span id="cb5-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids initiaux (bas√©s sur la distribution de l'√©tat initial)</span></span>
<span id="cb5-26">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x_particle[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb5-27">    </span>
<span id="cb5-28">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalisation des poids</span></span>
<span id="cb5-29">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb5-30">    </span>
<span id="cb5-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation initiale</span></span>
<span id="cb5-32">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb5-33">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb5-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  √âtape de pr√©diction (√©chantillonnage de nouvelles particules)</span></span>
<span id="cb5-35">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared))</span>
<span id="cb5-36">    </span>
<span id="cb5-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Mise √† jour des poids avec la vraisemblance de l'observation</span></span>
<span id="cb5-38">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(r[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x_particle[t, ])))</span>
<span id="cb5-39">    </span>
<span id="cb5-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Normalisation des poids</span></span>
<span id="cb5-41">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb5-42">    </span>
<span id="cb5-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  R√©√©chantillonnage des particules selon leurs poids</span></span>
<span id="cb5-44">    index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> w_normalized[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-45">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x_particle[t, index]</span>
<span id="cb5-46">    </span>
<span id="cb5-47">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©initialisation des poids apr√®s r√©√©chantillonnage (uniforme)</span></span>
<span id="cb5-48">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> M</span>
<span id="cb5-49">    </span>
<span id="cb5-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Estimation de x √† l'instant t (pond√©r√©e)</span></span>
<span id="cb5-51">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb5-52">  }</span>
<span id="cb5-53">}</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute MSE</span></span>
<span id="cb6-2">mse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE:"</span>, mse, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE: 0.2403607 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le Taylor"</span>)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x_hat,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb9-2"></span>
<span id="cb9-3">r_est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x_hat), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb9-4"></span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the estimate and the true state</span></span>
<span id="cb9-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log-returns"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le Taylor"</span>)</span>
<span id="cb9-7"></span>
<span id="cb9-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Superposition des trajectoires</span></span>
<span id="cb9-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(r_est, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend</span></span>
<span id="cb9-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="filtre-bootstrap-sur-le-mod√®le-log-sv-de-taylor" class="level2">
<h2 class="anchored" data-anchor-id="filtre-bootstrap-sur-le-mod√®le-log-sv-de-taylor">Filtre bootstrap sur le mod√®le log-sv de taylor</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb10-2"></span>
<span id="cb10-3">y_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)</span>
<span id="cb10-4">w_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)</span>
<span id="cb10-5">x_particle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb10-6">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb10-7">w_normalized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb10-8">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-9"></span>
<span id="cb10-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© d'une log chi-deux de df 1</span></span>
<span id="cb10-11">log_chi2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb10-12">  density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>( (x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pi)</span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>( density)</span>
<span id="cb10-14">}</span>
<span id="cb10-15"></span>
<span id="cb10-16"></span>
<span id="cb10-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtre particulaire bootstrap</span></span>
<span id="cb10-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb10-19">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb10-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des particules √† t = 0</span></span>
<span id="cb10-21">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb10-22">    </span>
<span id="cb10-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids initiaux (bas√©s sur la distribution de l'√©tat initial)</span></span>
<span id="cb10-24">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x_particle[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb10-25">    </span>
<span id="cb10-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalisation des poids</span></span>
<span id="cb10-27">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb10-28">    </span>
<span id="cb10-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation initiale</span></span>
<span id="cb10-30">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb10-31">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb10-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  √âtape de pr√©diction (√©chantillonnage de nouvelles particules)</span></span>
<span id="cb10-33">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared))</span>
<span id="cb10-34">    </span>
<span id="cb10-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Mise √† jour des poids avec la vraisemblance de l'observation</span></span>
<span id="cb10-36">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log_chi2</span>(y[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_particle[t,])</span>
<span id="cb10-37">    </span>
<span id="cb10-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Normalisation des poids</span></span>
<span id="cb10-39">    w_normalized[t,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t,])</span>
<span id="cb10-40">    </span>
<span id="cb10-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  R√©√©chantillonnage des particules selon leurs poids</span></span>
<span id="cb10-42">    index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> w_normalized[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb10-43">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x_particle[t, index]</span>
<span id="cb10-44">    </span>
<span id="cb10-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©initialisation des poids apr√®s r√©√©chantillonnage (uniforme)</span></span>
<span id="cb10-46">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> M</span>
<span id="cb10-47">    </span>
<span id="cb10-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Estimation de x √† l'instant t (pond√©r√©e)</span></span>
<span id="cb10-49">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb10-50">  }</span>
<span id="cb10-51">}</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute MSE</span></span>
<span id="cb11-2">mse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE:"</span>, mse, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE: 0.3450866 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le log-sv"</span>)</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x_hat,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>)</span>
<span id="cb13-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb14-2"></span>
<span id="cb14-3">r_est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x_hat), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb14-4"></span>
<span id="cb14-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the estimate and the true state</span></span>
<span id="cb14-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log-returns"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le log-sv"</span>)</span>
<span id="cb14-7"></span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Superposition des trajectoires</span></span>
<span id="cb14-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(r_est, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>)</span>
<span id="cb14-10"></span>
<span id="cb14-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend</span></span>
<span id="cb14-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="estimation-du-mod√®le-sv-de-taylor-par-filtrage-particulaire-version-pmhtutorial---part-2-b" class="level1">
<h1>Estimation du mod√®le SV de Taylor par filtrage particulaire (Version pmhtutorial - Part 2-b)</h1>
<p>Le mod√®le de volatilit√© stochastique modifi√© est d√©fini par les √©quations suivantes :</p>
<ol type="1">
<li><p><strong>Processus des rendements</strong> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%20r_t%20=%20%5Cexp(x_t%20/%202)%20%5Ccdot%20%5Cvarepsilon_t,%20%5Cquad%20%5Cvarepsilon_t%20%5Csim%20N(0,1)%20"></p></li>
<li><p><strong>Processus de la volatilit√© logarithmique</strong> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%20x_t%20=%20%5Cmu%20+%20%5Cphi%20%5Ctimes%20(x_%7Bt-1%7D-%5Cmu)%20+%20%5Csigma_t%20%5Ceta_t,%20%5Cquad%20%5Ceta_t%20%5Csim%20N(0,1)%20"></p></li>
</ol>
<ul>
<li><p>( x_t ) suit un processus autor√©gressif de premier ordre (<strong>AR(1)</strong>) et suit une distribution normale conditionnelle : <img src="https://latex.codecogs.com/png.latex?%20p(x_t)%20%5Csim%20N(%5Cmu%20,%20%5Cfrac%7B%5Csigma_t%5E2%7D%7B1-%5Cphi%5E2%7D)%20"> <img src="https://latex.codecogs.com/png.latex?%20x_t%20%7C%20x_%7Bt-1%7D%20%5Csim%20N(%5Cmu%20+%20%5Cphi%20%5Ctimes%20(x_%7Bt-1%7D-%5Cmu)%20,%20%5Csigma_t%5E2)%20"></p></li>
<li><p>( r_t ) suit une distribution <strong>normale conditionnelle</strong> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%20r_t%20%7C%20x_t%20%5Csim%20N(0,%20%5Cexp(x_t))%20"> <img src="https://latex.codecogs.com/png.latex?r_t%20=%20exp(x_t/2)*%20%5Cvarepsilon_t"> <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon_t"> ~ N(0,1) <img src="https://latex.codecogs.com/png.latex?x_t%20=%20%5Cmu%20+%20%5Cphi%20*%20(x_%7Bt-1%7D%20-%20%5Cmu)%20+%20%5Csigma_t%20*%20%5Ceta_t"> (eta_t ~ N(0,1))</p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span>())</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb16-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span></span>
<span id="cb16-3">mu <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb16-4">phi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span></span>
<span id="cb16-5">sigma_squared <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.09</span></span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation d'un mod√®le √† vol stochastique de Taylor (modifi√©)</span></span>
<span id="cb16-8">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Log-volatilit√©</span></span>
<span id="cb16-9">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rendements simul√©s</span></span>
<span id="cb16-10"></span>
<span id="cb16-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb16-12">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb16-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© de transition stationnaire de x_t</span></span>
<span id="cb16-14">    x[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb16-15">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb16-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># √âvolution de l'√©tat</span></span>
<span id="cb16-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#    x[t] &lt;- mu + phi * (x[t-1]) + sqrt(sigma_squared) * rnorm(1, mean = 0, sd = 1)</span></span>
<span id="cb16-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                       ^^^^^^ True model. To be able to use pmhtutorial package, use the following formula</span></span>
<span id="cb16-19">    x[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (x[t<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">-1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-20">  }</span>
<span id="cb16-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation des rendements</span></span>
<span id="cb16-22">  r[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb16-23">}</span>
<span id="cb16-24"></span>
<span id="cb16-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># extraction dans fichier csv</span></span>
<span id="cb16-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">write.csv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(r, x), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mod_log_sv.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">row.names =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb17-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√© simul√©"</span>)</span>
<span id="cb17-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements simul√©s"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<section id="filtre-bootstrap-avec-les-rendements-1" class="level2">
<h2 class="anchored" data-anchor-id="filtre-bootstrap-avec-les-rendements-1">Filtre bootstrap avec les rendements</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb18-2"></span>
<span id="cb18-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Definition des variables</span></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># D√©finition des param√®tres</span></span>
<span id="cb18-5"></span>
<span id="cb18-6">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mu,phi,sigma_squared)</span>
<span id="cb18-7"></span>
<span id="cb18-8">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(r)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre d'observations</span></span>
<span id="cb18-9">M <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nombre de particules</span></span>
<span id="cb18-10"></span>
<span id="cb18-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des matrices et vecteurs</span></span>
<span id="cb18-12">x_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)                   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation de x</span></span>
<span id="cb18-13">x_particle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Particules</span></span>
<span id="cb18-14">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids des particules</span></span>
<span id="cb18-15">w_normalized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids normalis√©s</span></span>
<span id="cb18-16"></span>
<span id="cb18-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtre particulaire bootstrap</span></span>
<span id="cb18-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb18-19">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb18-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des particules √† t = 0</span></span>
<span id="cb18-21">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb18-22">    </span>
<span id="cb18-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids initiaux (bas√©s sur la distribution de l'√©tat initial)</span></span>
<span id="cb18-24">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x_particle[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb18-25">    </span>
<span id="cb18-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalisation des poids</span></span>
<span id="cb18-27">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb18-28">    </span>
<span id="cb18-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation initiale</span></span>
<span id="cb18-30">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb18-31">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb18-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  √âtape de pr√©diction (√©chantillonnage de nouvelles particules)</span></span>
<span id="cb18-33">    x_particle[t,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (x_particle[t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared))</span>
<span id="cb18-34">    </span>
<span id="cb18-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Mise √† jour des poids avec la vraisemblance de l'observation</span></span>
<span id="cb18-36">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(r[t], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x_particle[t, ])))</span>
<span id="cb18-37">    </span>
<span id="cb18-38">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Normalisation des poids</span></span>
<span id="cb18-39">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb18-40">    </span>
<span id="cb18-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  R√©√©chantillonnage des particules selon leurs poids</span></span>
<span id="cb18-42">    index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> w_normalized[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb18-43">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x_particle[t, index]</span>
<span id="cb18-44">    </span>
<span id="cb18-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©initialisation des poids apr√®s r√©√©chantillonnage (uniforme)</span></span>
<span id="cb18-46">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> M</span>
<span id="cb18-47">    </span>
<span id="cb18-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Estimation de x √† l'instant t (pond√©r√©e)</span></span>
<span id="cb18-49">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb18-50">  }</span>
<span id="cb18-51">}</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute MSE</span></span>
<span id="cb19-2">mse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb19-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE:"</span>, mse, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE: 0.2403607 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le Taylor"</span>)</span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x_hat,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>)</span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb22-2"></span>
<span id="cb22-3">r_est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x_hat), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb22-4"></span>
<span id="cb22-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the estimate and the true state</span></span>
<span id="cb22-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log-returns"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le Taylor"</span>)</span>
<span id="cb22-7"></span>
<span id="cb22-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Superposition des trajectoires</span></span>
<span id="cb22-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(r_est, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span>
<span id="cb22-10"></span>
<span id="cb22-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend</span></span>
<span id="cb22-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<section id="utilisation-de-librarypmhtutorial" class="level3">
<h3 class="anchored" data-anchor-id="utilisation-de-librarypmhtutorial">Utilisation de library(pmhtutorial)</h3>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(pmhtutorial)</span>
<span id="cb23-2"></span>
<span id="cb23-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># particleFilterSVmodel takes sigma as parameters</span></span>
<span id="cb23-4">params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(params[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb23-5">x_hat_2<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">particleFilterSVmodel</span>(r,params,M)</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log-volatilit√©"</span>)</span>
<span id="cb24-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x_hat_2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xHatFiltered, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√© estim√©"</span>)</span>
<span id="cb24-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend</span></span>
<span id="cb24-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb25-2"></span>
<span id="cb25-3">r_est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x_hat_2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xHatFiltered <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x_hat_2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xHatFiltered), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb25-4"></span>
<span id="cb25-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Superposition des trajectoires</span></span>
<span id="cb25-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log-returns"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb25-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True returns"</span>)</span>
<span id="cb25-8"></span>
<span id="cb25-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(r_est, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>, </span>
<span id="cb25-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated returns"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span>
<span id="cb25-11"></span>
<span id="cb25-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="filtre-bootstrap-sur-le-mod√®le-log-sv-de-taylor-1" class="level2">
<h2 class="anchored" data-anchor-id="filtre-bootstrap-sur-le-mod√®le-log-sv-de-taylor-1">Filtre bootstrap sur le mod√®le log-sv de taylor</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb26-2"></span>
<span id="cb26-3">params <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(mu,phi,sigma_squared)</span>
<span id="cb26-4"></span>
<span id="cb26-5">y_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)</span>
<span id="cb26-6">w_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">numeric</span>(n)</span>
<span id="cb26-7">x_particle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb26-8">w <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb26-9">w_normalized <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol =</span> M)</span>
<span id="cb26-10">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(r<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb26-11"></span>
<span id="cb26-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Densit√© d'une log chi-deux de df 1</span></span>
<span id="cb26-13">log_chi2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb26-14">  density <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>( (x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>pi)</span>
<span id="cb26-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>( density)</span>
<span id="cb26-16">}</span>
<span id="cb26-17"></span>
<span id="cb26-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filtre particulaire bootstrap</span></span>
<span id="cb26-19"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (t <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n) {</span>
<span id="cb26-20">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) {</span>
<span id="cb26-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation des particules √† t = 0</span></span>
<span id="cb26-22">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb26-23">    </span>
<span id="cb26-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Poids initiaux (bas√©s sur la distribution de l'√©tat initial)</span></span>
<span id="cb26-25">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dnorm</span>(x_particle[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)))</span>
<span id="cb26-26">    </span>
<span id="cb26-27">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normalisation des poids</span></span>
<span id="cb26-28">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t, ])</span>
<span id="cb26-29">    </span>
<span id="cb26-30">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimation initiale</span></span>
<span id="cb26-31">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb26-32">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb26-33">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  √âtape de pr√©diction (√©chantillonnage de nouvelles particules)</span></span>
<span id="cb26-34">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> mu <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (x_particle[t <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>mu), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(sigma_squared))</span>
<span id="cb26-35">    </span>
<span id="cb26-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Mise √† jour des poids avec la vraisemblance de l'observation</span></span>
<span id="cb26-37">    w[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log_chi2</span>(y[t] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_particle[t,])</span>
<span id="cb26-38">    </span>
<span id="cb26-39">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Normalisation des poids</span></span>
<span id="cb26-40">    w_normalized[t,] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> w[t,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w[t,])</span>
<span id="cb26-41">    </span>
<span id="cb26-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  R√©√©chantillonnage des particules selon leurs poids</span></span>
<span id="cb26-43">    index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> M, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> w_normalized[t, ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb26-44">    x_particle[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> x_particle[t, index]</span>
<span id="cb26-45">    </span>
<span id="cb26-46">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># R√©initialisation des poids apr√®s r√©√©chantillonnage (uniforme)</span></span>
<span id="cb26-47">    w_normalized[t, ] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> M</span>
<span id="cb26-48">    </span>
<span id="cb26-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#  Estimation de x √† l'instant t (pond√©r√©e)</span></span>
<span id="cb26-50">    x_hat[t] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(w_normalized[t, ] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_particle[t, ])</span>
<span id="cb26-51">  }</span>
<span id="cb26-52">}</span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute MSE</span></span>
<span id="cb27-2">mse <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>((x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb27-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cat</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE:"</span>, mse, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE: 0.3450866 </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le log-sv"</span>)</span>
<span id="cb29-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(x_hat,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-volatilit√©"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>)</span>
<span id="cb29-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Log-vol est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb30-2"></span>
<span id="cb30-3">r_est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(x_hat), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb30-4"></span>
<span id="cb30-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot the estimate and the true state</span></span>
<span id="cb30-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log-returns"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mod√®le log-sv"</span>)</span>
<span id="cb30-7"></span>
<span id="cb30-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Superposition des trajectoires</span></span>
<span id="cb30-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(r_est, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>)</span>
<span id="cb30-10"></span>
<span id="cb30-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># legend</span></span>
<span id="cb30-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"topright"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements obs."</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements est."</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="application-sur-donn√©es-r√©elles" class="level1">
<h1>Application sur donn√©es r√©elles</h1>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the data from Quandl</span></span>
<span id="cb31-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(quantmod)</span>
<span id="cb31-3"></span>
<span id="cb31-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># T√©l√©chargement des donn√©es de Yahoo Finance</span></span>
<span id="cb31-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getSymbols</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^IXIC"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">src =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yahoo"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2012-01-02"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2014-01-02"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IXIC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">S_t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> IXIC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IXIC.Close</span>
<span id="cb33-2"></span>
<span id="cb33-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(S_t)))</span>
<span id="cb33-4">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> y[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(y)]</span>
<span id="cb33-5"></span>
<span id="cb33-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimate the filtered state using a particle filter</span></span>
<span id="cb33-7">theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.97</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15</span>)</span>
<span id="cb33-8">pfOutput <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">particleFilterSVmodel</span>(y, theta, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">noParticles=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb33-9"></span>
<span id="cb33-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pfOutput<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xHatFiltered, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>,</span>
<span id="cb33-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"estimate of log-volatility"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D95F02"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Particle filter estimate of log-volatility"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation des rendements estim√©s √† partir de x_hat</span></span>
<span id="cb34-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour rendre les simulations reproductibles</span></span>
<span id="cb34-3">r_est <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(pfOutput<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xHatFiltered <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(pfOutput<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xHatFiltered), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb34-4"></span>
<span id="cb34-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Superposition des trajectoires</span></span>
<span id="cb34-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log-returns"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb34-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#1B9E77"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True log-returns"</span>)</span>
<span id="cb34-8"></span>
<span id="cb34-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lines</span>(r_est, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"l"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temps"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rendements"</span>, </span>
<span id="cb34-10">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated log-returns"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="768"></p>
</figure>
</div>
</div>
</div>


</section>

 ]]></description>
  <category>paper</category>
  <category>proc-sto</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part2.html</guid>
  <pubDate>Mon, 20 Jan 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Calibration du mod√®le √† volatilit√© stochastique de Taylor : Filtre de Kalman</title>
  <link>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part1.html</link>
  <description><![CDATA[ 




<section id="calibration-du-mod√®le-√†-volatilit√©-stochastique-de-taylor---filtre-de-kalman" class="level1">
<h1>Calibration du mod√®le √† volatilit√© stochastique de Taylor - Filtre de Kalman</h1>
<p>Le mod√®le √† volatilit√© stochastique de Taylor est un mod√®le de volatilit√© stochastique qui est utilis√© pour mod√©liser la volatilit√© des actifs financiers. Le mod√®le est d√©fini par l‚Äô√©quation suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Baligned%7D%0Ar_t%20&amp;=%20%5Cexp(x_t/2)%20%5Ccdot%20%5Cvarepsilon_t,%20%5Cquad%20%5Cvarepsilon_t%20%5Csim%20%5Ctext%7BN%7D(0,1)%20%5C%5C%0Ax_t%20&amp;=%20%5Cmu%20+%20%5Cphi%20%5Ccdot%20x_%7Bt-1%7D%20+%20%5Csigma_t%20%5Ccdot%20%5Ceta_t%0A%5Cend%7Baligned%7D%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?r_t"> est le rendement de l‚Äôactif financier √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">, <img src="https://latex.codecogs.com/png.latex?x_t"> est la volatilit√© de l‚Äôactif financier √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">, <img src="https://latex.codecogs.com/png.latex?%5Cmu"> est la moyenne de la volatilit√©, <img src="https://latex.codecogs.com/png.latex?%5Cphi"> est le coefficient d‚Äôautor√©gression, <img src="https://latex.codecogs.com/png.latex?%5Csigma_t"> est l‚Äô√©cart-type de la volatilit√© √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">, <img src="https://latex.codecogs.com/png.latex?%5Ceta_t"> est un bruit blanc gaussien, et <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon_t"> est un bruit blanc gaussien.</p>
<p>Pour extraire la volatilit√©, nous utilisons le filtre de Kalman sur le logarithme des rendements au carr√© <img src="https://latex.codecogs.com/png.latex?y_t%20=%20%5Clog(r_t%5E2)">, afin de lin√©ariser le mod√®le. Le mod√®le lin√©aris√© est d√©fini par l‚Äô√©quation suivante :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ay_t%20=%20x_t%20+%20%5Cvarepsilon_t%0A"></p>
<p>o√π <img src="https://latex.codecogs.com/png.latex?y_t"> est le logarithme des rendements au carr√© √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">, <img src="https://latex.codecogs.com/png.latex?x_t"> est la volatilit√© de l‚Äôactif financier √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">, et <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon_t"> est un bruit blanc de loi log-<img src="https://latex.codecogs.com/png.latex?%5Cchi%5E2">.</p>
<p>De ce fait, nous pouvons utiliser le filtre de Kalman pour estimer la volatilit√© de l‚Äôactif financier en utilisant les rendements observ√©s. En effet, le filtre de Kalman est un algorithme r√©cursif qui permet d‚Äôestimer l‚Äô√©tat cach√© d‚Äôun syst√®me dynamique √† partir d‚Äôobservations bruit√©es. Il s‚Äôapplique √† des mod√®les lin√©aires dont le bruit est gaussien. Dans notre cas, nous avons lin√©aris√© le mod√®le pour qu‚Äôil soit compatible avec le filtre de Kalman. Cependant, le bruit n‚Äôest pas gaussien, mais log-<img src="https://latex.codecogs.com/png.latex?%5Cchi%5E2">. L‚Äôobjectif de ce notebook est d‚Äôobserver le comportement du filtre de Kalman o√π le bruit n‚Äôest pas gaussien.</p>
<p>Nous poss√©dons d√©j√† d‚Äôun fichier avec les rendements de l‚Äôactif financier et la vraie volatilit√© simul√©s avec les param√®tres suivants <img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%20-0.8">, <img src="https://latex.codecogs.com/png.latex?%5Cphi%20=%200.9">, <img src="https://latex.codecogs.com/png.latex?%5Csigma%20=%200.09">. Nous allons donc utiliser ces donn√©es pour estimer la volatilit√© de l‚Äôactif financier en utilisant le filtre de Kalman. N√©anmoins, le code est √©galement fourni pour simuler les donn√©es si vous souhaitez tester le filtre de Kalman sur d‚Äôautres param√®tres.</p>
<div id="a6920c7f" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation d'un mod√®le √† vol stochastique de Taylor</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># r_t = exp(x_t/2)*eps_t (eps_t iid N(0,1))</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x_t = mu + phi * x_{t-1} + sigma_t * eta_t  (eta_t iid N(0,1))</span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb1-9">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Param√®tres</span></span>
<span id="cb1-12">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">252</span></span>
<span id="cb1-13">mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span></span>
<span id="cb1-14">phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span></span>
<span id="cb1-15">sigma_squared <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.09</span></span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation</span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># np.random.seed(0)</span></span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># x = np.zeros(n)</span></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># r = np.zeros(n)</span></span>
<span id="cb1-22"></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for t in range(0, n):</span></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     if t == 0:</span></span>
<span id="cb1-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         x[t] = np.random.normal(loc= mu/(1-phi), scale=np.sqrt(sigma_squared/(1-phi**2))) # Densit√© de transition stationnaire de x_t</span></span>
<span id="cb1-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     else:</span></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#         x[t] = mu + phi * x[t-1] + np.sqrt(sigma_squared) * np.random.normal(loc=0, scale=1)</span></span>
<span id="cb1-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#     r[t] = np.exp(x[t]/2) * np.random.normal(loc=0, scale=1)</span></span>
<span id="cb1-29"></span>
<span id="cb1-30">data  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'true_sv_taylor.csv'</span>)</span>
<span id="cb1-31">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>]</span>
<span id="cb1-32">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'x'</span>]</span></code></pre></div>
</div>
<div id="afb13627" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Affichage des trajectoires</span></span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb2-3"></span>
<span id="cb2-4">plt.plot(r, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>)</span>
<span id="cb2-5">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trajectoire des rendements"</span>)</span>
<span id="cb2-6">plt.show()</span>
<span id="cb2-7"></span>
<span id="cb2-8">plt.plot(x, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>)</span>
<span id="cb2-9">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Trajectoire de log-volatilit√©"</span>)</span>
<span id="cb2-10">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part1_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part1_files/figure-html/cell-3-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="10e24e05" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Construction du mod√®le log-SV (mod√®le de Taylor)</span></span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pour appliquer le filtre de Kalman, il faut que les bruits soient centr√©s.</span></span>
<span id="cb3-4">mu_r_squared <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.27</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># car log(eps**2) suit une log chi-deux</span></span>
<span id="cb3-5">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu_r_squared</span></code></pre></div>
</div>
<section id="filtre-de-kalman-avec-param√®tres-connus" class="level2">
<h2 class="anchored" data-anchor-id="filtre-de-kalman-avec-param√®tres-connus">Filtre de Kalman avec param√®tres connus</h2>
<p>Le filtre de Kalman fonctionne en deux √©tapes : pr√©diction et mise √† jour. La pr√©diction consiste √† pr√©dire l‚Äô√©tat cach√© du syst√®me √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t"> en utilisant les observations jusqu‚Äô√† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t-1">. La mise √† jour consiste √† mettre √† jour l‚Äôestimation de l‚Äô√©tat cach√© en utilisant l‚Äôobservation √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">. Posons :</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?x_%7B%5Ctext%7Bhat%7D%5Bt%5D%7D"> l‚Äôestimation de la volatilit√© √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">,</li>
<li><img src="https://latex.codecogs.com/png.latex?P%5Bt%5D"> la matrice de covariance de l‚Äôestimation de la volatilit√© √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">,</li>
<li><img src="https://latex.codecogs.com/png.latex?x_%7B%5Ctext%7Bhat%5C_m%7D%7D"> la pr√©diction de la volatilit√© √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">,</li>
<li><img src="https://latex.codecogs.com/png.latex?P_m"> la matrice de covariance de la pr√©diction de la volatilit√© √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">,</li>
<li><img src="https://latex.codecogs.com/png.latex?y%5Bt%5D"> l‚Äôobservation √† l‚Äôinstant <img src="https://latex.codecogs.com/png.latex?t">,</li>
<li><img src="https://latex.codecogs.com/png.latex?K"> le gain de Kalman.</li>
</ul>
$$
<img src="https://latex.codecogs.com/png.latex?%5Cbegin%7Baligned%7D%0A%5Ctext%7BPr%C3%A9diction%7D%20&amp;%20:%20%5C%5C%0Ax_%7B%5Ctext%7Bhat%5C_m%7D%7D%20&amp;=%20%5Cmu%20+%20%5Cphi%20%5Ccdot%20x_%7B%5Ctext%7Bhat%7D%5Bt-1%5D%7D%20%5C%5C%0AP_m%20&amp;=%20%5Cphi%5E2%20%5Ccdot%20P%5Bt-1%5D%20+%20%5Csigma%5E2%20%5C%5C%0Ay_m%20&amp;=%20x_%7B%5Ctext%7Bhat%5C_m%7D%7D%20%5C%5C%0A%0A%5Ctext%7BMise%20%C3%A0%20jour%7D%20&amp;%20:%20%5C%5C%0AK%20&amp;=%20%5Cfrac%7BP_m%7D%7BP_m%20+%20%5Cpi%5E2/2%7D%20%5C%5C%0AP%5Bt%5D%20&amp;=%20(1%20-%20K)%20%5Ccdot%20P_m%20%5C%5C%0Ax_%7B%5Ctext%7Bhat%7D%5Bt%5D%7D%20&amp;=%20x_%7B%5Ctext%7Bhat%5C_m%7D%7D%20+%20K%20%5Ccdot%20(y%5Bt%5D%20-%20y_m)%0A%5Cend%7Baligned%7D">
<p>$$</p>
<p>Pour initialiser le filtre de Kalman, il est conseill√© de connaitre la loi stationnaire de la volatilit√©. En effet, la volatilit√© suit une loi normale stationnaire de param√®tre <img src="https://latex.codecogs.com/png.latex?%5Cmu/(1%20-%20%5Cphi)"> et <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E2/(1%20-%20%5Cphi%5E2)">. Par cons√©quent, nous pouvons initialiser le filtre de Kalman avec ces param√®tres. En ce qui concerne la matrice de covariance de l‚Äô√©tat initial, nous pouvons la fixer √† une valeur √©lev√©e, par exemple <img src="https://latex.codecogs.com/png.latex?10%5E2">.</p>
<p>Dans notre cas, nous allons tester deux initialisations diff√©rentes : une initialisation avec les param√®tres stationnaires et une initialisation avec des param√®tres al√©atoires.</p>
<div id="4f052587" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Script de filtre de kalman pour estimer la volatilit√© √† chaque instant t en supposant les param√®tres connus</span></span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> kalman_filter(y, mu, phi, sigma_squared, n, init_x, init_P):</span>
<span id="cb4-4">    x_hat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n)</span>
<span id="cb4-5">    P <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(n)</span>
<span id="cb4-6"></span>
<span id="cb4-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation</span></span>
<span id="cb4-8">    x_hat[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> init_x</span>
<span id="cb4-9">    P[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> init_P <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plus P est grand moins on fait confiance √† l'apriori sur la valeur de la volatilit√©</span></span>
<span id="cb4-10"></span>
<span id="cb4-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n):</span>
<span id="cb4-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pr√©diction</span></span>
<span id="cb4-13">        x_hat_m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> x_hat[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] </span>
<span id="cb4-14">        P_m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> phi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> P[t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma_squared</span>
<span id="cb4-15">        y_m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_hat_m</span>
<span id="cb4-16"></span>
<span id="cb4-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Mise √† jour</span></span>
<span id="cb4-18">        K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> P_m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (P_m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (np.pi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb4-19">        P[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> P_m</span>
<span id="cb4-20">        x_hat[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_hat_m <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (y[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y_m)</span>
<span id="cb4-21">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> x_hat, P, K</span></code></pre></div>
</div>
<div id="22c02554" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation √† 0 et 0.01</span></span>
<span id="cb5-2">init_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-3">init_P <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span></span>
<span id="cb5-4">x_hat, P, K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kalman_filter(y, mu, phi, sigma_squared, n, init_x, init_P)</span>
<span id="cb5-5">plt.plot(x_hat, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'grey'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√© estim√©e'</span>)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part1_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c3d78e3b" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation √† x_0 et sigma_squared/(1-phi**2)</span></span>
<span id="cb6-2">init_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb6-3">init_P <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_squared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-4">x_hat, P, K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kalman_filter(y, mu, phi, sigma_squared, n, init_x, init_P)</span>
<span id="cb6-5">plt.plot(x_hat, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√© estim√©e'</span>)</span>
<span id="cb6-6">plt.plot(x, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'grey'</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√© r√©elle'</span>)</span>
<span id="cb6-7">plt.legend()</span>
<span id="cb6-8"></span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute MSE, MAE, and RMSE</span></span>
<span id="cb6-11">mse <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean((x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb6-12">mae <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat))</span>
<span id="cb6-13">rmse <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(mse)</span>
<span id="cb6-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE = "</span>, mse)</span>
<span id="cb6-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MAE = "</span>, mae)</span>
<span id="cb6-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE = "</span>, rmse)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE =  0.2794557366826766
MAE =  0.4120099778966342
RMSE =  0.5286357315606622</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part1_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="8b8ba1cd" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialisation √† mu/(1-phi) et sigma_squared/(1-phi**2)</span></span>
<span id="cb8-2">init_x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi)</span>
<span id="cb8-3">init_P <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_squared<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-4">x_hat, P, K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kalman_filter(y, mu, phi, sigma_squared, n, init_x, init_P)</span>
<span id="cb8-5">plt.plot(x_hat, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√© estim√©e'</span>)</span>
<span id="cb8-6">plt.plot(x, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'grey'</span>, label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Volatilit√© r√©elle'</span>)</span>
<span id="cb8-7">plt.legend()</span>
<span id="cb8-8"></span>
<span id="cb8-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute MSE, MAE, RMSE</span></span>
<span id="cb8-10">mse <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean((x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb8-11">mae <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x_hat))</span>
<span id="cb8-12">rmse <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sqrt(mse)</span>
<span id="cb8-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MSE = "</span>, mse)</span>
<span id="cb8-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MAE = "</span>, mae)</span>
<span id="cb8-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RMSE = "</span>, rmse)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE =  0.27543214871007066
MAE =  0.4078063371140131
RMSE =  0.5248162999660649</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part1_files/figure-html/cell-8-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="filtre-de-kalman-avec-param√®tres-inconnus" class="level2">
<h2 class="anchored" data-anchor-id="filtre-de-kalman-avec-param√®tres-inconnus">Filtre de Kalman avec param√®tres inconnus</h2>
<p>Dans le cas o√π les param√®tres du mod√®le sont inconnus, nous pouvons les estimer en utilisant le filtre de Kalman. En effet, nous pouvons utiliser l‚Äôalgorithme EM pour estimer les param√®tres du mod√®le. L‚Äôalgorithme EM est un algorithme it√©ratif qui permet d‚Äôestimer les param√®tres d‚Äôun mod√®le en maximisant la vraisemblance des donn√©es observ√©es. Dans notre cas, nous allons utiliser l‚Äôalgorithme EM pour estimer les param√®tres <img src="https://latex.codecogs.com/png.latex?%5Cmu">, <img src="https://latex.codecogs.com/png.latex?%5Cphi"> et <img src="https://latex.codecogs.com/png.latex?%5Csigma"> du mod√®le.</p>
<div id="75e0191b" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb10-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define the log-likelihood function for the log-SV model with Kalman filter</span></span>
<span id="cb10-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> log_sv_kalman(params, y):</span>
<span id="cb10-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract parameters</span></span>
<span id="cb10-7">    mu, phi, sigma_eta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params</span>
<span id="cb10-8"></span>
<span id="cb10-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of observations</span></span>
<span id="cb10-10">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(y)</span>
<span id="cb10-11"></span>
<span id="cb10-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize state and variance</span></span>
<span id="cb10-13">    x_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial state (log-volatility)</span></span>
<span id="cb10-14">    P_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma_eta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> phi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial variance (stationarity assumption)</span></span>
<span id="cb10-15"></span>
<span id="cb10-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Log-likelihood accumulator</span></span>
<span id="cb10-17">    log_likelihood <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-18"></span>
<span id="cb10-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> t <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb10-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Observation equation: y_t ~ x_t + nu_t</span></span>
<span id="cb10-21"></span>
<span id="cb10-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prediction step</span></span>
<span id="cb10-23">        y_t_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_t</span>
<span id="cb10-24">        F_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> P_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.pi<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Variance of observation noise</span></span>
<span id="cb10-25"></span>
<span id="cb10-26">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update step</span></span>
<span id="cb10-27">        v_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> y[t] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y_t_pred  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prediction error</span></span>
<span id="cb10-28">        K_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> P_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> F_t  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Kalman gain</span></span>
<span id="cb10-29">        x_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> K_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> v_t</span>
<span id="cb10-30">        P_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K_t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> P_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> sigma_eta<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update variance</span></span>
<span id="cb10-31"></span>
<span id="cb10-32">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update log-likelihood</span></span>
<span id="cb10-33">        log_likelihood <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.pi) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.log(F_t) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (v_t<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> F_t))</span>
<span id="cb10-34"></span>
<span id="cb10-35">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># State evolution</span></span>
<span id="cb10-36">        x_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> phi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (x_t <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mu)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># State equation</span></span>
<span id="cb10-37"></span>
<span id="cb10-38">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>log_likelihood  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Negative log-likelihood for minimization</span></span>
<span id="cb10-39"></span>
<span id="cb10-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial parameter guesses</span></span>
<span id="cb10-41">initial_params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, np.sqrt(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)]</span>
<span id="cb10-42"></span>
<span id="cb10-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Constrain phi between -1 and 1 and sigma_eta &gt; 0</span></span>
<span id="cb10-44">bounds <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.inf, np.inf), (<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-6</span>, np.inf)]</span>
<span id="cb10-45"></span>
<span id="cb10-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Optimize parameters using the log-likelihood function</span></span>
<span id="cb10-47">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize(log_sv_kalman, initial_params, args<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(y,), bounds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>bounds, method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'L-BFGS-B'</span>)</span>
<span id="cb10-48"></span>
<span id="cb10-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract estimated parameters</span></span>
<span id="cb10-50">mu_est, phi_est, sigma_eta_est <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> result.x</span>
<span id="cb10-51"></span>
<span id="cb10-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Print results</span></span>
<span id="cb10-53"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated parameters:"</span>)</span>
<span id="cb10-54"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mu: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu_est<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-55"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"phi: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>phi_est<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-56"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sigma_eta: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sigma_eta_est<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated parameters:
mu: -0.8021
phi: 0.8001
sigma_eta: 1.2184</code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>proc-sto</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_log_sv-part1.html</guid>
  <pubDate>Mon, 13 Jan 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Calibration du mod√®le Black-Scholes</title>
  <link>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_bs.html</link>
  <description><![CDATA[ 




<section id="calibration-du-mod√®le-black-scholes" class="level1">
<h1>Calibration du mod√®le Black-Scholes</h1>
<p>Le mod√®le de Black-Scholes est un mod√®le math√©matique qui permet de d√©terminer le prix d‚Äôune option √† partir de plusieurs param√®tres. Il est bas√© sur l‚Äôhypoth√®se que le prix de l‚Äôactif sous-jacent suit un mouvement brownien g√©om√©trique :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AdS_t%20=%20%5Cmu%20S_t%20dt%20+%20%5Csigma%20S_t%20dW_t%0A"></p>
<p>Avec <img src="https://latex.codecogs.com/png.latex?S_t"> le prix de l‚Äôactif, <img src="https://latex.codecogs.com/png.latex?%5Cmu"> le taux de rendement moyen, <img src="https://latex.codecogs.com/png.latex?%5Csigma"> la volatilit√© et <img src="https://latex.codecogs.com/png.latex?W_t"> un mouvement brownien.</p>
<p>De ce fait, le prix d‚Äôune option europ√©enne peut √™tre calcul√© par la formule de Black-Scholes :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC(S_t,%20K,%20T,%20r,%20%5Csigma)%20=%20S_t%20N(d_1)%20-%20K%20e%5E%7B-rT%7D%20N(d_2)%0A"></p>
<p>Avec <img src="https://latex.codecogs.com/png.latex?C"> le prix de l‚Äôoption, <img src="https://latex.codecogs.com/png.latex?S_t"> le prix de l‚Äôactif sous-jacent, <img src="https://latex.codecogs.com/png.latex?K"> le prix d‚Äôexercice de l‚Äôoption, <img src="https://latex.codecogs.com/png.latex?T"> la maturit√© de l‚Äôoption, <img src="https://latex.codecogs.com/png.latex?r"> le taux d‚Äôint√©r√™t sans risque, <img src="https://latex.codecogs.com/png.latex?%5Csigma"> la volatilit√© de l‚Äôactif, <img src="https://latex.codecogs.com/png.latex?N"> la fonction de r√©partition de la loi normale centr√©e r√©duite, et :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ad_1%20=%20%5Cfrac%7B1%7D%7B%5Csigma%20%5Csqrt%7BT%7D%7D%20%5Cleft(%20%5Cln%20%5Cleft(%20%5Cfrac%7BS_t%7D%7BK%7D%20%5Cright)%20+%20%5Cleft(%20r%20+%20%5Cfrac%7B%5Csigma%5E2%7D%7B2%7D%20%5Cright)%20T%20%5Cright)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ad_2%20=%20d_1%20-%20%5Csigma%20%5Csqrt%7BT%7D%0A"></p>
<section id="calcul-dun-call" class="level2">
<h2 class="anchored" data-anchor-id="calcul-dun-call">1. Calcul d‚Äôun call</h2>
<div id="c1115b45" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul d'un call</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.optimize <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> minimize</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> FormulaBS(S,K,r,tau,sigma):</span>
<span id="cb1-7">    d1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.log(S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>tau ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau))</span>
<span id="cb1-8">    d2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau)</span>
<span id="cb1-9">    call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>norm.cdf(d1) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp( <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> r) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.cdf(d2)</span>
<span id="cb1-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> call</span></code></pre></div>
</div>
<p>Lorsqu‚Äôon a pas acc√®s √† une formule analytique pour le prix d‚Äôune option, on peut utiliser la m√©thode de Monte-Carlo pour estimer ce prix. Pour cela, on simule un grand nombre de trajectoires du prix de l‚Äôactif sous-jacent, et on calcule la valeur de l‚Äôoption √† chaque date de maturit√©. On fait ensuite la moyenne de ces valeurs pour obtenir une estimation du prix de l‚Äôoption.</p>
<p>Le prix de l‚Äôactif sous-jacent suit un mouvement brownien g√©om√©trique, et on peut simuler ce mouvement en utilisant la formule d‚ÄôIto :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AS_t%20=%20S_0%20e%5E%7B(%5Cmu%20-%20%5Cfrac%7B%5Csigma%5E2%7D%7B2%7D)t%20+%20%5Csigma%20W_t%7D%0A"></p>
<div id="ea38e2e8" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> FormulaBSMC(K,r,tau,sigma,M, S0) :</span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation du M mouvement brownien de loi N(0, sigma*sqrt(T))</span></span>
<span id="cb2-3">    var_brown <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau)</span>
<span id="cb2-4">    W_T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,var_brown,M)</span>
<span id="cb2-5"></span>
<span id="cb2-6">    S_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp((r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W_T)</span>
<span id="cb2-7">    payoff <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.maximum(S_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> K, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb2-8"></span>
<span id="cb2-9">    call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>tau) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean(payoff)</span>
<span id="cb2-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> call</span></code></pre></div>
</div>
<div id="55eecbab" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix d'un call lors t=O, T=6mois, S0= 42, K=40, r=10%, sigma=20%</span></span>
<span id="cb3-2">S0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span></span>
<span id="cb3-3">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span></span>
<span id="cb3-4">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb3-5">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb3-6">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb3-7"></span>
<span id="cb3-8">call_BS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FormulaBS(S0,K,r,tau,sigma)</span>
<span id="cb3-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le prix d'un call est de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_BS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le prix d'un call est de maturit√© 6mois et de strike 40 est de 20.67722481517296</code></pre>
</div>
</div>
<div id="af38329e" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">M_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50000</span>]</span>
<span id="cb5-2"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> M <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> M_values:</span>
<span id="cb5-3">    call_BSMC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FormulaBSMC(K, r, tau, sigma, M, S0)</span>
<span id="cb5-4">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le prix d'un call avec M=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>M<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_BSMC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le prix d'un call avec M=500, de maturit√© 6mois et de strike 40 est de 20.752646541960356
Le prix d'un call avec M=5000, de maturit√© 6mois et de strike 40 est de 20.7500497462893
Le prix d'un call avec M=50000, de maturit√© 6mois et de strike 40 est de 20.669764558628767</code></pre>
</div>
</div>
<div id="43961966" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul du prix d'un call lors t=O, T=3mois, S0= 42, K=40, r=10%, sigma=20%</span></span>
<span id="cb7-2">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb7-3">call_BS <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FormulaBS(S0,K,r,tau,sigma)</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le prix d'un call est de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_BS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> M <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> M_values:</span>
<span id="cb7-8">    call_BSMC <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FormulaBSMC(K, r, tau, sigma, M, S0)</span>
<span id="cb7-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Le prix d'un call avec M=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>M<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>call_BSMC<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Le prix d'un call est de maturit√© 3mois et de strike 40 est de 13.362666146646749
Le prix d'un call avec M=500, de maturit√© 3mois et de strike 40 est de 13.10712199610432
Le prix d'un call avec M=5000, de maturit√© 3mois et de strike 40 est de 13.26963328231244
Le prix d'un call avec M=50000, de maturit√© 3mois et de strike 40 est de 13.429289467911312</code></pre>
</div>
</div>
<p>Comme nous pouvons le constater, les deux m√©thodes permettent d‚Äôavoir des r√©sultats similaires. De plus, plus le nombre de simulations est grand, plus la pr√©cision de l‚Äôestimation est grande.</p>
<section id="calcul-des-greeks" class="level3">
<h3 class="anchored" data-anchor-id="calcul-des-greeks">1.1. Calcul des greeks</h3>
<p>Les greeks sont des indicateurs qui permettent de mesurer la sensibilit√© du prix d‚Äôune option √† diff√©rents param√®tres. Les principaux greeks sont :</p>
<ul>
<li>Delta : mesure la sensibilit√© du prix de l‚Äôoption par rapport au prix de l‚Äôactif sous-jacent <img src="https://latex.codecogs.com/png.latex?%0A%5CDelta%20=%20%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20S%7D%0A"></li>
<li>Gamma : mesure la sensibilit√© du delta par rapport au prix de l‚Äôactif sous-jacent <img src="https://latex.codecogs.com/png.latex?%0A%5CGamma%20=%20%5Cfrac%7B%5Cpartial%5E2%20C%7D%7B%5Cpartial%20S%5E2%7D%0A"></li>
<li>Vega : mesure la sensibilit√© du prix de l‚Äôoption par rapport √† la volatilit√© de l‚Äôactif <img src="https://latex.codecogs.com/png.latex?%0AVega%20=%20%5Cfrac%7B%5Cpartial%20C%7D%7B%5Cpartial%20%5Csigma%7D%0A"></li>
</ul>
<p>Il en existe d‚Äôautres, mais ces trois-l√† sont les plus couramment utilis√©s.</p>
<p>Avec le mod√®le de Black-Scholes, on peut calculer ces greeks de mani√®re analytique :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5CDelta%20=%20N(d_1)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5CGamma%20=%20%5Cfrac%7BN(d_1)%7D%7BS_t%20%5Csigma%20%5Csqrt%7BT%7D%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0AVega%20=%20S_t%20%5Csqrt%7BT%7D%20N(d_1)%0A"></p>
<p>Cependant, lorsqu‚Äôon a pas acc√®s √† une formule analytique pour le prix de l‚Äôoption, on peut utiliser la m√©thode de Monte-Carlo pour estimer ces greeks. Pour cela, on calcule le prix de l‚Äôoption pour une petite variation de chaque param√®tre, et on fait la diff√©rence entre ces deux prix pour obtenir une estimation du greek. On peut √©galement utiliser la m√©thode des diff√©rences finies pour calculer ces greeks.</p>
<div id="970a1635" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> FormulaBSGreeks(S,K,r,tau,sigma):</span>
<span id="cb9-2">    d1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.log(S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>tau ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau))</span>
<span id="cb9-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d2 = d1 - sigma * np.sqrt(tau)</span></span>
<span id="cb9-4"></span>
<span id="cb9-5">    delta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm.cdf(d1)</span>
<span id="cb9-6">    gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>np.sqrt(tau))) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.pdf(d1)</span>
<span id="cb9-7">    vega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> norm.pdf(d1)</span>
<span id="cb9-8"></span>
<span id="cb9-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> delta, gamma, vega</span></code></pre></div>
</div>
<div id="b9184e17" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb10-2">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110</span></span>
<span id="cb10-3">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span></span>
<span id="cb10-4">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb10-5">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span></span>
<span id="cb10-6"></span>
<span id="cb10-7">delta, gamma, vega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FormulaBSGreeks(S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>S,K<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>K,r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>r,tau<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tau,sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>sigma)</span>
<span id="cb10-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Les greeks d'un call sont de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> sont delta=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>delta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, gamma=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, vega=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>vega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Les greeks d'un call sont de maturit√© 0.5mois et de strike 110 sont delta=0.40141715171302983, gamma=0.027343746144537384, vega=27.343746144537384</code></pre>
</div>
</div>
<div id="eea06855" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Supposons qu'on a pas la formule des greeks</span></span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># comment calculer les greeks</span></span>
<span id="cb12-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Approche montecarlo </span></span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> FormulaBSGreeksMC(K,r,tau,sigma,M, S0) :</span>
<span id="cb12-6">    d1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.log(S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>tau) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau))</span>
<span id="cb12-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulation du M mouvement brownien de loi N(0, sigma*sqrt(T))</span></span>
<span id="cb12-8">    var_brown <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau)</span>
<span id="cb12-9">    W_T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,var_brown,M)</span>
<span id="cb12-10"></span>
<span id="cb12-11">    S_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> S0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.exp((r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> W_T)</span>
<span id="cb12-12"></span>
<span id="cb12-13">    delta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>tau) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean((S_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> S_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> S0)</span>
<span id="cb12-14">    gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm.pdf(d1)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(S0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sqrt(tau))</span>
<span id="cb12-15">    vega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>r<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>tau) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.mean((S_T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> K) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (S_T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(np.log(S_T<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>S0) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>tau))</span>
<span id="cb12-16"></span>
<span id="cb12-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> delta, gamma, vega</span>
<span id="cb12-18"></span>
<span id="cb12-19">delta, gamma, vega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FormulaBSGreeksMC(K,r,tau,sigma,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>, S)</span>
<span id="cb12-20"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Les greeks d'un call sont de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> sont delta=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>delta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, gamma=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, vega=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>vega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Les greeks d'un call sont de maturit√© 0.5mois et de strike 110 sont delta=0.4209503065079776, gamma=0.027343746144537384, vega=29.15680602998068</code></pre>
</div>
</div>
<div id="0f533e40" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># M√©rhode de diff√©rencee finie bas√© sur la m√©thode de Taylor</span></span>
<span id="cb14-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> FormulaBSGreeks_FD_num(S, K, r, tau, sigma, delta_S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-5</span>):</span>
<span id="cb14-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb14-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calcule les Grecs (Delta, Gamma, Vega) pour une option call</span></span>
<span id="cb14-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    par diff√©rences finies.</span></span>
<span id="cb14-6"></span>
<span id="cb14-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Param√®tres:</span></span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    S : float - Prix actuel de l'actif sous-jacent</span></span>
<span id="cb14-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    K : float - Prix d'exercice de l'option (strike)</span></span>
<span id="cb14-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    r : float - Taux d'int√©r√™t sans risque (annualis√©)</span></span>
<span id="cb14-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    tau : float - Temps jusqu'√† la maturit√© (en ann√©es)</span></span>
<span id="cb14-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    sigma : float - Volatilit√© de l'actif sous-jacent (annualis√©e)</span></span>
<span id="cb14-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    epsilon : float - Petit incr√©ment pour les diff√©rences finies</span></span>
<span id="cb14-14"></span>
<span id="cb14-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Retour:</span></span>
<span id="cb14-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    tuple - (Delta, Gamma, Vega)</span></span>
<span id="cb14-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb14-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Delta</span></span>
<span id="cb14-19">    delta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (FormulaBS(S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> delta_S, K, r, tau, sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> FormulaBS(S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> delta_S, K, r, tau, sigma)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta_S)</span>
<span id="cb14-20"></span>
<span id="cb14-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gamma</span></span>
<span id="cb14-22">    gamma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (FormulaBS(S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> delta_S, K, r, tau, sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> FormulaBS(S, K, r, tau, sigma) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> FormulaBS(S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> delta_S, K, r, tau, sigma)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (delta_S<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb14-23"></span>
<span id="cb14-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vega</span></span>
<span id="cb14-25">    vega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (FormulaBS(S, K, r, tau, sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> delta_S) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> FormulaBS(S, K, r, tau, sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> delta_S)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> delta_S)</span>
<span id="cb14-26"></span>
<span id="cb14-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> delta, gamma, vega</span>
<span id="cb14-28"></span>
<span id="cb14-29">delta, gamma, vega <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FormulaBSGreeks_FD_num(S,K,r,tau,sigma)</span>
<span id="cb14-30"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Les greeks d'un call sont de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> sont delta=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>delta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, gamma=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>gamma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, vega=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>vega<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Les greeks d'un call sont de maturit√© 0.5mois et de strike 110 sont delta=0.4014171516075748, gamma=0.027142732506035824, vega=27.34374614092871</code></pre>
</div>
</div>
</section>
<section id="calibration-du-mod√®le-bs-calcul-de-la-volatilit√©-implicite" class="level3">
<h3 class="anchored" data-anchor-id="calibration-du-mod√®le-bs-calcul-de-la-volatilit√©-implicite">1.2 Calibration du mod√®le BS : calcul de la volatilit√© implicite</h3>
<p>L‚Äôint√©r√™t du mod√®le de Black-Scholes est qu‚Äôil permet de calculer la volatilit√© implicite d‚Äôun actif √† partir du prix de l‚Äôoption. En effet, si on connait le prix de l‚Äôoption, le prix de l‚Äôactif sous-jacent, le prix d‚Äôexercice de l‚Äôoption, la maturit√© de l‚Äôoption et le taux d‚Äôint√©r√™t sans risque, on peut calculer la volatilit√© implicite en r√©solvant l‚Äô√©quation de Black-Scholes pour <img src="https://latex.codecogs.com/png.latex?%5Csigma"> :</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AC(S_t,%20K,%20T,%20r,%20%5Csigma)%20=%20S_t%20N(d_1)%20-%20K%20e%5E%7B-rT%7D%20N(d_2)%0A"></p>
<div id="fe689fc4" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> ImpliedVolBS(S,K,r,tau, Call):</span>
<span id="cb16-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># optim function</span></span>
<span id="cb16-3">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> obj_func(sigma):</span>
<span id="cb16-4">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (Call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> FormulaBS(S,K,r,tau,sigma))<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb16-5">    </span>
<span id="cb16-6">    res <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> minimize(obj_func, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>)</span>
<span id="cb16-7">    sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> res.x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb16-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> sigma</span></code></pre></div>
</div>
<div id="b812b77a" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la volatilit√© d'une option d'achat √† la monnaie de maturit√© 3 mois et de strike K=S=4.58 sachant que S0=100; r=5%</span></span>
<span id="cb17-2"></span>
<span id="cb17-3">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb17-4">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb17-5">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb17-6">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb17-7">Call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.58</span></span>
<span id="cb17-8">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ImpliedVolBS(S,K,r,tau, Call)</span>
<span id="cb17-9"></span>
<span id="cb17-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La volatilit√© implicite d'un call est de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La volatilit√© implicite d'un call est de maturit√© 0.25mois et de strike 100 est de 0.19821832844648876</code></pre>
</div>
</div>
<div id="66755ec3" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calcul de la volatilit√© d'une option d'achat √† la monnaie de maturit√© 6 mois et de strike K=S=5.53 sachant que S0=100; r=5%</span></span>
<span id="cb19-2"></span>
<span id="cb19-3">S <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-4">K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb19-5">r <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span></span>
<span id="cb19-6">tau <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span></span>
<span id="cb19-7">Call <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.53</span></span>
<span id="cb19-8">sigma <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ImpliedVolBS(S,K,r,tau, Call)</span>
<span id="cb19-9"></span>
<span id="cb19-10"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"La volatilit√© implicite d'un call est de maturit√© </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tau<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mois et de strike </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>K<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> est de </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sigma<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La volatilit√© implicite d'un call est de maturit√© 0.5mois et de strike 100 est de 0.15010660990708588</code></pre>
</div>
</div>


</section>
</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>proc-sto</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/proc_stochastique/modele_bs.html</guid>
  <pubDate>Sun, 05 Jan 2025 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Features selection</title>
  <dc:creator>Cheryl KOUADIO</dc:creator>
  <link>https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4.html</link>
  <description><![CDATA[ 




<section id="activity-1-mutual-information-and-hsic" class="level1">
<h1>Activity 1 : Mutual Information and HSIC</h1>
<p>Feature selection is a process where you automatically or manually select those features which contribute most to your prediction variable or output in which you are interested in. Having irrelevant features in your data can decrease the accuracy of the models and make your model learn based on irrelevant features, therefore, it is important to select only the relevant features.</p>
<p>The usual tools used for features selection are based on correlation tests such as Pearson correlation or Spearman correlation when the variables are quantitatives or the Chi-Square test when the variables are qualitatives. However, these do not take in the account the relationship between quantitative and qualitatives variables. Moreover, for the pearson correlation or the spearman one, we are only interested in the linear(pearson) or monotonic(spearman) relationship between the variables.</p>
<p>In this notebook, we are interested in measuring any kind of relationship between variables, no matter what type of variables they are. For that, we will introduce the mutual information, based on the Kullback-Leibler divergence, which is a measure of the divergence between the joint distribution of X and Y and the product of their marginal distributions :</p>
<p><img src="https://latex.codecogs.com/png.latex?I(X;Y)%20=%20%5Cint_%7BX%7D%20%5Cint_%7BY%7D%20p(x,y)%20%5Clog%20%5Cleft(%20%5Cfrac%7Bp(x,y)%7D%7Bp(x)p(y)%7D%20%5Cright)"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?p(x,y)"> is the joint probability distribution function of X and Y, and <img src="https://latex.codecogs.com/png.latex?p(x)"> and <img src="https://latex.codecogs.com/png.latex?p(y)"> are the marginal probability distribution functions of X and Y. If the variables are independent, then the mutual information is equal to 0. If the variables are dependent, then the mutual information is greater than 0.</p>
<p>In order to have confidence in this measure, we will consider a bivariate gaussian variable <img src="https://latex.codecogs.com/png.latex?Z=(X,Y)"> with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu%20=%20(0,0)"> and covariance matrix <img src="https://latex.codecogs.com/png.latex?%5CSigma%20=%20%5Cbegin%7Bpmatrix%7D%20%5Csigma%5E2_X%20&amp;%20%5Crho%20%5Csigma_X%20%5Csigma_X%20%5C%5C%20%20%5Crho%20%5Csigma_X%20%5Csigma_X%20&amp;%20%5Csigma%5E2_Y%20%5Cend%7Bpmatrix%7D">. We will compute the mutual information between X and Y for a grid a <img src="https://latex.codecogs.com/png.latex?%5Crho"> between 0.01 and 0.99 using 1000 size samples repeated 100 times and see how the mutual information behaves and compare it the theorical value of the mutual information which is equal to <img src="https://latex.codecogs.com/png.latex?-%5Cfrac%7B1%7D%7B2%7D%20%5Clog(1-%5Crho%5E2)">.</p>
<section id="accuracy-of-mutual-information-estimation" class="level2">
<h2 class="anchored" data-anchor-id="accuracy-of-mutual-information-estimation">1. Accuracy of mutual information estimation</h2>
<div id="91338d27" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> math</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.feature_selection <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> mutual_info_regression</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb1-7"></span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to generate bivariate Gaussian data</span></span>
<span id="cb1-10"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> generate_bivariate_gaussian(n, rho):</span>
<span id="cb1-11">    mu_X, mu_Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-12">    sigma_X, sigma_Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.chisquare(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), np.random.chisquare(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-13">    mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [mu_X, mu_Y]</span>
<span id="cb1-14">    cov <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [[sigma_X<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma_Y], </span>
<span id="cb1-15">           [rho <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma_X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> sigma_Y, sigma_Y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb1-16">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> np.random.multivariate_normal(mean, cov, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n)</span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to compute true mutual information</span></span>
<span id="cb1-19"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> true_mutual_information(rho):</span>
<span id="cb1-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.log(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> rho<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</div>
<div id="f7799bb0" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize parameters</span></span>
<span id="cb2-2">n_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb2-3">n_repeats <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb2-4">rho_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb2-5"></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store mutual information estimates</span></span>
<span id="cb2-7">estimated_mi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-8">true_mi_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> rho <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> rho_values:</span>
<span id="cb2-11">    mi_estimates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> _ <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_repeats):</span>
<span id="cb2-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate data</span></span>
<span id="cb2-14">        data_test <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_bivariate_gaussian(n_samples, rho)</span>
<span id="cb2-15">        X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_test[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Feature</span></span>
<span id="cb2-16">        Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_test[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Target</span></span>
<span id="cb2-17">        </span>
<span id="cb2-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Estimate mutual information</span></span>
<span id="cb2-19">        mi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mutual_info_regression(X, Y, discrete_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb2-20">        mi_estimates.append(mi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mutual_info_regression returns an array</span></span>
<span id="cb2-21">        </span>
<span id="cb2-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store results</span></span>
<span id="cb2-23">    estimated_mi.append(mi_estimates)</span>
<span id="cb2-24">    true_mi_values.append(true_mutual_information(rho))</span>
<span id="cb2-25"></span>
<span id="cb2-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert estimated MI to array for easy plotting</span></span>
<span id="cb2-27">estimated_mi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array(estimated_mi)</span>
<span id="cb2-28"></span>
<span id="cb2-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot boxplots of the estimated MI for each value of rho</span></span>
<span id="cb2-30">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb2-31">sns.boxplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>estimated_mi.T)</span>
<span id="cb2-32">plt.plot(np.arange(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(rho_values)), true_mi_values, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>, marker<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True MI"</span>)</span>
<span id="cb2-33">plt.xticks(ticks<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>np.arange(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(rho_values)), labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f'</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>rho<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> rho <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> rho_values])</span>
<span id="cb2-34">plt.xlabel(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r'$\rho$'</span>)</span>
<span id="cb2-35">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mutual Information'</span>)</span>
<span id="cb2-36">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Estimated vs True Mutual Information'</span>)</span>
<span id="cb2-37">plt.legend()</span>
<span id="cb2-38">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As we can see in the graph above, the mutual information is able to capture the relationship between the variables, even if they are not linearly related. In fact, as the parameter <img src="https://latex.codecogs.com/png.latex?%5Crho"> increases, the mutual information increases as well. Morever, between the theoretical value of the mutual information and the empirical one, we can see that they are very close to each other. Hence, the function <code>mutual_info_regression</code> is well implemented and can be used to select the relevant features in a dataset.</p>
</section>
<section id="comparison-between-mutual-information-and-correlation-tests" class="level2">
<h2 class="anchored" data-anchor-id="comparison-between-mutual-information-and-correlation-tests">2. Comparison between mutual information and correlation tests</h2>
<p>We will use a simulate dataset where we know the relationship between the variables and see how the pearson, spearman an mutual information perform. We will consider a dataset where the 15 first variables are normal <img src="https://latex.codecogs.com/png.latex?X_%7Bi%20=%201,%5Cdots,15%7D%20%5Csim%20%5Cmathcal%7BN%7D(0,1)"> and the 5 last variables are uniform <img src="https://latex.codecogs.com/png.latex?X_%7Bi%20=%2016,%5Cdots,20%7D%20%5Csim%20%5Cmathcal%7BU%7D(0,1)">. We will consider the target variable <img src="https://latex.codecogs.com/png.latex?Y"> as a linear combination of some variables :</p>
<p><img src="https://latex.codecogs.com/png.latex?%20Y%20=%202X_1%20+%20X_7%5E2%20+%20X_4%5E3%20+%203%20X_2%20X_%7B11%7D%20+%202%20%5Csin(2%5Cpi%20X_%7B19%7D)%20+%203X_6%5E2%5Ccos(2%5Cpi%20X_%7B17%7D)"></p>
<div id="b4347e41" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Function to generate data</span></span>
<span id="cb3-2"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> generate_data(n):</span>
<span id="cb3-3">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame()</span>
<span id="cb3-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>):</span>
<span id="cb3-5">        data[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"X</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.normal(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n)</span>
<span id="cb3-6">        </span>
<span id="cb3-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>):</span>
<span id="cb3-8">        data[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"X</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>i<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.uniform(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, n)</span>
<span id="cb3-9">    pi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> math.pi</span>
<span id="cb3-10">    data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X1"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X7"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X4"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X2"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X11"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\</span></span>
<span id="cb3-11">                <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.sin(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X19"</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X6"</span>]<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.cos(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X10"</span>])</span>
<span id="cb3-12">                </span>
<span id="cb3-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> data</span></code></pre></div>
</div>
<div id="b6f96866" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># compute the correlation between each feature and the target</span></span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pearsonr, spearmanr</span>
<span id="cb4-3"></span>
<span id="cb4-4">concat_spearman <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-5">concat_pearson <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>):</span>
<span id="cb4-8">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_data(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb4-9">    spearman_corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [spearmanr(data[col], data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>])[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data.columns[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb4-10">    pearson_corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [pearsonr(data[col], data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>])[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data.columns[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb4-11">    concat_spearman.append(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(spearman_corr))</span>
<span id="cb4-12">    concat_pearson.append(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(pearson_corr))</span></code></pre></div>
</div>
<div id="1f7be5a8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb5-2"></span>
<span id="cb5-3">feature_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.columns[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get feature names from the dataset</span></span>
<span id="cb5-4"></span>
<span id="cb5-5">spearman_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(concat_spearman, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>feature_names)</span>
<span id="cb5-6">pearson_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(concat_pearson, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>feature_names)</span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Spearman correlations</span></span>
<span id="cb5-9">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb5-10">sns.boxplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>spearman_df)</span>
<span id="cb5-11">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Spearman Correlations for Each Feature'</span>)</span>
<span id="cb5-12">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Spearman Correlation'</span>)</span>
<span id="cb5-13">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Feature'</span>)</span>
<span id="cb5-14">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>) </span>
<span id="cb5-15">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="c6ee36d9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pearson correlations</span></span>
<span id="cb6-2">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb6-3">sns.boxplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pearson_df)</span>
<span id="cb6-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Pearson Correlations for Each Feature'</span>)</span>
<span id="cb6-5">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Pearson Correlation'</span>)</span>
<span id="cb6-6">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Feature'</span>)</span>
<span id="cb6-7">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>) </span>
<span id="cb6-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As we can see, the spearman and pearson correlation can not identify all the relevant features, in fact, they are only able to identify the relevant variables <img src="https://latex.codecogs.com/png.latex?X_1">, <img src="https://latex.codecogs.com/png.latex?X_4"> and <img src="https://latex.codecogs.com/png.latex?X_%7B19%7D"> related to the target variable <img src="https://latex.codecogs.com/png.latex?Y">. If we are interested in selecting the relevant features using the mutual information, we can identify more relevant features such as <img src="https://latex.codecogs.com/png.latex?X_1">, <img src="https://latex.codecogs.com/png.latex?X_4">, <img src="https://latex.codecogs.com/png.latex?X_6">, <img src="https://latex.codecogs.com/png.latex?X_7">, and <img src="https://latex.codecogs.com/png.latex?X_%7B19%7D">, however some irrelevant features are also selected such as <img src="https://latex.codecogs.com/png.latex?X_2"> and <img src="https://latex.codecogs.com/png.latex?X_%7B11%7D">.</p>
<div id="11fd00b5" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1">mutual_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>):</span>
<span id="cb7-4">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_data(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb7-5">    mi_corr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [mutual_info_regression(data[[col]], data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>], discrete_features<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data.columns[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb7-6">    mutual_info.append(mi_corr)</span>
<span id="cb7-7"></span>
<span id="cb7-8">mutual_info <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(mutual_info, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>feature_names)</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plotting boxplots for Spearman correlations</span></span>
<span id="cb7-11">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb7-12">sns.boxplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mutual_info)</span>
<span id="cb7-13">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mutual information for each feature'</span>)</span>
<span id="cb7-14">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mutual info'</span>)</span>
<span id="cb7-15">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Feature'</span>)</span>
<span id="cb7-16">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate feature names if there are many features</span></span>
<span id="cb7-17">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>To conclude, the mutual information seems to be a good tool to select the relevant features in a dataset. In fact, it is able to capture the relationship between the variables, no matter what type of variables they are.</p>
<section id="what-about-feature-selection-with-lasso-regression" class="level3">
<h3 class="anchored" data-anchor-id="what-about-feature-selection-with-lasso-regression">What about feature selection with lasso regression?</h3>
<p>We might be interested in the behavior of the lasso regression in the same dataset. We will use the <code>Lasso</code> class from the <code>sklearn.linear_model</code> module to fit the lasso regression on the dataset and see how it performs in selecting the relevant features. We will use the <code>LassoCV</code> class to select the best value of the regularization parameter <img src="https://latex.codecogs.com/png.latex?%5Calpha"> using cross-validation.</p>
<div id="80e1fae6" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.linear_model <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> LassoCV</span>
<span id="cb8-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb8-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb8-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.preprocessing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StandardScaler</span>
<span id="cb8-5"></span>
<span id="cb8-6">n_simulations <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb8-7">n_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb8-8">n_features <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>  </span>
<span id="cb8-9"></span>
<span id="cb8-10">selected_features <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((n_simulations, n_features))</span>
<span id="cb8-11">scaler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StandardScaler()</span>
<span id="cb8-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_simulations):</span>
<span id="cb8-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate data</span></span>
<span id="cb8-14">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_data(n_samples)</span>
<span id="cb8-15">    X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>]) </span>
<span id="cb8-16">    X_scaled <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scaler.fit_transform(X)</span>
<span id="cb8-17">    y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>] </span>
<span id="cb8-18">    </span>
<span id="cb8-19">    lasso <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> LassoCV().fit(X_scaled, y)</span>
<span id="cb8-20">    </span>
<span id="cb8-21">    selected_features[sim, :] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (lasso.coef_ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>).astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span></code></pre></div>
</div>
<div id="2c35685e" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Frequency of selection for each feature</span></span>
<span id="cb9-2">selection_frequency <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(selected_features, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create a DataFrame for better visualization</span></span>
<span id="cb9-5">selection_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb9-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Feature'</span>: X.columns,</span>
<span id="cb9-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Selection Frequency'</span>: selection_frequency</span>
<span id="cb9-8">})</span>
<span id="cb9-9"></span>
<span id="cb9-10"></span>
<span id="cb9-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You can also visualize this with a bar plot</span></span>
<span id="cb9-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb9-13"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> seaborn <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> sns</span>
<span id="cb9-14"></span>
<span id="cb9-15">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb9-16">sns.barplot(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Feature'</span>, y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Selection Frequency'</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>selection_df,color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb9-17">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Feature Selection Frequency by Lasso'</span>)</span>
<span id="cb9-18">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)</span>
<span id="cb9-19">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>As we can see, the lasse regression is able to select the relevant features in the dataset. However, it is not able to select all the relevant features, hence it might always be interesting to use the mutual information (combined with lasso regression or other correlations tests) to select the relevant features in a dataset.</p>
</section>
</section>
<section id="hilbert-schmidt-independence-criterion" class="level2">
<h2 class="anchored" data-anchor-id="hilbert-schmidt-independence-criterion">3. Hilbert-Schmidt Independence Criterion</h2>
<p>We can also use the kernel trick applied to the kullback-leibler divergence to measure the mutual information between the variables. This is called the Maximum Mean Discrepancy (MMD) and is defined as :</p>
<p><img src="https://latex.codecogs.com/png.latex?MMD%5E2(X,Y)%20=%20%5Cmathbb%7BE%7D_%7Bx,x'%20%5Csim%20X%7D%20%5Bk(x,x')%5D%20+%20%5Cmathbb%7BE%7D_%7By,y'%20%5Csim%20Y%7D%20%5Bk(y,y')%5D%20-%202%20%5Cmathbb%7BE%7D_%7Bx%20%5Csim%20X,%20y%20%5Csim%20Y%7D%20%5Bk(x,y)%5D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?k"> is a kernel function. The MMD is equal to 0 if and only if the two distributions are equal. We can use the <code>MMD</code> class from the <code>sklearn.metrics.pairwise</code> module to compute the MMD between the variables. For a continuous variables, this writes :</p>
<p><img src="https://latex.codecogs.com/png.latex?MMD%5E2(X,Y)%20=%20%5Cint_X%20k(x,x')%20%5Cleft%5B%20p(x)%20-%20q(x)%5Cright%5D%20%5Cleft%5B%20p(x')%20-%20q(x')%5Cright%5D%20dxdx'"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?p"> and <img src="https://latex.codecogs.com/png.latex?q"> are the probability distribution functions of X and Y.</p>
<p>This is also defined as the Hilbert-Schmidt Independence Criterion (HSIC) when we are interested in the measure of divergence between the joint distribution of X and Y and the product of their marginal distributions. The estimate of the HSIC is given by :</p>
<p><img src="https://latex.codecogs.com/png.latex?HSIC(X,Y)%20=%20%5Cfrac%7B1%7D%7Bn%5E2%7D%20%5Ctext%7Btr%7D(KHLH)"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?K"> is the kernel matrix of X and <img src="https://latex.codecogs.com/png.latex?L"> is the kernel matrix of Y and H is the centering matrix <img src="https://latex.codecogs.com/png.latex?H%20=%20I%20-%20%5Cfrac%7B1%7D%7Bn%7D%20%5Cmathbf%7B1%7D%20%5Cmathbf%7B1%7D%5ET">. Since the HSIC is not implemented in the mainstream libraries, we will implement it ourselves using the sobolev kernel for X and Y with :</p>
<p><img src="https://latex.codecogs.com/png.latex?k(x,x')%20=%201%20+%20(z_i%20-%200.5)%20(z_j%20-%200.5)%20+%20%5Cfrac%7B1%7D%7B2%7D%20((z_i-z_j)%5E2%20-%20%7Cz_i%20-z_j%7C%20+1/6)"></p>
<div id="bd2f53cc" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sobolev_kernel(x,y):</span>
<span id="cb10-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>( (x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(x<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>y) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb10-3"></span>
<span id="cb10-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> compute_gram_matrix(z):</span>
<span id="cb10-5">    z <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.asarray(z)</span>
<span id="cb10-6">    M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sobolev_kernel(z[:,<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>],z[<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,:])</span>
<span id="cb10-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> M</span>
<span id="cb10-8"></span>
<span id="cb10-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> hsic(X, Y):</span>
<span id="cb10-10">    n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb10-11">    H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.eye(n) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.ones((n, n))</span>
<span id="cb10-12"></span>
<span id="cb10-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute Gram matrices with Sobolev kernel</span></span>
<span id="cb10-14">    K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_gram_matrix(X)</span>
<span id="cb10-15">    L <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> compute_gram_matrix(Y)</span>
<span id="cb10-16"></span>
<span id="cb10-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate HSIC</span></span>
<span id="cb10-18">    hsic_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> np.trace(K <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> H <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> L <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> H)</span>
<span id="cb10-19">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> hsic_value</span></code></pre></div>
</div>
<div id="7b44045f" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.preprocessing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> MinMaxScaler</span>
<span id="cb11-2"></span>
<span id="cb11-3">hsic_values <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb11-4"></span>
<span id="cb11-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>):</span>
<span id="cb11-6">    data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_data(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb11-7">    scaler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MinMaxScaler()</span>
<span id="cb11-8">    data_scaled <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(scaler.fit_transform(data), columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data.columns)</span>
<span id="cb11-9">    hsic_var <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [hsic(data_scaled[col], data_scaled[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>]) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> data.columns[:<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb11-10">    hsic_values.append(hsic_var)</span>
<span id="cb11-11"></span>
<span id="cb11-12">hsic_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(hsic_values, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>feature_names)</span></code></pre></div>
</div>
<div id="1fb7d557" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plotting boxplots for Spearman correlations</span></span>
<span id="cb12-2">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb12-3">sns.boxplot(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>hsic_df)</span>
<span id="cb12-4">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'HSIC for Each Feature'</span>)</span>
<span id="cb12-5">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'HSIC'</span>)</span>
<span id="cb12-6">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Feature'</span>)</span>
<span id="cb12-7">plt.xticks(rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rotate feature names if there are many features</span></span>
<span id="cb12-8">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="threshold-selection-for-mutual-information-and-hsic" class="level2">
<h2 class="anchored" data-anchor-id="threshold-selection-for-mutual-information-and-hsic">Threshold selection for mutual information and HSIC</h2>
<p>The hilbert-schmidt independence criterion, the mutual information are able to capture the relationship between the variables, no matter what type of variables they are. However, it needs a definition of a threshold to select the relevant features in a dataset. As for correlation tests like pearson or speaman, we might use statistical tests to select the relevant features in a dataset. However, for mutual information and HSIC, we use the permutation test where the test statistic distribution under the null hypothesis (X and Y are independent), is estimated with several data permutations. The p-value is then computed as the proportion of test statistics that are more extreme than the observed test statistic.</p>
<div id="e9760489" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> sklearn.utils <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> resample</span>
<span id="cb13-2">data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> generate_data(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span>
<span id="cb13-3"></span>
<span id="cb13-4">Y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>]</span>
<span id="cb13-5">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>])</span>
<span id="cb13-6"></span>
<span id="cb13-7">scaler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MinMaxScaler()</span>
<span id="cb13-8">data_scaled <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(scaler.fit_transform(data), columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data.columns)</span>
<span id="cb13-9">X_scaled <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_scaled.drop(columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>])</span>
<span id="cb13-10">Y_scaled <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data_scaled[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>]</span>
<span id="cb13-11"></span>
<span id="cb13-12">mi_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mutual_info_regression(X, Y)</span>
<span id="cb13-13"></span>
<span id="cb13-14">n_rep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb13-15">all_miXYindep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((n_rep, n_features))</span>
<span id="cb13-16">all_HSICindep <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros((n_rep, n_features))</span>
<span id="cb13-17"></span>
<span id="cb13-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> rep <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n_rep):</span>
<span id="cb13-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Permutation</span></span>
<span id="cb13-20">    yb <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> resample(Y, replace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb13-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute mutual information between all features and Y</span></span>
<span id="cb13-22">    mi_temp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mutual_info_regression(X, np.ravel(yb))</span>
<span id="cb13-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store the MI from this repetition</span></span>
<span id="cb13-24">    all_miXYindep[rep, :] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> mi_temp</span>
<span id="cb13-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Permutation</span></span>
<span id="cb13-26">    yb_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> resample(Y_scaled, replace <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb13-27"></span>
<span id="cb13-28"></span>
<span id="cb13-29">p_values_mi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(mi_train <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> all_miXYindep, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div>
</div>
<div id="0704b427" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1">plt.figure(figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb14-2">plt.plot(p_values_mi, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'o'</span>)</span>
<span id="cb14-3">plt.title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Mutual Information p-value'</span>)</span>
<span id="cb14-4">plt.axhline(y<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'r'</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'-'</span>)</span>
<span id="cb14-5">plt.xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Features'</span>)</span>
<span id="cb14-6">plt.ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'p-value'</span>)</span>
<span id="cb14-7">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Depending on the pvalues, we can select the relevant features in a dataset. Using the mutual information, the variables selected are listed below :</p>
<div id="ac2c3ce9" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Selected variables with MI p-values </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%s</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> "</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> np.where(p_values_mi <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>))</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Selected variables with MI p-values [ 0  1  3  5  9 12] </code></pre>
</div>
</div>


</section>
</section>

 ]]></description>
  <category>paper</category>
  <category>apprentissage-stat</category>
  <category>ensai-gdr</category>
  <guid>https://cheryl-kdio.github.io/posts/ensai/apprentisage-stat/Tp4.html</guid>
  <pubDate>Fri, 18 Oct 2024 22:00:00 GMT</pubDate>
</item>
</channel>
</rss>
