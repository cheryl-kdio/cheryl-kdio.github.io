{
  "hash": "607bc884898c2c5a0369efa332ae3832",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle:  TP1:Méthodes traditionnelles de calcul de la VaR et Expected Shortfall (ES)\njupyter: python3\nauthor: Cheryl Kouadio\ncategories: [paper,risques-fin,ensai-gdr]\ndate: \"2025-02-28\"\n---\n\n\n\n\nCe TP est fait dans le but de modéliser la Value at Risk qui est une mesure de risque financier. La Value at Risk (VaR) est une mesure essentielle du risque de marché qui estime la perte potentielle maximale d’un portefeuille sur un horizon h donné, avec un certain niveau de confiance $\\alpha$. La VaR est utilisée par les institutions financières et les gestionnaires de risques pour évaluer l’exposition aux pertes extrêmes et ajuster leurs stratégies d’investissement. Elle est définie comme suit :\n\n$$VaR_{\\alpha}(h) = inf \\{ l \\in \\mathbb{R} | P(PnL \\geq -l) \\geq 1 - \\alpha \\}$$\n\nLe PnL représente le profit and loss, c’est-à-dire la variation de la valeur du portefeuille. Dans notre cas, nous utilserons les rendements logarithmiques des actifs financiers, qui est stationnaire, pour calculer la VaR. Les rendements logarithmiques sont calculés comme suit :\n\n$$r_t = log(\\frac{P_t}{P_{t-1}}) \\approx \\frac{P_t - P_{t-1}}{P_{t-1}}.$$\n\nCette mesure est préférée aux rendements simples car sa décomposition en termes additifs permet de mieux modéliser les variations de prix des actifs financiers. De plus, en supposant la distribution identique et indépendante des rendements, on peut facilement déterminer sa loi de probabilité et calculer la VaR.\n\nDans ce projet, nous explorerons plusieurs méthodes pour calculer la VaR, en tenant compte de la nature des rendements financiers et des hypothèses sous-jacentes :\n\n- **Méthodes non paramétriques** : VaR historique et VaR bootstrap.\n- **Méthodes paramétriques**: VaR gaussienne et VaR basée sur une distribution Skew Student.\n- **Méthodes avancées** : VaR avec pondération exponentielle EWMA et VaR calculée par diffusion d’actifs.\nEn complément, nous calculerons également l’Expected Shortfall (ES), qui mesure la perte moyenne au-delà du seuil de la VaR. Cette mesure est plus robuste, car elle intègre les queues de distribution et est particulièrement utile pour évaluer les risques extrêmes.\n\n::: {#c449f234 .cell execution_count=1}\n``` {.python .cell-code}\n# Définition des librairies\nimport yfinance as yf\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport warnings\nfrom tqdm import tqdm\nfrom scipy.stats import bootstrap\n\nwarnings.filterwarnings(\"ignore\")\n```\n:::\n\n\n::: {#fb148365 .cell execution_count=2}\n``` {.python .cell-code}\n# Import des données du CAC 40\ndata = yf.download(\"^FCHI\",start=\"2008-01-01\")\n\n# Calcul des rendements logarithmiques\ndata['log_return'] = np.log(data['Close'] / data['Close'].shift(1))\n\n# Retirer la première ligne\ndata = data.dropna()\ndata.columns = data.columns.get_level_values(0)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\r[*********************100%***********************]  1 of 1 completed\n```\n:::\n:::\n\n\n::: {#56992603 .cell execution_count=3}\n``` {.python .cell-code}\ndata.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Price</th>\n      <th>Close</th>\n      <th>High</th>\n      <th>Low</th>\n      <th>Open</th>\n      <th>Volume</th>\n      <th>log_return</th>\n    </tr>\n    <tr>\n      <th>Date</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2008-01-03</th>\n      <td>5546.080078</td>\n      <td>5559.049805</td>\n      <td>5515.609863</td>\n      <td>5538.200195</td>\n      <td>117504500</td>\n      <td>-0.000771</td>\n    </tr>\n    <tr>\n      <th>2008-01-04</th>\n      <td>5446.790039</td>\n      <td>5567.089844</td>\n      <td>5417.529785</td>\n      <td>5543.689941</td>\n      <td>162947200</td>\n      <td>-0.018065</td>\n    </tr>\n    <tr>\n      <th>2008-01-07</th>\n      <td>5452.830078</td>\n      <td>5475.250000</td>\n      <td>5429.319824</td>\n      <td>5432.000000</td>\n      <td>181161800</td>\n      <td>0.001108</td>\n    </tr>\n    <tr>\n      <th>2008-01-08</th>\n      <td>5495.669922</td>\n      <td>5533.930176</td>\n      <td>5471.140137</td>\n      <td>5476.509766</td>\n      <td>174857100</td>\n      <td>0.007826</td>\n    </tr>\n    <tr>\n      <th>2008-01-09</th>\n      <td>5435.419922</td>\n      <td>5463.069824</td>\n      <td>5420.060059</td>\n      <td>5459.399902</td>\n      <td>198041500</td>\n      <td>-0.011024</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n# I. Data wrangling\n\nLe jeu de données est constitué de 6 variables, à savoir, le prix de clôture (Close), le volume des transactions (Volume), le prix d'ouverture (Open), le prix le plus bas (Low), le prix le plus élevé (High) et les rendements logarithmiques (log-return). Pour calculer les rendements sur lesquels nous nous sommes baser pour mesurer le risque du portefeuille, nous avons utilisé le prix de clôture. Il aurait été idéal de disposer des prix de clôture ajustés, i.e. les prix de clôture qui tiennent compte des dividendes et des éventuels splits. Cependant, en raison de l'indispobilité de ces données, nous avons utilisé les prix de clôture bruts.\n\nSur tout l'historique du CAC 40, nous n'observons aucune donnée manquante et aucune valeur aberrante (i.e. Prix de clôture négatif). Nous avons donc pu calculer les rendements logarithmiques sans problème.\n\n::: {#bade16ba .cell execution_count=4}\n``` {.python .cell-code}\ndata.info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<class 'pandas.core.frame.DataFrame'>\nDatetimeIndex: 4630 entries, 2008-01-03 to 2026-02-10\nData columns (total 6 columns):\n #   Column      Non-Null Count  Dtype  \n---  ------      --------------  -----  \n 0   Close       4630 non-null   float64\n 1   High        4630 non-null   float64\n 2   Low         4630 non-null   float64\n 3   Open        4630 non-null   float64\n 4   Volume      4630 non-null   int64  \n 5   log_return  4630 non-null   float64\ndtypes: float64(5), int64(1)\nmemory usage: 253.2 KB\n```\n:::\n:::\n\n\n::: {#93de6eb3 .cell execution_count=5}\n``` {.python .cell-code}\ndata.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>Price</th>\n      <th>Close</th>\n      <th>High</th>\n      <th>Low</th>\n      <th>Open</th>\n      <th>Volume</th>\n      <th>log_return</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>4630.000000</td>\n      <td>4630.000000</td>\n      <td>4630.000000</td>\n      <td>4630.000000</td>\n      <td>4.630000e+03</td>\n      <td>4630.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>5159.397158</td>\n      <td>5191.392396</td>\n      <td>5122.058257</td>\n      <td>5158.404029</td>\n      <td>1.059394e+08</td>\n      <td>0.000088</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>1461.767094</td>\n      <td>1464.656510</td>\n      <td>1461.496378</td>\n      <td>1462.353717</td>\n      <td>5.310210e+07</td>\n      <td>0.013605</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>2519.290039</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000e+00</td>\n      <td>-0.130983</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>3994.122559</td>\n      <td>4019.992432</td>\n      <td>3965.000000</td>\n      <td>3995.302490</td>\n      <td>6.965910e+07</td>\n      <td>-0.005908</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>4917.965088</td>\n      <td>4952.119873</td>\n      <td>4880.074951</td>\n      <td>4923.284912</td>\n      <td>9.485980e+07</td>\n      <td>0.000465</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>6231.207642</td>\n      <td>6266.062378</td>\n      <td>6175.047607</td>\n      <td>6217.902588</td>\n      <td>1.333100e+08</td>\n      <td>0.006684</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>8362.089844</td>\n      <td>8396.719727</td>\n      <td>8327.219727</td>\n      <td>8368.990234</td>\n      <td>5.312476e+08</td>\n      <td>0.105946</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#d513fa99 .cell execution_count=6}\n``` {.python .cell-code}\n# check na\nprint(\"=\"*80)\nprint(data.isna().sum())\nprint(\"=\"*80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nPrice\nClose         0\nHigh          0\nLow           0\nOpen          0\nVolume        0\nlog_return    0\ndtype: int64\n================================================================================\n```\n:::\n:::\n\n\nSur tout l'historique du CAC40, i.e. entre 1990 jusqu'à récemment, nous avons enregistré 5 périodes de crise financière. Ces périodes sont les suivantes :\n\n- 1994 : Crise obligataire\n- 2000 : Bulle Internet\n- 2008 : Crise des subprimes\n- 2011 : Crise de la dette souveraine\n- 2020 : Crise du Covid-19\n\nCela peut se réperer par les clusters de rendements observables sur le graphique ci-dessous. Comme on peut l'observer, ces clusters de volatilité sont généralement associés à des périodes où le rendement journalier chute brutalemment. Pour mesurer le risque de marché, il peut être utile de modéliser ces clusters de volatilité et de prendre en compte les queues de distribution à travers des modèles GARCH par exemple.\n\nPour modéliser la VaR comme mesure de risque, il serait utile également de prendre les événements extrêmes en considération. En effet, en observant la densité des rendements, on peut voir que la distribution des rendements est leptokurtique, c'est-à-dire que les queues de distribution sont plus épaisses que celles d'une distribution normale (kurtosis > 3). Cela signifie que les événements extrêmes sont plus fréquents que ce que la distribution normale ne le suggère. De plus, le coefficient d'asytmmétrie est négatif, ce qui signifie que la distribution des rendements est asymétrique. Cela peut être problématique pour les méthodes paramétriques qui supposent, parfois, une distribution symétrique des rendements.\n\n::: {#5fc2d393 .cell execution_count=7}\n``` {.python .cell-code}\nfig, ax1 = plt.subplots(figsize=(12, 6))\n\nax1.plot(data['log_return'], label='Rendements logarithmiques', color='red')\nax1.set_xlabel('Date')\nax1.set_ylabel('Rendements logarithmiques', color='red')\nax1.tick_params(axis='y', labelcolor='red')\n\nax2 = ax1.twinx()\nax2.plot(data['Close'], label='Prix historiques', color='blue')\nax2.set_ylabel('Prix historiques', color='blue')\nax2.tick_params(axis='y', labelcolor='blue')\n\nfig.legend(loc='upper left', bbox_to_anchor=(0.12,0.89))\nplt.title(\"Evolution des prix de clôture, rendements logarithmiques du CAC 40\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-8-output-1.png){}\n:::\n:::\n\n\n::: {#a975d26a .cell execution_count=8}\n``` {.python .cell-code}\n# Densité des rendements logarithmiques\nplt.figure(figsize=(8, 6))\ndata['log_return'].plot(kind='kde', color='red')\nplt.title(\"Densité des rendements logarithmiques du CAC 40\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-9-output-1.png){}\n:::\n:::\n\n\n::: {#e7065a40 .cell execution_count=9}\n``` {.python .cell-code}\n# Skewness\nskewness = data['log_return'].skew()\nprint(f\"Skewness: {skewness:.2f}\")\n\n# Kurtosis\nkurtosis = data['log_return'].kurtosis()\nprint(f\"Kurtosis: {kurtosis:.2f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSkewness: -0.28\nKurtosis: 8.48\n```\n:::\n:::\n\n\n::: {#48ab4a9f .cell execution_count=10}\n``` {.python .cell-code}\n# Autocorrélation et pacf\nfrom statsmodels.graphics.tsaplots import plot_acf, plot_pacf\n\nfig, (ax1, ax2) = plt.subplots(1, 2, figsize=(12, 6))\n\nplot_acf(data['log_return'], lags=10, ax=ax1)\nplot_pacf(data['log_return'], lags=10, ax=ax2)\n\nplt.suptitle(\"Autocorrélation et PACF des rendements logarithmiques du CAC 40\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-11-output-1.png){}\n:::\n:::\n\n\n::: {#f98cfdff .cell execution_count=11}\n``` {.python .cell-code}\n# check for stationarity\nfrom statsmodels.tsa.stattools import adfuller\nimport pandas as pd\n\ndef adf_test(series, title=''):\n    \"\"\"\n    Pass in a time series and an optional title, returns an Adataset report\n    \"\"\"\n    print('Augmented Dickey-Fuller Test: {}\\n'.format(title))\n    # .dropna() handles differenced data\n    result = adfuller(series.dropna(),autolag='AIC')\n\n    labels = ['Adataset test statistic','p-value','# lags used','# observations']\n    out = pd.Series(result[0:4],index=labels)\n\n    for key,val in result[4].items():\n        out['critical value ({})'.format(key)]=val\n\n    # .to_string() removes the line \"dtype: float64\"\n    print(f'{out.to_string()}\\n')\n\n    if result[1] <= 0.05:\n        print(\"Strong evidence against the null hypothesis\")\n        print(\"Reject the null hypothesis\")\n        print(\"Data has no unit root and is stationary\")\n    else:\n        print(\"Weak evidence against the null hypothesis\")\n        print(\"Fail to reject the null hypothesis\")\n        print(\"Data has a unit root and is non-stationary\")\n\nprint(\"=\"*80)\nadf_test(data[\"Close\"], title='Prix de clôture')\nprint(\"=\"*80)\nadf_test(data[\"log_return\"], title='Log-rendements')\nprint(\"=\"*80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nAugmented Dickey-Fuller Test: Prix de clôture\n\nAdataset test statistic      -0.664665\np-value                       0.855691\n# lags used                   0.000000\n# observations             4629.000000\ncritical value (1%)          -3.431763\ncritical value (5%)          -2.862165\ncritical value (10%)         -2.567102\n\nWeak evidence against the null hypothesis\nFail to reject the null hypothesis\nData has a unit root and is non-stationary\n================================================================================\nAugmented Dickey-Fuller Test: Log-rendements\n\nAdataset test statistic   -1.238290e+01\np-value                    4.982874e-23\n# lags used                2.900000e+01\n# observations             4.600000e+03\ncritical value (1%)       -3.431772e+00\ncritical value (5%)       -2.862169e+00\ncritical value (10%)      -2.567105e+00\n\nStrong evidence against the null hypothesis\nReject the null hypothesis\nData has no unit root and is stationary\n================================================================================\n```\n:::\n:::\n\n\n# II. Implémentation de la VaR\n\nOn va prendre comme période d'apprentissage où la BCE fait baisser ses taux directeurs et comme période de (back-)test où la BCE fait augmenter ses taux directeurs. De ce fait, nous avons le découpage suivant :\n- Train : 15 octobre 2008 - 26 juillet 2022\n- Test : 28 juillet 2022 - 11 juin 2024\n\nOn va implémenter les différentes méthodes de calcul de la VaR et de l'ES sur le jeu de données du CAC 40. On va comparer les performances de ces méthodes en utilisant la période de test. On s'attend à ce que les méthodes paramétriques soient moins performantes que les méthodes non paramétriques, car elles supposent une distribution des rendements qui n'est pas toujours vérifiée. De plus, les méthodes avancées, comme l'EWMA et la diffusion d'actifs, devraient être plus performantes que les méthodes non paramétriques, car elles prennent en compte la dynamique des rendements et les corrélations entre les actifs. En général, le backtest devrait être vérifié puisque la période de test ne comporte aucune crise financière.\n\n::: {#a1be9c32 .cell execution_count=12}\n``` {.python .cell-code}\ntrain = data[['log_return',\"Close\"]]['15-10-2008':'26-07-2022']\ndata_train = train['log_return']\n\ntest = data[['log_return',\"Close\"]]['27-07-2022':'11-06-2024']\ndata_test = test['log_return']\n```\n:::\n\n\n## II.1. Statistiques descriptives\n\nNous constatons que dans la période d'entrainement est plus volatile (std=1.39%). Cela s'explique par le fait que la période d'entrainement prend en compte deux crises majeures : la crise des subprimes et la crise du Covid-19. Cela peut également se voir à travers les clusters de volatilité observables à la suite de ces crises. Dans la période de test, aucun évènement majeur n'est observé, avec une plus faible volatilité observée (std=0.08%).\n\nOn s'attend à ce que la VaR entrainée sur la période d'entrainement performe très bien sur la période de test, mais on s'attend également à ce que la VaR entrainée sur la période de test performe moins bien sur la période d'entrainement.\n\n::: {#fac3bbd1 .cell execution_count=13}\n``` {.python .cell-code}\nplt.figure(figsize=(10, 4))\nplt.plot(data_train, label='Train', color='grey')\nplt.plot(data_test, label='Test', color='red')\nplt.legend(loc='upper left')\nplt.title(\"Données d'entrainement et de test\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-14-output-1.png){}\n:::\n:::\n\n\n::: {#2561fe16 .cell execution_count=14}\n``` {.python .cell-code}\ndata_train.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```\ncount    3523.000000\nmean        0.000153\nstd         0.013953\nmin        -0.130983\n25%        -0.006099\n50%         0.000580\n75%         0.006855\nmax         0.096169\nName: log_return, dtype: float64\n```\n:::\n:::\n\n\n::: {#3f4ec0fc .cell execution_count=15}\n``` {.python .cell-code}\ndata_test.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```\ncount    586.000000\nmean       0.000292\nstd        0.008947\nmin       -0.036484\n25%       -0.004763\n50%        0.000642\n75%        0.005612\nmax        0.041504\nName: log_return, dtype: float64\n```\n:::\n:::\n\n\n## II.2. VaR non paramétrique\n\nLa VaR est une mesure de risque qui donne une estimation de la perte maximale que l'on peut subir avec un certain niveau de confiance $\\alpha$ sur un horizon de temps donné. Par exemple, une VaR à 5% sur 1 jour de 1000 euros signifie que 95% du temps, on ne perdra pas plus de 1000 euros sur un jour.\n\n$$P(\\text{Loss} < \\text{VaR}) = \\alpha.$$\n\nOn peut également raisonner en terme de gain, i.e. Profit and Loss (PnL).\n\n$$P(\\text{PnL} > - \\text{VaR}) = \\alpha.$$\n\nLa VaR peut se calculer suivant trois approches :\n1. **Approche historique** : On se base sur les rendements passés selon l'horizon fixé pour estimer la VaR, à l'aide d'un quantile empirique d'ordre $\\alpha$. Autrement, on peut se baser sur les rendements journaliers et utiliser la méthode de **scaling**.\n2. **Approche bootstrap** : On tire aléatoirement des échantillons de rendements passés avec remise, puis on prend le quantile empirique d'ordre $\\alpha$ pour calculer la VaR de chaque échantillon. La VaR finale est la moyenne des VaR obtenues.\n\n### II.2.1. Historique\n\n::: {#d02fc6bb .cell execution_count=16}\n``` {.python .cell-code}\n# Objectif : implémenter une fonction calculant la VaR historique\n\ndef historical_var(data, alpha=0.99):\n    \"\"\"\n    Calcul de la VaR historique\n    data : les rendements logarithmiques\n    alpha : le niveau de confiance\n    \"\"\"\n    return -np.percentile(data, 100*(1- alpha))\n```\n:::\n\n\n::: {#b1b0fc65 .cell execution_count=17}\n``` {.python .cell-code}\n# Calcul de la VaR historique sur l'échantillon d'entrainement pour h=1j et alpha=0.99\nalpha = 0.99\nvar_hist_train = historical_var(data_train, alpha=alpha)\nprint(f\"La VaR historique pour h=1j et alpha=0.99 est : {var_hist_train:.4%}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLa VaR historique pour h=1j et alpha=0.99 est : 4.0850%\n```\n:::\n:::\n\n\nOn constate que la VaR historique pour une horizon de 1 jour et un niveau de confiance de 99% est de -4,09%. De ce fait, la perte maximale que l'on peut subir avec un niveau de confiance de 99% sur un jour est de 4,09%. Autrement dit, il y a 1 chance sur 100 que la perte soit supérieure à 4,09%. Cette perte peut se produire 2 à 3 ans fois en une année (252 jours de trading).\n\n### II.2.2. Bootstrap\n\nPour l'implémentation de la VaR bootstrap, nous faisons le choix de faire un tirage de taille n=la taille de la série des rendements, avec remise. Ce choix est fait pour des raisons de simplicité. En ce qui concerne le choix du nombre d'échantillons, nous allons observer l'évolution de de l'estimation de la VaR en fonction du nombre d'échantillons. Nous limiterons à des échantillons compris entre 1000 et 10000, pour des raisons de temps computationnels, en ayant conscience que plus le nombre d'échantillons est grand, plus l'estimation de la VaR sera précise.\n\n::: {#5da3e799 .cell execution_count=18}\n``` {.python .cell-code}\n# Objectif : implémenter une fonction calculant la VaR bootstrap et un IC\n\ndef bootstrap_var(data, alpha=0.99, M=1000, seuil=0.05):\n    \"\"\"\n    Calcul de la VaR bootstrap\n    data : les rendements logarithmiques\n    alpha : le niveau de confiance de la VaR\n    n : le nombre de simulations\n    seuil : le seuil de l'intervalle de confiance\n    \"\"\"\n    # set seed\n    np.random.seed(42)\n\n    # Initialisation du vecteur des VaR\n    var = np.zeros(M)\n\n    # Calcul de la VaR bootstrap\n    for i in range(M):\n        sample = np.random.choice(data, size=len(data), replace=True)\n        var[i] = -np.percentile(sample, 100*(1- alpha))\n\n    # Calcul de l'intervalle de confiance\n    lower = np.percentile(var, 100*(1-seuil)/2)\n    upper = np.percentile(var, 100*(seuil + (1-seuil)/2))\n\n    return np.mean(var), lower, upper\n```\n:::\n\n\n::: {#1a41bce3 .cell execution_count=19}\n``` {.python .cell-code}\n# Observer la variation de la VaR en fonction de M\nM_values = np.arange(1000, 10000, 10)\nvar_bs_values = []\n\nfor M in tqdm(M_values):\n    var_bs_train, _, _ = bootstrap_var(data_train, alpha=alpha, M=M)\n    var_bs_values.append(var_bs_train)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\r  0%|          | 0/900 [00:00<?, ?it/s]\r  0%|          | 2/900 [00:00<00:57, 15.54it/s]\r  0%|          | 4/900 [00:00<00:58, 15.20it/s]\r  1%|          | 6/900 [00:00<00:58, 15.25it/s]\r  1%|          | 8/900 [00:00<00:58, 15.17it/s]\r  1%|          | 10/900 [00:00<00:59, 15.02it/s]\r  1%|▏         | 12/900 [00:00<01:00, 14.72it/s]\r  2%|▏         | 14/900 [00:00<01:01, 14.52it/s]\r  2%|▏         | 16/900 [00:01<01:01, 14.34it/s]\r  2%|▏         | 18/900 [00:01<01:02, 14.16it/s]\r  2%|▏         | 20/900 [00:01<01:03, 13.92it/s]\r  2%|▏         | 22/900 [00:01<01:03, 13.73it/s]\r  3%|▎         | 24/900 [00:01<01:05, 13.47it/s]\r  3%|▎         | 26/900 [00:01<01:05, 13.29it/s]\r  3%|▎         | 28/900 [00:01<01:06, 13.10it/s]\r  3%|▎         | 30/900 [00:02<01:07, 12.88it/s]\r  4%|▎         | 32/900 [00:02<01:08, 12.70it/s]\r  4%|▍         | 34/900 [00:02<01:09, 12.52it/s]\r  4%|▍         | 36/900 [00:02<01:10, 12.26it/s]\r  4%|▍         | 38/900 [00:02<01:11, 12.07it/s]\r  4%|▍         | 40/900 [00:03<01:12, 11.91it/s]\r  5%|▍         | 42/900 [00:03<01:13, 11.72it/s]\r  5%|▍         | 44/900 [00:03<01:14, 11.57it/s]\r  5%|▌         | 46/900 [00:03<01:15, 11.38it/s]\r  5%|▌         | 48/900 [00:03<01:15, 11.22it/s]\r  6%|▌         | 50/900 [00:03<01:16, 11.05it/s]\r  6%|▌         | 52/900 [00:04<01:17, 10.90it/s]\r  6%|▌         | 54/900 [00:04<01:18, 10.75it/s]\r  6%|▌         | 56/900 [00:04<01:19, 10.62it/s]\r  6%|▋         | 58/900 [00:04<01:20, 10.47it/s]\r  7%|▋         | 60/900 [00:04<01:21, 10.32it/s]\r  7%|▋         | 62/900 [00:05<01:22, 10.18it/s]\r  7%|▋         | 64/900 [00:05<01:23, 10.04it/s]\r  7%|▋         | 66/900 [00:05<01:24,  9.92it/s]\r  7%|▋         | 67/900 [00:05<01:24,  9.87it/s]\r  8%|▊         | 68/900 [00:05<01:25,  9.78it/s]\r  8%|▊         | 69/900 [00:05<01:25,  9.72it/s]\r  8%|▊         | 70/900 [00:05<01:26,  9.63it/s]\r  8%|▊         | 71/900 [00:06<01:26,  9.56it/s]\r  8%|▊         | 72/900 [00:06<01:27,  9.50it/s]\r  8%|▊         | 73/900 [00:06<01:27,  9.41it/s]\r  8%|▊         | 74/900 [00:06<01:28,  9.36it/s]\r  8%|▊         | 75/900 [00:06<01:28,  9.31it/s]\r  8%|▊         | 76/900 [00:06<01:29,  9.24it/s]\r  9%|▊         | 77/900 [00:06<01:29,  9.17it/s]\r  9%|▊         | 78/900 [00:06<01:30,  9.12it/s]\r  9%|▉         | 79/900 [00:06<01:30,  9.08it/s]\r  9%|▉         | 80/900 [00:07<01:30,  9.01it/s]\r  9%|▉         | 81/900 [00:07<01:31,  8.98it/s]\r  9%|▉         | 82/900 [00:07<01:31,  8.90it/s]\r  9%|▉         | 83/900 [00:07<01:32,  8.87it/s]\r  9%|▉         | 84/900 [00:07<01:32,  8.82it/s]\r  9%|▉         | 85/900 [00:07<01:32,  8.77it/s]\r 10%|▉         | 86/900 [00:07<01:33,  8.70it/s]\r 10%|▉         | 87/900 [00:07<01:34,  8.64it/s]\r 10%|▉         | 88/900 [00:07<01:34,  8.59it/s]\r 10%|▉         | 89/900 [00:08<01:34,  8.54it/s]\r 10%|█         | 90/900 [00:08<01:35,  8.49it/s]\r 10%|█         | 91/900 [00:08<01:35,  8.47it/s]\r 10%|█         | 92/900 [00:08<01:35,  8.45it/s]\r 10%|█         | 93/900 [00:08<01:35,  8.41it/s]\r 10%|█         | 94/900 [00:08<01:36,  8.37it/s]\r 11%|█         | 95/900 [00:08<01:36,  8.32it/s]\r 11%|█         | 96/900 [00:08<01:37,  8.25it/s]\r 11%|█         | 97/900 [00:09<01:37,  8.20it/s]\r 11%|█         | 98/900 [00:09<01:38,  8.17it/s]\r 11%|█         | 99/900 [00:09<01:38,  8.10it/s]\r 11%|█         | 100/900 [00:09<01:38,  8.08it/s]\r 11%|█         | 101/900 [00:09<01:39,  8.03it/s]\r 11%|█▏        | 102/900 [00:09<01:39,  8.01it/s]\r 11%|█▏        | 103/900 [00:09<01:39,  7.98it/s]\r 12%|█▏        | 104/900 [00:09<01:40,  7.95it/s]\r 12%|█▏        | 105/900 [00:10<01:40,  7.90it/s]\r 12%|█▏        | 106/900 [00:10<01:40,  7.87it/s]\r 12%|█▏        | 107/900 [00:10<01:41,  7.81it/s]\r 12%|█▏        | 108/900 [00:10<01:42,  7.70it/s]\r 12%|█▏        | 109/900 [00:10<01:43,  7.66it/s]\r 12%|█▏        | 110/900 [00:10<01:43,  7.63it/s]\r 12%|█▏        | 111/900 [00:10<01:44,  7.58it/s]\r 12%|█▏        | 112/900 [00:10<01:44,  7.56it/s]\r 13%|█▎        | 113/900 [00:11<01:45,  7.48it/s]\r 13%|█▎        | 114/900 [00:11<01:45,  7.43it/s]\r 13%|█▎        | 115/900 [00:11<01:49,  7.18it/s]\r 13%|█▎        | 116/900 [00:11<01:48,  7.23it/s]\r 13%|█▎        | 117/900 [00:11<01:47,  7.28it/s]\r 13%|█▎        | 118/900 [00:11<01:48,  7.19it/s]\r 13%|█▎        | 119/900 [00:11<01:48,  7.22it/s]\r 13%|█▎        | 120/900 [00:12<01:48,  7.18it/s]\r 13%|█▎        | 121/900 [00:12<01:48,  7.20it/s]\r 14%|█▎        | 122/900 [00:12<01:48,  7.16it/s]\r 14%|█▎        | 123/900 [00:12<01:49,  7.09it/s]\r 14%|█▍        | 124/900 [00:12<01:49,  7.11it/s]\r 14%|█▍        | 125/900 [00:12<01:50,  6.98it/s]\r 14%|█▍        | 126/900 [00:12<01:50,  7.01it/s]\r 14%|█▍        | 127/900 [00:13<01:51,  6.95it/s]\r 14%|█▍        | 128/900 [00:13<01:51,  6.92it/s]\r 14%|█▍        | 129/900 [00:13<01:53,  6.82it/s]\r 14%|█▍        | 130/900 [00:13<01:53,  6.81it/s]\r 15%|█▍        | 131/900 [00:13<01:52,  6.81it/s]\r 15%|█▍        | 132/900 [00:13<01:53,  6.79it/s]\r 15%|█▍        | 133/900 [00:13<01:52,  6.81it/s]\r 15%|█▍        | 134/900 [00:14<01:53,  6.75it/s]\r 15%|█▌        | 135/900 [00:14<01:53,  6.72it/s]\r 15%|█▌        | 136/900 [00:14<01:54,  6.66it/s]\r 15%|█▌        | 137/900 [00:14<01:56,  6.56it/s]\r 15%|█▌        | 138/900 [00:14<01:55,  6.61it/s]\r 15%|█▌        | 139/900 [00:14<01:56,  6.53it/s]\r 16%|█▌        | 140/900 [00:15<01:56,  6.53it/s]\r 16%|█▌        | 141/900 [00:15<01:55,  6.56it/s]\r 16%|█▌        | 142/900 [00:15<01:56,  6.48it/s]\r 16%|█▌        | 143/900 [00:15<01:56,  6.49it/s]\r 16%|█▌        | 144/900 [00:15<01:57,  6.44it/s]\r 16%|█▌        | 145/900 [00:15<01:57,  6.43it/s]\r 16%|█▌        | 146/900 [00:15<01:57,  6.44it/s]\r 16%|█▋        | 147/900 [00:16<01:58,  6.37it/s]\r 16%|█▋        | 148/900 [00:16<01:58,  6.33it/s]\r 17%|█▋        | 149/900 [00:16<02:02,  6.11it/s]\r 17%|█▋        | 150/900 [00:16<02:03,  6.09it/s]\r 17%|█▋        | 151/900 [00:16<02:01,  6.15it/s]\r 17%|█▋        | 152/900 [00:16<02:00,  6.21it/s]\r 17%|█▋        | 153/900 [00:17<02:01,  6.12it/s]\r 17%|█▋        | 154/900 [00:17<02:01,  6.14it/s]\r 17%|█▋        | 155/900 [00:17<02:00,  6.19it/s]\r 17%|█▋        | 156/900 [00:17<02:00,  6.20it/s]\r 17%|█▋        | 157/900 [00:17<02:01,  6.13it/s]\r 18%|█▊        | 158/900 [00:17<02:00,  6.14it/s]\r 18%|█▊        | 159/900 [00:18<02:00,  6.16it/s]\r 18%|█▊        | 160/900 [00:18<02:03,  5.99it/s]\r 18%|█▊        | 161/900 [00:18<02:03,  5.97it/s]\r 18%|█▊        | 162/900 [00:18<02:03,  5.98it/s]\r 18%|█▊        | 163/900 [00:18<02:02,  6.02it/s]\r 18%|█▊        | 164/900 [00:18<02:01,  6.05it/s]\r 18%|█▊        | 165/900 [00:19<02:02,  6.02it/s]\r 18%|█▊        | 166/900 [00:19<02:02,  5.99it/s]\r 19%|█▊        | 167/900 [00:19<02:02,  6.00it/s]\r 19%|█▊        | 168/900 [00:19<02:02,  6.00it/s]\r 19%|█▉        | 169/900 [00:19<02:02,  5.99it/s]\r 19%|█▉        | 170/900 [00:19<02:02,  5.98it/s]\r 19%|█▉        | 171/900 [00:20<02:02,  5.97it/s]\r 19%|█▉        | 172/900 [00:20<02:03,  5.92it/s]\r 19%|█▉        | 173/900 [00:20<02:03,  5.89it/s]\r 19%|█▉        | 174/900 [00:20<02:04,  5.85it/s]\r 19%|█▉        | 175/900 [00:20<02:03,  5.85it/s]\r 20%|█▉        | 176/900 [00:21<02:13,  5.42it/s]\r 20%|█▉        | 177/900 [00:21<02:11,  5.49it/s]\r 20%|█▉        | 178/900 [00:21<02:09,  5.56it/s]\r 20%|█▉        | 179/900 [00:21<02:08,  5.60it/s]\r 20%|██        | 180/900 [00:21<02:10,  5.53it/s]\r 20%|██        | 181/900 [00:21<02:16,  5.27it/s]\r 20%|██        | 182/900 [00:22<02:13,  5.38it/s]\r 20%|██        | 183/900 [00:22<02:11,  5.46it/s]\r 20%|██        | 184/900 [00:22<02:09,  5.52it/s]\r 21%|██        | 185/900 [00:22<02:09,  5.51it/s]\r 21%|██        | 186/900 [00:22<02:09,  5.51it/s]\r 21%|██        | 187/900 [00:23<02:09,  5.51it/s]\r 21%|██        | 188/900 [00:23<02:08,  5.53it/s]\r 21%|██        | 189/900 [00:23<02:08,  5.53it/s]\r 21%|██        | 190/900 [00:23<02:08,  5.53it/s]\r 21%|██        | 191/900 [00:23<02:08,  5.53it/s]\r 21%|██▏       | 192/900 [00:23<02:08,  5.49it/s]\r 21%|██▏       | 193/900 [00:24<02:08,  5.48it/s]\r 22%|██▏       | 194/900 [00:24<02:08,  5.48it/s]\r 22%|██▏       | 195/900 [00:24<02:08,  5.47it/s]\r 22%|██▏       | 196/900 [00:24<02:11,  5.35it/s]\r 22%|██▏       | 197/900 [00:24<02:11,  5.35it/s]\r 22%|██▏       | 198/900 [00:25<02:11,  5.35it/s]\r 22%|██▏       | 199/900 [00:25<02:11,  5.35it/s]\r 22%|██▏       | 200/900 [00:25<02:10,  5.36it/s]\r 22%|██▏       | 201/900 [00:25<02:10,  5.36it/s]\r 22%|██▏       | 202/900 [00:25<02:10,  5.35it/s]\r 23%|██▎       | 203/900 [00:25<02:10,  5.34it/s]\r 23%|██▎       | 204/900 [00:26<02:10,  5.33it/s]\r 23%|██▎       | 205/900 [00:26<02:14,  5.16it/s]\r 23%|██▎       | 206/900 [00:26<02:17,  5.05it/s]\r 23%|██▎       | 207/900 [00:26<02:16,  5.07it/s]\r 23%|██▎       | 208/900 [00:26<02:15,  5.11it/s]\r 23%|██▎       | 209/900 [00:27<02:15,  5.12it/s]\r 23%|██▎       | 210/900 [00:27<02:14,  5.11it/s]\r 23%|██▎       | 211/900 [00:27<02:14,  5.13it/s]\r 24%|██▎       | 212/900 [00:27<02:22,  4.83it/s]\r 24%|██▎       | 213/900 [00:27<02:22,  4.84it/s]\r 24%|██▍       | 214/900 [00:28<02:19,  4.91it/s]\r 24%|██▍       | 215/900 [00:28<02:23,  4.77it/s]\r 24%|██▍       | 216/900 [00:28<02:25,  4.69it/s]\r 24%|██▍       | 217/900 [00:28<02:23,  4.75it/s]\r 24%|██▍       | 218/900 [00:29<02:24,  4.72it/s]\r 24%|██▍       | 219/900 [00:29<02:25,  4.67it/s]\r 24%|██▍       | 220/900 [00:29<02:23,  4.74it/s]\r 25%|██▍       | 221/900 [00:29<02:20,  4.82it/s]\r 25%|██▍       | 222/900 [00:29<02:31,  4.47it/s]\r 25%|██▍       | 223/900 [00:30<02:28,  4.55it/s]\r 25%|██▍       | 224/900 [00:30<02:25,  4.63it/s]\r 25%|██▌       | 225/900 [00:30<02:33,  4.41it/s]\r 25%|██▌       | 226/900 [00:30<02:31,  4.44it/s]\r 25%|██▌       | 227/900 [00:31<02:27,  4.55it/s]\r 25%|██▌       | 228/900 [00:31<02:25,  4.63it/s]\r 25%|██▌       | 229/900 [00:31<02:23,  4.69it/s]\r 26%|██▌       | 230/900 [00:31<02:29,  4.48it/s]\r 26%|██▌       | 231/900 [00:31<02:28,  4.51it/s]\r 26%|██▌       | 232/900 [00:32<02:25,  4.59it/s]\r 26%|██▌       | 233/900 [00:32<02:23,  4.65it/s]\r 26%|██▌       | 234/900 [00:32<02:21,  4.70it/s]\r 26%|██▌       | 235/900 [00:32<02:20,  4.73it/s]\r 26%|██▌       | 236/900 [00:32<02:19,  4.75it/s]\r 26%|██▋       | 237/900 [00:33<02:20,  4.72it/s]\r 26%|██▋       | 238/900 [00:33<02:28,  4.45it/s]\r 27%|██▋       | 239/900 [00:33<02:27,  4.48it/s]\r 27%|██▋       | 240/900 [00:33<02:25,  4.55it/s]\r 27%|██▋       | 241/900 [00:34<02:30,  4.36it/s]\r 27%|██▋       | 242/900 [00:34<02:30,  4.38it/s]\r 27%|██▋       | 243/900 [00:34<02:27,  4.44it/s]\r 27%|██▋       | 244/900 [00:34<02:25,  4.51it/s]\r 27%|██▋       | 245/900 [00:34<02:24,  4.53it/s]\r 27%|██▋       | 246/900 [00:35<02:24,  4.54it/s]\r 27%|██▋       | 247/900 [00:35<02:22,  4.57it/s]\r 28%|██▊       | 248/900 [00:35<02:22,  4.59it/s]\r 28%|██▊       | 249/900 [00:35<02:21,  4.59it/s]\r 28%|██▊       | 250/900 [00:36<02:21,  4.59it/s]\r 28%|██▊       | 251/900 [00:36<02:25,  4.47it/s]\r 28%|██▊       | 252/900 [00:36<02:33,  4.21it/s]\r 28%|██▊       | 253/900 [00:36<02:32,  4.23it/s]\r 28%|██▊       | 254/900 [00:37<02:29,  4.32it/s]\r 28%|██▊       | 255/900 [00:37<02:28,  4.36it/s]\r 28%|██▊       | 256/900 [00:37<02:27,  4.38it/s]\r 29%|██▊       | 257/900 [00:37<02:26,  4.39it/s]\r 29%|██▊       | 258/900 [00:37<02:32,  4.22it/s]\r 29%|██▉       | 259/900 [00:38<02:37,  4.07it/s]\r 29%|██▉       | 260/900 [00:38<02:34,  4.15it/s]\r 29%|██▉       | 261/900 [00:38<02:30,  4.24it/s]\r 29%|██▉       | 262/900 [00:38<02:35,  4.10it/s]\r 29%|██▉       | 263/900 [00:39<02:37,  4.05it/s]\r 29%|██▉       | 264/900 [00:39<02:34,  4.11it/s]\r 29%|██▉       | 265/900 [00:39<02:37,  4.03it/s]\r 30%|██▉       | 266/900 [00:39<02:36,  4.06it/s]\r 30%|██▉       | 267/900 [00:40<02:32,  4.14it/s]\r 30%|██▉       | 268/900 [00:40<02:34,  4.09it/s]\r 30%|██▉       | 269/900 [00:40<02:39,  3.97it/s]\r 30%|███       | 270/900 [00:40<02:36,  4.02it/s]\r 30%|███       | 271/900 [00:41<02:38,  3.96it/s]\r 30%|███       | 272/900 [00:41<02:40,  3.92it/s]\r 30%|███       | 273/900 [00:41<02:35,  4.02it/s]\r 30%|███       | 274/900 [00:41<02:33,  4.07it/s]\r 31%|███       | 275/900 [00:42<02:31,  4.13it/s]\r 31%|███       | 276/900 [00:42<02:30,  4.16it/s]\r 31%|███       | 277/900 [00:42<02:39,  3.90it/s]\r 31%|███       | 278/900 [00:42<02:37,  3.94it/s]\r 31%|███       | 279/900 [00:43<02:34,  4.01it/s]\r 31%|███       | 280/900 [00:43<02:32,  4.06it/s]\r 31%|███       | 281/900 [00:43<02:30,  4.10it/s]\r 31%|███▏      | 282/900 [00:43<02:29,  4.13it/s]\r 31%|███▏      | 283/900 [00:44<02:37,  3.91it/s]\r 32%|███▏      | 284/900 [00:44<02:36,  3.95it/s]\r 32%|███▏      | 285/900 [00:44<02:33,  4.01it/s]\r 32%|███▏      | 286/900 [00:44<02:31,  4.04it/s]\r 32%|███▏      | 287/900 [00:45<02:33,  3.99it/s]\r 32%|███▏      | 288/900 [00:45<02:36,  3.90it/s]\r 32%|███▏      | 289/900 [00:45<02:34,  3.94it/s]\r 32%|███▏      | 290/900 [00:45<02:32,  3.99it/s]\r 32%|███▏      | 291/900 [00:46<02:45,  3.67it/s]\r 32%|███▏      | 292/900 [00:46<02:41,  3.76it/s]\r 33%|███▎      | 293/900 [00:46<02:38,  3.83it/s]\r 33%|███▎      | 294/900 [00:47<02:39,  3.80it/s]\r 33%|███▎      | 295/900 [00:47<02:41,  3.75it/s]\r 33%|███▎      | 296/900 [00:47<02:38,  3.82it/s]\r 33%|███▎      | 297/900 [00:47<02:35,  3.87it/s]\r 33%|███▎      | 298/900 [00:48<02:33,  3.92it/s]\r 33%|███▎      | 299/900 [00:48<02:41,  3.73it/s]\r 33%|███▎      | 300/900 [00:48<02:39,  3.75it/s]\r 33%|███▎      | 301/900 [00:48<02:36,  3.83it/s]\r 34%|███▎      | 302/900 [00:49<02:44,  3.65it/s]\r 34%|███▎      | 303/900 [00:49<02:43,  3.65it/s]\r 34%|███▍      | 304/900 [00:49<02:39,  3.73it/s]\r 34%|███▍      | 305/900 [00:49<02:40,  3.70it/s]\r 34%|███▍      | 306/900 [00:50<02:37,  3.76it/s]\r 34%|███▍      | 307/900 [00:50<02:39,  3.72it/s]\r 34%|███▍      | 308/900 [00:50<02:43,  3.62it/s]\r 34%|███▍      | 309/900 [00:51<02:40,  3.69it/s]\r 34%|███▍      | 310/900 [00:51<02:37,  3.75it/s]\r 35%|███▍      | 311/900 [00:51<02:38,  3.73it/s]\r 35%|███▍      | 312/900 [00:51<02:36,  3.76it/s]\r 35%|███▍      | 313/900 [00:52<02:35,  3.78it/s]\r 35%|███▍      | 314/900 [00:52<02:40,  3.65it/s]\r 35%|███▌      | 315/900 [00:52<02:42,  3.60it/s]\r 35%|███▌      | 316/900 [00:52<02:39,  3.66it/s]\r 35%|███▌      | 317/900 [00:53<02:42,  3.59it/s]\r 35%|███▌      | 318/900 [00:53<02:41,  3.60it/s]\r 35%|███▌      | 319/900 [00:53<02:38,  3.67it/s]\r 36%|███▌      | 320/900 [00:54<02:37,  3.68it/s]\r 36%|███▌      | 321/900 [00:54<02:35,  3.72it/s]\r 36%|███▌      | 322/900 [00:54<02:34,  3.75it/s]\r 36%|███▌      | 323/900 [00:54<02:39,  3.62it/s]\r 36%|███▌      | 324/900 [00:55<02:40,  3.59it/s]\r 36%|███▌      | 325/900 [00:55<02:38,  3.64it/s]\r 36%|███▌      | 326/900 [00:55<02:36,  3.66it/s]\r 36%|███▋      | 327/900 [00:55<02:35,  3.67it/s]\r 36%|███▋      | 328/900 [00:56<02:34,  3.69it/s]\r 37%|███▋      | 329/900 [00:56<02:34,  3.70it/s]\r 37%|███▋      | 330/900 [00:56<02:33,  3.71it/s]\r 37%|███▋      | 331/900 [00:57<02:35,  3.67it/s]\r 37%|███▋      | 332/900 [00:57<02:34,  3.68it/s]\r 37%|███▋      | 333/900 [00:57<02:34,  3.67it/s]\r 37%|███▋      | 334/900 [00:57<02:41,  3.50it/s]\r 37%|███▋      | 335/900 [00:58<02:39,  3.53it/s]\r 37%|███▋      | 336/900 [00:58<02:38,  3.56it/s]\r 37%|███▋      | 337/900 [00:58<02:37,  3.58it/s]\r 38%|███▊      | 338/900 [00:58<02:37,  3.57it/s]\r 38%|███▊      | 339/900 [00:59<02:41,  3.48it/s]\r 38%|███▊      | 340/900 [00:59<02:39,  3.52it/s]\r 38%|███▊      | 341/900 [00:59<02:44,  3.41it/s]\r 38%|███▊      | 342/900 [01:00<02:41,  3.45it/s]\r 38%|███▊      | 343/900 [01:00<02:46,  3.35it/s]\r 38%|███▊      | 344/900 [01:00<02:46,  3.34it/s]\r 38%|███▊      | 345/900 [01:01<02:42,  3.41it/s]\r 38%|███▊      | 346/900 [01:01<02:50,  3.25it/s]\r 39%|███▊      | 347/900 [01:01<02:48,  3.28it/s]\r 39%|███▊      | 348/900 [01:01<02:44,  3.36it/s]\r 39%|███▉      | 349/900 [01:02<02:49,  3.24it/s]\r 39%|███▉      | 350/900 [01:02<02:46,  3.31it/s]\r 39%|███▉      | 351/900 [01:02<02:42,  3.38it/s]\r 39%|███▉      | 352/900 [01:03<02:40,  3.42it/s]\r 39%|███▉      | 353/900 [01:03<02:38,  3.45it/s]\r 39%|███▉      | 354/900 [01:03<02:37,  3.48it/s]\r 39%|███▉      | 355/900 [01:04<02:36,  3.48it/s]\r 40%|███▉      | 356/900 [01:04<02:35,  3.49it/s]\r 40%|███▉      | 357/900 [01:04<02:38,  3.43it/s]\r 40%|███▉      | 358/900 [01:04<02:37,  3.43it/s]\r 40%|███▉      | 359/900 [01:05<02:43,  3.31it/s]\r 40%|████      | 360/900 [01:05<02:44,  3.28it/s]\r 40%|████      | 361/900 [01:05<02:41,  3.34it/s]\r 40%|████      | 362/900 [01:06<02:39,  3.37it/s]\r 40%|████      | 363/900 [01:06<02:45,  3.24it/s]\r 40%|████      | 364/900 [01:06<02:47,  3.21it/s]\r 41%|████      | 365/900 [01:07<02:43,  3.27it/s]\r 41%|████      | 366/900 [01:07<02:41,  3.31it/s]\r 41%|████      | 367/900 [01:07<02:39,  3.35it/s]\r 41%|████      | 368/900 [01:08<02:47,  3.18it/s]\r 41%|████      | 369/900 [01:08<02:43,  3.24it/s]\r 41%|████      | 370/900 [01:08<02:49,  3.13it/s]\r 41%|████      | 371/900 [01:08<02:44,  3.21it/s]\r 41%|████▏     | 372/900 [01:09<02:42,  3.25it/s]\r 41%|████▏     | 373/900 [01:09<02:49,  3.11it/s]\r 42%|████▏     | 374/900 [01:09<02:47,  3.15it/s]\r 42%|████▏     | 375/900 [01:10<02:43,  3.21it/s]\r 42%|████▏     | 376/900 [01:10<02:41,  3.24it/s]\r 42%|████▏     | 377/900 [01:10<02:39,  3.28it/s]\r 42%|████▏     | 378/900 [01:11<02:38,  3.30it/s]\r 42%|████▏     | 379/900 [01:11<02:36,  3.32it/s]\r 42%|████▏     | 380/900 [01:11<02:38,  3.28it/s]\r 42%|████▏     | 381/900 [01:12<02:37,  3.30it/s]\r 42%|████▏     | 382/900 [01:12<02:36,  3.31it/s]\r 43%|████▎     | 383/900 [01:12<02:36,  3.31it/s]\r 43%|████▎     | 384/900 [01:12<02:35,  3.31it/s]\r 43%|████▎     | 385/900 [01:13<02:36,  3.30it/s]\r 43%|████▎     | 386/900 [01:13<02:35,  3.30it/s]\r 43%|████▎     | 387/900 [01:13<02:35,  3.30it/s]\r 43%|████▎     | 388/900 [01:14<02:35,  3.30it/s]\r 43%|████▎     | 389/900 [01:14<02:35,  3.29it/s]\r 43%|████▎     | 390/900 [01:14<02:34,  3.29it/s]\r 43%|████▎     | 391/900 [01:15<02:41,  3.15it/s]\r 44%|████▎     | 392/900 [01:15<02:40,  3.16it/s]\r 44%|████▎     | 393/900 [01:15<02:39,  3.18it/s]\r 44%|████▍     | 394/900 [01:16<02:38,  3.19it/s]\r 44%|████▍     | 395/900 [01:16<02:38,  3.19it/s]\r 44%|████▍     | 396/900 [01:16<02:44,  3.06it/s]\r 44%|████▍     | 397/900 [01:17<02:44,  3.07it/s]\r 44%|████▍     | 398/900 [01:17<02:41,  3.11it/s]\r 44%|████▍     | 399/900 [01:17<02:49,  2.96it/s]\r 44%|████▍     | 400/900 [01:18<02:46,  3.00it/s]\r 45%|████▍     | 401/900 [01:18<02:49,  2.95it/s]\r 45%|████▍     | 402/900 [01:18<02:46,  3.00it/s]\r 45%|████▍     | 403/900 [01:19<02:43,  3.04it/s]\r 45%|████▍     | 404/900 [01:19<02:50,  2.91it/s]\r 45%|████▌     | 405/900 [01:19<02:46,  2.97it/s]\r 45%|████▌     | 406/900 [01:20<02:43,  3.02it/s]\r 45%|████▌     | 407/900 [01:20<02:41,  3.05it/s]\r 45%|████▌     | 408/900 [01:20<02:40,  3.07it/s]\r 45%|████▌     | 409/900 [01:20<02:38,  3.10it/s]\r 46%|████▌     | 410/900 [01:21<02:39,  3.07it/s]\r 46%|████▌     | 411/900 [01:21<02:38,  3.09it/s]\r 46%|████▌     | 412/900 [01:21<02:37,  3.10it/s]\r 46%|████▌     | 413/900 [01:22<02:37,  3.10it/s]\r 46%|████▌     | 414/900 [01:22<02:36,  3.11it/s]\r 46%|████▌     | 415/900 [01:22<02:35,  3.11it/s]\r 46%|████▌     | 416/900 [01:23<02:35,  3.10it/s]\r 46%|████▋     | 417/900 [01:23<02:35,  3.11it/s]\r 46%|████▋     | 418/900 [01:23<02:35,  3.10it/s]\r 47%|████▋     | 419/900 [01:24<02:35,  3.09it/s]\r 47%|████▋     | 420/900 [01:24<02:35,  3.08it/s]\r 47%|████▋     | 421/900 [01:24<02:35,  3.08it/s]\r 47%|████▋     | 422/900 [01:25<02:34,  3.08it/s]\r 47%|████▋     | 423/900 [01:25<02:35,  3.07it/s]\r 47%|████▋     | 424/900 [01:25<02:35,  3.06it/s]\r 47%|████▋     | 425/900 [01:26<02:36,  3.04it/s]\r 47%|████▋     | 426/900 [01:26<02:36,  3.03it/s]\r 47%|████▋     | 427/900 [01:26<02:36,  3.03it/s]\r 48%|████▊     | 428/900 [01:27<02:36,  3.02it/s]\r 48%|████▊     | 429/900 [01:27<02:37,  3.00it/s]\r 48%|████▊     | 430/900 [01:27<02:36,  3.00it/s]\r 48%|████▊     | 431/900 [01:28<02:36,  3.00it/s]\r 48%|████▊     | 432/900 [01:28<02:36,  3.00it/s]\r 48%|████▊     | 433/900 [01:28<02:35,  3.00it/s]\r 48%|████▊     | 434/900 [01:29<02:35,  2.99it/s]\r 48%|████▊     | 435/900 [01:29<02:35,  2.99it/s]\r 48%|████▊     | 436/900 [01:29<02:35,  2.98it/s]\r 49%|████▊     | 437/900 [01:30<02:34,  2.99it/s]\r 49%|████▊     | 438/900 [01:30<02:35,  2.97it/s]\r 49%|████▉     | 439/900 [01:30<02:35,  2.96it/s]\r 49%|████▉     | 440/900 [01:31<02:35,  2.96it/s]\r 49%|████▉     | 441/900 [01:31<02:35,  2.95it/s]\r 49%|████▉     | 442/900 [01:31<02:35,  2.95it/s]\r 49%|████▉     | 443/900 [01:32<02:35,  2.94it/s]\r 49%|████▉     | 444/900 [01:32<02:35,  2.93it/s]\r 49%|████▉     | 445/900 [01:32<02:35,  2.94it/s]\r 50%|████▉     | 446/900 [01:33<02:34,  2.93it/s]\r 50%|████▉     | 447/900 [01:33<02:35,  2.92it/s]\r 50%|████▉     | 448/900 [01:33<02:36,  2.89it/s]\r 50%|████▉     | 449/900 [01:34<02:38,  2.85it/s]\r 50%|█████     | 450/900 [01:34<02:39,  2.83it/s]\r 50%|█████     | 451/900 [01:35<02:39,  2.82it/s]\r 50%|█████     | 452/900 [01:35<02:37,  2.84it/s]\r 50%|█████     | 453/900 [01:35<02:36,  2.85it/s]\r 50%|█████     | 454/900 [01:36<02:36,  2.86it/s]\r 51%|█████     | 455/900 [01:36<02:35,  2.87it/s]\r 51%|█████     | 456/900 [01:36<02:36,  2.84it/s]\r 51%|█████     | 457/900 [01:37<02:35,  2.85it/s]\r 51%|█████     | 458/900 [01:37<02:35,  2.85it/s]\r 51%|█████     | 459/900 [01:37<02:34,  2.85it/s]\r 51%|█████     | 460/900 [01:38<02:34,  2.85it/s]\r 51%|█████     | 461/900 [01:38<02:34,  2.85it/s]\r 51%|█████▏    | 462/900 [01:38<02:33,  2.85it/s]\r 51%|█████▏    | 463/900 [01:39<02:33,  2.86it/s]\r 52%|█████▏    | 464/900 [01:39<02:32,  2.86it/s]\r 52%|█████▏    | 465/900 [01:39<02:33,  2.84it/s]\r 52%|█████▏    | 466/900 [01:40<02:35,  2.78it/s]\r 52%|█████▏    | 467/900 [01:40<02:35,  2.78it/s]\r 52%|█████▏    | 468/900 [01:41<02:34,  2.79it/s]\r 52%|█████▏    | 469/900 [01:41<02:43,  2.63it/s]\r 52%|█████▏    | 470/900 [01:41<02:42,  2.65it/s]\r 52%|█████▏    | 471/900 [01:42<02:39,  2.69it/s]\r 52%|█████▏    | 472/900 [01:42<02:41,  2.65it/s]\r 53%|█████▎    | 473/900 [01:42<02:40,  2.66it/s]\r 53%|█████▎    | 474/900 [01:43<02:43,  2.61it/s]\r 53%|█████▎    | 475/900 [01:43<02:40,  2.64it/s]\r 53%|█████▎    | 476/900 [01:44<02:44,  2.58it/s]\r 53%|█████▎    | 477/900 [01:44<02:41,  2.62it/s]\r 53%|█████▎    | 478/900 [01:44<02:43,  2.59it/s]\r 53%|█████▎    | 479/900 [01:45<02:44,  2.56it/s]\r 53%|█████▎    | 480/900 [01:45<02:41,  2.60it/s]\r 53%|█████▎    | 481/900 [01:46<02:46,  2.52it/s]\r 54%|█████▎    | 482/900 [01:46<02:47,  2.50it/s]\r 54%|█████▎    | 483/900 [01:46<02:42,  2.56it/s]\r 54%|█████▍    | 484/900 [01:47<02:44,  2.52it/s]\r 54%|█████▍    | 485/900 [01:47<02:42,  2.56it/s]\r 54%|█████▍    | 486/900 [01:48<02:39,  2.60it/s]\r 54%|█████▍    | 487/900 [01:48<02:36,  2.63it/s]\r 54%|█████▍    | 488/900 [01:48<02:37,  2.61it/s]\r 54%|█████▍    | 489/900 [01:49<02:35,  2.64it/s]\r 54%|█████▍    | 490/900 [01:49<02:34,  2.66it/s]\r 55%|█████▍    | 491/900 [01:49<02:33,  2.67it/s]\r 55%|█████▍    | 492/900 [01:50<02:32,  2.68it/s]\r 55%|█████▍    | 493/900 [01:50<02:35,  2.61it/s]\r 55%|█████▍    | 494/900 [01:51<02:34,  2.63it/s]\r 55%|█████▌    | 495/900 [01:51<02:33,  2.64it/s]\r 55%|█████▌    | 496/900 [01:51<02:32,  2.65it/s]\r 55%|█████▌    | 497/900 [01:52<02:31,  2.66it/s]\r 55%|█████▌    | 498/900 [01:52<02:30,  2.67it/s]\r 55%|█████▌    | 499/900 [01:52<02:30,  2.67it/s]\r 56%|█████▌    | 500/900 [01:53<02:30,  2.66it/s]\r 56%|█████▌    | 501/900 [01:53<02:29,  2.66it/s]\r 56%|█████▌    | 502/900 [01:54<02:29,  2.65it/s]\r 56%|█████▌    | 503/900 [01:54<02:29,  2.65it/s]\r 56%|█████▌    | 504/900 [01:54<02:29,  2.65it/s]\r 56%|█████▌    | 505/900 [01:55<02:28,  2.65it/s]\r 56%|█████▌    | 506/900 [01:55<02:28,  2.65it/s]\r 56%|█████▋    | 507/900 [01:55<02:28,  2.65it/s]\r 56%|█████▋    | 508/900 [01:56<02:28,  2.64it/s]\r 57%|█████▋    | 509/900 [01:56<02:28,  2.64it/s]\r 57%|█████▋    | 510/900 [01:57<02:27,  2.64it/s]\r 57%|█████▋    | 511/900 [01:57<02:28,  2.63it/s]\r 57%|█████▋    | 512/900 [01:57<02:27,  2.63it/s]\r 57%|█████▋    | 513/900 [01:58<02:27,  2.62it/s]\r 57%|█████▋    | 514/900 [01:58<02:27,  2.62it/s]\r 57%|█████▋    | 515/900 [01:58<02:27,  2.62it/s]\r 57%|█████▋    | 516/900 [01:59<02:27,  2.60it/s]\r 57%|█████▋    | 517/900 [01:59<02:27,  2.60it/s]\r 58%|█████▊    | 518/900 [02:00<02:27,  2.59it/s]\r 58%|█████▊    | 519/900 [02:00<02:27,  2.58it/s]\r 58%|█████▊    | 520/900 [02:00<02:27,  2.58it/s]\r 58%|█████▊    | 521/900 [02:01<02:26,  2.58it/s]\r 58%|█████▊    | 522/900 [02:01<02:26,  2.58it/s]\r 58%|█████▊    | 523/900 [02:02<02:26,  2.57it/s]\r 58%|█████▊    | 524/900 [02:02<02:26,  2.57it/s]\r 58%|█████▊    | 525/900 [02:02<02:26,  2.56it/s]\r 58%|█████▊    | 526/900 [02:03<02:26,  2.56it/s]\r 59%|█████▊    | 527/900 [02:03<02:25,  2.56it/s]\r 59%|█████▊    | 528/900 [02:04<02:26,  2.55it/s]\r 59%|█████▉    | 529/900 [02:04<02:25,  2.54it/s]\r 59%|█████▉    | 530/900 [02:04<02:25,  2.54it/s]\r 59%|█████▉    | 531/900 [02:05<02:25,  2.53it/s]\r 59%|█████▉    | 532/900 [02:05<02:25,  2.54it/s]\r 59%|█████▉    | 533/900 [02:06<02:25,  2.53it/s]\r 59%|█████▉    | 534/900 [02:06<02:24,  2.52it/s]\r 59%|█████▉    | 535/900 [02:06<02:24,  2.52it/s]\r 60%|█████▉    | 536/900 [02:07<02:24,  2.52it/s]\r 60%|█████▉    | 537/900 [02:07<02:24,  2.52it/s]\r 60%|█████▉    | 538/900 [02:08<02:23,  2.52it/s]\r 60%|█████▉    | 539/900 [02:08<02:23,  2.52it/s]\r 60%|██████    | 540/900 [02:08<02:23,  2.51it/s]\r 60%|██████    | 541/900 [02:09<02:22,  2.51it/s]\r 60%|██████    | 542/900 [02:09<02:22,  2.51it/s]\r 60%|██████    | 543/900 [02:10<02:22,  2.51it/s]\r 60%|██████    | 544/900 [02:10<02:22,  2.49it/s]\r 61%|██████    | 545/900 [02:10<02:23,  2.48it/s]\r 61%|██████    | 546/900 [02:11<02:23,  2.47it/s]\r 61%|██████    | 547/900 [02:11<02:25,  2.43it/s]\r 61%|██████    | 548/900 [02:12<02:29,  2.36it/s]\r 61%|██████    | 549/900 [02:12<02:27,  2.38it/s]\r 61%|██████    | 550/900 [02:12<02:25,  2.40it/s]\r 61%|██████    | 551/900 [02:13<02:25,  2.41it/s]\r 61%|██████▏   | 552/900 [02:13<02:24,  2.41it/s]\r 61%|██████▏   | 553/900 [02:14<02:23,  2.41it/s]\r 62%|██████▏   | 554/900 [02:14<02:23,  2.41it/s]\r 62%|██████▏   | 555/900 [02:15<02:22,  2.41it/s]\r 62%|██████▏   | 556/900 [02:15<02:22,  2.41it/s]\r 62%|██████▏   | 557/900 [02:15<02:22,  2.41it/s]\r 62%|██████▏   | 558/900 [02:16<02:22,  2.40it/s]\r 62%|██████▏   | 559/900 [02:16<02:22,  2.40it/s]\r 62%|██████▏   | 560/900 [02:17<02:22,  2.39it/s]\r 62%|██████▏   | 561/900 [02:17<02:21,  2.39it/s]\r 62%|██████▏   | 562/900 [02:17<02:21,  2.39it/s]\r 63%|██████▎   | 563/900 [02:18<02:21,  2.39it/s]\r 63%|██████▎   | 564/900 [02:18<02:20,  2.39it/s]\r 63%|██████▎   | 565/900 [02:19<02:20,  2.39it/s]\r 63%|██████▎   | 566/900 [02:19<02:19,  2.39it/s]\r 63%|██████▎   | 567/900 [02:20<02:19,  2.39it/s]\r 63%|██████▎   | 568/900 [02:20<02:19,  2.37it/s]\r 63%|██████▎   | 569/900 [02:20<02:19,  2.37it/s]\r 63%|██████▎   | 570/900 [02:21<02:19,  2.37it/s]\r 63%|██████▎   | 571/900 [02:21<02:19,  2.36it/s]\r 64%|██████▎   | 572/900 [02:22<02:19,  2.36it/s]\r 64%|██████▎   | 573/900 [02:22<02:19,  2.35it/s]\r 64%|██████▍   | 574/900 [02:23<02:22,  2.29it/s]\r 64%|██████▍   | 575/900 [02:23<02:21,  2.29it/s]\r 64%|██████▍   | 576/900 [02:23<02:20,  2.31it/s]\r 64%|██████▍   | 577/900 [02:24<02:18,  2.33it/s]\r 64%|██████▍   | 578/900 [02:24<02:18,  2.33it/s]\r 64%|██████▍   | 579/900 [02:25<02:18,  2.31it/s]\r 64%|██████▍   | 580/900 [02:25<02:18,  2.31it/s]\r 65%|██████▍   | 581/900 [02:26<02:17,  2.31it/s]\r 65%|██████▍   | 582/900 [02:26<02:17,  2.32it/s]\r 65%|██████▍   | 583/900 [02:26<02:16,  2.32it/s]\r 65%|██████▍   | 584/900 [02:27<02:16,  2.31it/s]\r 65%|██████▌   | 585/900 [02:27<02:16,  2.31it/s]\r 65%|██████▌   | 586/900 [02:28<02:17,  2.29it/s]\r 65%|██████▌   | 587/900 [02:28<02:16,  2.29it/s]\r 65%|██████▌   | 588/900 [02:29<02:15,  2.30it/s]\r 65%|██████▌   | 589/900 [02:29<02:15,  2.30it/s]\r 66%|██████▌   | 590/900 [02:29<02:15,  2.29it/s]\r 66%|██████▌   | 591/900 [02:30<02:14,  2.29it/s]\r 66%|██████▌   | 592/900 [02:30<02:14,  2.29it/s]\r 66%|██████▌   | 593/900 [02:31<02:15,  2.26it/s]\r 66%|██████▌   | 594/900 [02:31<02:14,  2.27it/s]\r 66%|██████▌   | 595/900 [02:32<02:14,  2.27it/s]\r 66%|██████▌   | 596/900 [02:32<02:14,  2.27it/s]\r 66%|██████▋   | 597/900 [02:33<02:15,  2.23it/s]\r 66%|██████▋   | 598/900 [02:33<02:14,  2.24it/s]\r 67%|██████▋   | 599/900 [02:33<02:13,  2.25it/s]\r 67%|██████▋   | 600/900 [02:34<02:15,  2.22it/s]\r 67%|██████▋   | 601/900 [02:34<02:13,  2.24it/s]\r 67%|██████▋   | 602/900 [02:35<02:12,  2.24it/s]\r 67%|██████▋   | 603/900 [02:35<02:16,  2.18it/s]\r 67%|██████▋   | 604/900 [02:36<02:14,  2.20it/s]\r 67%|██████▋   | 605/900 [02:36<02:15,  2.18it/s]\r 67%|██████▋   | 606/900 [02:37<02:17,  2.14it/s]\r 67%|██████▋   | 607/900 [02:37<02:16,  2.15it/s]\r 68%|██████▊   | 608/900 [02:38<02:13,  2.18it/s]\r 68%|██████▊   | 609/900 [02:38<02:11,  2.21it/s]\r 68%|██████▊   | 610/900 [02:39<02:12,  2.19it/s]\r 68%|██████▊   | 611/900 [02:39<02:11,  2.20it/s]\r 68%|██████▊   | 612/900 [02:40<02:18,  2.07it/s]\r 68%|██████▊   | 613/900 [02:40<02:18,  2.07it/s]\r 68%|██████▊   | 614/900 [02:40<02:18,  2.07it/s]\r 68%|██████▊   | 615/900 [02:41<02:14,  2.11it/s]\r 68%|██████▊   | 616/900 [02:41<02:14,  2.12it/s]\r 69%|██████▊   | 617/900 [02:42<02:12,  2.14it/s]\r 69%|██████▊   | 618/900 [02:42<02:10,  2.16it/s]\r 69%|██████▉   | 619/900 [02:43<02:09,  2.17it/s]\r 69%|██████▉   | 620/900 [02:43<02:09,  2.17it/s]\r 69%|██████▉   | 621/900 [02:44<02:08,  2.18it/s]\r 69%|██████▉   | 622/900 [02:44<02:07,  2.18it/s]\r 69%|██████▉   | 623/900 [02:45<02:07,  2.17it/s]\r 69%|██████▉   | 624/900 [02:45<02:06,  2.18it/s]\r 69%|██████▉   | 625/900 [02:46<02:05,  2.19it/s]\r 70%|██████▉   | 626/900 [02:46<02:05,  2.18it/s]\r 70%|██████▉   | 627/900 [02:46<02:04,  2.18it/s]\r 70%|██████▉   | 628/900 [02:47<02:04,  2.19it/s]\r 70%|██████▉   | 629/900 [02:47<02:03,  2.19it/s]\r 70%|███████   | 630/900 [02:48<02:04,  2.17it/s]\r 70%|███████   | 631/900 [02:48<02:03,  2.18it/s]\r 70%|███████   | 632/900 [02:49<02:03,  2.18it/s]\r 70%|███████   | 633/900 [02:49<02:02,  2.18it/s]\r 70%|███████   | 634/900 [02:50<02:01,  2.18it/s]\r 71%|███████   | 635/900 [02:50<02:01,  2.18it/s]\r 71%|███████   | 636/900 [02:51<02:01,  2.17it/s]\r 71%|███████   | 637/900 [02:51<02:01,  2.17it/s]\r 71%|███████   | 638/900 [02:52<02:00,  2.17it/s]\r 71%|███████   | 639/900 [02:52<02:00,  2.17it/s]\r 71%|███████   | 640/900 [02:52<02:00,  2.16it/s]\r 71%|███████   | 641/900 [02:53<02:00,  2.16it/s]\r 71%|███████▏  | 642/900 [02:53<02:00,  2.15it/s]\r 71%|███████▏  | 643/900 [02:54<02:00,  2.14it/s]\r 72%|███████▏  | 644/900 [02:54<01:59,  2.14it/s]\r 72%|███████▏  | 645/900 [02:55<01:59,  2.14it/s]\r 72%|███████▏  | 646/900 [02:55<01:58,  2.14it/s]\r 72%|███████▏  | 647/900 [02:56<01:58,  2.14it/s]\r 72%|███████▏  | 648/900 [02:56<01:58,  2.13it/s]\r 72%|███████▏  | 649/900 [02:57<01:57,  2.14it/s]\r 72%|███████▏  | 650/900 [02:57<01:57,  2.13it/s]\r 72%|███████▏  | 651/900 [02:58<01:56,  2.13it/s]\r 72%|███████▏  | 652/900 [02:58<01:56,  2.13it/s]\r 73%|███████▎  | 653/900 [02:59<01:56,  2.13it/s]\r 73%|███████▎  | 654/900 [02:59<01:56,  2.12it/s]\r 73%|███████▎  | 655/900 [02:59<01:55,  2.12it/s]\r 73%|███████▎  | 656/900 [03:00<01:55,  2.11it/s]\r 73%|███████▎  | 657/900 [03:00<01:54,  2.11it/s]\r 73%|███████▎  | 658/900 [03:01<01:54,  2.11it/s]\r 73%|███████▎  | 659/900 [03:01<01:54,  2.11it/s]\r 73%|███████▎  | 660/900 [03:02<01:53,  2.11it/s]\r 73%|███████▎  | 661/900 [03:02<01:53,  2.11it/s]\r 74%|███████▎  | 662/900 [03:03<01:53,  2.10it/s]\r 74%|███████▎  | 663/900 [03:03<01:52,  2.10it/s]\r 74%|███████▍  | 664/900 [03:04<01:52,  2.10it/s]\r 74%|███████▍  | 665/900 [03:04<01:52,  2.10it/s]\r 74%|███████▍  | 666/900 [03:05<01:52,  2.09it/s]\r 74%|███████▍  | 667/900 [03:05<01:51,  2.08it/s]\r 74%|███████▍  | 668/900 [03:06<01:51,  2.08it/s]\r 74%|███████▍  | 669/900 [03:06<01:51,  2.07it/s]\r 74%|███████▍  | 670/900 [03:07<01:51,  2.07it/s]\r 75%|███████▍  | 671/900 [03:07<01:50,  2.07it/s]\r 75%|███████▍  | 672/900 [03:08<01:50,  2.07it/s]\r 75%|███████▍  | 673/900 [03:08<01:49,  2.07it/s]\r 75%|███████▍  | 674/900 [03:09<01:49,  2.06it/s]\r 75%|███████▌  | 675/900 [03:09<01:49,  2.06it/s]\r 75%|███████▌  | 676/900 [03:10<01:49,  2.05it/s]\r 75%|███████▌  | 677/900 [03:10<01:48,  2.05it/s]\r 75%|███████▌  | 678/900 [03:11<01:48,  2.05it/s]\r 75%|███████▌  | 679/900 [03:11<01:47,  2.05it/s]\r 76%|███████▌  | 680/900 [03:12<01:47,  2.05it/s]\r 76%|███████▌  | 681/900 [03:12<01:46,  2.05it/s]\r 76%|███████▌  | 682/900 [03:13<01:46,  2.04it/s]\r 76%|███████▌  | 683/900 [03:13<01:46,  2.04it/s]\r 76%|███████▌  | 684/900 [03:13<01:45,  2.04it/s]\r 76%|███████▌  | 685/900 [03:14<01:45,  2.04it/s]\r 76%|███████▌  | 686/900 [03:14<01:45,  2.03it/s]\r 76%|███████▋  | 687/900 [03:15<01:44,  2.04it/s]\r 76%|███████▋  | 688/900 [03:15<01:44,  2.04it/s]\r 77%|███████▋  | 689/900 [03:16<01:44,  2.03it/s]\r 77%|███████▋  | 690/900 [03:16<01:43,  2.03it/s]\r 77%|███████▋  | 691/900 [03:17<01:43,  2.03it/s]\r 77%|███████▋  | 692/900 [03:17<01:43,  2.02it/s]\r 77%|███████▋  | 693/900 [03:18<01:43,  2.01it/s]\r 77%|███████▋  | 694/900 [03:18<01:42,  2.01it/s]\r 77%|███████▋  | 695/900 [03:19<01:42,  2.00it/s]\r 77%|███████▋  | 696/900 [03:19<01:41,  2.00it/s]\r 77%|███████▋  | 697/900 [03:20<01:41,  2.00it/s]\r 78%|███████▊  | 698/900 [03:20<01:41,  2.00it/s]\r 78%|███████▊  | 699/900 [03:21<01:40,  2.00it/s]\r 78%|███████▊  | 700/900 [03:21<01:40,  2.00it/s]\r 78%|███████▊  | 701/900 [03:22<01:39,  1.99it/s]\r 78%|███████▊  | 702/900 [03:22<01:39,  1.99it/s]\r 78%|███████▊  | 703/900 [03:23<01:38,  1.99it/s]\r 78%|███████▊  | 704/900 [03:23<01:38,  1.99it/s]\r 78%|███████▊  | 705/900 [03:24<01:38,  1.99it/s]\r 78%|███████▊  | 706/900 [03:24<01:38,  1.98it/s]\r 79%|███████▊  | 707/900 [03:25<01:37,  1.98it/s]\r 79%|███████▊  | 708/900 [03:25<01:37,  1.97it/s]\r 79%|███████▉  | 709/900 [03:26<01:36,  1.97it/s]\r 79%|███████▉  | 710/900 [03:27<01:36,  1.97it/s]\r 79%|███████▉  | 711/900 [03:27<01:35,  1.97it/s]\r 79%|███████▉  | 712/900 [03:28<01:35,  1.97it/s]\r 79%|███████▉  | 713/900 [03:28<01:34,  1.97it/s]\r 79%|███████▉  | 714/900 [03:29<01:34,  1.97it/s]\r 79%|███████▉  | 715/900 [03:29<01:34,  1.96it/s]\r 80%|███████▉  | 716/900 [03:30<01:33,  1.96it/s]\r 80%|███████▉  | 717/900 [03:30<01:33,  1.96it/s]\r 80%|███████▉  | 718/900 [03:31<01:33,  1.95it/s]\r 80%|███████▉  | 719/900 [03:31<01:32,  1.95it/s]\r 80%|████████  | 720/900 [03:32<01:32,  1.94it/s]\r 80%|████████  | 721/900 [03:32<01:32,  1.94it/s]\r 80%|████████  | 722/900 [03:33<01:31,  1.95it/s]\r 80%|████████  | 723/900 [03:33<01:30,  1.95it/s]\r 80%|████████  | 724/900 [03:34<01:30,  1.94it/s]\r 81%|████████  | 725/900 [03:34<01:30,  1.93it/s]\r 81%|████████  | 726/900 [03:35<01:29,  1.93it/s]\r 81%|████████  | 727/900 [03:35<01:29,  1.94it/s]\r 81%|████████  | 728/900 [03:36<01:28,  1.94it/s]\r 81%|████████  | 729/900 [03:36<01:28,  1.93it/s]\r 81%|████████  | 730/900 [03:37<01:28,  1.93it/s]\r 81%|████████  | 731/900 [03:37<01:27,  1.92it/s]\r 81%|████████▏ | 732/900 [03:38<01:27,  1.92it/s]\r 81%|████████▏ | 733/900 [03:38<01:27,  1.91it/s]\r 82%|████████▏ | 734/900 [03:39<01:27,  1.90it/s]\r 82%|████████▏ | 735/900 [03:39<01:26,  1.90it/s]\r 82%|████████▏ | 736/900 [03:40<01:26,  1.90it/s]\r 82%|████████▏ | 737/900 [03:40<01:25,  1.91it/s]\r 82%|████████▏ | 738/900 [03:41<01:25,  1.90it/s]\r 82%|████████▏ | 739/900 [03:42<01:24,  1.90it/s]\r 82%|████████▏ | 740/900 [03:42<01:24,  1.90it/s]\r 82%|████████▏ | 741/900 [03:43<01:23,  1.90it/s]\r 82%|████████▏ | 742/900 [03:43<01:23,  1.90it/s]\r 83%|████████▎ | 743/900 [03:44<01:22,  1.90it/s]\r 83%|████████▎ | 744/900 [03:44<01:22,  1.90it/s]\r 83%|████████▎ | 745/900 [03:45<01:21,  1.90it/s]\r 83%|████████▎ | 746/900 [03:45<01:21,  1.89it/s]\r 83%|████████▎ | 747/900 [03:46<01:21,  1.89it/s]\r 83%|████████▎ | 748/900 [03:46<01:21,  1.87it/s]\r 83%|████████▎ | 749/900 [03:47<01:20,  1.87it/s]\r 83%|████████▎ | 750/900 [03:47<01:20,  1.87it/s]\r 83%|████████▎ | 751/900 [03:48<01:19,  1.87it/s]\r 84%|████████▎ | 752/900 [03:48<01:19,  1.87it/s]\r 84%|████████▎ | 753/900 [03:49<01:18,  1.87it/s]\r 84%|████████▍ | 754/900 [03:50<01:18,  1.87it/s]\r 84%|████████▍ | 755/900 [03:50<01:17,  1.86it/s]\r 84%|████████▍ | 756/900 [03:51<01:17,  1.86it/s]\r 84%|████████▍ | 757/900 [03:51<01:16,  1.86it/s]\r 84%|████████▍ | 758/900 [03:52<01:16,  1.86it/s]\r 84%|████████▍ | 759/900 [03:52<01:15,  1.86it/s]\r 84%|████████▍ | 760/900 [03:53<01:15,  1.86it/s]\r 85%|████████▍ | 761/900 [03:53<01:14,  1.86it/s]\r 85%|████████▍ | 762/900 [03:54<01:14,  1.85it/s]\r 85%|████████▍ | 763/900 [03:54<01:13,  1.85it/s]\r 85%|████████▍ | 764/900 [03:55<01:13,  1.85it/s]\r 85%|████████▌ | 765/900 [03:55<01:13,  1.83it/s]\r 85%|████████▌ | 766/900 [03:56<01:12,  1.84it/s]\r 85%|████████▌ | 767/900 [03:57<01:12,  1.84it/s]\r 85%|████████▌ | 768/900 [03:57<01:11,  1.84it/s]\r 85%|████████▌ | 769/900 [03:58<01:12,  1.81it/s]\r 86%|████████▌ | 770/900 [03:58<01:11,  1.82it/s]\r 86%|████████▌ | 771/900 [03:59<01:11,  1.81it/s]\r 86%|████████▌ | 772/900 [03:59<01:10,  1.81it/s]\r 86%|████████▌ | 773/900 [04:00<01:10,  1.81it/s]\r 86%|████████▌ | 774/900 [04:00<01:09,  1.81it/s]\r 86%|████████▌ | 775/900 [04:01<01:08,  1.81it/s]\r 86%|████████▌ | 776/900 [04:02<01:08,  1.81it/s]\r 86%|████████▋ | 777/900 [04:02<01:07,  1.81it/s]\r 86%|████████▋ | 778/900 [04:03<01:07,  1.81it/s]\r 87%|████████▋ | 779/900 [04:03<01:06,  1.81it/s]\r 87%|████████▋ | 780/900 [04:04<01:06,  1.80it/s]\r 87%|████████▋ | 781/900 [04:04<01:05,  1.81it/s]\r 87%|████████▋ | 782/900 [04:05<01:05,  1.80it/s]\r 87%|████████▋ | 783/900 [04:05<01:04,  1.80it/s]\r 87%|████████▋ | 784/900 [04:06<01:04,  1.80it/s]\r 87%|████████▋ | 785/900 [04:07<01:03,  1.81it/s]\r 87%|████████▋ | 786/900 [04:07<01:03,  1.80it/s]\r 87%|████████▋ | 787/900 [04:08<01:02,  1.81it/s]\r 88%|████████▊ | 788/900 [04:08<01:02,  1.80it/s]\r 88%|████████▊ | 789/900 [04:09<01:01,  1.80it/s]\r 88%|████████▊ | 790/900 [04:09<01:01,  1.80it/s]\r 88%|████████▊ | 791/900 [04:10<01:00,  1.79it/s]\r 88%|████████▊ | 792/900 [04:10<01:00,  1.79it/s]\r 88%|████████▊ | 793/900 [04:11<00:59,  1.79it/s]\r 88%|████████▊ | 794/900 [04:12<00:59,  1.79it/s]\r 88%|████████▊ | 795/900 [04:12<00:58,  1.79it/s]\r 88%|████████▊ | 796/900 [04:13<00:58,  1.79it/s]\r 89%|████████▊ | 797/900 [04:13<00:57,  1.79it/s]\r 89%|████████▊ | 798/900 [04:14<00:57,  1.79it/s]\r 89%|████████▉ | 799/900 [04:14<00:56,  1.79it/s]\r 89%|████████▉ | 800/900 [04:15<00:56,  1.78it/s]\r 89%|████████▉ | 801/900 [04:15<00:55,  1.77it/s]\r 89%|████████▉ | 802/900 [04:16<00:55,  1.77it/s]\r 89%|████████▉ | 803/900 [04:17<00:54,  1.76it/s]\r 89%|████████▉ | 804/900 [04:17<00:54,  1.76it/s]\r 89%|████████▉ | 805/900 [04:18<00:53,  1.76it/s]\r 90%|████████▉ | 806/900 [04:18<00:53,  1.76it/s]\r 90%|████████▉ | 807/900 [04:19<00:52,  1.76it/s]\r 90%|████████▉ | 808/900 [04:19<00:52,  1.76it/s]\r 90%|████████▉ | 809/900 [04:20<00:51,  1.75it/s]\r 90%|█████████ | 810/900 [04:21<00:51,  1.75it/s]\r 90%|█████████ | 811/900 [04:21<00:50,  1.75it/s]\r 90%|█████████ | 812/900 [04:22<00:50,  1.76it/s]\r 90%|█████████ | 813/900 [04:22<00:49,  1.75it/s]\r 90%|█████████ | 814/900 [04:23<00:49,  1.75it/s]\r 91%|█████████ | 815/900 [04:23<00:48,  1.75it/s]\r 91%|█████████ | 816/900 [04:24<00:48,  1.75it/s]\r 91%|█████████ | 817/900 [04:25<00:47,  1.74it/s]\r 91%|█████████ | 818/900 [04:25<00:46,  1.74it/s]\r 91%|█████████ | 819/900 [04:26<00:46,  1.74it/s]\r 91%|█████████ | 820/900 [04:26<00:45,  1.74it/s]\r 91%|█████████ | 821/900 [04:27<00:45,  1.73it/s]\r 91%|█████████▏| 822/900 [04:27<00:45,  1.73it/s]\r 91%|█████████▏| 823/900 [04:28<00:44,  1.73it/s]\r 92%|█████████▏| 824/900 [04:29<00:43,  1.73it/s]\r 92%|█████████▏| 825/900 [04:29<00:43,  1.73it/s]\r 92%|█████████▏| 826/900 [04:30<00:42,  1.73it/s]\r 92%|█████████▏| 827/900 [04:30<00:42,  1.72it/s]\r 92%|█████████▏| 828/900 [04:31<00:41,  1.72it/s]\r 92%|█████████▏| 829/900 [04:32<00:41,  1.72it/s]\r 92%|█████████▏| 830/900 [04:32<00:40,  1.72it/s]\r 92%|█████████▏| 831/900 [04:33<00:40,  1.72it/s]\r 92%|█████████▏| 832/900 [04:33<00:39,  1.72it/s]\r 93%|█████████▎| 833/900 [04:34<00:39,  1.72it/s]\r 93%|█████████▎| 834/900 [04:34<00:38,  1.71it/s]\r 93%|█████████▎| 835/900 [04:35<00:37,  1.71it/s]\r 93%|█████████▎| 836/900 [04:36<00:37,  1.71it/s]\r 93%|█████████▎| 837/900 [04:36<00:36,  1.71it/s]\r 93%|█████████▎| 838/900 [04:37<00:36,  1.71it/s]\r 93%|█████████▎| 839/900 [04:37<00:35,  1.70it/s]\r 93%|█████████▎| 840/900 [04:38<00:35,  1.71it/s]\r 93%|█████████▎| 841/900 [04:39<00:34,  1.71it/s]\r 94%|█████████▎| 842/900 [04:39<00:33,  1.71it/s]\r 94%|█████████▎| 843/900 [04:40<00:33,  1.71it/s]\r 94%|█████████▍| 844/900 [04:40<00:32,  1.70it/s]\r 94%|█████████▍| 845/900 [04:41<00:32,  1.70it/s]\r 94%|█████████▍| 846/900 [04:41<00:31,  1.70it/s]\r 94%|█████████▍| 847/900 [04:42<00:31,  1.70it/s]\r 94%|█████████▍| 848/900 [04:43<00:30,  1.70it/s]\r 94%|█████████▍| 849/900 [04:43<00:30,  1.70it/s]\r 94%|█████████▍| 850/900 [04:44<00:29,  1.69it/s]\r 95%|█████████▍| 851/900 [04:44<00:29,  1.69it/s]\r 95%|█████████▍| 852/900 [04:45<00:28,  1.68it/s]\r 95%|█████████▍| 853/900 [04:46<00:28,  1.67it/s]\r 95%|█████████▍| 854/900 [04:46<00:27,  1.66it/s]\r 95%|█████████▌| 855/900 [04:47<00:27,  1.67it/s]\r 95%|█████████▌| 856/900 [04:47<00:26,  1.66it/s]\r 95%|█████████▌| 857/900 [04:48<00:25,  1.67it/s]\r 95%|█████████▌| 858/900 [04:49<00:25,  1.67it/s]\r 95%|█████████▌| 859/900 [04:49<00:24,  1.67it/s]\r 96%|█████████▌| 860/900 [04:50<00:23,  1.67it/s]\r 96%|█████████▌| 861/900 [04:50<00:23,  1.67it/s]\r 96%|█████████▌| 862/900 [04:51<00:22,  1.67it/s]\r 96%|█████████▌| 863/900 [04:52<00:22,  1.67it/s]\r 96%|█████████▌| 864/900 [04:52<00:21,  1.66it/s]\r 96%|█████████▌| 865/900 [04:53<00:21,  1.66it/s]\r 96%|█████████▌| 866/900 [04:53<00:20,  1.65it/s]\r 96%|█████████▋| 867/900 [04:54<00:19,  1.66it/s]\r 96%|█████████▋| 868/900 [04:55<00:19,  1.65it/s]\r 97%|█████████▋| 869/900 [04:55<00:18,  1.65it/s]\r 97%|█████████▋| 870/900 [04:56<00:18,  1.65it/s]\r 97%|█████████▋| 871/900 [04:57<00:17,  1.64it/s]\r 97%|█████████▋| 872/900 [04:57<00:17,  1.65it/s]\r 97%|█████████▋| 873/900 [04:58<00:16,  1.64it/s]\r 97%|█████████▋| 874/900 [04:58<00:15,  1.64it/s]\r 97%|█████████▋| 875/900 [04:59<00:15,  1.63it/s]\r 97%|█████████▋| 876/900 [05:00<00:14,  1.64it/s]\r 97%|█████████▋| 877/900 [05:00<00:14,  1.63it/s]\r 98%|█████████▊| 878/900 [05:01<00:13,  1.63it/s]\r 98%|█████████▊| 879/900 [05:01<00:12,  1.63it/s]\r 98%|█████████▊| 880/900 [05:02<00:12,  1.63it/s]\r 98%|█████████▊| 881/900 [05:03<00:11,  1.63it/s]\r 98%|█████████▊| 882/900 [05:03<00:11,  1.62it/s]\r 98%|█████████▊| 883/900 [05:04<00:10,  1.62it/s]\r 98%|█████████▊| 884/900 [05:05<00:09,  1.62it/s]\r 98%|█████████▊| 885/900 [05:05<00:09,  1.62it/s]\r 98%|█████████▊| 886/900 [05:06<00:08,  1.62it/s]\r 99%|█████████▊| 887/900 [05:06<00:08,  1.62it/s]\r 99%|█████████▊| 888/900 [05:07<00:07,  1.62it/s]\r 99%|█████████▉| 889/900 [05:08<00:06,  1.62it/s]\r 99%|█████████▉| 890/900 [05:08<00:06,  1.62it/s]\r 99%|█████████▉| 891/900 [05:09<00:05,  1.61it/s]\r 99%|█████████▉| 892/900 [05:09<00:04,  1.61it/s]\r 99%|█████████▉| 893/900 [05:10<00:04,  1.61it/s]\r 99%|█████████▉| 894/900 [05:11<00:03,  1.61it/s]\r 99%|█████████▉| 895/900 [05:11<00:03,  1.60it/s]\r100%|█████████▉| 896/900 [05:12<00:02,  1.61it/s]\r100%|█████████▉| 897/900 [05:13<00:01,  1.60it/s]\r100%|█████████▉| 898/900 [05:13<00:01,  1.60it/s]\r100%|█████████▉| 899/900 [05:14<00:00,  1.60it/s]\r100%|██████████| 900/900 [05:14<00:00,  1.59it/s]\r100%|██████████| 900/900 [05:14<00:00,  2.86it/s]\n```\n:::\n:::\n\n\n::: {#5e4f5922 .cell execution_count=20}\n``` {.python .cell-code}\nplt.figure(figsize=(10, 4))\nplt.plot(M_values, var_bs_values, marker='o', color='red')\nplt.xlabel('Nombre de simulations')\nplt.ylabel('VaR bootstrap')\nplt.title(\"Variation de la VaR bootstrap en fonction du nombre de simulations\")\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```\nText(0.5, 1.0, 'Variation de la VaR bootstrap en fonction du nombre de simulations')\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-21-output-2.png){}\n:::\n:::\n\n\nPour la taille de l'echantillon bootstrap, nous allons prendre M=8000 étant donné que la courbe semble se stabiliser à partir de cette valeur. Avec ce choix, la VaR estimé est de 4.11%% avec un intervalle de confiance à 5% de [4.05%, 4.09%]. De plus, en ce qui concerne la VaR historique, nous constatons que l'estimation est contenu dans l'intervalle de confiance.\n\n::: {#67702b22 .cell execution_count=21}\n``` {.python .cell-code}\nM=8000\nvar_bs_train, lower_ic,upper_ic = bootstrap_var(data_train, alpha=alpha, M=M)\nprint(f\"La VaR bootstrap pour h=1j et alpha=0.99 est : {var_bs_train:.4%}\")\nprint(f\"L'intervalle de confiance est : [{lower_ic:.4%}, {upper_ic:.4%}]\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLa VaR bootstrap pour h=1j et alpha=0.99 est : 4.1065%\nL'intervalle de confiance est : [4.0536%, 4.0939%]\n```\n:::\n:::\n\n\n### II.2.3. Backtest\n\nPour l'exercice de backtest, il s'agit de :\n1. Déterminer si la proportion $p$ de violations de la VaR est cohérente avec le niveau de confiance, i.e. égale à $1-\\alpha$. Cela permet de vérifier si la mesure de risque est bien calibrée. Pour cela, nous pouvons avoir recours à un test de proportion ou un test de ratio de vraisemblance.\n\n    **Unconditional coverage test** :\n    Soit I la variable indicatrice de violation de la VaR, i.e. $I=1$ si la perte est supérieure à la VaR, et $I=0$ sinon. La proportion de violations de la VaR est donnée par :\n\n    $$p = \\frac{1}{n} \\sum_{i=1}^{n} I_i = \\frac{Z}{n}$$\n\n    Sous H0, i.e. p=1-$\\alpha$, Z $\\sim$ Binomiale(n, 1-$\\alpha$). En supposant que n est suffisamment grand, on peut approximer Z par une loi normale. Ainsi donc :\n    $$\\frac{Z - n (1-\\alpha)}{\\sqrt{\\alpha (1-\\alpha) n}} \\sim \\mathcal{N}(n(1-\\alpha), n\\alpha(1-\\alpha))$$\n\n    Sous cette hypothèse asymptotique, on peut calculer la statistique du ratio de vraisemblance suivant :\n    $$LR = -2 ln \\left( \\frac{L(H1)}{L(H0)} \\right) =-2 ln \\left( 1- (1-\\alpha))^{n-e}(1-\\alpha)^e \\right) + 2 ln \\left( (1-\\frac{e}{n})^{n-e} (\\frac{e}{n})^e  \\right)  \\sim \\chi^2(1)$$\n\n    où e est le nombre de violations de la VaR. On rejette H0 si LR > $\\chi^2(1-\\alpha)$.\n\n    **Test de proportion** :\n    $$\n    H_0 : p = p_0 = 1-\\alpha \\\\ H_1 : p > 1-\\alpha\n    $$\n    On peut également utiliser un test binomial pour tester si la proportion de violations de la VaR est égale à $1-\\alpha$. On peut calculer la statistique du test suivant :\n    $$Z = \\frac{p - p_0}{\\sqrt{p_0 (1-p_0) / n}} \\sim \\mathcal{N}(0,1)$$\n\n    On rejette H0 si Z > $p_0+ \\phi^{-1}(1-\\alpha) \\sqrt{p_0 (1-p_0)/n}$, où $\\phi$ est la quantile de la loi normale standard.\n\n2. Déterminer si, lorsqu'il y en a, les violations de VaR à deux différents jours sont indépendantes. Cela permet si la mesure de risque est capable de réagir aux chocs de marché affectant la volatilité des rendements. Pour cela, nous utilisons un conditional coverage test.\n\n    **Conditional coverage test** :\n    y revenir\n\n::: {#954b7432 .cell execution_count=22}\n``` {.python .cell-code}\nimport scipy.stats as stats\n\n# Objectif : implémenter une fonction calculant le nombre d'exception sur l'échantillon test\ndef exceptions(data, var):\n    \"\"\"\n    Calcul du nombre d'exception\n    data : les rendements logarithmiques\n    var : la VaR\n    \"\"\"\n    return np.sum(data < -var)\n\n\n# Objectif : test de proportion binomiale\n\ndef binomial_test(n, p, p0 = 0.01, alpha=0.05):\n    \"\"\"\n    Test de proportion binomiale\n    H0 : p = p0\n    H1 : p > p0\n    n : le nombre d'essais\n    p : la proportion\n    alpha : le niveau de confiance\n    \"\"\"\n\n    z = (p - p0) / np.sqrt(p0 * (1 - p0) / n)\n    #reject_zone = p0 + stats.norm.ppf(1 - alpha) * np.sqrt(p0 * (1 - p0) / n)\n    p_value = 1 - stats.norm.cdf(z)\n    reject = p_value < alpha\n\n    # Calcul des IC\n    lower = p - stats.norm.ppf(1 - alpha) * np.sqrt(p * (1 - p) / n)\n    upper = p + stats.norm.ppf(1 - alpha) * np.sqrt(p * (1 - p) / n)\n\n    return p_value, reject, lower, upper\n\n# Unconditionnal coverage test ==> to do.\n```\n:::\n\n\n::: {#a660e3eb .cell execution_count=23}\n``` {.python .cell-code}\n# Backtest de la VaR historique\n\nexceptions_test = exceptions(data_test, var_hist_train)\nprint(f\"Le nombre d'exceptions sur l'échantillon de test est : {exceptions_test}\")\n\nprint(\"=\"*80)\nn = len(data_test)\np = exceptions_test / n\np_value, reject, lower,upper = binomial_test(n, p)\nprint(f\"H0 : le nombre d'exceptions est inférieur ou égale à {1-alpha:.2%}\")\nprint(f\"IC : [{lower:.2%},{upper:.2%}]\")\nprint(f\"La p-value du test de proportion binomiale est : {p_value:.4f}\")\nprint(f\"Rejet de l'hypothèse nulle : {reject}\")\nprint(\"=\"*80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLe nombre d'exceptions sur l'échantillon de test est : 0\n================================================================================\nH0 : le nombre d'exceptions est inférieur ou égale à 1.00%\nIC : [0.00%,0.00%]\nLa p-value du test de proportion binomiale est : 0.9925\nRejet de l'hypothèse nulle : False\n================================================================================\n```\n:::\n:::\n\n\n## II.3. VaR paramétrique\n\n### II.3.1. Validation ex-ante\n\nVisuellement, les données ne semblent pas suivre une loi normale. En effet, les quantiles théoriques d'une loi normale ne collent pas avec les quantiles empiriques des rendements. Cela peut être dû à la présence de queues épaisses observables sur l'estimation de la densité des rendements sur l'échantillon d'apprentissage, de pics, de clusters de volatilité que nous avons observées plus haut. De plus, le skewness est négatif ce qui indique une asymétrie négative des rendements. Enfin, le kurtosis est supérieur à 3, ce qui indique une distribution leptokurtique des rendements.\n\nNous allons tout de même implémenter une VaR gaussienne pour voir comment elle se comporte dans le backtest.\n\n::: {#781daeeb .cell execution_count=24}\n``` {.python .cell-code}\n# Test visuel d'adéquation de la loi normale\n\n# Créer un Q-Q plot\nfig, ax = plt.subplots(figsize=(10, 6))\nstats.probplot(data_train, dist=\"norm\", plot=ax)\n\n# Personnalisation du graphique\nax.set_title(\"Q-Q Plot (Normal Distribution)\")\nax.set_xlabel(\"Theoretical Quantiles\")\nax.set_ylabel(\"Sample Quantiles\")\n\n# Afficher le graphique\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-25-output-1.png){}\n:::\n:::\n\n\n::: {#8b0a95a8 .cell execution_count=25}\n``` {.python .cell-code}\n# Densité de l'echantillon train et l'échantillon de test\n\nplt.figure(figsize=(10, 4))\ndata_train.plot(kind='kde', label='Train', color='red')\nplt.legend(loc='upper left')\nplt.title(\"Densité de l'échantillon d'entrainement\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-26-output-1.png){}\n:::\n:::\n\n\n::: {#7b671a3f .cell execution_count=26}\n``` {.python .cell-code}\n# Skewness et kurtosis\nprint(\"=\"*80)\nprint(\"Skewness de l'échantillon d'entrainement : \", data_train.skew())\nprint(\"Kurtosis de l'échantillon d'entrainement : \", data_train.kurt())\nprint(\"=\"*80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nSkewness de l'échantillon d'entrainement :  -0.2981820421484688\nKurtosis de l'échantillon d'entrainement :  7.353960005618779\n================================================================================\n```\n:::\n:::\n\n\n::: {#b9670dff .cell execution_count=27}\n``` {.python .cell-code}\nfrom scipy.stats import kstest\n\n# Test de Kolmogorov-Smirnov\nks_stat, ks_p_value = kstest(data_train, 'norm')\nprint(\"=\"*80)\nprint(\"H0 : Les données suivent une loi normale\")\nprint(f\"Statistique de test : {ks_stat:.4f}\")\nprint(f\"P-value : {ks_p_value:.4f}\")\nprint(\"=\"*80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nH0 : Les données suivent une loi normale\nStatistique de test : 0.4775\nP-value : 0.0000\n================================================================================\n```\n:::\n:::\n\n\n### II.3.2. Implémentation de la VaR\n\n#### a. Méthode scaling\n\n::: {#1d8aff3c .cell execution_count=28}\n``` {.python .cell-code}\n# Objectif : écrire une fonction qui calcule la VaR gaussienne\n\ndef gaussian_var(data, alpha):\n    \"\"\"\n    Calcul de la VaR gaussienne\n    data : les rendements logarithmiques\n    alpha : le niveau de confiance\n    \"\"\"\n    from scipy.stats import norm\n\n    mu = np.mean(data)\n    sigma = np.std(data)\n    return -(mu + sigma * norm.ppf(1 - alpha))\n```\n:::\n\n\n::: {#7a456048 .cell execution_count=29}\n``` {.python .cell-code}\nvar_gauss_train = gaussian_var(data_train, alpha=alpha)\nprint(f\"La VaR gaussienne pour h=1j et alpha={alpha} est : {var_gauss_train:.4%}\")\nprint(f\"La VaR historique pour h=10j et alpha={alpha} est : {np.sqrt(10)*var_gauss_train:.4%}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLa VaR gaussienne pour h=1j et alpha=0.99 est : 3.2302%\nLa VaR historique pour h=10j et alpha=0.99 est : 10.2148%\n```\n:::\n:::\n\n\n#### b. Méthode de diffusion d’un actif\n\nPour calculer la **VaR gaussienne à 10 jours** par **méthode de diffusion d’un actif**, nous allons suivre les étapes suivantes :\n\nL'évolution du prix d'un actif suit un processus de type mouvement brownien géométrique :\n$$\ndS_t = \\mu S_t dt + \\sigma S_t dW_t <=> S_t = S_{t-1} e^{(\\mu - \\frac{1}{2} \\sigma^2) + \\sigma W_t}\n$$\noù $ S_t$ est le prix de l'actif à l'instant$ t$, $ \\mu$ est le rendement moyen estimé (drift), $ \\sigma$ est la volatilité du rendement, $ dW_t$ est un mouvement brownien standard.\n\n\nOn peut de ce fait calculer plusieurs trajectoires de rendements de $S_0$ et $S_{10}$, puis calculer la VaR à partir de la série des rendements $ r_{10j} = \\ln(S_{10} / S_{0}) $ obtenus avec ces trajectoires.\n\nEn utilisant la méthode de scaling et la méthode de diffusion, nous obtenons sensiblement la même VaR.\n\n::: {#c4561a82 .cell execution_count=30}\n``` {.python .cell-code}\nimport numpy as np\n\nmu = np.mean(data_train)\nsigma = np.std(data_train)\n\nreturn_sim = []\nT = 10\nM = 1000\nS0 = train['Close'].iloc[-1]\n\nfor i in range(M):\n    S = np.zeros(T+1)\n    S[0] = S0\n    for t in range(1,T+1):\n        Wt = np.random.normal()\n        S[t] = S[t-1] * np.exp((mu - 0.5 * sigma**2) + sigma * Wt)\n\n    return_sim.append(np.log(S[T]/S0))\n\nvar_gauss_diffusion = gaussian_var(return_sim, alpha=alpha)\nprint(f\"La VaR gaussienne pour h=10j et alpha={alpha} est : {var_gauss_diffusion:.4%}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLa VaR gaussienne pour h=10j et alpha=0.99 est : 10.0053%\n```\n:::\n:::\n\n\n#### c. Méthode EWMA\n\nLa VaR EWMA est une méthode qui permet de calculer la VaR en surpondérant les rendements les plus récents. Cela permet de donner plus de poids aux rendements les plus récents, et donc de mieux capturer les changements de volatilité. La VaR EWMA est donnée par la formule suivante :\n\n$$\nVaR_{t+1} = \\mu + \\sigma \\times z_{\\alpha}\n$$\n\n::: {#db2eae5a .cell execution_count=31}\n``` {.python .cell-code}\n# VaR la méthode EWMA (Exponential Weighting Moving Average)\n\ndef gaussian_var_ewma(data, alpha, lambda_=0.94):\n    \"\"\"\n    Calcul de la VaR gaussienne EWMA\n    data : les rendements logarithmiques\n    alpha : le niveau de confiance\n    lambda_ : le paramètre de lissage\n    \"\"\"\n\n    weights = np.array([(1-lambda_)*(lambda_**i) for i in range(len(data))])\n    weights = weights / np.sum(weights)\n\n    mu = np.sum(data[::-1] * weights)\n    sigma = np.sqrt(np.sum(weights * (data[::-1] - mu)**2))\n\n    return -(mu + sigma * stats.norm.ppf(1 - alpha)), mu, sigma\n\n# y revenir\n```\n:::\n\n\n::: {#1505b88f .cell execution_count=32}\n``` {.python .cell-code}\nlambdas = [0.9, 0.95, 0.99]\nalpha = 0.99\nimport scipy.stats as stats\nfor l in lambdas:\n    print(\"=\"*80)\n    print(\"Lambda : \", l)\n    print(\"-\"*15)\n    var_gauss_emwa, mu, sigma = gaussian_var_ewma(data_train, alpha=alpha, lambda_=l)\n    print(f\"La VaR gaussienne EWMA pour h=1j et alpha={alpha} est : {var_gauss_emwa:.4%}\")\n    print(f\"La moyenne est : {mu:.4%}\")\n    print(f\"L'écart-type est : {sigma:.4%}\")\n\n    n_exceptions = exceptions(data_test, var_gauss_emwa)\n    print(f\"Le nombre d'exceptions sur l'échantillon de test est : {n_exceptions}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nLambda :  0.9\n---------------\nLa VaR gaussienne EWMA pour h=1j et alpha=0.99 est : 2.3751%\nLa moyenne est : 0.1898%\nL'écart-type est : 1.1025%\nLe nombre d'exceptions sur l'échantillon de test est : 5\n================================================================================\nLambda :  0.95\n---------------\nLa VaR gaussienne EWMA pour h=1j et alpha=0.99 est : 2.8969%\nLa moyenne est : 0.0735%\nL'écart-type est : 1.2768%\nLe nombre d'exceptions sur l'échantillon de test est : 4\n================================================================================\nLambda :  0.99\n---------------\nLa VaR gaussienne EWMA pour h=1j et alpha=0.99 est : 3.3511%\nLa moyenne est : -0.0321%\nL'écart-type est : 1.4267%\nLe nombre d'exceptions sur l'échantillon de test est : 1\n```\n:::\n:::\n\n\nAvec la méthode EWMA, nous observons une  que la VaR diminue plus $\\lambda$ augmente. Cela est dû au fait que plus $\\lambda$ est grand, plus les rendements les plus récents sont surpondérés, et donc la volatilité est plus faible, en raison de la fin de la période d'apprentissage.\n\n## II.4. VaR skew-student\n\n### II.4.1. Validation ex-ante\n\n::: {#22cd24b7 .cell execution_count=33}\n``` {.python .cell-code}\n# Ecrire une fonction permettant d’estimer les paramètres d’une loi de Skew Student par maximum de vraisemblance.\n\nfrom scipy.optimize import minimize\nfrom scipy.stats import t\n\n\ndef skew_student_pdf(x, mu, sigma, gamma, nu ):\n    \"\"\"\n    Compute the Skew Student-t probability density function (PDF).\n    \"\"\"\n\n\n    t_x = ((x - mu) * gamma / sigma) * np.sqrt((nu + 1) / (nu + ((x - mu) / sigma) ** 2))\n    # PDF of the standard Student-t distribution\n    pdf_t = t.pdf(x , df=nu,  loc=mu, scale=sigma)\n    # CDF of the transformed Student-t distribution\n    cdf_t = t.cdf(t_x, df=nu + 1,loc=0, scale=1)\n\n    # Skew Student density function\n    density = 2 * pdf_t * cdf_t\n\n    return density\n\n\ndef skew_student_log_likelihood(params, data):\n    \"\"\"\n    Calcul de la log-vraisemblance de la loi de Skew Student\n    params [mu, sigma, gamma, nu]: les paramètres de la loi\n    data : les rendements logarithmiques\n    \"\"\"\n    mu, sigma, gamma, nu = params\n    density = skew_student_pdf(data , mu, sigma, gamma, nu)\n    # log-vraisemblance\n    loglik = np.sum(np.log(density))\n\n    return - loglik\n\n# Optimisation des paramètres avec contraintes de positivité sur sigma et nu\ndef skew_student_fit(data):\n    \"\"\"\n    Estimation des paramètres de la loi de Skew Student\n    \"\"\"\n    # initial guess\n    x0 = np.array([np.mean(data), np.std(data), 1, 4])\n\n    # contraintes\n    bounds = [(None, None), (0, None), (None, None), (None, None)]\n\n    # optimisation\n    res = minimize(skew_student_log_likelihood, x0, args=(data), bounds=bounds)\n\n    return res.x\n\nparams = skew_student_fit(data_train)\nprint(\"=\"*80)\nprint(\"Les paramètres estimés de la loi de Skew Student sont : \")\nprint(\"-\"*15)\nprint(\"Mu : \", params[0])\nprint(\"Sigma : \", params[1])\nprint(\"Gamma : \", params[2])\nprint(\"Nu : \", params[3])\nprint(\"=\"*80)\n\n\nparams_sstd = {\n    \"mu\" : params[0],\n    \"sigma\" : params[1],\n    \"gamma\" : params[2],\n    \"nu\" : params[3]\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nLes paramètres estimés de la loi de Skew Student sont : \n---------------\nMu :  0.0023247899830732325\nSigma :  0.008823850410822238\nGamma :  -0.23183614178494735\nNu :  2.9618421112435653\n================================================================================\n```\n:::\n:::\n\n\n::: {#33712ed5 .cell execution_count=34}\n``` {.python .cell-code}\n# Superposition de la densité théorique et des données\n\nx_values = np.linspace(min(data_train), max(data_train), 1000)\n\ntheoretical_density = skew_student_pdf(x_values, **params_sstd)\nplt.figure(figsize = (10,4))\nplt.hist(data_train, bins=30, density=True, alpha=0.5, label='Données empiriques')\nplt.plot(x_values, theoretical_density, label='Densité Skew Student', color='red')\n# Densité normale\nplt.plot(x_values, stats.norm.pdf(x_values, np.mean(data_train), np.std(data_train)), label='Densité normale', color='blue')\nplt.xlabel('Rendements logarithmiques')\nplt.ylabel('Densité')\nplt.title(\"Comparaison entre les données et la densité théorique d'une loi de Skew Student\")\nplt.legend()\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-35-output-1.png){}\n:::\n:::\n\n\nLe graphique ci-dessus est satisfaisant. La densité théorique de la skew-student semble bien s'ajuster aux données. La loi skew-student de paramètres ($\\mu = 0.002, \\sigma = 0.009, \\gamma = -0.23, \\nu = 2.96$). Le $\\mu$ est le rendement moyen, $\\sigma$ est l'écart-type, $\\gamma$ est le coefficient d'asymétrie et $\\nu$ est le degré de liberté. Le skewness est négatif, ce qui indique une asymétrie négative des rendements, comme ce qu'on a observé plus haut.\n\nNous allons appuyer cette validation en utilisant le QQ-plot. La fonction quantile d'une loi skew-student n'est pas analytique. Pour ce faire, nous allons construire la fonction de repartition de la skew-student ainsi que la fonction quantile qui est l’inverse de cette fonction de repartition. Nous allons ensuite comparer les quantiles théoriques de la skew-student avec les quantiles empiriques des rendements.\n\nEn observant le QQ-plot, on constate que les quantiles théoriques de la skew-student collent bien avec les quantiles empiriques des rendements. Cela confirme que la skew-student est une bonne approximation de la distribution des rendements.\nPour une validation plus rigoureuse, on peut utiliser un test de Kolmogorov-Smirnov pour tester si les rendements suivent une loi skew-student.\n\n::: {#52bc6f76 .cell execution_count=35}\n``` {.python .cell-code}\n## Intégration de la fonction de densité\nfrom scipy import integrate\nfrom scipy.optimize import minimize_scalar\n\ndef integrale_SkewStudent(x,params):\n    borne_inf = -np.inf\n    resultat_integration, erreur = integrate.quad(lambda x: skew_student_pdf(x, **params), borne_inf, x)\n    return resultat_integration\n\ndef fonc_minimize(x, alpha,params):\n    value = integrale_SkewStudent(x,params)-alpha\n    return abs(value)\n\ndef skew_student_quantile(alpha,mu, sigma, gamma, nu ):\n    params = {\n    \"mu\" : mu ,\n    \"sigma\" : sigma,\n    \"gamma\" : gamma,\n    \"nu\" : nu\n    }\n\n    if alpha <0 or alpha >1:\n        raise Exception(\"Veuillez entrer un niveau alpha entre 0 et 1\")\n    else:\n        resultat_minimisation = minimize_scalar(lambda x: fonc_minimize(x, alpha,params))\n        return resultat_minimisation.x\n```\n:::\n\n\n::: {#87e10501 .cell execution_count=36}\n``` {.python .cell-code}\nniveaux_quantiles = np.arange(0.001, 1, 0.001)\nquantiles_empiriques = np.quantile(data_train, niveaux_quantiles)\nquantiles_theoriques = [skew_student_quantile(alpha,**params_sstd) for alpha in tqdm(niveaux_quantiles)]\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\r  0%|          | 0/999 [00:00<?, ?it/s]\r  0%|          | 1/999 [00:00<04:09,  3.99it/s]\r  0%|          | 2/999 [00:00<04:01,  4.13it/s]\r  0%|          | 3/999 [00:00<04:07,  4.02it/s]\r  0%|          | 4/999 [00:01<04:47,  3.47it/s]\r  1%|          | 5/999 [00:01<05:03,  3.28it/s]\r  1%|          | 6/999 [00:01<05:04,  3.26it/s]\r  1%|          | 7/999 [00:02<05:03,  3.26it/s]\r  1%|          | 8/999 [00:02<05:09,  3.21it/s]\r  1%|          | 9/999 [00:02<05:07,  3.22it/s]\r  1%|          | 10/999 [00:03<05:12,  3.16it/s]\r  1%|          | 11/999 [00:03<05:03,  3.25it/s]\r  1%|          | 12/999 [00:03<05:08,  3.19it/s]\r  1%|▏         | 13/999 [00:03<05:15,  3.13it/s]\r  1%|▏         | 14/999 [00:04<05:22,  3.05it/s]\r  2%|▏         | 15/999 [00:04<05:07,  3.20it/s]\r  2%|▏         | 16/999 [00:04<05:09,  3.18it/s]\r  2%|▏         | 17/999 [00:05<05:10,  3.17it/s]\r  2%|▏         | 18/999 [00:05<05:13,  3.13it/s]\r  2%|▏         | 19/999 [00:05<05:18,  3.08it/s]\r  2%|▏         | 20/999 [00:06<05:10,  3.15it/s]\r  2%|▏         | 21/999 [00:06<05:10,  3.15it/s]\r  2%|▏         | 22/999 [00:06<05:17,  3.08it/s]\r  2%|▏         | 23/999 [00:07<05:10,  3.14it/s]\r  2%|▏         | 24/999 [00:07<05:07,  3.17it/s]\r  3%|▎         | 25/999 [00:07<05:08,  3.15it/s]\r  3%|▎         | 26/999 [00:08<05:14,  3.09it/s]\r  3%|▎         | 27/999 [00:08<05:12,  3.11it/s]\r  3%|▎         | 28/999 [00:08<05:12,  3.11it/s]\r  3%|▎         | 29/999 [00:09<05:19,  3.04it/s]\r  3%|▎         | 30/999 [00:09<05:15,  3.07it/s]\r  3%|▎         | 31/999 [00:09<05:23,  2.99it/s]\r  3%|▎         | 32/999 [00:10<05:31,  2.91it/s]\r  3%|▎         | 33/999 [00:10<05:36,  2.87it/s]\r  3%|▎         | 34/999 [00:10<05:40,  2.83it/s]\r  4%|▎         | 35/999 [00:11<05:44,  2.80it/s]\r  4%|▎         | 36/999 [00:11<05:56,  2.70it/s]\r  4%|▎         | 37/999 [00:12<06:03,  2.65it/s]\r  4%|▍         | 38/999 [00:12<06:13,  2.58it/s]\r  4%|▍         | 39/999 [00:12<06:19,  2.53it/s]\r  4%|▍         | 40/999 [00:13<06:07,  2.61it/s]\r  4%|▍         | 41/999 [00:13<06:08,  2.60it/s]\r  4%|▍         | 42/999 [00:13<06:12,  2.57it/s]\r  4%|▍         | 43/999 [00:14<06:13,  2.56it/s]\r  4%|▍         | 44/999 [00:14<06:09,  2.59it/s]\r  5%|▍         | 45/999 [00:15<06:03,  2.63it/s]\r  5%|▍         | 46/999 [00:15<05:58,  2.66it/s]\r  5%|▍         | 47/999 [00:15<05:45,  2.75it/s]\r  5%|▍         | 48/999 [00:16<05:49,  2.72it/s]\r  5%|▍         | 49/999 [00:16<06:01,  2.62it/s]\r  5%|▌         | 50/999 [00:16<05:54,  2.68it/s]\r  5%|▌         | 51/999 [00:17<05:52,  2.69it/s]\r  5%|▌         | 52/999 [00:17<05:54,  2.67it/s]\r  5%|▌         | 53/999 [00:18<05:54,  2.67it/s]\r  5%|▌         | 54/999 [00:18<05:42,  2.76it/s]\r  6%|▌         | 55/999 [00:18<05:40,  2.78it/s]\r  6%|▌         | 56/999 [00:19<05:44,  2.73it/s]\r  6%|▌         | 57/999 [00:19<05:54,  2.66it/s]\r  6%|▌         | 58/999 [00:19<05:51,  2.68it/s]\r  6%|▌         | 59/999 [00:20<05:42,  2.75it/s]\r  6%|▌         | 60/999 [00:20<05:45,  2.71it/s]\r  6%|▌         | 61/999 [00:21<05:42,  2.74it/s]\r  6%|▌         | 62/999 [00:21<05:49,  2.68it/s]\r  6%|▋         | 63/999 [00:21<05:50,  2.67it/s]\r  6%|▋         | 64/999 [00:22<05:54,  2.64it/s]\r  7%|▋         | 65/999 [00:22<05:47,  2.69it/s]\r  7%|▋         | 66/999 [00:22<05:45,  2.70it/s]\r  7%|▋         | 67/999 [00:23<05:49,  2.66it/s]\r  7%|▋         | 68/999 [00:23<05:48,  2.67it/s]\r  7%|▋         | 69/999 [00:24<05:58,  2.59it/s]\r  7%|▋         | 70/999 [00:24<05:54,  2.62it/s]\r  7%|▋         | 71/999 [00:24<06:05,  2.54it/s]\r  7%|▋         | 72/999 [00:25<05:56,  2.60it/s]\r  7%|▋         | 73/999 [00:25<05:58,  2.59it/s]\r  7%|▋         | 74/999 [00:25<05:55,  2.60it/s]\r  8%|▊         | 75/999 [00:26<05:56,  2.59it/s]\r  8%|▊         | 76/999 [00:26<06:00,  2.56it/s]\r  8%|▊         | 77/999 [00:27<05:56,  2.59it/s]\r  8%|▊         | 78/999 [00:27<05:59,  2.56it/s]\r  8%|▊         | 79/999 [00:27<06:04,  2.53it/s]\r  8%|▊         | 80/999 [00:28<06:01,  2.54it/s]\r  8%|▊         | 81/999 [00:28<05:58,  2.56it/s]\r  8%|▊         | 82/999 [00:29<05:57,  2.56it/s]\r  8%|▊         | 83/999 [00:29<05:51,  2.61it/s]\r  8%|▊         | 84/999 [00:29<05:48,  2.63it/s]\r  9%|▊         | 85/999 [00:30<05:41,  2.67it/s]\r  9%|▊         | 86/999 [00:30<05:41,  2.67it/s]\r  9%|▊         | 87/999 [00:30<05:47,  2.63it/s]\r  9%|▉         | 88/999 [00:31<05:48,  2.62it/s]\r  9%|▉         | 89/999 [00:31<05:43,  2.65it/s]\r  9%|▉         | 90/999 [00:32<05:34,  2.72it/s]\r  9%|▉         | 91/999 [00:32<05:35,  2.70it/s]\r  9%|▉         | 92/999 [00:32<05:31,  2.73it/s]\r  9%|▉         | 93/999 [00:33<05:22,  2.81it/s]\r  9%|▉         | 94/999 [00:33<05:24,  2.79it/s]\r 10%|▉         | 95/999 [00:33<05:35,  2.70it/s]\r 10%|▉         | 96/999 [00:34<05:36,  2.69it/s]\r 10%|▉         | 97/999 [00:34<05:44,  2.62it/s]\r 10%|▉         | 98/999 [00:35<05:42,  2.63it/s]\r 10%|▉         | 99/999 [00:35<05:38,  2.66it/s]\r 10%|█         | 100/999 [00:35<05:27,  2.74it/s]\r 10%|█         | 101/999 [00:36<05:27,  2.74it/s]\r 10%|█         | 102/999 [00:36<05:24,  2.77it/s]\r 10%|█         | 103/999 [00:36<05:26,  2.74it/s]\r 10%|█         | 104/999 [00:37<05:23,  2.77it/s]\r 11%|█         | 105/999 [00:37<05:20,  2.79it/s]\r 11%|█         | 106/999 [00:37<05:28,  2.72it/s]\r 11%|█         | 107/999 [00:38<05:30,  2.70it/s]\r 11%|█         | 108/999 [00:38<05:37,  2.64it/s]\r 11%|█         | 109/999 [00:39<05:36,  2.64it/s]\r 11%|█         | 110/999 [00:39<05:40,  2.61it/s]\r 11%|█         | 111/999 [00:39<05:45,  2.57it/s]\r 11%|█         | 112/999 [00:40<05:50,  2.53it/s]\r 11%|█▏        | 113/999 [00:40<05:56,  2.49it/s]\r 11%|█▏        | 114/999 [00:41<05:52,  2.51it/s]\r 12%|█▏        | 115/999 [00:41<05:52,  2.51it/s]\r 12%|█▏        | 116/999 [00:41<05:49,  2.52it/s]\r 12%|█▏        | 117/999 [00:42<05:52,  2.50it/s]\r 12%|█▏        | 118/999 [00:42<05:49,  2.52it/s]\r 12%|█▏        | 119/999 [00:43<05:52,  2.49it/s]\r 12%|█▏        | 120/999 [00:43<05:48,  2.52it/s]\r 12%|█▏        | 121/999 [00:43<05:50,  2.50it/s]\r 12%|█▏        | 122/999 [00:44<06:05,  2.40it/s]\r 12%|█▏        | 123/999 [00:44<05:59,  2.44it/s]\r 12%|█▏        | 124/999 [00:45<05:57,  2.45it/s]\r 13%|█▎        | 125/999 [00:45<05:58,  2.44it/s]\r 13%|█▎        | 126/999 [00:46<05:58,  2.44it/s]\r 13%|█▎        | 127/999 [00:46<05:57,  2.44it/s]\r 13%|█▎        | 128/999 [00:46<05:54,  2.45it/s]\r 13%|█▎        | 129/999 [00:47<05:55,  2.44it/s]\r 13%|█▎        | 130/999 [00:47<05:53,  2.46it/s]\r 13%|█▎        | 131/999 [00:48<05:48,  2.49it/s]\r 13%|█▎        | 132/999 [00:48<05:40,  2.55it/s]\r 13%|█▎        | 133/999 [00:48<05:36,  2.58it/s]\r 13%|█▎        | 134/999 [00:49<05:29,  2.63it/s]\r 14%|█▎        | 135/999 [00:49<05:30,  2.61it/s]\r 14%|█▎        | 136/999 [00:49<05:32,  2.59it/s]\r 14%|█▎        | 137/999 [00:50<05:36,  2.56it/s]\r 14%|█▍        | 138/999 [00:50<05:34,  2.57it/s]\r 14%|█▍        | 139/999 [00:51<05:45,  2.49it/s]\r 14%|█▍        | 140/999 [00:51<05:50,  2.45it/s]\r 14%|█▍        | 141/999 [00:51<05:40,  2.52it/s]\r 14%|█▍        | 142/999 [00:52<05:34,  2.56it/s]\r 14%|█▍        | 143/999 [00:52<05:40,  2.51it/s]\r 14%|█▍        | 144/999 [00:53<05:31,  2.58it/s]\r 15%|█▍        | 145/999 [00:53<05:25,  2.62it/s]\r 15%|█▍        | 146/999 [00:53<05:19,  2.67it/s]\r 15%|█▍        | 147/999 [00:54<05:25,  2.62it/s]\r 15%|█▍        | 148/999 [00:54<05:46,  2.46it/s]\r 15%|█▍        | 149/999 [00:55<05:50,  2.43it/s]\r 15%|█▌        | 150/999 [00:55<05:54,  2.40it/s]\r 15%|█▌        | 151/999 [00:55<05:46,  2.45it/s]\r 15%|█▌        | 152/999 [00:56<05:38,  2.50it/s]\r 15%|█▌        | 153/999 [00:56<05:42,  2.47it/s]\r 15%|█▌        | 154/999 [00:57<05:47,  2.43it/s]\r 16%|█▌        | 155/999 [00:57<05:50,  2.41it/s]\r 16%|█▌        | 156/999 [00:57<05:53,  2.39it/s]\r 16%|█▌        | 157/999 [00:58<05:53,  2.38it/s]\r 16%|█▌        | 158/999 [00:58<05:47,  2.42it/s]\r 16%|█▌        | 159/999 [00:59<05:57,  2.35it/s]\r 16%|█▌        | 160/999 [00:59<06:03,  2.31it/s]\r 16%|█▌        | 161/999 [01:00<05:58,  2.34it/s]\r 16%|█▌        | 162/999 [01:00<06:08,  2.27it/s]\r 16%|█▋        | 163/999 [01:01<06:10,  2.25it/s]\r 16%|█▋        | 164/999 [01:01<06:17,  2.21it/s]\r 17%|█▋        | 165/999 [01:01<06:13,  2.23it/s]\r 17%|█▋        | 166/999 [01:02<06:08,  2.26it/s]\r 17%|█▋        | 167/999 [01:02<06:04,  2.28it/s]\r 17%|█▋        | 168/999 [01:03<06:09,  2.25it/s]\r 17%|█▋        | 169/999 [01:03<06:07,  2.26it/s]\r 17%|█▋        | 170/999 [01:04<06:06,  2.26it/s]\r 17%|█▋        | 171/999 [01:04<05:58,  2.31it/s]\r 17%|█▋        | 172/999 [01:05<06:04,  2.27it/s]\r 17%|█▋        | 173/999 [01:05<06:04,  2.27it/s]\r 17%|█▋        | 174/999 [01:05<05:58,  2.30it/s]\r 18%|█▊        | 175/999 [01:06<05:55,  2.32it/s]\r 18%|█▊        | 176/999 [01:06<06:04,  2.26it/s]\r 18%|█▊        | 177/999 [01:07<06:04,  2.25it/s]\r 18%|█▊        | 178/999 [01:07<05:53,  2.32it/s]\r 18%|█▊        | 179/999 [01:08<05:45,  2.37it/s]\r 18%|█▊        | 180/999 [01:08<05:50,  2.34it/s]\r 18%|█▊        | 181/999 [01:08<05:52,  2.32it/s]\r 18%|█▊        | 182/999 [01:09<06:00,  2.26it/s]\r 18%|█▊        | 183/999 [01:09<06:10,  2.20it/s]\r 18%|█▊        | 184/999 [01:10<06:03,  2.24it/s]\r 19%|█▊        | 185/999 [01:10<06:11,  2.19it/s]\r 19%|█▊        | 186/999 [01:11<06:19,  2.14it/s]\r 19%|█▊        | 187/999 [01:11<06:18,  2.14it/s]\r 19%|█▉        | 188/999 [01:12<06:17,  2.15it/s]\r 19%|█▉        | 189/999 [01:12<06:02,  2.23it/s]\r 19%|█▉        | 190/999 [01:13<06:02,  2.23it/s]\r 19%|█▉        | 191/999 [01:13<05:41,  2.37it/s]\r 19%|█▉        | 192/999 [01:13<05:49,  2.31it/s]\r 19%|█▉        | 193/999 [01:14<05:46,  2.32it/s]\r 19%|█▉        | 194/999 [01:14<05:45,  2.33it/s]\r 20%|█▉        | 195/999 [01:15<05:42,  2.35it/s]\r 20%|█▉        | 196/999 [01:15<05:42,  2.35it/s]\r 20%|█▉        | 197/999 [01:15<05:45,  2.32it/s]\r 20%|█▉        | 198/999 [01:16<05:42,  2.34it/s]\r 20%|█▉        | 199/999 [01:16<05:47,  2.30it/s]\r 20%|██        | 200/999 [01:17<05:49,  2.28it/s]\r 20%|██        | 201/999 [01:17<05:45,  2.31it/s]\r 20%|██        | 202/999 [01:18<05:50,  2.27it/s]\r 20%|██        | 203/999 [01:18<05:47,  2.29it/s]\r 20%|██        | 204/999 [01:19<05:39,  2.34it/s]\r 21%|██        | 205/999 [01:19<05:35,  2.37it/s]\r 21%|██        | 206/999 [01:19<05:29,  2.41it/s]\r 21%|██        | 207/999 [01:20<05:36,  2.35it/s]\r 21%|██        | 208/999 [01:20<05:40,  2.32it/s]\r 21%|██        | 209/999 [01:21<05:47,  2.28it/s]\r 21%|██        | 210/999 [01:21<05:45,  2.28it/s]\r 21%|██        | 211/999 [01:22<05:58,  2.20it/s]\r 21%|██        | 212/999 [01:22<05:53,  2.23it/s]\r 21%|██▏       | 213/999 [01:22<05:43,  2.29it/s]\r 21%|██▏       | 214/999 [01:23<05:46,  2.26it/s]\r 22%|██▏       | 215/999 [01:23<05:49,  2.24it/s]\r 22%|██▏       | 216/999 [01:24<05:43,  2.28it/s]\r 22%|██▏       | 217/999 [01:24<05:43,  2.28it/s]\r 22%|██▏       | 218/999 [01:25<05:43,  2.28it/s]\r 22%|██▏       | 219/999 [01:25<05:25,  2.39it/s]\r 22%|██▏       | 220/999 [01:25<05:27,  2.38it/s]\r 22%|██▏       | 221/999 [01:26<05:31,  2.35it/s]\r 22%|██▏       | 222/999 [01:26<05:40,  2.28it/s]\r 22%|██▏       | 223/999 [01:27<05:46,  2.24it/s]\r 22%|██▏       | 224/999 [01:27<05:44,  2.25it/s]\r 23%|██▎       | 225/999 [01:28<05:50,  2.21it/s]\r 23%|██▎       | 226/999 [01:28<05:42,  2.25it/s]\r 23%|██▎       | 227/999 [01:29<05:42,  2.26it/s]\r 23%|██▎       | 228/999 [01:29<05:44,  2.24it/s]\r 23%|██▎       | 229/999 [01:30<05:55,  2.17it/s]\r 23%|██▎       | 230/999 [01:30<06:04,  2.11it/s]\r 23%|██▎       | 231/999 [01:31<06:10,  2.07it/s]\r 23%|██▎       | 232/999 [01:31<06:01,  2.12it/s]\r 23%|██▎       | 233/999 [01:31<05:50,  2.19it/s]\r 23%|██▎       | 234/999 [01:32<05:43,  2.22it/s]\r 24%|██▎       | 235/999 [01:32<05:39,  2.25it/s]\r 24%|██▎       | 236/999 [01:33<05:49,  2.18it/s]\r 24%|██▎       | 237/999 [01:33<05:58,  2.13it/s]\r 24%|██▍       | 238/999 [01:34<06:08,  2.06it/s]\r 24%|██▍       | 239/999 [01:34<06:19,  2.00it/s]\r 24%|██▍       | 240/999 [01:35<06:23,  1.98it/s]\r 24%|██▍       | 241/999 [01:35<06:23,  1.98it/s]\r 24%|██▍       | 242/999 [01:36<06:25,  1.96it/s]\r 24%|██▍       | 243/999 [01:36<06:32,  1.92it/s]\r 24%|██▍       | 244/999 [01:37<06:36,  1.90it/s]\r 25%|██▍       | 245/999 [01:37<06:31,  1.92it/s]\r 25%|██▍       | 246/999 [01:38<06:34,  1.91it/s]\r 25%|██▍       | 247/999 [01:39<06:32,  1.92it/s]\r 25%|██▍       | 248/999 [01:39<06:45,  1.85it/s]\r 25%|██▍       | 249/999 [01:40<06:53,  1.81it/s]\r 25%|██▌       | 250/999 [01:40<06:50,  1.82it/s]\r 25%|██▌       | 251/999 [01:41<06:54,  1.81it/s]\r 25%|██▌       | 252/999 [01:41<06:45,  1.84it/s]\r 25%|██▌       | 253/999 [01:42<06:51,  1.81it/s]\r 25%|██▌       | 254/999 [01:42<06:58,  1.78it/s]\r 26%|██▌       | 255/999 [01:43<06:59,  1.77it/s]\r 26%|██▌       | 256/999 [01:44<06:55,  1.79it/s]\r 26%|██▌       | 257/999 [01:44<06:35,  1.87it/s]\r 26%|██▌       | 258/999 [01:45<06:27,  1.91it/s]\r 26%|██▌       | 259/999 [01:45<06:28,  1.90it/s]\r 26%|██▌       | 260/999 [01:46<06:20,  1.94it/s]\r 26%|██▌       | 261/999 [01:46<06:12,  1.98it/s]\r 26%|██▌       | 262/999 [01:47<05:59,  2.05it/s]\r 26%|██▋       | 263/999 [01:47<05:55,  2.07it/s]\r 26%|██▋       | 264/999 [01:47<05:50,  2.10it/s]\r 27%|██▋       | 265/999 [01:48<05:47,  2.11it/s]\r 27%|██▋       | 266/999 [01:48<05:46,  2.12it/s]\r 27%|██▋       | 267/999 [01:49<05:42,  2.13it/s]\r 27%|██▋       | 268/999 [01:49<05:49,  2.09it/s]\r 27%|██▋       | 269/999 [01:50<05:48,  2.10it/s]\r 27%|██▋       | 270/999 [01:50<05:52,  2.07it/s]\r 27%|██▋       | 271/999 [01:51<05:49,  2.08it/s]\r 27%|██▋       | 272/999 [01:51<05:58,  2.03it/s]\r 27%|██▋       | 273/999 [01:52<05:59,  2.02it/s]\r 27%|██▋       | 274/999 [01:52<05:55,  2.04it/s]\r 28%|██▊       | 275/999 [01:53<05:55,  2.03it/s]\r 28%|██▊       | 276/999 [01:53<06:01,  2.00it/s]\r 28%|██▊       | 277/999 [01:54<05:53,  2.04it/s]\r 28%|██▊       | 278/999 [01:54<05:59,  2.01it/s]\r 28%|██▊       | 279/999 [01:55<06:01,  1.99it/s]\r 28%|██▊       | 280/999 [01:55<06:07,  1.96it/s]\r 28%|██▊       | 281/999 [01:56<06:07,  1.95it/s]\r 28%|██▊       | 282/999 [01:56<06:14,  1.91it/s]\r 28%|██▊       | 283/999 [01:57<06:15,  1.91it/s]\r 28%|██▊       | 284/999 [01:58<06:32,  1.82it/s]\r 29%|██▊       | 285/999 [01:58<06:44,  1.76it/s]\r 29%|██▊       | 286/999 [01:59<06:34,  1.81it/s]\r 29%|██▊       | 287/999 [01:59<06:41,  1.78it/s]\r 29%|██▉       | 288/999 [02:00<06:31,  1.81it/s]\r 29%|██▉       | 289/999 [02:00<06:35,  1.80it/s]\r 29%|██▉       | 290/999 [02:01<06:26,  1.83it/s]\r 29%|██▉       | 291/999 [02:01<06:34,  1.79it/s]\r 29%|██▉       | 292/999 [02:02<06:23,  1.84it/s]\r 29%|██▉       | 293/999 [02:02<06:15,  1.88it/s]\r 29%|██▉       | 294/999 [02:03<06:25,  1.83it/s]\r 30%|██▉       | 295/999 [02:04<06:16,  1.87it/s]\r 30%|██▉       | 296/999 [02:04<06:26,  1.82it/s]\r 30%|██▉       | 297/999 [02:05<06:19,  1.85it/s]\r 30%|██▉       | 298/999 [02:05<06:23,  1.83it/s]\r 30%|██▉       | 299/999 [02:06<06:19,  1.85it/s]\r 30%|███       | 300/999 [02:06<06:27,  1.80it/s]\r 30%|███       | 301/999 [02:07<06:31,  1.78it/s]\r 30%|███       | 302/999 [02:07<06:30,  1.78it/s]\r 30%|███       | 303/999 [02:08<06:39,  1.74it/s]\r 30%|███       | 304/999 [02:09<06:29,  1.79it/s]\r 31%|███       | 305/999 [02:09<06:18,  1.83it/s]\r 31%|███       | 306/999 [02:10<06:08,  1.88it/s]\r 31%|███       | 307/999 [02:10<06:05,  1.89it/s]\r 31%|███       | 308/999 [02:11<05:53,  1.95it/s]\r 31%|███       | 309/999 [02:11<05:59,  1.92it/s]\r 31%|███       | 310/999 [02:12<06:05,  1.89it/s]\r 31%|███       | 311/999 [02:12<06:11,  1.85it/s]\r 31%|███       | 312/999 [02:13<06:12,  1.84it/s]\r 31%|███▏      | 313/999 [02:13<06:14,  1.83it/s]\r 31%|███▏      | 314/999 [02:14<06:08,  1.86it/s]\r 32%|███▏      | 315/999 [02:14<05:59,  1.90it/s]\r 32%|███▏      | 316/999 [02:15<05:59,  1.90it/s]\r 32%|███▏      | 317/999 [02:15<05:59,  1.90it/s]\r 32%|███▏      | 318/999 [02:16<05:55,  1.92it/s]\r 32%|███▏      | 319/999 [02:16<06:00,  1.89it/s]\r 32%|███▏      | 320/999 [02:17<06:01,  1.88it/s]\r 32%|███▏      | 321/999 [02:18<06:20,  1.78it/s]\r 32%|███▏      | 322/999 [02:18<06:07,  1.84it/s]\r 32%|███▏      | 323/999 [02:19<06:21,  1.77it/s]\r 32%|███▏      | 324/999 [02:19<06:19,  1.78it/s]\r 33%|███▎      | 325/999 [02:20<06:11,  1.81it/s]\r 33%|███▎      | 326/999 [02:20<06:06,  1.84it/s]\r 33%|███▎      | 327/999 [02:21<06:21,  1.76it/s]\r 33%|███▎      | 328/999 [02:22<06:11,  1.81it/s]\r 33%|███▎      | 329/999 [02:22<06:22,  1.75it/s]\r 33%|███▎      | 330/999 [02:23<06:13,  1.79it/s]\r 33%|███▎      | 331/999 [02:23<06:11,  1.80it/s]\r 33%|███▎      | 332/999 [02:24<06:11,  1.79it/s]\r 33%|███▎      | 333/999 [02:24<06:11,  1.79it/s]\r 33%|███▎      | 334/999 [02:25<06:02,  1.84it/s]\r 34%|███▎      | 335/999 [02:25<06:01,  1.83it/s]\r 34%|███▎      | 336/999 [02:26<06:03,  1.82it/s]\r 34%|███▎      | 337/999 [02:26<06:02,  1.83it/s]\r 34%|███▍      | 338/999 [02:27<06:04,  1.81it/s]\r 34%|███▍      | 339/999 [02:28<05:54,  1.86it/s]\r 34%|███▍      | 340/999 [02:28<05:47,  1.90it/s]\r 34%|███▍      | 341/999 [02:29<05:49,  1.88it/s]\r 34%|███▍      | 342/999 [02:29<05:48,  1.88it/s]\r 34%|███▍      | 343/999 [02:30<05:48,  1.88it/s]\r 34%|███▍      | 344/999 [02:30<05:50,  1.87it/s]\r 35%|███▍      | 345/999 [02:31<05:45,  1.89it/s]\r 35%|███▍      | 346/999 [02:31<05:45,  1.89it/s]\r 35%|███▍      | 347/999 [02:32<05:47,  1.88it/s]\r 35%|███▍      | 348/999 [02:32<05:46,  1.88it/s]\r 35%|███▍      | 349/999 [02:33<05:40,  1.91it/s]\r 35%|███▌      | 350/999 [02:33<05:38,  1.92it/s]\r 35%|███▌      | 351/999 [02:34<05:44,  1.88it/s]\r 35%|███▌      | 352/999 [02:34<05:46,  1.87it/s]\r 35%|███▌      | 353/999 [02:35<05:47,  1.86it/s]\r 35%|███▌      | 354/999 [02:36<05:43,  1.88it/s]\r 36%|███▌      | 355/999 [02:36<05:40,  1.89it/s]\r 36%|███▌      | 356/999 [02:37<05:40,  1.89it/s]\r 36%|███▌      | 357/999 [02:37<05:37,  1.90it/s]\r 36%|███▌      | 358/999 [02:38<05:43,  1.86it/s]\r 36%|███▌      | 359/999 [02:38<05:47,  1.84it/s]\r 36%|███▌      | 360/999 [02:39<05:40,  1.87it/s]\r 36%|███▌      | 361/999 [02:39<05:40,  1.87it/s]\r 36%|███▌      | 362/999 [02:40<05:36,  1.89it/s]\r 36%|███▋      | 363/999 [02:40<05:29,  1.93it/s]\r 36%|███▋      | 364/999 [02:41<05:23,  1.97it/s]\r 37%|███▋      | 365/999 [02:41<05:30,  1.92it/s]\r 37%|███▋      | 366/999 [02:42<05:29,  1.92it/s]\r 37%|███▋      | 367/999 [02:42<05:26,  1.93it/s]\r 37%|███▋      | 368/999 [02:43<05:23,  1.95it/s]\r 37%|███▋      | 369/999 [02:43<05:18,  1.98it/s]\r 37%|███▋      | 370/999 [02:44<05:17,  1.98it/s]\r 37%|███▋      | 371/999 [02:44<05:14,  2.00it/s]\r 37%|███▋      | 372/999 [02:45<05:17,  1.98it/s]\r 37%|███▋      | 373/999 [02:45<05:17,  1.97it/s]\r 37%|███▋      | 374/999 [02:46<05:16,  1.98it/s]\r 38%|███▊      | 375/999 [02:46<05:07,  2.03it/s]\r 38%|███▊      | 376/999 [02:47<05:04,  2.05it/s]\r 38%|███▊      | 377/999 [02:47<05:09,  2.01it/s]\r 38%|███▊      | 378/999 [02:48<05:05,  2.03it/s]\r 38%|███▊      | 379/999 [02:48<05:08,  2.01it/s]\r 38%|███▊      | 380/999 [02:49<05:14,  1.97it/s]\r 38%|███▊      | 381/999 [02:49<05:13,  1.97it/s]\r 38%|███▊      | 382/999 [02:50<05:07,  2.01it/s]\r 38%|███▊      | 383/999 [02:50<05:02,  2.04it/s]\r 38%|███▊      | 384/999 [02:51<05:07,  2.00it/s]\r 39%|███▊      | 385/999 [02:51<05:08,  1.99it/s]\r 39%|███▊      | 386/999 [02:52<05:11,  1.97it/s]\r 39%|███▊      | 387/999 [02:52<04:56,  2.06it/s]\r 39%|███▉      | 388/999 [02:53<05:05,  2.00it/s]\r 39%|███▉      | 389/999 [02:53<05:03,  2.01it/s]\r 39%|███▉      | 390/999 [02:54<05:04,  2.00it/s]\r 39%|███▉      | 391/999 [02:54<05:11,  1.95it/s]\r 39%|███▉      | 392/999 [02:55<05:14,  1.93it/s]\r 39%|███▉      | 393/999 [02:55<05:16,  1.91it/s]\r 39%|███▉      | 394/999 [02:56<05:13,  1.93it/s]\r 40%|███▉      | 395/999 [02:56<05:09,  1.95it/s]\r 40%|███▉      | 396/999 [02:57<05:13,  1.92it/s]\r 40%|███▉      | 397/999 [02:57<05:14,  1.91it/s]\r 40%|███▉      | 398/999 [02:58<05:12,  1.92it/s]\r 40%|███▉      | 399/999 [02:59<05:21,  1.87it/s]\r 40%|████      | 400/999 [02:59<05:18,  1.88it/s]\r 40%|████      | 401/999 [03:00<05:18,  1.88it/s]\r 40%|████      | 402/999 [03:00<05:15,  1.89it/s]\r 40%|████      | 403/999 [03:01<05:14,  1.90it/s]\r 40%|████      | 404/999 [03:01<05:10,  1.92it/s]\r 41%|████      | 405/999 [03:02<05:04,  1.95it/s]\r 41%|████      | 406/999 [03:02<05:02,  1.96it/s]\r 41%|████      | 407/999 [03:03<05:02,  1.96it/s]\r 41%|████      | 408/999 [03:03<04:57,  1.98it/s]\r 41%|████      | 409/999 [03:04<04:57,  1.98it/s]\r 41%|████      | 410/999 [03:04<05:00,  1.96it/s]\r 41%|████      | 411/999 [03:05<05:04,  1.93it/s]\r 41%|████      | 412/999 [03:05<04:59,  1.96it/s]\r 41%|████▏     | 413/999 [03:06<04:59,  1.96it/s]\r 41%|████▏     | 414/999 [03:06<04:56,  1.97it/s]\r 42%|████▏     | 415/999 [03:07<05:01,  1.93it/s]\r 42%|████▏     | 416/999 [03:07<05:05,  1.91it/s]\r 42%|████▏     | 417/999 [03:08<05:09,  1.88it/s]\r 42%|████▏     | 418/999 [03:08<05:03,  1.92it/s]\r 42%|████▏     | 419/999 [03:09<05:07,  1.89it/s]\r 42%|████▏     | 420/999 [03:09<05:08,  1.88it/s]\r 42%|████▏     | 421/999 [03:10<05:14,  1.84it/s]\r 42%|████▏     | 422/999 [03:11<05:17,  1.82it/s]\r 42%|████▏     | 423/999 [03:11<05:19,  1.80it/s]\r 42%|████▏     | 424/999 [03:12<05:13,  1.84it/s]\r 43%|████▎     | 425/999 [03:12<05:13,  1.83it/s]\r 43%|████▎     | 426/999 [03:13<05:11,  1.84it/s]\r 43%|████▎     | 427/999 [03:13<05:13,  1.82it/s]\r 43%|████▎     | 428/999 [03:14<05:11,  1.83it/s]\r 43%|████▎     | 429/999 [03:14<05:23,  1.76it/s]\r 43%|████▎     | 430/999 [03:15<05:17,  1.79it/s]\r 43%|████▎     | 431/999 [03:16<05:08,  1.84it/s]\r 43%|████▎     | 432/999 [03:16<05:06,  1.85it/s]\r 43%|████▎     | 433/999 [03:17<05:00,  1.88it/s]\r 43%|████▎     | 434/999 [03:17<04:56,  1.91it/s]\r 44%|████▎     | 435/999 [03:18<05:06,  1.84it/s]\r 44%|████▎     | 436/999 [03:18<05:14,  1.79it/s]\r 44%|████▎     | 437/999 [03:19<05:20,  1.75it/s]\r 44%|████▍     | 438/999 [03:19<05:18,  1.76it/s]\r 44%|████▍     | 439/999 [03:20<05:10,  1.80it/s]\r 44%|████▍     | 440/999 [03:20<05:10,  1.80it/s]\r 44%|████▍     | 441/999 [03:21<05:00,  1.86it/s]\r 44%|████▍     | 442/999 [03:22<04:57,  1.87it/s]\r 44%|████▍     | 443/999 [03:22<04:58,  1.86it/s]\r 44%|████▍     | 444/999 [03:23<04:53,  1.89it/s]\r 45%|████▍     | 445/999 [03:23<04:54,  1.88it/s]\r 45%|████▍     | 446/999 [03:24<04:49,  1.91it/s]\r 45%|████▍     | 447/999 [03:24<04:54,  1.87it/s]\r 45%|████▍     | 448/999 [03:25<04:52,  1.89it/s]\r 45%|████▍     | 449/999 [03:25<04:52,  1.88it/s]\r 45%|████▌     | 450/999 [03:26<04:57,  1.84it/s]\r 45%|████▌     | 451/999 [03:26<05:00,  1.82it/s]\r 45%|████▌     | 452/999 [03:27<05:03,  1.80it/s]\r 45%|████▌     | 453/999 [03:27<05:04,  1.79it/s]\r 45%|████▌     | 454/999 [03:28<05:02,  1.80it/s]\r 46%|████▌     | 455/999 [03:29<05:00,  1.81it/s]\r 46%|████▌     | 456/999 [03:29<04:54,  1.84it/s]\r 46%|████▌     | 457/999 [03:30<04:53,  1.85it/s]\r 46%|████▌     | 458/999 [03:30<04:52,  1.85it/s]\r 46%|████▌     | 459/999 [03:31<05:03,  1.78it/s]\r 46%|████▌     | 460/999 [03:31<05:03,  1.77it/s]\r 46%|████▌     | 461/999 [03:32<05:02,  1.78it/s]\r 46%|████▌     | 462/999 [03:32<05:00,  1.79it/s]\r 46%|████▋     | 463/999 [03:33<05:00,  1.78it/s]\r 46%|████▋     | 464/999 [03:34<05:04,  1.76it/s]\r 47%|████▋     | 465/999 [03:34<04:55,  1.81it/s]\r 47%|████▋     | 466/999 [03:35<04:57,  1.79it/s]\r 47%|████▋     | 467/999 [03:35<04:48,  1.84it/s]\r 47%|████▋     | 468/999 [03:36<04:43,  1.87it/s]\r 47%|████▋     | 469/999 [03:36<04:45,  1.86it/s]\r 47%|████▋     | 470/999 [03:37<04:46,  1.85it/s]\r 47%|████▋     | 471/999 [03:37<04:48,  1.83it/s]\r 47%|████▋     | 472/999 [03:38<04:55,  1.78it/s]\r 47%|████▋     | 473/999 [03:39<04:57,  1.77it/s]\r 47%|████▋     | 474/999 [03:39<04:44,  1.84it/s]\r 48%|████▊     | 475/999 [03:40<04:42,  1.85it/s]\r 48%|████▊     | 476/999 [03:40<04:39,  1.87it/s]\r 48%|████▊     | 477/999 [03:41<04:42,  1.84it/s]\r 48%|████▊     | 478/999 [03:41<04:47,  1.81it/s]\r 48%|████▊     | 479/999 [03:42<04:51,  1.79it/s]\r 48%|████▊     | 480/999 [03:42<04:41,  1.84it/s]\r 48%|████▊     | 481/999 [03:43<04:43,  1.83it/s]\r 48%|████▊     | 482/999 [03:43<04:39,  1.85it/s]\r 48%|████▊     | 483/999 [03:44<04:46,  1.80it/s]\r 48%|████▊     | 484/999 [03:45<04:39,  1.84it/s]\r 49%|████▊     | 485/999 [03:45<04:35,  1.87it/s]\r 49%|████▊     | 486/999 [03:46<04:31,  1.89it/s]\r 49%|████▊     | 487/999 [03:46<04:30,  1.90it/s]\r 49%|████▉     | 488/999 [03:47<04:26,  1.91it/s]\r 49%|████▉     | 489/999 [03:47<04:22,  1.94it/s]\r 49%|████▉     | 490/999 [03:48<04:21,  1.95it/s]\r 49%|████▉     | 491/999 [03:48<04:15,  1.99it/s]\r 49%|████▉     | 492/999 [03:49<04:15,  1.99it/s]\r 49%|████▉     | 493/999 [03:49<04:19,  1.95it/s]\r 49%|████▉     | 494/999 [03:50<04:22,  1.92it/s]\r 50%|████▉     | 495/999 [03:50<04:22,  1.92it/s]\r 50%|████▉     | 496/999 [03:51<04:20,  1.93it/s]\r 50%|████▉     | 497/999 [03:51<04:24,  1.90it/s]\r 50%|████▉     | 498/999 [03:52<04:24,  1.89it/s]\r 50%|████▉     | 499/999 [03:52<04:14,  1.97it/s]\r 50%|█████     | 500/999 [03:53<04:14,  1.96it/s]\r 50%|█████     | 501/999 [03:53<04:05,  2.03it/s]\r 50%|█████     | 502/999 [03:54<04:13,  1.96it/s]\r 50%|█████     | 503/999 [03:54<04:11,  1.97it/s]\r 50%|█████     | 504/999 [03:55<04:09,  1.98it/s]\r 51%|█████     | 505/999 [03:55<04:10,  1.97it/s]\r 51%|█████     | 506/999 [03:56<04:15,  1.93it/s]\r 51%|█████     | 507/999 [03:56<04:12,  1.95it/s]\r 51%|█████     | 508/999 [03:57<03:59,  2.05it/s]\r 51%|█████     | 509/999 [03:57<03:57,  2.06it/s]\r 51%|█████     | 510/999 [03:58<04:00,  2.03it/s]\r 51%|█████     | 511/999 [03:58<03:56,  2.06it/s]\r 51%|█████▏    | 512/999 [03:59<03:52,  2.09it/s]\r 51%|█████▏    | 513/999 [03:59<03:52,  2.09it/s]\r 51%|█████▏    | 514/999 [04:00<03:54,  2.07it/s]\r 52%|█████▏    | 515/999 [04:00<04:03,  1.99it/s]\r 52%|█████▏    | 516/999 [04:01<04:00,  2.01it/s]\r 52%|█████▏    | 517/999 [04:01<04:01,  2.00it/s]\r 52%|█████▏    | 518/999 [04:02<04:03,  1.98it/s]\r 52%|█████▏    | 519/999 [04:02<04:00,  1.99it/s]\r 52%|█████▏    | 520/999 [04:03<04:00,  1.99it/s]\r 52%|█████▏    | 521/999 [04:03<03:58,  2.00it/s]\r 52%|█████▏    | 522/999 [04:04<03:56,  2.02it/s]\r 52%|█████▏    | 523/999 [04:04<04:01,  1.97it/s]\r 52%|█████▏    | 524/999 [04:05<04:03,  1.95it/s]\r 53%|█████▎    | 525/999 [04:05<04:09,  1.90it/s]\r 53%|█████▎    | 526/999 [04:06<04:08,  1.90it/s]\r 53%|█████▎    | 527/999 [04:06<04:01,  1.95it/s]\r 53%|█████▎    | 528/999 [04:07<04:06,  1.91it/s]\r 53%|█████▎    | 529/999 [04:07<03:55,  2.00it/s]\r 53%|█████▎    | 530/999 [04:08<04:03,  1.93it/s]\r 53%|█████▎    | 531/999 [04:08<04:03,  1.92it/s]\r 53%|█████▎    | 532/999 [04:09<04:05,  1.90it/s]\r 53%|█████▎    | 533/999 [04:09<04:04,  1.91it/s]\r 53%|█████▎    | 534/999 [04:10<04:00,  1.93it/s]\r 54%|█████▎    | 535/999 [04:10<03:57,  1.95it/s]\r 54%|█████▎    | 536/999 [04:11<03:58,  1.94it/s]\r 54%|█████▍    | 537/999 [04:11<03:55,  1.96it/s]\r 54%|█████▍    | 538/999 [04:12<03:54,  1.97it/s]\r 54%|█████▍    | 539/999 [04:12<03:56,  1.95it/s]\r 54%|█████▍    | 540/999 [04:13<03:54,  1.96it/s]\r 54%|█████▍    | 541/999 [04:13<03:53,  1.96it/s]\r 54%|█████▍    | 542/999 [04:14<03:53,  1.96it/s]\r 54%|█████▍    | 543/999 [04:14<03:52,  1.96it/s]\r 54%|█████▍    | 544/999 [04:15<03:57,  1.91it/s]\r 55%|█████▍    | 545/999 [04:16<04:00,  1.89it/s]\r 55%|█████▍    | 546/999 [04:16<03:57,  1.90it/s]\r 55%|█████▍    | 547/999 [04:17<03:56,  1.91it/s]\r 55%|█████▍    | 548/999 [04:17<03:58,  1.89it/s]\r 55%|█████▍    | 549/999 [04:18<03:54,  1.92it/s]\r 55%|█████▌    | 550/999 [04:18<03:50,  1.95it/s]\r 55%|█████▌    | 551/999 [04:19<03:55,  1.90it/s]\r 55%|█████▌    | 552/999 [04:19<03:51,  1.93it/s]\r 55%|█████▌    | 553/999 [04:20<03:53,  1.91it/s]\r 55%|█████▌    | 554/999 [04:20<03:51,  1.92it/s]\r 56%|█████▌    | 555/999 [04:21<03:52,  1.91it/s]\r 56%|█████▌    | 556/999 [04:21<03:52,  1.91it/s]\r 56%|█████▌    | 557/999 [04:22<03:50,  1.92it/s]\r 56%|█████▌    | 558/999 [04:22<03:49,  1.92it/s]\r 56%|█████▌    | 559/999 [04:23<03:47,  1.93it/s]\r 56%|█████▌    | 560/999 [04:23<03:48,  1.92it/s]\r 56%|█████▌    | 561/999 [04:24<03:46,  1.93it/s]\r 56%|█████▋    | 562/999 [04:24<03:43,  1.96it/s]\r 56%|█████▋    | 563/999 [04:25<03:52,  1.88it/s]\r 56%|█████▋    | 564/999 [04:26<03:55,  1.85it/s]\r 57%|█████▋    | 565/999 [04:26<04:02,  1.79it/s]\r 57%|█████▋    | 566/999 [04:27<03:58,  1.82it/s]\r 57%|█████▋    | 567/999 [04:27<03:52,  1.86it/s]\r 57%|█████▋    | 568/999 [04:28<03:59,  1.80it/s]\r 57%|█████▋    | 569/999 [04:28<04:08,  1.73it/s]\r 57%|█████▋    | 570/999 [04:29<04:03,  1.77it/s]\r 57%|█████▋    | 571/999 [04:29<03:56,  1.81it/s]\r 57%|█████▋    | 572/999 [04:30<03:53,  1.83it/s]\r 57%|█████▋    | 573/999 [04:31<03:54,  1.82it/s]\r 57%|█████▋    | 574/999 [04:31<03:54,  1.81it/s]\r 58%|█████▊    | 575/999 [04:32<03:47,  1.86it/s]\r 58%|█████▊    | 576/999 [04:32<03:42,  1.90it/s]\r 58%|█████▊    | 577/999 [04:33<03:44,  1.88it/s]\r 58%|█████▊    | 578/999 [04:33<03:42,  1.89it/s]\r 58%|█████▊    | 579/999 [04:34<03:35,  1.94it/s]\r 58%|█████▊    | 580/999 [04:34<03:37,  1.93it/s]\r 58%|█████▊    | 581/999 [04:35<03:43,  1.87it/s]\r 58%|█████▊    | 582/999 [04:35<03:35,  1.93it/s]\r 58%|█████▊    | 583/999 [04:36<03:35,  1.93it/s]\r 58%|█████▊    | 584/999 [04:36<03:35,  1.92it/s]\r 59%|█████▊    | 585/999 [04:37<03:36,  1.91it/s]\r 59%|█████▊    | 586/999 [04:37<03:40,  1.87it/s]\r 59%|█████▉    | 587/999 [04:38<03:41,  1.86it/s]\r 59%|█████▉    | 588/999 [04:38<03:40,  1.87it/s]\r 59%|█████▉    | 589/999 [04:39<03:34,  1.91it/s]\r 59%|█████▉    | 590/999 [04:39<03:35,  1.90it/s]\r 59%|█████▉    | 591/999 [04:40<03:40,  1.85it/s]\r 59%|█████▉    | 592/999 [04:41<03:33,  1.91it/s]\r 59%|█████▉    | 593/999 [04:41<03:36,  1.88it/s]\r 59%|█████▉    | 594/999 [04:42<03:39,  1.84it/s]\r 60%|█████▉    | 595/999 [04:42<03:42,  1.82it/s]\r 60%|█████▉    | 596/999 [04:43<03:43,  1.80it/s]\r 60%|█████▉    | 597/999 [04:43<03:47,  1.77it/s]\r 60%|█████▉    | 598/999 [04:44<03:44,  1.79it/s]\r 60%|█████▉    | 599/999 [04:45<03:44,  1.78it/s]\r 60%|██████    | 600/999 [04:45<03:42,  1.80it/s]\r 60%|██████    | 601/999 [04:46<03:37,  1.83it/s]\r 60%|██████    | 602/999 [04:46<03:34,  1.85it/s]\r 60%|██████    | 603/999 [04:47<03:33,  1.86it/s]\r 60%|██████    | 604/999 [04:47<03:31,  1.87it/s]\r 61%|██████    | 605/999 [04:48<03:30,  1.87it/s]\r 61%|██████    | 606/999 [04:48<03:36,  1.82it/s]\r 61%|██████    | 607/999 [04:49<03:31,  1.86it/s]\r 61%|██████    | 608/999 [04:49<03:26,  1.89it/s]\r 61%|██████    | 609/999 [04:50<03:23,  1.92it/s]\r 61%|██████    | 610/999 [04:50<03:20,  1.94it/s]\r 61%|██████    | 611/999 [04:51<03:18,  1.96it/s]\r 61%|██████▏   | 612/999 [04:51<03:21,  1.92it/s]\r 61%|██████▏   | 613/999 [04:52<03:17,  1.96it/s]\r 61%|██████▏   | 614/999 [04:52<03:20,  1.92it/s]\r 62%|██████▏   | 615/999 [04:53<03:11,  2.00it/s]\r 62%|██████▏   | 616/999 [04:53<03:18,  1.93it/s]\r 62%|██████▏   | 617/999 [04:54<03:17,  1.93it/s]\r 62%|██████▏   | 618/999 [04:54<03:18,  1.92it/s]\r 62%|██████▏   | 619/999 [04:55<03:13,  1.96it/s]\r 62%|██████▏   | 620/999 [04:55<03:16,  1.93it/s]\r 62%|██████▏   | 621/999 [04:56<03:13,  1.96it/s]\r 62%|██████▏   | 622/999 [04:56<03:11,  1.97it/s]\r 62%|██████▏   | 623/999 [04:57<03:12,  1.96it/s]\r 62%|██████▏   | 624/999 [04:57<03:10,  1.97it/s]\r 63%|██████▎   | 625/999 [04:58<03:12,  1.94it/s]\r 63%|██████▎   | 626/999 [04:59<03:12,  1.94it/s]\r 63%|██████▎   | 627/999 [04:59<03:10,  1.96it/s]\r 63%|██████▎   | 628/999 [05:00<03:11,  1.93it/s]\r 63%|██████▎   | 629/999 [05:00<03:12,  1.92it/s]\r 63%|██████▎   | 630/999 [05:01<03:12,  1.91it/s]\r 63%|██████▎   | 631/999 [05:01<03:10,  1.94it/s]\r 63%|██████▎   | 632/999 [05:02<03:02,  2.01it/s]\r 63%|██████▎   | 633/999 [05:02<03:02,  2.00it/s]\r 63%|██████▎   | 634/999 [05:03<03:02,  2.00it/s]\r 64%|██████▎   | 635/999 [05:03<03:01,  2.00it/s]\r 64%|██████▎   | 636/999 [05:04<03:03,  1.97it/s]\r 64%|██████▍   | 637/999 [05:04<02:59,  2.01it/s]\r 64%|██████▍   | 638/999 [05:05<03:02,  1.98it/s]\r 64%|██████▍   | 639/999 [05:05<03:02,  1.97it/s]\r 64%|██████▍   | 640/999 [05:06<03:02,  1.96it/s]\r 64%|██████▍   | 641/999 [05:06<03:07,  1.91it/s]\r 64%|██████▍   | 642/999 [05:07<03:08,  1.90it/s]\r 64%|██████▍   | 643/999 [05:07<03:06,  1.91it/s]\r 64%|██████▍   | 644/999 [05:08<03:05,  1.92it/s]\r 65%|██████▍   | 645/999 [05:08<03:01,  1.95it/s]\r 65%|██████▍   | 646/999 [05:09<03:04,  1.91it/s]\r 65%|██████▍   | 647/999 [05:09<03:03,  1.92it/s]\r 65%|██████▍   | 648/999 [05:10<02:56,  1.98it/s]\r 65%|██████▍   | 649/999 [05:10<02:53,  2.01it/s]\r 65%|██████▌   | 650/999 [05:11<02:48,  2.07it/s]\r 65%|██████▌   | 651/999 [05:11<02:50,  2.04it/s]\r 65%|██████▌   | 652/999 [05:12<02:50,  2.03it/s]\r 65%|██████▌   | 653/999 [05:12<02:53,  1.99it/s]\r 65%|██████▌   | 654/999 [05:13<02:48,  2.05it/s]\r 66%|██████▌   | 655/999 [05:13<02:44,  2.10it/s]\r 66%|██████▌   | 656/999 [05:14<02:48,  2.03it/s]\r 66%|██████▌   | 657/999 [05:14<02:49,  2.01it/s]\r 66%|██████▌   | 658/999 [05:15<02:46,  2.05it/s]\r 66%|██████▌   | 659/999 [05:15<02:44,  2.07it/s]\r 66%|██████▌   | 660/999 [05:16<02:46,  2.04it/s]\r 66%|██████▌   | 661/999 [05:16<02:44,  2.05it/s]\r 66%|██████▋   | 662/999 [05:17<02:45,  2.04it/s]\r 66%|██████▋   | 663/999 [05:17<02:47,  2.00it/s]\r 66%|██████▋   | 664/999 [05:18<02:49,  1.97it/s]\r 67%|██████▋   | 665/999 [05:18<02:47,  2.00it/s]\r 67%|██████▋   | 666/999 [05:19<02:46,  1.99it/s]\r 67%|██████▋   | 667/999 [05:19<02:43,  2.03it/s]\r 67%|██████▋   | 668/999 [05:20<02:43,  2.02it/s]\r 67%|██████▋   | 669/999 [05:20<02:46,  1.98it/s]\r 67%|██████▋   | 670/999 [05:21<02:46,  1.97it/s]\r 67%|██████▋   | 671/999 [05:21<02:43,  2.01it/s]\r 67%|██████▋   | 672/999 [05:22<02:38,  2.07it/s]\r 67%|██████▋   | 673/999 [05:22<02:36,  2.08it/s]\r 67%|██████▋   | 674/999 [05:23<02:35,  2.09it/s]\r 68%|██████▊   | 675/999 [05:23<02:34,  2.09it/s]\r 68%|██████▊   | 676/999 [05:23<02:35,  2.08it/s]\r 68%|██████▊   | 677/999 [05:24<02:36,  2.05it/s]\r 68%|██████▊   | 678/999 [05:24<02:37,  2.04it/s]\r 68%|██████▊   | 679/999 [05:25<02:36,  2.05it/s]\r 68%|██████▊   | 680/999 [05:25<02:38,  2.02it/s]\r 68%|██████▊   | 681/999 [05:26<02:35,  2.04it/s]\r 68%|██████▊   | 682/999 [05:26<02:32,  2.08it/s]\r 68%|██████▊   | 683/999 [05:27<02:35,  2.04it/s]\r 68%|██████▊   | 684/999 [05:27<02:35,  2.02it/s]\r 69%|██████▊   | 685/999 [05:28<02:34,  2.04it/s]\r 69%|██████▊   | 686/999 [05:28<02:34,  2.02it/s]\r 69%|██████▉   | 687/999 [05:29<02:38,  1.97it/s]\r 69%|██████▉   | 688/999 [05:29<02:39,  1.94it/s]\r 69%|██████▉   | 689/999 [05:30<02:37,  1.96it/s]\r 69%|██████▉   | 690/999 [05:30<02:38,  1.95it/s]\r 69%|██████▉   | 691/999 [05:31<02:37,  1.95it/s]\r 69%|██████▉   | 692/999 [05:32<02:36,  1.96it/s]\r 69%|██████▉   | 693/999 [05:32<02:36,  1.96it/s]\r 69%|██████▉   | 694/999 [05:32<02:32,  1.99it/s]\r 70%|██████▉   | 695/999 [05:33<02:35,  1.96it/s]\r 70%|██████▉   | 696/999 [05:34<02:38,  1.91it/s]\r 70%|██████▉   | 697/999 [05:34<02:39,  1.90it/s]\r 70%|██████▉   | 698/999 [05:35<02:38,  1.90it/s]\r 70%|██████▉   | 699/999 [05:35<02:39,  1.88it/s]\r 70%|███████   | 700/999 [05:36<02:37,  1.90it/s]\r 70%|███████   | 701/999 [05:36<02:36,  1.91it/s]\r 70%|███████   | 702/999 [05:37<02:40,  1.85it/s]\r 70%|███████   | 703/999 [05:37<02:39,  1.85it/s]\r 70%|███████   | 704/999 [05:38<02:37,  1.87it/s]\r 71%|███████   | 705/999 [05:38<02:45,  1.77it/s]\r 71%|███████   | 706/999 [05:39<02:39,  1.84it/s]\r 71%|███████   | 707/999 [05:40<02:37,  1.85it/s]\r 71%|███████   | 708/999 [05:40<02:33,  1.89it/s]\r 71%|███████   | 709/999 [05:41<02:34,  1.87it/s]\r 71%|███████   | 710/999 [05:41<02:37,  1.83it/s]\r 71%|███████   | 711/999 [05:42<02:37,  1.83it/s]\r 71%|███████▏  | 712/999 [05:42<02:35,  1.85it/s]\r 71%|███████▏  | 713/999 [05:43<02:30,  1.90it/s]\r 71%|███████▏  | 714/999 [05:43<02:32,  1.87it/s]\r 72%|███████▏  | 715/999 [05:44<02:31,  1.87it/s]\r 72%|███████▏  | 716/999 [05:44<02:33,  1.84it/s]\r 72%|███████▏  | 717/999 [05:45<02:38,  1.78it/s]\r 72%|███████▏  | 718/999 [05:46<02:37,  1.79it/s]\r 72%|███████▏  | 719/999 [05:46<02:39,  1.75it/s]\r 72%|███████▏  | 720/999 [05:47<02:43,  1.70it/s]\r 72%|███████▏  | 721/999 [05:47<02:47,  1.66it/s]\r 72%|███████▏  | 722/999 [05:48<02:50,  1.62it/s]\r 72%|███████▏  | 723/999 [05:49<02:50,  1.62it/s]\r 72%|███████▏  | 724/999 [05:49<02:48,  1.63it/s]\r 73%|███████▎  | 725/999 [05:50<02:46,  1.65it/s]\r 73%|███████▎  | 726/999 [05:50<02:40,  1.70it/s]\r 73%|███████▎  | 727/999 [05:51<02:41,  1.68it/s]\r 73%|███████▎  | 728/999 [05:52<02:41,  1.67it/s]\r 73%|███████▎  | 729/999 [05:52<02:41,  1.67it/s]\r 73%|███████▎  | 730/999 [05:53<02:43,  1.64it/s]\r 73%|███████▎  | 731/999 [05:53<02:41,  1.66it/s]\r 73%|███████▎  | 732/999 [05:54<02:43,  1.64it/s]\r 73%|███████▎  | 733/999 [05:55<02:41,  1.65it/s]\r 73%|███████▎  | 734/999 [05:55<02:37,  1.69it/s]\r 74%|███████▎  | 735/999 [05:56<02:34,  1.71it/s]\r 74%|███████▎  | 736/999 [05:56<02:40,  1.64it/s]\r 74%|███████▍  | 737/999 [05:57<02:40,  1.63it/s]\r 74%|███████▍  | 738/999 [05:58<02:54,  1.49it/s]\r 74%|███████▍  | 739/999 [05:59<02:56,  1.47it/s]\r 74%|███████▍  | 740/999 [05:59<02:56,  1.47it/s]\r 74%|███████▍  | 741/999 [06:00<02:56,  1.46it/s]\r 74%|███████▍  | 742/999 [06:01<02:53,  1.48it/s]\r 74%|███████▍  | 743/999 [06:01<02:48,  1.52it/s]\r 74%|███████▍  | 744/999 [06:02<02:49,  1.51it/s]\r 75%|███████▍  | 745/999 [06:03<02:44,  1.54it/s]\r 75%|███████▍  | 746/999 [06:03<02:41,  1.57it/s]\r 75%|███████▍  | 747/999 [06:04<02:40,  1.57it/s]\r 75%|███████▍  | 748/999 [06:04<02:44,  1.53it/s]\r 75%|███████▍  | 749/999 [06:05<02:41,  1.55it/s]\r 75%|███████▌  | 750/999 [06:06<02:43,  1.52it/s]\r 75%|███████▌  | 751/999 [06:06<02:43,  1.52it/s]\r 75%|███████▌  | 752/999 [06:07<02:39,  1.54it/s]\r 75%|███████▌  | 753/999 [06:08<02:40,  1.53it/s]\r 75%|███████▌  | 754/999 [06:08<02:41,  1.52it/s]\r 76%|███████▌  | 755/999 [06:09<02:40,  1.52it/s]\r 76%|███████▌  | 756/999 [06:10<02:37,  1.55it/s]\r 76%|███████▌  | 757/999 [06:10<02:42,  1.49it/s]\r 76%|███████▌  | 758/999 [06:11<02:42,  1.48it/s]\r 76%|███████▌  | 759/999 [06:12<02:38,  1.51it/s]\r 76%|███████▌  | 760/999 [06:12<02:40,  1.49it/s]\r 76%|███████▌  | 761/999 [06:13<02:43,  1.46it/s]\r 76%|███████▋  | 762/999 [06:14<02:43,  1.45it/s]\r 76%|███████▋  | 763/999 [06:15<02:46,  1.42it/s]\r 76%|███████▋  | 764/999 [06:15<02:49,  1.38it/s]\r 77%|███████▋  | 765/999 [06:16<02:45,  1.41it/s]\r 77%|███████▋  | 766/999 [06:17<02:43,  1.43it/s]\r 77%|███████▋  | 767/999 [06:17<02:43,  1.42it/s]\r 77%|███████▋  | 768/999 [06:18<02:42,  1.42it/s]\r 77%|███████▋  | 769/999 [06:19<02:41,  1.43it/s]\r 77%|███████▋  | 770/999 [06:20<02:41,  1.42it/s]\r 77%|███████▋  | 771/999 [06:20<02:35,  1.46it/s]\r 77%|███████▋  | 772/999 [06:21<02:32,  1.49it/s]\r 77%|███████▋  | 773/999 [06:21<02:31,  1.50it/s]\r 77%|███████▋  | 774/999 [06:22<02:32,  1.48it/s]\r 78%|███████▊  | 775/999 [06:23<02:30,  1.49it/s]\r 78%|███████▊  | 776/999 [06:23<02:31,  1.47it/s]\r 78%|███████▊  | 777/999 [06:24<02:31,  1.47it/s]\r 78%|███████▊  | 778/999 [06:25<02:33,  1.44it/s]\r 78%|███████▊  | 779/999 [06:26<02:29,  1.47it/s]\r 78%|███████▊  | 780/999 [06:26<02:27,  1.48it/s]\r 78%|███████▊  | 781/999 [06:27<02:30,  1.44it/s]\r 78%|███████▊  | 782/999 [06:28<02:29,  1.46it/s]\r 78%|███████▊  | 783/999 [06:28<02:29,  1.45it/s]\r 78%|███████▊  | 784/999 [06:29<02:28,  1.45it/s]\r 79%|███████▊  | 785/999 [06:30<02:32,  1.41it/s]\r 79%|███████▊  | 786/999 [06:31<02:35,  1.37it/s]\r 79%|███████▉  | 787/999 [06:31<02:32,  1.39it/s]\r 79%|███████▉  | 788/999 [06:32<02:31,  1.39it/s]\r 79%|███████▉  | 789/999 [06:33<02:30,  1.39it/s]\r 79%|███████▉  | 790/999 [06:33<02:29,  1.39it/s]\r 79%|███████▉  | 791/999 [06:34<02:25,  1.43it/s]\r 79%|███████▉  | 792/999 [06:35<02:22,  1.45it/s]\r 79%|███████▉  | 793/999 [06:35<02:20,  1.47it/s]\r 79%|███████▉  | 794/999 [06:36<02:21,  1.45it/s]\r 80%|███████▉  | 795/999 [06:37<02:17,  1.48it/s]\r 80%|███████▉  | 796/999 [06:37<02:17,  1.48it/s]\r 80%|███████▉  | 797/999 [06:38<02:17,  1.47it/s]\r 80%|███████▉  | 798/999 [06:39<02:20,  1.43it/s]\r 80%|███████▉  | 799/999 [06:40<02:24,  1.38it/s]\r 80%|████████  | 800/999 [06:40<02:26,  1.36it/s]\r 80%|████████  | 801/999 [06:41<02:24,  1.37it/s]\r 80%|████████  | 802/999 [06:42<02:23,  1.37it/s]\r 80%|████████  | 803/999 [06:43<02:24,  1.36it/s]\r 80%|████████  | 804/999 [06:43<02:25,  1.34it/s]\r 81%|████████  | 805/999 [06:44<02:24,  1.34it/s]\r 81%|████████  | 806/999 [06:45<02:23,  1.34it/s]\r 81%|████████  | 807/999 [06:46<02:20,  1.37it/s]\r 81%|████████  | 808/999 [06:46<02:17,  1.38it/s]\r 81%|████████  | 809/999 [06:47<02:15,  1.40it/s]\r 81%|████████  | 810/999 [06:48<02:11,  1.44it/s]\r 81%|████████  | 811/999 [06:48<02:11,  1.43it/s]\r 81%|████████▏ | 812/999 [06:49<02:10,  1.43it/s]\r 81%|████████▏ | 813/999 [06:50<02:10,  1.42it/s]\r 81%|████████▏ | 814/999 [06:50<02:13,  1.39it/s]\r 82%|████████▏ | 815/999 [06:51<02:15,  1.36it/s]\r 82%|████████▏ | 816/999 [06:52<02:16,  1.34it/s]\r 82%|████████▏ | 817/999 [06:53<02:16,  1.33it/s]\r 82%|████████▏ | 818/999 [06:54<02:14,  1.35it/s]\r 82%|████████▏ | 819/999 [06:54<02:17,  1.31it/s]\r 82%|████████▏ | 820/999 [06:55<02:15,  1.32it/s]\r 82%|████████▏ | 821/999 [06:56<02:13,  1.33it/s]\r 82%|████████▏ | 822/999 [06:57<02:10,  1.35it/s]\r 82%|████████▏ | 823/999 [06:57<02:09,  1.35it/s]\r 82%|████████▏ | 824/999 [06:58<02:09,  1.35it/s]\r 83%|████████▎ | 825/999 [06:59<02:10,  1.33it/s]\r 83%|████████▎ | 826/999 [06:59<02:06,  1.37it/s]\r 83%|████████▎ | 827/999 [07:00<02:01,  1.42it/s]\r 83%|████████▎ | 828/999 [07:01<02:00,  1.41it/s]\r 83%|████████▎ | 829/999 [07:02<02:01,  1.39it/s]\r 83%|████████▎ | 830/999 [07:02<01:59,  1.42it/s]\r 83%|████████▎ | 831/999 [07:03<01:56,  1.44it/s]\r 83%|████████▎ | 832/999 [07:04<01:56,  1.43it/s]\r 83%|████████▎ | 833/999 [07:04<01:51,  1.48it/s]\r 83%|████████▎ | 834/999 [07:05<01:49,  1.51it/s]\r 84%|████████▎ | 835/999 [07:06<01:50,  1.48it/s]\r 84%|████████▎ | 836/999 [07:06<01:50,  1.48it/s]\r 84%|████████▍ | 837/999 [07:07<01:51,  1.45it/s]\r 84%|████████▍ | 838/999 [07:08<01:51,  1.44it/s]\r 84%|████████▍ | 839/999 [07:08<01:51,  1.43it/s]\r 84%|████████▍ | 840/999 [07:09<01:50,  1.44it/s]\r 84%|████████▍ | 841/999 [07:10<01:48,  1.46it/s]\r 84%|████████▍ | 842/999 [07:10<01:47,  1.46it/s]\r 84%|████████▍ | 843/999 [07:11<01:45,  1.48it/s]\r 84%|████████▍ | 844/999 [07:12<01:43,  1.50it/s]\r 85%|████████▍ | 845/999 [07:12<01:40,  1.53it/s]\r 85%|████████▍ | 846/999 [07:13<01:43,  1.48it/s]\r 85%|████████▍ | 847/999 [07:14<01:42,  1.49it/s]\r 85%|████████▍ | 848/999 [07:14<01:41,  1.48it/s]\r 85%|████████▍ | 849/999 [07:15<01:42,  1.46it/s]\r 85%|████████▌ | 850/999 [07:16<01:40,  1.48it/s]\r 85%|████████▌ | 851/999 [07:16<01:41,  1.46it/s]\r 85%|████████▌ | 852/999 [07:17<01:40,  1.46it/s]\r 85%|████████▌ | 853/999 [07:18<01:38,  1.49it/s]\r 85%|████████▌ | 854/999 [07:18<01:34,  1.53it/s]\r 86%|████████▌ | 855/999 [07:19<01:34,  1.52it/s]\r 86%|████████▌ | 856/999 [07:20<01:32,  1.55it/s]\r 86%|████████▌ | 857/999 [07:20<01:29,  1.58it/s]\r 86%|████████▌ | 858/999 [07:21<01:29,  1.57it/s]\r 86%|████████▌ | 859/999 [07:22<01:29,  1.57it/s]\r 86%|████████▌ | 860/999 [07:22<01:31,  1.52it/s]\r 86%|████████▌ | 861/999 [07:23<01:32,  1.50it/s]\r 86%|████████▋ | 862/999 [07:24<01:29,  1.54it/s]\r 86%|████████▋ | 863/999 [07:24<01:29,  1.52it/s]\r 86%|████████▋ | 864/999 [07:25<01:30,  1.48it/s]\r 87%|████████▋ | 865/999 [07:26<01:31,  1.47it/s]\r 87%|████████▋ | 866/999 [07:26<01:30,  1.48it/s]\r 87%|████████▋ | 867/999 [07:27<01:30,  1.46it/s]\r 87%|████████▋ | 868/999 [07:28<01:27,  1.50it/s]\r 87%|████████▋ | 869/999 [07:28<01:26,  1.51it/s]\r 87%|████████▋ | 870/999 [07:29<01:24,  1.53it/s]\r 87%|████████▋ | 871/999 [07:30<01:24,  1.51it/s]\r 87%|████████▋ | 872/999 [07:30<01:24,  1.50it/s]\r 87%|████████▋ | 873/999 [07:31<01:24,  1.48it/s]\r 87%|████████▋ | 874/999 [07:32<01:23,  1.50it/s]\r 88%|████████▊ | 875/999 [07:32<01:23,  1.49it/s]\r 88%|████████▊ | 876/999 [07:33<01:22,  1.48it/s]\r 88%|████████▊ | 877/999 [07:34<01:23,  1.47it/s]\r 88%|████████▊ | 878/999 [07:34<01:22,  1.47it/s]\r 88%|████████▊ | 879/999 [07:35<01:21,  1.47it/s]\r 88%|████████▊ | 880/999 [07:36<01:20,  1.47it/s]\r 88%|████████▊ | 881/999 [07:36<01:20,  1.47it/s]\r 88%|████████▊ | 882/999 [07:37<01:20,  1.46it/s]\r 88%|████████▊ | 883/999 [07:38<01:18,  1.47it/s]\r 88%|████████▊ | 884/999 [07:38<01:17,  1.48it/s]\r 89%|████████▊ | 885/999 [07:39<01:15,  1.52it/s]\r 89%|████████▊ | 886/999 [07:40<01:14,  1.51it/s]\r 89%|████████▉ | 887/999 [07:40<01:14,  1.51it/s]\r 89%|████████▉ | 888/999 [07:41<01:16,  1.46it/s]\r 89%|████████▉ | 889/999 [07:42<01:14,  1.48it/s]\r 89%|████████▉ | 890/999 [07:42<01:12,  1.50it/s]\r 89%|████████▉ | 891/999 [07:43<01:10,  1.54it/s]\r 89%|████████▉ | 892/999 [07:44<01:08,  1.56it/s]\r 89%|████████▉ | 893/999 [07:44<01:07,  1.57it/s]\r 89%|████████▉ | 894/999 [07:45<01:07,  1.56it/s]\r 90%|████████▉ | 895/999 [07:46<01:06,  1.56it/s]\r 90%|████████▉ | 896/999 [07:46<01:05,  1.57it/s]\r 90%|████████▉ | 897/999 [07:47<01:05,  1.57it/s]\r 90%|████████▉ | 898/999 [07:48<01:04,  1.56it/s]\r 90%|████████▉ | 899/999 [07:48<01:03,  1.57it/s]\r 90%|█████████ | 900/999 [07:49<01:02,  1.57it/s]\r 90%|█████████ | 901/999 [07:49<01:02,  1.56it/s]\r 90%|█████████ | 902/999 [07:50<01:02,  1.56it/s]\r 90%|█████████ | 903/999 [07:51<01:00,  1.58it/s]\r 90%|█████████ | 904/999 [07:51<01:00,  1.58it/s]\r 91%|█████████ | 905/999 [07:52<01:00,  1.55it/s]\r 91%|█████████ | 906/999 [07:53<00:59,  1.56it/s]\r 91%|█████████ | 907/999 [07:53<00:58,  1.56it/s]\r 91%|█████████ | 908/999 [07:54<00:57,  1.57it/s]\r 91%|█████████ | 909/999 [07:55<00:58,  1.54it/s]\r 91%|█████████ | 910/999 [07:55<00:59,  1.51it/s]\r 91%|█████████ | 911/999 [07:56<00:58,  1.51it/s]\r 91%|█████████▏| 912/999 [07:57<00:58,  1.50it/s]\r 91%|█████████▏| 913/999 [07:57<00:57,  1.49it/s]\r 91%|█████████▏| 914/999 [07:58<00:56,  1.52it/s]\r 92%|█████████▏| 915/999 [07:59<00:55,  1.51it/s]\r 92%|█████████▏| 916/999 [07:59<00:55,  1.51it/s]\r 92%|█████████▏| 917/999 [08:00<00:54,  1.49it/s]\r 92%|█████████▏| 918/999 [08:01<00:54,  1.49it/s]\r 92%|█████████▏| 919/999 [08:01<00:53,  1.48it/s]\r 92%|█████████▏| 920/999 [08:02<00:52,  1.51it/s]\r 92%|█████████▏| 921/999 [08:03<00:50,  1.55it/s]\r 92%|█████████▏| 922/999 [08:03<00:49,  1.56it/s]\r 92%|█████████▏| 923/999 [08:04<00:48,  1.56it/s]\r 92%|█████████▏| 924/999 [08:04<00:47,  1.57it/s]\r 93%|█████████▎| 925/999 [08:05<00:47,  1.56it/s]\r 93%|█████████▎| 926/999 [08:06<00:47,  1.55it/s]\r 93%|█████████▎| 927/999 [08:06<00:46,  1.54it/s]\r 93%|█████████▎| 928/999 [08:07<00:46,  1.54it/s]\r 93%|█████████▎| 929/999 [08:08<00:45,  1.53it/s]\r 93%|█████████▎| 930/999 [08:08<00:45,  1.53it/s]\r 93%|█████████▎| 931/999 [08:09<00:44,  1.53it/s]\r 93%|█████████▎| 932/999 [08:10<00:43,  1.54it/s]\r 93%|█████████▎| 933/999 [08:10<00:43,  1.52it/s]\r 93%|█████████▎| 934/999 [08:11<00:42,  1.53it/s]\r 94%|█████████▎| 935/999 [08:12<00:41,  1.55it/s]\r 94%|█████████▎| 936/999 [08:12<00:40,  1.54it/s]\r 94%|█████████▍| 937/999 [08:13<00:39,  1.56it/s]\r 94%|█████████▍| 938/999 [08:13<00:37,  1.61it/s]\r 94%|█████████▍| 939/999 [08:14<00:37,  1.58it/s]\r 94%|█████████▍| 940/999 [08:15<00:36,  1.60it/s]\r 94%|█████████▍| 941/999 [08:15<00:35,  1.62it/s]\r 94%|█████████▍| 942/999 [08:16<00:35,  1.60it/s]\r 94%|█████████▍| 943/999 [08:17<00:35,  1.59it/s]\r 94%|█████████▍| 944/999 [08:17<00:34,  1.58it/s]\r 95%|█████████▍| 945/999 [08:18<00:34,  1.58it/s]\r 95%|█████████▍| 946/999 [08:19<00:33,  1.59it/s]\r 95%|█████████▍| 947/999 [08:19<00:30,  1.68it/s]\r 95%|█████████▍| 948/999 [08:20<00:30,  1.65it/s]\r 95%|█████████▍| 949/999 [08:20<00:30,  1.65it/s]\r 95%|█████████▌| 950/999 [08:21<00:30,  1.62it/s]\r 95%|█████████▌| 951/999 [08:22<00:30,  1.56it/s]\r 95%|█████████▌| 952/999 [08:22<00:30,  1.52it/s]\r 95%|█████████▌| 953/999 [08:23<00:30,  1.51it/s]\r 95%|█████████▌| 954/999 [08:24<00:30,  1.46it/s]\r 96%|█████████▌| 955/999 [08:24<00:30,  1.45it/s]\r 96%|█████████▌| 956/999 [08:25<00:29,  1.45it/s]\r 96%|█████████▌| 957/999 [08:26<00:29,  1.43it/s]\r 96%|█████████▌| 958/999 [08:27<00:28,  1.43it/s]\r 96%|█████████▌| 959/999 [08:27<00:28,  1.42it/s]\r 96%|█████████▌| 960/999 [08:28<00:26,  1.45it/s]\r 96%|█████████▌| 961/999 [08:29<00:26,  1.44it/s]\r 96%|█████████▋| 962/999 [08:29<00:25,  1.44it/s]\r 96%|█████████▋| 963/999 [08:30<00:25,  1.41it/s]\r 96%|█████████▋| 964/999 [08:31<00:25,  1.37it/s]\r 97%|█████████▋| 965/999 [08:32<00:24,  1.39it/s]\r 97%|█████████▋| 966/999 [08:32<00:23,  1.41it/s]\r 97%|█████████▋| 967/999 [08:33<00:22,  1.44it/s]\r 97%|█████████▋| 968/999 [08:34<00:21,  1.45it/s]\r 97%|█████████▋| 969/999 [08:34<00:21,  1.41it/s]\r 97%|█████████▋| 970/999 [08:35<00:20,  1.44it/s]\r 97%|█████████▋| 971/999 [08:36<00:19,  1.44it/s]\r 97%|█████████▋| 972/999 [08:36<00:18,  1.42it/s]\r 97%|█████████▋| 973/999 [08:37<00:18,  1.42it/s]\r 97%|█████████▋| 974/999 [08:38<00:18,  1.35it/s]\r 98%|█████████▊| 975/999 [08:39<00:17,  1.36it/s]\r 98%|█████████▊| 976/999 [08:39<00:16,  1.41it/s]\r 98%|█████████▊| 977/999 [08:40<00:16,  1.36it/s]\r 98%|█████████▊| 978/999 [08:41<00:15,  1.34it/s]\r 98%|█████████▊| 979/999 [08:42<00:14,  1.37it/s]\r 98%|█████████▊| 980/999 [08:42<00:13,  1.40it/s]\r 98%|█████████▊| 981/999 [08:43<00:13,  1.38it/s]\r 98%|█████████▊| 982/999 [08:44<00:12,  1.38it/s]\r 98%|█████████▊| 983/999 [08:44<00:11,  1.41it/s]\r 98%|█████████▊| 984/999 [08:45<00:10,  1.40it/s]\r 99%|█████████▊| 985/999 [08:46<00:10,  1.39it/s]\r 99%|█████████▊| 986/999 [08:46<00:09,  1.43it/s]\r 99%|█████████▉| 987/999 [08:47<00:08,  1.42it/s]\r 99%|█████████▉| 988/999 [08:48<00:07,  1.40it/s]\r 99%|█████████▉| 989/999 [08:49<00:07,  1.42it/s]\r 99%|█████████▉| 990/999 [08:49<00:06,  1.43it/s]\r 99%|█████████▉| 991/999 [08:50<00:05,  1.41it/s]\r 99%|█████████▉| 992/999 [08:51<00:04,  1.42it/s]\r 99%|█████████▉| 993/999 [08:51<00:04,  1.38it/s]\r 99%|█████████▉| 994/999 [08:52<00:03,  1.39it/s]\r100%|█████████▉| 995/999 [08:53<00:02,  1.42it/s]\r100%|█████████▉| 996/999 [08:54<00:02,  1.41it/s]\r100%|█████████▉| 997/999 [08:54<00:01,  1.39it/s]\r100%|█████████▉| 998/999 [08:55<00:00,  1.34it/s]\r100%|██████████| 999/999 [08:56<00:00,  1.39it/s]\r100%|██████████| 999/999 [08:56<00:00,  1.86it/s]\n```\n:::\n:::\n\n\n::: {#ebe9eacf .cell execution_count=37}\n``` {.python .cell-code}\nplt.figure(figsize=(10, 6))\nplt.scatter(quantiles_theoriques, quantiles_empiriques)\nplt.plot(quantiles_theoriques, quantiles_theoriques, color='red', label='Première bissectrice')\nplt.title('QQ Plot - Quantiles empiriques vs Quantiles théoriques')\nplt.xlabel('Quantiles théoriques (distribution Skew Student)')\nplt.ylabel('Quantiles empiriques')\nplt.grid(True)\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-38-output-1.png){}\n:::\n:::\n\n\n::: {#20dd39f6 .cell execution_count=38}\n``` {.python .cell-code}\n# # kstest y revenir\n# ks_stat, ks_p_value = kstest(data_train, skew_student_pdf, args=(**params_sstd,))\n\n# print(\"=\"*80)\n# print(\"H0 : Les données suivent une loi de Skew Student\")\n# print(f\"Statistique de test : {ks_stat:.4f}\")\n# print(f\"P-value : {ks_p_value:.4f}\")\n# print(\"=\"*80)\n# A revoir\n```\n:::\n\n\n### II.4.2. Calcul de la VaR Skew Student\n\n::: {#5a000c54 .cell execution_count=39}\n``` {.python .cell-code}\n# Objectif : écrire une fonction qui calcule la VaR skew-student\n\ndef sstd_var_fct(alpha, params):\n    \"\"\"\n    Calcul de la VaR skew student\n    data : les rendements logarithmiques\n    alpha : le niveau de confiance\n    \"\"\"\n\n    return -skew_student_quantile(1-alpha, **params)\n```\n:::\n\n\n::: {#86892cb9 .cell execution_count=40}\n``` {.python .cell-code}\nsstd_var = sstd_var_fct(alpha, params_sstd)\nprint(f\"La VaR skew student pour h=1j et alpha={alpha} est : {sstd_var:.4%}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLa VaR skew student pour h=1j et alpha=0.99 est : 4.2575%\n```\n:::\n:::\n\n\n# III. Implémentation de l'ES\n\nL'expected shortfall (ES) est une mesure de risque qui donne une estimation de la perte moyenne au-delà du seuil de la VaR. Par exemple, un ES à 5% sur 1 jour de 1000 euros signifie que si la perte dépasse 1000 euros, alors la perte moyenne sera de 1500 euros. L'ES est une mesure plus robuste que la VaR, car elle prend en compte les queues de distribution et est particulièrement utile pour évaluer les risques extrêmes. Elle est définie comme suit :\n\n$$ES_{\\alpha}(h) = E(PnL | PnL \\leq -VaR_{\\alpha}(h))$$\n\n\n/!\\ La ES du cours est différente de celle ci. Elle est définie comme suit :\n$$ES_{\\alpha}(h) = E(PnL - VaR | PnL \\leq -VaR_{\\alpha}(h)) = CTE - VaR$$\n\nVoir ce qui est fait dans le cadre réglementaire.\n\n::: {#79cc0359 .cell execution_count=41}\n``` {.python .cell-code}\n# Expected Shortfall pour la VaR historique, bootstrap et gaussienne, et skew-student\n\ndef expected_shortfall(data, var):\n    \"\"\"\n    Calcul de l'Expected Shortfall\n    data : les rendements logarithmiques\n    var : la VaR\n    \"\"\"\n    return -data[data < -var].mean()\n\nes_hist_train = expected_shortfall(data_train, var_hist_train)\nes_bs_train = expected_shortfall(data_train, var_bs_train)\nes_gauss_train = expected_shortfall(data_train, var_gauss_train)\nes_sstd_train = expected_shortfall(data_train, sstd_var)\n\n# in a df\nes = pd.DataFrame({\n    'Historique': [es_hist_train],\n    'Bootstrap': [es_bs_train],\n    'Gaussienne': [es_gauss_train],\n    'Skew Student': [es_sstd_train]\n})\n\nprint(\"=\"*80)\nprint(\"Expected Shortfall empirique (en %) pour h=1j\")\nprint(round(100*es,2))\nprint(\"=\"*80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nExpected Shortfall empirique (en %) pour h=1j\n   Historique  Bootstrap  Gaussienne  Skew Student\n0        5.47       5.51        4.47          5.68\n================================================================================\n```\n:::\n:::\n\n\n::: {#f55c5a18 .cell execution_count=42}\n``` {.python .cell-code}\nimport scipy.stats as stats\nimport scipy.integrate as integrate\n\ndef expected_shortfall_theoretical(alpha, quantile_function, density_function,params):\n    \"\"\"\n    Computes the Expected Shortfall (Conditional VaR) for a given distribution.\n\n    Parameters:\n    - alpha (float): Confidence level (e.g., 0.99 for 99%)\n    - quantile_function (callable): Function to compute quantiles (e.g., skew_student_quantile)\n    - params (dict): Parameters of the distribution\n\n    Returns:\n    - float: Expected Shortfall value\n    \"\"\"\n\n    # Compute the Value at Risk (VaR) at level alpha\n    var_alpha = quantile_function(1-alpha, **params)\n\n    # Expected Shortfall integral\n    integral_value, _ = integrate.quad(lambda x: x * density_function(x, **params), -float(\"inf\"), var_alpha)\n\n    # Compute Expected Shortfall\n    es_alpha = -integral_value / (1 - alpha)\n\n    return es_alpha\n\n# Compute Expected Shortfall using the corrected function\nalpha = 0.99\nes_sstd_theoretical = expected_shortfall_theoretical(alpha,skew_student_quantile,skew_student_pdf, params_sstd)\n\nparams_norm = {\n    \"loc\" : np.mean(data_train),\n    \"scale\" : np.std(data_train)\n}\n\nes_gauss_theoretical = expected_shortfall_theoretical(alpha,stats.norm.ppf,stats.norm.pdf, params_norm)\n\nes_theoretical = pd.DataFrame({\n    'Gaussienne': [es_gauss_theoretical],\n    'Skew Student': [es_sstd_theoretical]\n})\n\nprint(\"=\"*80)\nprint(\"Expected Shortfall théorique (en %) pour h=1j\")\nprint(round(100*es_theoretical,2))\nprint(\"=\"*80)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nExpected Shortfall théorique (en %) pour h=1j\n   Gaussienne  Skew Student\n0         3.7          6.71\n================================================================================\n```\n:::\n:::\n\n\n# IV.Protocole de Backtesting\n\nL'exercice de backtesting consiste à vérifier la capacité d'adaptation du modèle et sa viabilité en dehors de son cadre d'entraînement. Il permet d’évaluer la performance des modèles dans le temps. Idéalement, il faudrait le realiser quotidiennement afin d'évaluer s'il est utile ou non de recalibrer le modèle.\n\nDans le cadre de TP, nous n'avons pas observé d'exceptions avec l'utilisation de la VaR historique. Cela est probablement du à la période d’apprentissage trop stricte. Notre modèle était donc trop restrictif/conservateur ce qui peut témoigner de son incapacité d'adaptation. Pour ce faire, il aurait été necessaire de le recalibrer.\n\nSachant que les modèles sont évalués quotidiennement, à quel moment doit-on considérer qu'il est nécessaire de recalibrer le modèle ? Quels indicateurs pourrait-on mettre en place pour déterminer si tout est sous contrôle (VaR trop haute, trop basse) ou si un recalibrage est requis, sachant que le modèle est backtesté chaque jour ?  \n\nPour repondre à ces questions, nous proposons le protocole de backtest ci-dessous : \n\n- Dans la réglementation baloise, il est demandé de tester les performances de la VaR sur les 250 jours suivants la date de réalisation du modèle. Dans ces 250 jours, on est censé observé 2 à 3 exceptions, soit 1%. Lorsqu'il n'y a aucune exception sur cette période de temps, nous jugerons que le modèle est mal calibré.\n\n- Lorsqu'il y a des exceptions, nous pouvons comparer ces exceptions théoriques aux exceptions observées à l'aide d'un test de Kupiec/Unconditionnal coverage [1], une variante du test binomiale qui permet de tester sous l'hypothèse nulle que le taux d'exception(p) est égal au niveau de confiance de la VaR (1-$\\alpha$). La statistique de test suit une loi de khi-deux à 1 degré de liberté. Lorsque cette hypothèse est rejetée, cela signifie que le modèle est mal calibré. En effet, si une banque a trop d’exceptions, i.e. $p \\geq 1 - \\alpha$, cela signifie que son modèle sous-estime le risque, ce qui peut conduire à une exigence de recalibrage ou une augmentation du capital réglementaire. Si une banque a trop peu d’exceptions (voire 0), i.e. $p \\leq 1 - \\alpha$, cela peut indiquer que son modèle est trop conservateur, ce qui immobilise trop de capital inutilement.\n \n- Puisqu'un seul test de backtesting n'est pas suffisant[2] pour juger la qualité d’un modèle de VaR, il serait  préférable  de  combiner  différentes  méthodes. Pour ce faire, un autre test a été utilisé pour juger de la necessité de recalibrage du modèle. Il s'agit du test de Christoffersen’s Interval Forecast/Independance test [3]. Ce test permet de vérifier si les exceptions sont indépendantes et donc bien réparties dans le temps. En effet, si les exceptions sont concentrées dans un intervalle de temps, cela peut indiquer que le modèle est mal calibré. Sous l'hypothèse nulle, la statistique de test suit asymptotiquement une loi de khi-deux à 1 degré de liberté. \n\n- En couplant le test de Kupiec au test de Christoffersen [3], nous avons le test de conditional coverage mixte[3] qui suit une loi de khi-deux à 2 degrés de liberté.\n\nPour la mise en place de ces tests statistiques, nous avons besoin d'une échantillon de taille suffisamment grande, i.e $N=30$. Pour ce faire, nous ne pourrons mettre en place ce protocole qu'à partir du 30ème jour de backtesting. Pour le backtest, nous avons fait le choix d'utiliser un expanding window, i.e. une fenêtre d'apprentissage qui s'agrandit à chaque période de recalibrage. Il aurait été plus pertinent de privilégier un rolling window, i.e. une fenêtre d'apprentissage qui se déplace à chaque période de recalibrage, pour éviter de bruiter les données.\n\n\nPROBLÈME : au bout de 30j, s'il n'y a pas d'exceptions, on ne recalibre pas le modèle mais si au 31e jour il y a une exception, le test de kupiec echoue=> recalibrage.\n***References***:\n- [1] Kupiec, P. \"Techniques for Verifying the Accuracy of Risk Management Models.\" Journal of Derivatives. Vol. 3, 1995, pp. 73–84.\n- [2] Haas, M. \"New Methods in Backtesting.\" Financial Engineering, Research Center Caesar, Bonn, 2001.\n- [3] Christoffersen, P. \"Evaluating Interval Forecasts.\" International Economic Review. Vol. 39, 1998, pp. 841–862.\n\n::: {#f9751825 .cell execution_count=43}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nfrom scipy.stats import chi2\n\nclass Backtest:\n    def __init__(self, actual, forecast, alpha, alpha_test):\n        self.index = actual.index\n        self.actual = actual.values\n        self.forecast = forecast\n        self.alpha = alpha\n        self.alpha_test = alpha_test\n\n    def hit_series(self):\n        \"\"\" Returns a series of 1s (VaR breaches) and 0s (no breach) \"\"\"\n        return (self.actual < - self.forecast).astype(int)\n    \n    def lr_bt(self):\n        \"\"\" Back-test protocol \"\"\"\n        hits = self.hit_series()  # Série des violations de la VaR (1 si violation, 0 sinon)\n        transitions = hits[1:] - hits[:-1]  # Différences entre valeurs successives (1 si passage de 0 à 1, -1 si passage de 1 à 0)\n\n        # Transition counts\n        n01 = np.sum(transitions == 1)  # 0 -> 1\n        n10 = np.sum(transitions == -1) # 1 -> 0\n        n11 = np.sum((transitions == 0) & (hits[1:] == 1)) # 1 -> 1\n        n00 = np.sum((transitions == 0) & (hits[1:] == 0)) # 0 -> 0\n        \n        # Number of observations in each state\n        n0, n1 = n01 + n00, n10 + n11\n        total_n = n0 + n1\n        \n        # Probability estimates\n        p01 = n01 / (n00 + n01) if (n00 + n01) > 0 else 0\n        p11 = n11 / (n11 + n10) if (n11 + n10) > 0 else 0\n        p = n1 / total_n if total_n > 0 else 0\n        \n        if n1 > 0:\n            #\n\n            # Unconditional Coverage Test/Kupiec\n            uc_h0 = n0 * np.log(1 - self.alpha) + n1 * np.log(self.alpha)\n            uc_h1 = n0 * np.log(1 - p) + n1 * np.log(p)\n            uc_stat = -2 * (uc_h0 - uc_h1)\n            # uc_critical_val = chi2.ppf(self.alpha_test, 1)\n            uc_pval = 1 - chi2.cdf(uc_stat, 1)\n            \n            # Independence Test/Christoffersen\n            ind_h0 = (n00 + n01) * np.log(1 - p) + (n01 + n11) * np.log(p)\n            ind_h1 = 0\n            if p01 > 0: ind_h1 += n01 * np.log(p01)\n            if (1 - p01) > 0: ind_h1 += n00 * np.log(1 - p01)\n            if p11 > 0: ind_h1 += n11 * np.log(p11)\n            if (1 - p11) > 0: ind_h1 += n10 * np.log(1 - p11)\n            ind_stat = -2 * (ind_h0 - ind_h1)\n            # ind_critical_val = chi2.ppf(self.alpha_test, 1)\n            ind_pval = 1 - chi2.cdf(ind_stat, 1)\n            \n            # Conditional Coverage Test/ Christoffersen & Kupiec mixture\n            cc_stat = uc_stat + ind_stat\n            # cc_critical_val = chi2.ppf(self.alpha_test, 2)\n            cc_pval = 1 - chi2.cdf(cc_stat, 2)\n            \n            # Store results in a DataFrame\n            df = pd.DataFrame({\n                \"Statistic\": [uc_stat, cc_stat, ind_stat],\n                # \"Critical Value\": [uc_critical_val, ind_critical_val, cc_critical_val],\n                \"p-value\": [uc_pval, cc_pval, ind_pval]\n            }, index=[\"Unconditional\", \"Conditional\",\"Independence\"])\n\n            binomial_test = stats.binomtest(n1, total_n, 1-self.alpha, alternative='two-sided')\n            df.loc[\"Binomial\"] = [binomial_test.statistic, binomial_test.pvalue]\n        else:\n            df = pd.DataFrame(np.nan, index=[\"Unconditional\", \"Conditional\", \"Independence\"], columns=[\"Statistic\", \"p-value\"])\n            binomial_test = stats.binomtest(n1, total_n, 1-self.alpha, alternative='two-sided')\n            df.loc[\"Binomial\"] = [binomial_test.statistic, binomial_test.pvalue]\n        \n        \n        return df\n```\n:::\n\n\n::: {#00b66711 .cell execution_count=44}\n``` {.python .cell-code}\ndef daily_backtest(actual, forecast, alpha=0.99, alpha_test = 0.95,min_days=30, max_days=250):\n    \"\"\" Runs a growing backtest daily, starting at min_days up to max_days \"\"\"\n    recalibration_needed = False\n    end_test = min(max_days,len(actual))\n    for end in range(min_days, end_test +1):\n        data_to_test = actual[:end]\n        var_to_test = forecast\n        if len(data_to_test) < 30:\n            continue\n        \n        bt = Backtest(actual=data_to_test, forecast=var_to_test, alpha=alpha, alpha_test=alpha_test)\n        result = bt.lr_bt()\n        \n        nb_exceptions = bt.hit_series().sum()\n        \n        # res=bootstrap((data_to_test,), statistic=lambda x: exceptions(x, var_to_test)/len(x), method='percentile', n_resamples=1000)\n        # ci_lower, ci_upper = res.confidence_interval\n\n        # if ci_lower <= 1-alpha <= ci_upper:\n        #     print(f\"Recalibration needed at {end} days: The conditional test failed.\")\n        #     recalibration_needed = True\n        #     return recalibration_needed, end\n\n        # if \"conditional\" in result.index and result.loc[\"Independence\", \"p-value\"] < 0.05:\n        #     print(f\"Recalibration needed at {end} days: The Independence test failed.\")\n        #     recalibration_needed = True\n        #     return recalibration_needed, end\n        # failed_tests = result.iloc[2:][result.iloc[2:][\"p-value\"] < 0.05].index.tolist()\n        failed_tests = result[result[\"p-value\"] < 0.05].index.tolist()\n\n        if failed_tests:\n            print(f\"Recalibration needed at {end} days: The following tests failed: {', '.join(failed_tests)}\")\n            recalibration_needed = True\n            return recalibration_needed, end\n            \n        if end == max_days and nb_exceptions == 0:\n            print(f\"Recalibration needed at {end} days: No exceptions observed in the test window.\")\n            recalibration_needed = True\n            return recalibration_needed, end\n    \n    if not recalibration_needed:\n        print(\"No recalibration needed in the tested period.\")\n```\n:::\n\n\n::: {#66855bba .cell execution_count=45}\n``` {.python .cell-code}\ndef iterative_backtest(data_train, data_test, var_model, alpha):\n    \"\"\" Runs an iterative backtest with recalibration \"\"\"\n    data_train = data_train.copy()\n    data_test = data_test.copy()\n\n    var_result = var_model(data_train, alpha=alpha)\n    var_to_test = var_result[0] if isinstance(var_result, (list, tuple)) else var_result \n    \n    recalibration_points = [0]\n    vars_stored = [var_to_test]\n    \n    while len(data_test) > 0 and len(data_test) >= 250:\n        print(\"=\"*80)\n        print(f\"Old VaR to test: {var_to_test:.4%}\")\n\n        # Run daily backtest correctly\n        res_backtest, index = daily_backtest(data_test, var_to_test, alpha=alpha, alpha_test=0.95, min_days=30, max_days=250)\n\n        # Find the index of recalibration\n        if res_backtest:\n            print(len(data_test))\n            recalibration_points.append(index)\n\n            # Expand training data and shrink test data\n            data_train = pd.concat([data_train, data_test.iloc[:index,]])\n            data_test = data_test.iloc[index:,]\n            var_result = var_model(data_train, alpha=alpha)\n            var_to_test = var_result[0] if isinstance(var_result, (list, tuple)) else var_result \n            vars_stored.append(var_to_test)\n\n            print(f\"New VaR to test: {var_to_test:.4%}\")\n        else:\n            print(\"No recalibration needed.\")\n            break\n\n    return recalibration_points, vars_stored\n\n# Execute iterative backtest\nrecalibration_points, vars_stored = iterative_backtest(data_train, data_test, gaussian_var_ewma, alpha=alpha)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n================================================================================\nOld VaR to test: 2.7763%\nRecalibration needed at 103 days: The following tests failed: Unconditional, Conditional\n586\nNew VaR to test: 2.5925%\n================================================================================\nOld VaR to test: 2.5925%\nRecalibration needed at 61 days: The following tests failed: Unconditional, Conditional\n483\nNew VaR to test: 2.6675%\n================================================================================\nOld VaR to test: 2.6675%\nRecalibration needed at 30 days: The following tests failed: Unconditional, Conditional\n422\nNew VaR to test: 1.8885%\n================================================================================\nOld VaR to test: 1.8885%\nRecalibration needed at 50 days: The following tests failed: Unconditional, Conditional\n392\nNew VaR to test: 2.5369%\n================================================================================\nOld VaR to test: 2.5369%\nRecalibration needed at 240 days: The following tests failed: Unconditional, Conditional\n342\nNew VaR to test: 2.7075%\n```\n:::\n:::\n\n\n::: {#fc763664 .cell execution_count=46}\n``` {.python .cell-code}\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nplt.figure(figsize=(12, 6))\ndata_test.reset_index(drop=True, inplace=True)\nplt.plot(data_test, label=\"Returns\", color='blue')\nrecab = np.cumsum(np.array(recalibration_points))\nvars_stored_neg = -np.array(vars_stored)\n\nplt.scatter(recab, vars_stored_neg, color='black', label=\"Recalibration points\", zorder=3)\nif len(recab) > 0:\n    plt.step(recab, vars_stored_neg, where='post', color='red', linestyle='solid', label=\"VaR Adjusted\")\n    plt.hlines(vars_stored_neg[-1], xmin=recab[-1], xmax=len(data_test), color='red', linestyle='solid')\n\nplt.xlabel(\"Time\")\nplt.ylabel(\"VaR / Returns\")\nplt.title(\"Backtesting VaR with Recalibration Points\")\nplt.legend()\nplt.grid(True)\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](var_classiques_files/figure-html/cell-47-output-1.png){}\n:::\n:::\n\n\n",
    "supporting": [
      "var_classiques_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}